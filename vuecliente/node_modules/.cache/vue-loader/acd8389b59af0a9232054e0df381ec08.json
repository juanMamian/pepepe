{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/visorNodoConocimiento/SeccionNodoConocimiento.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/visorNodoConocimiento/SeccionNodoConocimiento.vue","mtime":1648741729589},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CgppbXBvcnQgQXJjaGl2b1NlY2Npb25Ob2RvIGZyb20gIi4vYXJjaGl2b1NlY2Npb25Ob2RvLnZ1ZSI7CmltcG9ydCBMb2FkaW5nIGZyb20gIi4uL3V0aWxpZGFkZXMvTG9hZGluZy52dWUiOwppbXBvcnQgeyBjaGFyUHJvaGliaWRvc05vbWJyZUNvc2EgfSBmcm9tICIuLi9jb25maWdzIjsKaW1wb3J0IGdxbCBmcm9tICJncmFwaHFsLXRhZyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIGVzdGFTZWNjaW9uOiBPYmplY3QsCiAgICBpZE5vZG86IFN0cmluZywKICAgIHVzdWFyaW9FeHBlcnRvOiBCb29sZWFuLAogIH0sCiAgY29tcG9uZW50czogewogICAgQXJjaGl2b1NlY2Npb25Ob2RvLAogICAgTG9hZGluZywKICB9LAogIG5hbWU6ICJTZWNjaW9uTm9kb0Nvbm9jaW1pZW50byIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGVkaXRhbmRvOiBmYWxzZSwKICAgICAgc3ViaWVuZG9BcmNoaXZvOiBmYWxzZSwKICAgICAgdmVyc2lvbkFyY2hpdm86IDAsCgogICAgICBlZGl0YW5kb05vbWJyZTogZmFsc2UsCiAgICAgIGVudmlhbmRvTnVldm9Ob21icmU6IGZhbHNlLAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHN1YmlyQXJjaGl2b0NvbnRlbmlkbyhlKSB7CiAgICAgIGNvbnN0IGlucHV0QXJjaGl2byA9IGUudGFyZ2V0OwogICAgICB2YXIgZGF0b3MgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgY29uc3QgbnVldm9BcmNoaXZvID0gaW5wdXRBcmNoaXZvLmZpbGVzWzBdOwoKICAgICAgZGF0b3MuYXBwZW5kKCJudWV2b0FyY2hpdm8iLCBudWV2b0FyY2hpdm8pOwogICAgICBkYXRvcy5hcHBlbmQoImlkTm9kbyIsIHRoaXMuaWROb2RvKTsKICAgICAgZGF0b3MuYXBwZW5kKCJpZFNlY2Npb24iLCB0aGlzLmVzdGFTZWNjaW9uLmlkKTsKICAgICAgdGhpcy5zdWJpZW5kb0FyY2hpdm8gPSB0cnVlOwogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiB0aGlzLnNlcnZlclVybCArICIvYXBpL2F0bGFzL3N1YmlyQXJjaGl2b0NvbnRlbmlkb1NlY2Npb25Ob2RvIiwKICAgICAgICBkYXRhOiBkYXRvcywKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAiQ29udGVudC1UeXBlIjogIm11bHRpcGFydC9mb3JtLWRhdGEiLAogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgdGhpcy4kc3RvcmUuc3RhdGUudG9rZW4sCiAgICAgICAgfSwKICAgICAgfSkKICAgICAgICAudGhlbigoeyBkYXRhOiB7IGluZm9BcmNoaXZvIH0gfSkgPT4gewogICAgICAgICAgdGhpcy5zdWJpZW5kb0FyY2hpdm8gPSBmYWxzZTsKICAgICAgICAgIHRoaXMudmVyc2lvbkFyY2hpdm8rKzsKICAgICAgICAgIHRoaXMuJGVtaXQoInN1YmlBcmNoaXZvIiwgaW5mb0FyY2hpdm8pOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5zdWJpZW5kb0FyY2hpdm8gPSBmYWxzZTsKCiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3Igc3ViaWVuZG8gYXJjaGl2by4gRTogJHtlcnJvcn1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBpbmljaWFyRWRpY2lvbk5vbWJyZSgpIHsKICAgICAgdGhpcy4kcmVmcy5pbnB1dE51ZXZvTm9tYnJlLnZhbHVlID0gdGhpcy5lc3RhU2VjY2lvbi5ub21icmU7CiAgICAgIHRoaXMuZWRpdGFuZG9Ob21icmUgPSB0cnVlOwogICAgfSwKICAgIGd1YXJkYXJOdWV2b05vbWJyZSgpIHsKICAgICAgdmFyIG51ZXZvTm9tYnJlID0gdGhpcy4kcmVmcy5pbnB1dE51ZXZvTm9tYnJlLnZhbHVlLnRyaW0oKTsKICAgICAgaWYgKG51ZXZvTm9tYnJlID09IHRoaXMuZXN0YVNlY2Npb24ubm9tYnJlKSB7CiAgICAgICAgdGhpcy5lZGl0YW5kb05vbWJyZSA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKG51ZXZvTm9tYnJlLmxlbmd0aCA8IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGNoYXJQcm9oaWJpZG9zTm9tYnJlQ29zYS50ZXN0KG51ZXZvTm9tYnJlKSkgewogICAgICAgIGNvbnNvbGUubG9nKGBDYXJhY3RlcmVzIGlsZWdhbGVzYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zb2xlLmxvZyhgZ3VhcmRhbmRvIG51ZXZvIG5vbWJyZWApOwogICAgICB0aGlzLmVudmlhbmRvTnVldm9Ob21icmUgPSB0cnVlOwogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgKICAgICAgICAgICAgICAkaWROb2RvOiBJRCEKICAgICAgICAgICAgICAkaWRTZWNjaW9uOiBJRCEKICAgICAgICAgICAgICAkbnVldm9Ob21icmU6IFN0cmluZyEKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgZWRpdGFyTm9tYnJlU2VjY2lvbk5vZG9Db25vY2ltaWVudG8oCiAgICAgICAgICAgICAgICBpZE5vZG86ICRpZE5vZG8KICAgICAgICAgICAgICAgIGlkU2VjY2lvbjogJGlkU2VjY2lvbgogICAgICAgICAgICAgICAgbnVldm9Ob21icmU6ICRudWV2b05vbWJyZQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgIG5vbWJyZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBpZE5vZG86IHRoaXMuaWROb2RvLAogICAgICAgICAgICBpZFNlY2Npb246IHRoaXMuZXN0YVNlY2Npb24uaWQsCiAgICAgICAgICAgIG51ZXZvTm9tYnJlOiBudWV2b05vbWJyZSwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoZGF0YSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYGZpbiBkZSBsYSBtdXRhY2lvbi4gRGF0YTogJHtKU09OLnN0cmluZ2lmeShkYXRhKX0gYCk7CiAgICAgICAgICB0aGlzLmVudmlhbmRvTnVldm9Ob21icmUgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZWRpdGFuZG9Ob21icmUgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9OdWV2b05vbWJyZSA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yLiBFIDoke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICB9LAogIGNvbXB1dGVkOiB7CiAgICBkaXJlY2Npb25Ob2RvOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlcnZlclVybCArICIvYXNzZXRzQXRsYXMvY29udGVuaWRvc05vZG9zLyIgKyB0aGlzLmlkTm9kbzsKICAgIH0sCiAgICBhcmNoaXZvc09yZGVuYWRvcygpIHsKICAgICAgdmFyIGFyY2hpdm9zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmVzdGFTZWNjaW9uLmFyY2hpdm9zKSk7CiAgICAgIGFyY2hpdm9zLnNvcnQoKGEpID0+IHsKICAgICAgICBpZiAoYS5wcmltYXJpbykgcmV0dXJuIC0xOwogICAgICAgIHJldHVybiAwOwogICAgICB9KTsKICAgICAgcmV0dXJuIGFyY2hpdm9zOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["SeccionNodoConocimiento.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+FA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SeccionNodoConocimiento.vue","sourceRoot":"src/components/visorNodoConocimiento","sourcesContent":["<template>\n  <div class=\"seccionNodoConocimiento\">\n    <div class=\"contenedorControles\">\n      <div class=\"boton\" v-if=\"usuarioExperto || usuarioSuperadministrador\" @click=\"editando = !editando\">\n        <img src=\"@/assets/iconos/edit.svg\" alt=\"Editar\" />\n      </div>\n    </div>\n    <div id=\"zonaFront\" class=\"frontDeSeccion\" v-show=\"!editando\" :key=\"versionArchivo\">\n      <iframe\n        id=\"iframeSeccion\"\n        :src=\"direccionNodo + '/' + estaSeccion.id + '/?v=' + versionArchivo\"\n        v-if=\"estaSeccion.tipoPrimario && estaSeccion.tipoPrimario.substring(0,5)!='image'\"\n        frameborder=\"0\"\n      ></iframe>\n      <img\n      :src=\"direccionNodo + '/' + estaSeccion.id + '/?v=' + versionArchivo\"\n      v-if=\"estaSeccion.tipoPrimario && estaSeccion.tipoPrimario.substring(0,5)==='image'\"\n      />\n    </div>\n\n    <div id=\"zonaAdministracion\" v-if=\"usuarioExperto || usuarioSuperadministrador\" v-show=\"editando\">\n      <div id=\"nombre\" v-show=\"!editandoNombre\" @click=\"iniciarEdicionNombre\">\n        {{ estaSeccion.nombre }}\n      </div>\n      <input\n        v-show=\"editandoNombre\"\n        type=\"text\"\n        name=\"\"\n        :value=\"estaSeccion.nombre\"\n        id=\"inputNuevoNombre\"\n        ref=\"inputNuevoNombre\"\n        :class=\"{deshabilitado: enviandoNuevoNombre}\"\n        @blur=\"guardarNuevoNombre\"\n        @keypress.enter=\"guardarNuevoNombre\"\n      />\n      <loading texto=\"\" v-show=\"enviandoNuevoNombre\"/>\n      <div class=\"contenedorControles\">\n        <div\n          class=\"boton\"\n          title=\"Subir un archivo\"\n          @click=\"$refs.inputArchivoContenido.click()\"\n          v-show=\"!subiendoArchivo\"\n        >\n          <img src=\"@/assets/iconos/plusCircle.svg\" alt=\"Plus\" />\n        </div>\n        <loading texto=\"\" v-show=\"subiendoArchivo\" />\n\n        <div\n          class=\"boton\"\n          :title=\"\n            estaSeccion.modo === 'archivo'\n              ? 'Cambiar modo a enlace'\n              : 'Cambiar modo a archivo'\n          \"\n        >\n          <img\n            src=\"@/assets/iconos/file.svg\"\n            v-show=\"estaSeccion.modo === 'archivo'\"\n            alt=\"Archivo\"\n          />\n          <img\n            src=\"@/assets/iconos/link.svg\"\n            v-show=\"estaSeccion.modo === 'enlace'\"\n            alt=\"Archivo\"\n          />\n        </div>\n      </div>\n\n      <div id=\"listaArchivos\" v-show=\"estaSeccion.modo === 'archivo'\">\n        <input\n          type=\"file\"\n          class=\"inputArchivoContenido\"\n          ref=\"inputArchivoContenido\"\n          v-show=\"false\"\n          @change=\"subirArchivoContenido($event)\"\n        />\n        <archivo-seccion-nodo\n          :esteArchivo=\"archivo\"\n          :usuarioExperto=\"usuarioExperto\"\n          :idNodo=\"idNodo\"\n          :idSeccion=\"estaSeccion.id\"\n          v-for=\"archivo of archivosOrdenados\"\n          :key=\"archivo.id\"\n          @meElimine=\"$emit('archivoEliminado', archivo.nombre)\"\n          @soyPrimario=\"\n            $emit('tengoNuevoPrimario', archivo.nombre);\n            versionArchivo++;\n          \"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\n\nimport ArchivoSeccionNodo from \"./archivoSeccionNodo.vue\";\nimport Loading from \"../utilidades/Loading.vue\";\nimport { charProhibidosNombreCosa } from \"../configs\";\nimport gql from \"graphql-tag\";\n\nexport default {\n  props: {\n    estaSeccion: Object,\n    idNodo: String,\n    usuarioExperto: Boolean,\n  },\n  components: {\n    ArchivoSeccionNodo,\n    Loading,\n  },\n  name: \"SeccionNodoConocimiento\",\n  data() {\n    return {\n      editando: false,\n      subiendoArchivo: false,\n      versionArchivo: 0,\n\n      editandoNombre: false,\n      enviandoNuevoNombre: false,\n    };\n  },\n  methods: {\n    subirArchivoContenido(e) {\n      const inputArchivo = e.target;\n      var datos = new FormData();\n      const nuevoArchivo = inputArchivo.files[0];\n\n      datos.append(\"nuevoArchivo\", nuevoArchivo);\n      datos.append(\"idNodo\", this.idNodo);\n      datos.append(\"idSeccion\", this.estaSeccion.id);\n      this.subiendoArchivo = true;\n      axios({\n        method: \"post\",\n        url: this.serverUrl + \"/api/atlas/subirArchivoContenidoSeccionNodo\",\n        data: datos,\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: \"Bearer \" + this.$store.state.token,\n        },\n      })\n        .then(({ data: { infoArchivo } }) => {\n          this.subiendoArchivo = false;\n          this.versionArchivo++;\n          this.$emit(\"subiArchivo\", infoArchivo);\n        })\n        .catch((error) => {\n          this.subiendoArchivo = false;\n\n          console.log(`Error subiendo archivo. E: ${error}`);\n        });\n    },\n    iniciarEdicionNombre() {\n      this.$refs.inputNuevoNombre.value = this.estaSeccion.nombre;\n      this.editandoNombre = true;\n    },\n    guardarNuevoNombre() {\n      var nuevoNombre = this.$refs.inputNuevoNombre.value.trim();\n      if (nuevoNombre == this.estaSeccion.nombre) {\n        this.editandoNombre = false;\n        return;\n      }\n\n      if (nuevoNombre.length < 1) {\n        return;\n      }\n      if (charProhibidosNombreCosa.test(nuevoNombre)) {\n        console.log(`Caracteres ilegales`);\n        return;\n      }\n\n      console.log(`guardando nuevo nombre`);\n      this.enviandoNuevoNombre = true;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation (\n              $idNodo: ID!\n              $idSeccion: ID!\n              $nuevoNombre: String!\n            ) {\n              editarNombreSeccionNodoConocimiento(\n                idNodo: $idNodo\n                idSeccion: $idSeccion\n                nuevoNombre: $nuevoNombre\n              ) {\n                id\n                nombre\n              }\n            }\n          `,\n          variables: {\n            idNodo: this.idNodo,\n            idSeccion: this.estaSeccion.id,\n            nuevoNombre: nuevoNombre,\n          },\n        })\n        .then((data) => {\n          console.log(`fin de la mutacion. Data: ${JSON.stringify(data)} `);\n          this.enviandoNuevoNombre = false;\n          this.editandoNombre = false;\n        })\n        .catch((error) => {\n          this.enviandoNuevoNombre = false;\n          console.log(`Error. E :${error}`);\n        });\n    },\n  },\n  computed: {\n    direccionNodo: function () {\n      return this.serverUrl + \"/assetsAtlas/contenidosNodos/\" + this.idNodo;\n    },\n    archivosOrdenados() {\n      var archivos = JSON.parse(JSON.stringify(this.estaSeccion.archivos));\n      archivos.sort((a) => {\n        if (a.primario) return -1;\n        return 0;\n      });\n      return archivos;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.seccionNodoConocimiento {\n  width: 100%;  \n}\n#zonaFront{  \n  max-width:100vw;\n  margin: 5px auto;\n}\n#zonaFront iframe{\n  \n  width: 100%;\n}\n#zonaFront img{\n  max-width: 100%;\n  margin: 0px auto;\n  display:block;\n}\n#iframeSeccion {\n  width: 100%;\n  height: 100vh;\n}\n#zonaAdministracion {\n  width: min(500px, 90vw);\n  border-radius: 10px;\n  margin: 0px auto;\n  background-color: var(--paletaMain);\n  padding: 10px 0px;\n  min-height: 300px;\n}\n#nombre {\n  text-align: center;\n}\n#inputNuevoNombre {\n  display: block;\n  margin: 15px auto;\n  padding: 5px;\n  border-radius: 5px;\n  font-size: 16px;\n  color: rgb(48, 48, 48);\n}\n</style>\n"]}]}