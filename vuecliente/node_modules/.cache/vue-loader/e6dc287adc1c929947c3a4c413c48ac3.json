{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/LoginArea.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/LoginArea.vue","mtime":1644587546118},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nIGZyb20gIi4vdXRpbGlkYWRlcy9Mb2FkaW5nLnZ1ZSI7CmltcG9ydCBncWwgZnJvbSAnZ3JhcGhxbC10YWcnOwoKdmFyIGNoYXJQcm9oaWJpZG9zVXNlcm5hbWUgPSAvW15hLXpBLVowLTlfw7HDkV0vZzsKY29uc3QgbWluUGFzc3dvcmQgPSA2Owpjb25zdCBtaW5Vc2VybmFtZSA9IDQ7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkxvZ2luQXJlYSIsCiAgY29tcG9uZW50czogeyBMb2FkaW5nIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgcGFzc3dvcmQ6ICIiLAogICAgICBsb2dpbkZhaWw6IGZhbHNlLAogICAgICBsb2dpbkZhaWxNc2c6ICIiLAogICAgICBlbnZpYW5kb0RhdG9zOiBmYWxzZSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgdXN1YXJpb0NvbmVjdGFkbygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzdWFyaW8udXNlcm5hbWUgIT0gbnVsbCA/IHRydWUgOiBmYWxzZTsKICAgIH0sCiAgICBub21icmVVc3VhcmlvKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby51c2VybmFtZTsKICAgIH0sCiAgICBjb2xvclVzZXJuYW1lKCkgewogICAgICByZXR1cm4gewogICAgICAgIGNvbG9yOgogICAgICAgICAgY2hhclByb2hpYmlkb3NVc2VybmFtZS50ZXN0KHRoaXMudXNlcm5hbWUpIHx8CiAgICAgICAgICB0aGlzLnVzZXJuYW1lLmxlbmd0aCA8IG1pblVzZXJuYW1lCiAgICAgICAgICAgID8gInJlZCIKICAgICAgICAgICAgOiAiYmxhY2siLAogICAgICB9OwogICAgfSwKICAgIHBhc3NJbGVnYWwoKSB7CiAgICAgIGlmICh0aGlzLnBhc3N3b3JkLmxlbmd0aCA8IG1pblBhc3N3b3JkKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHVzZXJuYW1lSWxlZ2FsKCkgewogICAgICBpZiAoCiAgICAgICAgIXRoaXMudXNlcm5hbWUgfHwKICAgICAgICBjaGFyUHJvaGliaWRvc1VzZXJuYW1lLnRlc3QodGhpcy51c2VybmFtZSkgfHwKICAgICAgICB0aGlzLnVzZXJuYW1lLmxlbmd0aCA8IG1pblVzZXJuYW1lCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBpbmljaWFyU2VzaW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKGBJbmljaWFuZG8gbG9naW5gKTsKICAgICAgbGV0IGRpcyA9IHRoaXM7CgogICAgICB2YXIgcGFzc3dvcmQgPSB0aGlzLiRyZWZzLmlucHV0UGFzc3dvcmQudmFsdWU7CiAgICAgIHZhciB1c2VybmFtZSA9IHRoaXMuJHJlZnMuaW5wdXRVc2VybmFtZS52YWx1ZTsKCiAgICAgIGlmICh0aGlzLnBhc3N3b3JkLmxlbmd0aCA8IG1pblBhc3N3b3JkKSB7CiAgICAgICAgY29uc29sZS5sb2coYFBhc3N3b3JkIGlsZWdhbGApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKAogICAgICAgIGNoYXJQcm9oaWJpZG9zVXNlcm5hbWUudGVzdCh0aGlzLnVzZXJuYW1lKSB8fAogICAgICAgIHRoaXMudXNlcm5hbWUubGVuZ3RoIDwgbWluVXNlcm5hbWUKICAgICAgKSB7CiAgICAgICAgY29uc29sZS5sb2coYFVzZXJuYW1lIGlsZWdhbGApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5lbnZpYW5kb0RhdG9zID0gdHJ1ZTsKCiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5xdWVyeSh7CiAgICAgICAgICBxdWVyeTogZ3FsYAogICAgICAgICAgICBxdWVyeSAoJHVzZXJuYW1lOiBTdHJpbmchLCAkcGFzc3dvcmQ6IFN0cmluZyEpIHsKICAgICAgICAgICAgICBsb2dpbih1c2VybmFtZTogJHVzZXJuYW1lLCBwYXNzd29yZDogJHBhc3N3b3JkKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIHVzZXJuYW1lLAogICAgICAgICAgICBwYXNzd29yZCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoeyBkYXRhOiB7IGxvZ2luIH0gfSkgPT4gewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJsb2dlYXJzZSIsIGxvZ2luKTsKICAgICAgICAgIGRpcy4kcm91dGVyLnB1c2goIi8iKTsKCiAgICAgICAgICB0aGlzLmVudmlhbmRvRGF0b3MgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJvcn1gKTsKICAgICAgICAgIHRoaXMuZW52aWFuZG9EYXRvcyA9IGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgLy8gYXhpb3MKICAgICAgLy8gICAucG9zdCh0aGlzLnNlcnZlclVybCArICIvYXBpL3VzdWFyaW9zL2xvZ2luIiwgewogICAgICAvLyAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgIC8vICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZCwKICAgICAgLy8gICB9KQogICAgICAvLyAgIC50aGVuKGZ1bmN0aW9uIChyZXNwdWVzdGEpIHsKICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGBMb2dlYWRvYCk7CgogICAgICAvLyAgICAgaWYgKHJlc3B1ZXN0YS5kYXRhLnVzZXJuYW1lID09IGRpcy51c2VybmFtZSkgewogICAgICAvLyAgICAgICBkaXMuJHN0b3JlLmNvbW1pdCgibG9nZWFyc2UiLCByZXNwdWVzdGEuZGF0YS50b2tlbik7CiAgICAgIC8vICAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gZGlzLmNsaWVudGVVcmw7CiAgICAgIC8vICAgICAgIGRpcy5lbnZpYW5kb0RhdG9zID0gZmFsc2U7CiAgICAgIC8vICAgICAgIGRpcy4kcm91dGVyLnB1c2goIi8iKTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICB9KQogICAgICAvLyAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgLy8gICAgIGRpcy5lbnZpYW5kb0RhdG9zID0gZmFsc2U7CiAgICAgIC8vICAgICBkaXMuJHN0b3JlLmNvbW1pdCgiZGVzbG9nZWFyc2UiKTsKCiAgICAgIC8vICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcikgewogICAgICAvLyAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvciA9PSAiYmFkTG9naW4iKSB7CiAgICAgIC8vICAgICAgICAgZGlzLmxvZ2luRmFpbCA9IHRydWU7CiAgICAgIC8vICAgICAgICAgZGlzLmxvZ2luRmFpbE1zZyA9ICJEYXRvcyBpbnbDoWxpZG9zIjsKICAgICAgLy8gICAgICAgICByZXR1cm47CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgICAgaWYgKGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3IgPT0gInNlYmFzdGlhbiIpIHsKICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhgVXN1YXJpbyBibG9xdWVhZG8gdGVtcG9yYWxtZW50ZWApOwogICAgICAvLyAgICAgICB9CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2UuZGF0YS5tc2pVc3VhcmlvKSB7CiAgICAgIC8vICAgICAgIGFsZXJ0KGVycm9yLnJlc3BvbnNlLmRhdGEubXNqVXN1YXJpbyk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgIC8vICAgfSk7CiAgICB9LAogICAgZGVzbG9nZWFyc2U6IGZ1bmN0aW9uICgpIHsKICAgICAgLy9Mb2dvdXQgZW4gdnVleCB5IGVuIGFwb2xsbwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoImRlc2xvZ2VhcnNlIik7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdGhpcy5jbGllbnRlVXJsOwoKICAgICAgLy8vLy8vLy8vCiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["LoginArea.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"LoginArea.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"loginArea\">\n    <div id=\"ventanaCentral\">\n      <form>\n        <p id=\"tituloVentana\">¡Bienvenidx!</p>\n        <br />\n        <div class=\"instruccion\">Escribe tus datos de login</div>\n        <input\n          type=\"text\"\n          name=\"username\"\n          :style=\"colorUsername\"\n          v-model=\"username\"\n          ref=\"inputUsername\"\n          placeholder=\"Nombre de usuario\"\n          class=\"inputs\"\n          @input=\"loginFail = false\"\n        />\n        <br />\n        <input\n          type=\"password\"\n          name=\"password\"\n          ref=\"inputPassword\"\n          class=\"inputs\"\n          v-model=\"password\"\n          placeholder=\"password\"\n          @input=\"loginFail = false\"\n          @keypress.enter=\"iniciarSesion\"\n        />\n        <br />\n        <br />\n        <loading v-show=\"enviandoDatos\" :texto=\"'Conectando...'\" />\n        <div\n          class=\"botonEnviar\"\n          @click.stop.prevent=\"iniciarSesion\"\n          :class=\"{\n            loginFail,\n            desaparecido: enviandoDatos,\n            deshabilitado: passIlegal,\n          }\"\n        >\n          {{ loginFail ? loginFailMsg : \"Ingresar\" }}\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Loading from \"./utilidades/Loading.vue\";\nimport gql from 'graphql-tag';\n\nvar charProhibidosUsername = /[^a-zA-Z0-9_ñÑ]/g;\nconst minPassword = 6;\nconst minUsername = 4;\n\nexport default {\n  name: \"LoginArea\",\n  components: { Loading },\n  data() {\n    return {\n      username: \"\",\n      password: \"\",\n      loginFail: false,\n      loginFailMsg: \"\",\n      enviandoDatos: false,\n    };\n  },\n  computed: {\n    usuarioConectado() {\n      return this.$store.state.usuario.username != null ? true : false;\n    },\n    nombreUsuario() {\n      return this.$store.state.usuario.username;\n    },\n    colorUsername() {\n      return {\n        color:\n          charProhibidosUsername.test(this.username) ||\n          this.username.length < minUsername\n            ? \"red\"\n            : \"black\",\n      };\n    },\n    passIlegal() {\n      if (this.password.length < minPassword) {\n        return true;\n      }\n      return false;\n    },\n    usernameIlegal() {\n      if (\n        !this.username ||\n        charProhibidosUsername.test(this.username) ||\n        this.username.length < minUsername\n      ) {\n        return true;\n      }\n      return false;\n    },\n  },\n  methods: {\n    iniciarSesion: function () {\n      console.log(`Iniciando login`);\n      let dis = this;\n\n      var password = this.$refs.inputPassword.value;\n      var username = this.$refs.inputUsername.value;\n\n      if (this.password.length < minPassword) {\n        console.log(`Password ilegal`);\n        return;\n      }\n\n      if (\n        charProhibidosUsername.test(this.username) ||\n        this.username.length < minUsername\n      ) {\n        console.log(`Username ilegal`);\n        return;\n      }\n\n      this.enviandoDatos = true;\n\n      this.$apollo\n        .query({\n          query: gql`\n            query ($username: String!, $password: String!) {\n              login(username: $username, password: $password)\n            }\n          `,\n          variables: {\n            username,\n            password,\n          },\n        })\n        .then(({ data: { login } }) => {\n          this.$store.commit(\"logearse\", login);\n          dis.$router.push(\"/\");\n\n          this.enviandoDatos = false;\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n          this.enviandoDatos = false;\n        });\n\n      // axios\n      //   .post(this.serverUrl + \"/api/usuarios/login\", {\n      //     username: this.username,\n      //     password: this.password,\n      //   })\n      //   .then(function (respuesta) {\n      //     console.log(`Logeado`);\n\n      //     if (respuesta.data.username == dis.username) {\n      //       dis.$store.commit(\"logearse\", respuesta.data.token);\n      //       // window.location.href = dis.clienteUrl;\n      //       dis.enviandoDatos = false;\n      //       dis.$router.push(\"/\");\n      //     }\n      //   })\n      //   .catch(function (error) {\n      //     dis.enviandoDatos = false;\n      //     dis.$store.commit(\"deslogearse\");\n\n      //     if (error.response && error.response.data.error) {\n      //       if (error.response.data.error == \"badLogin\") {\n      //         dis.loginFail = true;\n      //         dis.loginFailMsg = \"Datos inválidos\";\n      //         return;\n      //       }\n      //       if (error.response.data.error == \"sebastian\") {\n      //         console.log(`Usuario bloqueado temporalmente`);\n      //       }\n      //     }\n      //     if (error.response && error.response.data.msjUsuario) {\n      //       alert(error.response.data.msjUsuario);\n      //     }\n      //     console.log(`error: ${error}`);\n      //   });\n    },\n    deslogearse: function () {\n      //Logout en vuex y en apollo\n      this.$store.commit(\"deslogearse\");\n      window.location.href = this.clienteUrl;\n\n      /////////\n    },\n  },\n};\n</script>\n\n<style scoped>\n#tituloVentana {\n  font-size: 35px;\n  margin: 5px auto;\n  text-align: center;\n  font-family: sans-serif;\n}\n.instruccion {\n  font-size: 18;\n  text-align: center;\n  margin: 40px 0px;\n  margin-bottom: 0px;\n}\n.inputs {\n  font-size: 20px;\n  padding: 10px 20px;\n  border-radius: 10px;\n  margin-right: auto;\n  margin-left: auto;\n  margin-top: 15px;\n  display: block;\n}\n#ventanaCentral {\n  margin: 5% auto;\n  padding: 20px;\n  width: min(550px, 90%);\n}\n.botonEnviar {\n  width: min(300px, 90vw);\n  text-align: center;\n  display: block;\n  margin-left: auto;\n  margin-right: auto;\n  font-size: 20px;\n  padding: 15px 5px;\n  background-color: var(--mainColor);\n  border-radius: 30px;\n  cursor: pointer;\n}\n.loginFail {\n  color: red;\n  pointer-events: none;\n  opacity: 0.5;\n  font-style: italic;\n  font-size: 12px;\n}\n.desaparecido {\n  display: none;\n  pointer-events: none;\n}\n</style>"]}]}