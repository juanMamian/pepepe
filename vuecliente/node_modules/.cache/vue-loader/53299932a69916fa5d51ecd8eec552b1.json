{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/atlasConocimiento/AtlasConocimiento.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/atlasConocimiento/AtlasConocimiento.vue","mtime":1676563818636},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwppbXBvcnQgTm9kb0Nvbm9jaW1pZW50byBmcm9tICIuL05vZG9Db25vY2ltaWVudG8udnVlIjsKaW1wb3J0IEJ1c2NhZG9yTm9kb3NDb25vY2ltaWVudG8gZnJvbSAiLi9CdXNjYWRvck5vZG9zQ29ub2NpbWllbnRvLnZ1ZSI7CmltcG9ydCBMb2FkaW5nIGZyb20gIi4uL3V0aWxpZGFkZXMvTG9hZGluZy52dWUiOwppbXBvcnQgUGFuZWxDb25qdW50b3NOb2RvcyBmcm9tICIuL1BhbmVsQ29uanVudG9zTm9kb3MudnVlIjsKaW1wb3J0IEVubGFjZXNOb2RvQ29ub2NpbWllbnRvIGZyb20gIi4vRW5sYWNlc05vZG9Db25vY2ltaWVudG8udnVlIjsKaW1wb3J0IHsgZnJhZ21lbnRvRGF0b05vZG9Db25vY2ltaWVudG8gfSBmcm9tICIuL2ZyYWdzQXRsYXNDb25vY2ltaWVudG8iOwppbXBvcnQgUGllUHJvZ3Jlc28gZnJvbSAiLi4vdXRpbGlkYWRlcy9QaWVQcm9ncmVzby52dWUiOwpjb25zdCBkZWJvdW5jZSA9IHJlcXVpcmUoImRlYm91bmNlIik7CgpleHBvcnQgY29uc3QgZnJhZ21lbnRvQ29sZWNjaW9uZXMgPSBncWxgCiAgZnJhZ21lbnQgZnJhZ0NvbGVjY2lvbmVzIG9uIENvbGVjY2lvbk5vZG9zQXRsYXNDb25vY2ltaWVudG8gewogICAgaWQKICAgIG5vbWJyZQogICAgaWRzTm9kb3MKICAgIG5vZG9zIHsKICAgICAgaWQKICAgICAgbm9tYnJlCiAgICB9CiAgfQpgOwoKY29uc3QgZnJhZ21lbnRvTm9kb0Nvbm9jaW1pZW50byA9IGdxbGAKICBmcmFnbWVudCBmcmFnTm9kb0Nvbm9jaW1pZW50byBvbiBOb2RvQ29ub2NpbWllbnRvIHsKICAgIGlkCiAgICBub21icmUKICAgIGRlc2NyaXBjaW9uCiAgICBleHBlcnRvcwogICAgdGlwb05vZG8KICAgIGNsYXNlcyB7CiAgICAgIGlkCiAgICAgIG5vbWJyZQogICAgICBpZEV4cGVydG8KICAgICAgaW50ZXJlc2Fkb3MKICAgIH0KICAgIGNvb3Jkc01hbnVhbGVzIHsKICAgICAgeAogICAgICB5CiAgICB9CiAgICBjb29yZHMgewogICAgICB4CiAgICAgIHkKICAgIH0KICAgIGF1dG9Db29yZHMgewogICAgICB4CiAgICAgIHkKICAgIH0KICAgIGNlbnRyb01hc2EgewogICAgICB4CiAgICAgIHkKICAgIH0KICAgIHN0dWNrCiAgICBhbmd1bG8KICAgIHB1bnRhamUKICAgIHZpbmN1bG9zIHsKICAgICAgaWQKICAgICAgaWRSZWYKICAgICAgcm9sCiAgICAgIHRpcG8KICAgIH0KICAgIGZ1ZXJ6YUNlbnRyb01hc2EgewogICAgICBmdWVyemEKICAgICAgZGlyZWNjaW9uCiAgICB9CiAgICBmdWVyemFDb2xpc2lvbiB7CiAgICAgIGZ1ZXJ6YQogICAgICBkaXJlY2Npb24KICAgIH0KICB9CmA7Cgpjb25zdCBRVUVSWV9OT0RPUyA9IGdxbGAKICBxdWVyeSB0b2Rvc05vZG9zIHsKICAgIHRvZG9zTm9kb3MgewogICAgICAuLi5mcmFnTm9kb0Nvbm9jaW1pZW50bwogICAgfQogIH0KICAke2ZyYWdtZW50b05vZG9Db25vY2ltaWVudG99CmA7CgpleHBvcnQgY29uc3QgUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUyA9IGdxbGAKICBxdWVyeSB7CiAgICB5byB7CiAgICAgIGlkCiAgICAgIGF0bGFzIHsKICAgICAgICBkYXRvc05vZG9zIHsKICAgICAgICAgIC4uLmZyYWdEYXRvTm9kb0Nvbm9jaW1pZW50bwogICAgICAgIH0KICAgICAgICBjb25maWd1cmFjaW9uIHsKICAgICAgICAgIG1vZG8KICAgICAgICB9CiAgICAgICAgY29sZWNjaW9uZXMgewogICAgICAgICAgLi4uZnJhZ0NvbGVjY2lvbmVzCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogICR7ZnJhZ21lbnRvRGF0b05vZG9Db25vY2ltaWVudG99CiAgJHtmcmFnbWVudG9Db2xlY2Npb25lc30KYDsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBOb2RvQ29ub2NpbWllbnRvLAogICAgQnVzY2Fkb3JOb2Rvc0Nvbm9jaW1pZW50bywKICAgIExvYWRpbmcsCiAgICBQYW5lbENvbmp1bnRvc05vZG9zLAogICAgRW5sYWNlc05vZG9Db25vY2ltaWVudG8sCiAgICBQaWVQcm9ncmVzbywKICB9LAogIG5hbWU6ICJBdGxhc0Nvbm9jaW1pZW50byIsCiAgYXBvbGxvOiB7CiAgICB0b2Rvc05vZG9zOiB7CiAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPUywKICAgICAgcmVzdWx0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kaWJ1amFyVmluY3Vsb3NHcmlzZXMoKTsKICAgICAgfSwKICAgICAgdXBkYXRlKHsgdG9kb3NOb2RvcyB9KSB7CiAgICAgICAgdGhpcy5ub2Rvc0Rlc2NhcmdhZG9zID0gdHJ1ZTsKICAgICAgICB2YXIgbnVldm9Ub2Rvc05vZG9zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0b2Rvc05vZG9zKSk7CiAgICAgICAgbnVldm9Ub2Rvc05vZG9zLmZvckVhY2goKG5vZG8pID0+IHsKICAgICAgICAgIG5vZG8uY29vcmRzTWFudWFsZXMgPSBub2RvLmF1dG9Db29yZHM7CiAgICAgICAgICBub2RvLmNvb3JkcyA9IG5vZG8uYXV0b0Nvb3JkczsKICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgaWRMYXN0Tm9kb1RhcmdldCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKAogICAgICAgICAgImF0bGFzQ29ub2NpbWllbnRvSWRMYXN0Tm9kb1RhcmdldCIKICAgICAgICApOwoKICAgICAgICBpZiAoaWRMYXN0Tm9kb1RhcmdldCkgewogICAgICAgICAgY29uc3Qgbm9kb0xhc3QgPSB0b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT09IGlkTGFzdE5vZG9UYXJnZXQpOwogICAgICAgICAgaWYgKG5vZG9MYXN0KSB7CiAgICAgICAgICAgIHRoaXMuaWROb2RvVGFyZ2V0ID0gbm9kb0xhc3QuaWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWV2b1RvZG9zTm9kb3M7CiAgICAgIH0sCiAgICAgIGZldGNoUG9saWN5OiAiY2FjaGUtZmlyc3QiLAogICAgfSwKICAgIHlvOiB7CiAgICAgIHF1ZXJ5OiBRVUVSWV9EQVRPU19VU1VBUklPX05PRE9TLAogICAgICBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy51c3VhcmlvTG9nZWFkbyB8fCB0aGlzLnRvZG9zTm9kb3MubGVuZ3RoIDwgMTsKICAgICAgfSwKICAgICAgdXBkYXRlKHsgeW8gfSkgewogICAgICAgIGNvbnN0IGlkTGFzdENvbGVjY2lvblRhcmdldCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKAogICAgICAgICAgImF0bGFzQ29ub2NpbWllbnRvSWRMYXN0Q29sZWNjaW9uVGFyZ2V0IgogICAgICAgICk7CgogICAgICAgIGNvbnNvbGUubG9nKGBJRCBsYXN0Q29sZWNjaW9uVGFyZ2V0OiAke2lkTGFzdENvbGVjY2lvblRhcmdldH1gKTsKCiAgICAgICAgaWYgKGlkTGFzdENvbGVjY2lvblRhcmdldCAmJiB5by5hdGxhcz8uY29sZWNjaW9uZXMpIHsKICAgICAgICAgIGNvbnN0IGNvbGVjY2lvbkxhc3QgPSB5by5hdGxhcz8uY29sZWNjaW9uZXMuZmluZCgKICAgICAgICAgICAgKGNvbCkgPT4gY29sLmlkID09PSBpZExhc3RDb2xlY2Npb25UYXJnZXQKICAgICAgICAgICk7CiAgICAgICAgICBpZiAoY29sZWNjaW9uTGFzdCkgewogICAgICAgICAgICB0aGlzLmlkQ29sZWNjaW9uU2VsZWNjaW9uYWRhID0gY29sZWNjaW9uTGFzdC5pZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHlvOwogICAgICB9LAogICAgfSwKICAgIGNvbmZpZ3VyYWNpb25BdGxhczogewogICAgICBxdWVyeTogZ3FsYAogICAgICAgIHF1ZXJ5ICgkbm9tYnJlQXRsYXM6IFN0cmluZyEpIHsKICAgICAgICAgIGNvbmZpZ3VyYWNpb25BdGxhcyhub21icmVBdGxhczogJG5vbWJyZUF0bGFzKSB7CiAgICAgICAgICAgIGlkCiAgICAgICAgICAgIHBvc2ljaW9uYW5kbwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgYCwKICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgbm9tYnJlQXRsYXM6ICJjb25vY2ltaWVudG8iLAogICAgICB9LAogICAgICBmZXRjaFBvbGljeTogIm5ldHdvcmstb25seSIsCiAgICB9LAogICAgcHJvZ3Jlc29Ob2RvVGFyZ2V0OiB7CiAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgcXVlcnkgKCRpZE5vZG86IElEISkgewogICAgICAgICAgbm9kbyhpZE5vZG86ICRpZE5vZG8pIHsKICAgICAgICAgICAgaWQKICAgICAgICAgICAgcG9yY2VudGFqZUNvbXBsZXRhZG8KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIGAsCiAgICAgIHZhcmlhYmxlcygpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWROb2RvOiB0aGlzLmlkTm9kb1RhcmdldCwKICAgICAgICB9OwogICAgICB9LAogICAgICBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy5pZE5vZG9UYXJnZXQ7CiAgICAgIH0sCiAgICAgIHVwZGF0ZSh7IG5vZG8gfSkgewogICAgICAgIHJldHVybiBub2RvLnBvcmNlbnRhamVDb21wbGV0YWRvOwogICAgICB9LAogICAgfSwKICAgIHByb2dyZXNvQ29sZWNjaW9uU2VsZWNjaW9uYWRhOiB7CiAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgcXVlcnkgKCRpZENvbGVjY2lvbjogSUQhLCAkaWRVc3VhcmlvOiBJRCEpIHsKICAgICAgICAgIGNvbGVjY2lvbk5vZG9zQ29ub2NpbWllbnRvKAogICAgICAgICAgICBpZENvbGVjY2lvbjogJGlkQ29sZWNjaW9uCiAgICAgICAgICAgIGlkVXN1YXJpbzogJGlkVXN1YXJpbwogICAgICAgICAgKSB7CiAgICAgICAgICAgIGlkCiAgICAgICAgICAgIHByb2dyZXNvCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICBgLAogICAgICB2YXJpYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlkQ29sZWNjaW9uOiB0aGlzLmlkQ29sZWNjaW9uU2VsZWNjaW9uYWRhLAogICAgICAgICAgaWRVc3VhcmlvOiB0aGlzLnVzdWFyaW8uaWQsCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgdXBkYXRlKHsgY29sZWNjaW9uTm9kb3NDb25vY2ltaWVudG8gfSkgewogICAgICAgIHJldHVybiBjb2xlY2Npb25Ob2Rvc0Nvbm9jaW1pZW50by5wcm9ncmVzbzsKICAgICAgfSwKICAgICAgc2tpcCgpIHsKICAgICAgICByZXR1cm4gIXRoaXMuaWRDb2xlY2Npb25TZWxlY2Npb25hZGE7CiAgICAgIH0sCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbmZpZ3VyYWNpb25BdGxhczogewogICAgICAgIHBvc2ljaW9uYW5kbzogZmFsc2UsCiAgICAgIH0sCiAgICAgIGhvdmVyZWQ6IGZhbHNlLAogICAgICB0b2Rvc05vZG9zOiBbXSwKICAgICAgbm9kb3NEZXNjYXJnYWRvczogZmFsc2UsCiAgICAgIHBvc2ljaW9uQ3JlYW5kb05vZG86IG51bGwsCiAgICAgIGlkTm9kb1NlbGVjY2lvbmFkbzogbnVsbCwKICAgICAgaWRzTm9kb3NDYWRlbmFQcmV2aWFTZWxlY2Npb25hZG86IFtdLAogICAgICBpZE5vZG9NZW51Q3g6IG51bGwsCiAgICAgIGlkc05lY2VzYXJpb3NQYXJhVGFyZ2V0OiBbXSwKICAgICAgZW52aWFuZG9RdWVyeU1vZG86IGZhbHNlLAogICAgICBtb2RvQXRsYXM6ICJlc3R1ZGlhbnRlIiwKICAgICAgZW52aWFuZG9RdWVyeVRhcmdldDogZmFsc2UsCgogICAgICByZWRpYnVqYXJFbmxhY2VzTm9kb3M6IDAsCgogICAgICB5bzogewogICAgICAgIGF0bGFzOiB7CiAgICAgICAgICBkYXRvc05vZG9zOiBbXSwKICAgICAgICAgIGNvbmZpZ3VyYWNpb246IHsKICAgICAgICAgICAgbW9kbzogImVzdHVkaWFudGUiLAogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICB9LAoKICAgICAgY2VudHJvVmlzdGFEZWNpbWFsOiB7CiAgICAgICAgeDogMjE4LAogICAgICAgIHk6IDM5LAogICAgICB9LAogICAgICBzaG93aW5nWm9vbUluZm86IGZhbHNlLAogICAgICB6b29tOiA4MCwKICAgICAgbWluWm9vbTogMjAsCiAgICAgIG1heFpvb206IDIwMCwKICAgICAgcGluY2hpbmc6IGZhbHNlLAogICAgICBsYXN0UGluY2hEaXN0YW5jZTogMCwKICAgICAgYWN0dWFsaXphclRyYXpvczogMCwKICAgICAgcGFubmluZ1Zpc3RhOiBmYWxzZSwKICAgICAgdmlzdGFQYW5uZWQ6IGZhbHNlLAoKICAgICAgYWN0dWFsaXphclZpbmN1bG9zR3Jpc2VzOiAwLAoKICAgICAgdWx0aW1vVG91Y2hYOiAwLAogICAgICB1bHRpbW9Ub3VjaFk6IDAsCgogICAgICBjZXJyYXJCdXNxdWVkYTogMCwKCiAgICAgIGNhbGxpbmdQb3NpY2lvbmVzOiBmYWxzZSwKCiAgICAgIG1vc3RyYW5kb01lbnVDb250ZXh0dWFsOiBmYWxzZSwKICAgICAgb2Zmc2V0TWVudUNvbnRleHR1YWw6IHsKICAgICAgICB0b3A6ICIwcHgiLAogICAgICAgIGxlZnQ6ICIwcHgiLAogICAgICB9LAogICAgICBlbnZpYW5kb1F1ZXJ5Q29uZmlndXJhY2lvbkF0bGFzOiBmYWxzZSwKCiAgICAgIGlkQ29sZWNjaW9uU2VsZWNjaW9uYWRhOiBudWxsLAogICAgICBzZWxlY2Npb25hbmRvQ29sZWNjaW9uOiBmYWxzZSwKICAgICAgbW9zdHJhbmRvT3BjaW9uZXNDb2xlY2Npb246IGZhbHNlLAoKICAgICAgaW5kZXhMYXN0TG9jYXRlTmV4dEF2YWlsYWJsZTogMCwKICAgICAgaW5kZXhMYXN0TG9jYXRlTmV4dENoZWNrOiAwLAogICAgICBpbmRleExhc3RMb2NhdGVOZXh0UmVwYXNvOiAwLAoKICAgICAgaWRDb2xlY2Npb25UYXJnZXRPbkxhc3RMb2NhbGl6YWNpb246IG51bGwsCgogICAgICBpZE5vZG9UYXJnZXQ6IG51bGwsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIG5vbWJyZUNvbGVjY2lvblNlbGVjY2lvbmFkYSgpIHsKICAgICAgaWYgKCF0aGlzLmlkQ29sZWNjaW9uU2VsZWNjaW9uYWRhKSB7CiAgICAgICAgcmV0dXJuICJBdGxhcyI7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmNvbGVjY2lvblNlbGVjY2lvbmFkYT8ubm9tYnJlIHx8ICJDYXJnYW5kbyI7CiAgICB9LAogICAgY29sZWNjaW9uU2VsZWNjaW9uYWRhKCkgewogICAgICBpZiAoIXRoaXMuaWRDb2xlY2Npb25TZWxlY2Npb25hZGEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5jb2xlY2Npb25lc1VzdWFyaW8uZmluZCgKICAgICAgICAoY29sKSA9PiBjb2wuaWQgPT09IHRoaXMuaWRDb2xlY2Npb25TZWxlY2Npb25hZGEKICAgICAgKTsKICAgIH0sCiAgICBjb2xlY2Npb25lc1VzdWFyaW8oKSB7CiAgICAgIGlmICghdGhpcy55bz8uYXRsYXM/LmNvbGVjY2lvbmVzKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5jb2xlY2Npb25lczsKICAgIH0sCiAgICBpZHNOb2Rvc09iamV0aXZvcygpIHsKICAgICAgaWYgKCF0aGlzLnlvIHx8ICF0aGlzLnlvLmF0bGFzIHx8ICF0aGlzLnlvLmF0bGFzLmRhdG9zTm9kb3MpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMueW8uYXRsYXMuZGF0b3NOb2RvcwogICAgICAgIC5maWx0ZXIoKG4pID0+IG4ub2JqZXRpdm8gPT0gdHJ1ZSkKICAgICAgICAubWFwKChuKSA9PiBuLmlkTm9kbyk7CiAgICB9LAogICAgbm9kb3NPYmpldGl2bygpIHsKICAgICAgaWYgKCF0aGlzLnRvZG9zTm9kb3MpIHJldHVybiBbXTsKICAgICAgcmV0dXJuIHRoaXMudG9kb3NOb2Rvcy5maWx0ZXIoKG4pID0+CiAgICAgICAgdGhpcy5pZHNOb2Rvc09iamV0aXZvcy5pbmNsdWRlcyhuLmlkKQogICAgICApOwogICAgfSwKICAgIG5vZG9TZWxlY2Npb25hZG86IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLmlkTm9kb1NlbGVjY2lvbmFkbykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnRvZG9zTm9kb3MuZmluZCgobikgPT4gbi5pZCA9PT0gdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8pOwogICAgfSwKICAgIGlkVXN1YXJpbzogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5pZDsKICAgIH0sCiAgICB1c3VhcmlvQWRtaW5pc3RyYWRvckF0bGFzOiBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5wZXJtaXNvcykgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5wZXJtaXNvcy5pbmNsdWRlcygiYXRsYXNBZG1pbmlzdHJhZG9yIikKICAgICAgICA/IHRydWUKICAgICAgICA6IGZhbHNlOwogICAgfSwKCiAgICBub2RvVGFyZ2V0KCkgewogICAgICBpZiAoIXRoaXMuaWROb2RvVGFyZ2V0KSByZXR1cm4gbnVsbDsKICAgICAgcmV0dXJuIHRoaXMudG9kb3NOb2Rvcy5maW5kKChuKSA9PiBuLmlkID09PSB0aGlzLmlkTm9kb1RhcmdldCk7CiAgICB9LAogICAgaWRzTm9kb3NBcHJlbmRpZG9zKCkgewogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5kYXRvc05vZG9zCiAgICAgICAgLmZpbHRlcigobikgPT4gbi5hcHJlbmRpZG8gPT09IHRydWUpCiAgICAgICAgLm1hcCgobikgPT4gbi5pZE5vZG8pOwogICAgfSwKICAgIGRhdG9zTm9kb3NFc3R1ZGlhZG9zKCkgewogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5kYXRvc05vZG9zLmZpbHRlcigKICAgICAgICAobikgPT4gIW4uYXByZW5kaWRvICYmIG4uZXN0dWRpYWRvCiAgICAgICk7CiAgICB9LAogICAgaWRzTm9kb3NFc3R1ZGlhZG9zKCkgewogICAgICByZXR1cm4gdGhpcy5kYXRvc05vZG9zRXN0dWRpYWRvcy5tYXAoKG5lKSA9PiBuZS5pZE5vZG8pOwogICAgfSwKICAgIGRhdG9zTm9kb3NSZXBhc2FyKCkgewogICAgICBpZiAoIXRoaXMueW8gfHwgIXRoaXMueW8uYXRsYXMgfHwgIXRoaXMueW8uYXRsYXMuZGF0b3NOb2RvcykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQoKICAgICAgdmFyIGRhdG9zTm9kb0NvblJlcGFzb0NvbmZpZ3VyYWRvID0gdGhpcy5kYXRvc05vZG9zRXN0dWRpYWRvcy5maWx0ZXIoCiAgICAgICAgKGRuKSA9PiBkbi5wZXJpb2RvUmVwYXNvCiAgICAgICk7CiAgICAgIGxldCBkYXRlSG95ID0gbmV3IERhdGUoKTsKCiAgICAgIGxldCBkYXRlSG95TWluID0gZGF0ZUhveTsKICAgICAgZGF0ZUhveU1pbi5zZXRIb3VycygwKTsKICAgICAgZGF0ZUhveU1pbi5zZXRNaW51dGVzKDApOwogICAgICBkYXRlSG95TWluLnNldFNlY29uZHMoMCk7CgogICAgICBsZXQgZGF0b3NOb2RvUGFyYVJlcGFzYXIgPSBkYXRvc05vZG9Db25SZXBhc29Db25maWd1cmFkby5maWx0ZXIoKGRuKSA9PiB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIG5ldyBEYXRlKGRuLmVzdHVkaWFkbykuZ2V0VGltZSgpICsgZG4ucGVyaW9kb1JlcGFzbyA8CiAgICAgICAgICBkYXRlSG95TWluLmdldFRpbWUoKQogICAgICAgICk7CiAgICAgIH0pOwogICAgICByZXR1cm4gZGF0b3NOb2RvUGFyYVJlcGFzYXI7CiAgICB9LAogICAgaWRzTm9kb3NSZXBhc2FyKCkgewogICAgICByZXR1cm4gdGhpcy5kYXRvc05vZG9zUmVwYXNhci5tYXAoKGRuKSA9PiBkbi5pZE5vZG8pOwogICAgfSwKICAgIGlkc05vZG9zUmVwYXNhclByZXNlbnRlcygpIHsKICAgICAgaWYgKCF0aGlzLmlkVGFyZ2V0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaWRzTm9kb3NSZXBhc2FyOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5pZHNOb2Rvc1JlcGFzYXIuZmlsdGVyKChpZCkgPT4KICAgICAgICB0aGlzLmlkc05vZG9zUmVuZGVyLmluY2x1ZGVzKGlkKQogICAgICApOwogICAgfSwKICAgIGRhdG9zTm9kb3NGcmVzY29zKCkgewogICAgICByZXR1cm4gdGhpcy5kYXRvc05vZG9zRXN0dWRpYWRvcy5maWx0ZXIoCiAgICAgICAgKGRuKSA9PiAhdGhpcy5pZHNOb2Rvc1JlcGFzYXIuaW5jbHVkZXMoZG4uaWROb2RvKQogICAgICApOwogICAgfSwKICAgIGlkc05vZG9zRnJlc2NvcygpIHsKICAgICAgcmV0dXJuIHRoaXMuZGF0b3NOb2Rvc0ZyZXNjb3MubWFwKChuZikgPT4gbmYuaWROb2RvKTsKICAgIH0sCiAgICBpZHNOb2Rvc1ByZXNlbnRlc0NhYmV6YSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRzTm9kb3NGcmVzY29zCiAgICAgICAgLmZpbHRlcigoaWROZSkgPT4gIXRoaXMuaWRzTm9kb3NBcHJlbmRpZG9zLmluY2x1ZGVzKGlkTmUpKQogICAgICAgIC5jb25jYXQodGhpcy5pZHNOb2Rvc0FwcmVuZGlkb3MpOwogICAgfSwKICAgIGNlbnRyb1Zpc3RhKCkgewogICAgICByZXR1cm4gewogICAgICAgIHg6IE1hdGgucm91bmQodGhpcy5jZW50cm9WaXN0YURlY2ltYWwueCksCiAgICAgICAgeTogTWF0aC5yb3VuZCh0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC55KSwKICAgICAgfTsKICAgIH0sCiAgICBmYWN0b3Jab29tKCkgewogICAgICByZXR1cm4gTnVtYmVyKCh0aGlzLnpvb20gLyAxMDApLnRvRml4ZWQoMikpOwogICAgfSwKICAgIGVzcXVpbmFzRGlhZ3JhbWEoKSB7CiAgICAgIGNvbnN0IG1heFggPSB0aGlzLnRvZG9zTm9kb3MucmVkdWNlKAogICAgICAgIChhY2MsIG4pID0+IChuLmF1dG9Db29yZHMueCA+IGFjYyA/IG4uYXV0b0Nvb3Jkcy54IDogYWNjKSwKICAgICAgICAwCiAgICAgICk7CiAgICAgIGNvbnN0IG1heFkgPSB0aGlzLnRvZG9zTm9kb3MucmVkdWNlKAogICAgICAgIChhY2MsIG4pID0+IChuLmF1dG9Db29yZHMueSA+IGFjYyA/IG4uYXV0b0Nvb3Jkcy55IDogYWNjKSwKICAgICAgICAwCiAgICAgICk7CiAgICAgIGNvbnN0IG1pblggPSB0aGlzLnRvZG9zTm9kb3MucmVkdWNlKAogICAgICAgIChhY2MsIG4pID0+IChuLmF1dG9Db29yZHMueCA8IGFjYyA/IG4uYXV0b0Nvb3Jkcy54IDogYWNjKSwKICAgICAgICAwCiAgICAgICk7CiAgICAgIGNvbnN0IG1pblkgPSB0aGlzLnRvZG9zTm9kb3MucmVkdWNlKAogICAgICAgIChhY2MsIG4pID0+IChuLmF1dG9Db29yZHMueSA8IGFjYyA/IG4uYXV0b0Nvb3Jkcy55IDogYWNjKSwKICAgICAgICAwCiAgICAgICk7CgogICAgICByZXR1cm4gewogICAgICAgIHgxOiBtaW5YLAogICAgICAgIHkxOiBtaW5ZLAoKICAgICAgICB4MjogbWF4WCwKICAgICAgICB5MjogbWF4WSwKICAgICAgfTsKICAgIH0sCiAgICBvZmZzZXRDb250ZW5lZG9yTm9kb3MoKSB7CiAgICAgIGNvbnN0IGFuY2hvID0gdGhpcy5lc3F1aW5hc0RpYWdyYW1hLngyIC0gdGhpcy5lc3F1aW5hc0RpYWdyYW1hLngxOwogICAgICBjb25zdCBhbHRvID0gdGhpcy5lc3F1aW5hc0RpYWdyYW1hLnkyIC0gdGhpcy5lc3F1aW5hc0RpYWdyYW1hLnkxOwogICAgICByZXR1cm4gewogICAgICAgIC8vIGxlZnQ6IC0odGhpcy5jZW50cm9WaXN0YS54ICogdGhpcy5mYWN0b3Jab29tKSArICJweCIsCiAgICAgICAgLy8gdG9wOiAtKHRoaXMuY2VudHJvVmlzdGEueSAqIHRoaXMuZmFjdG9yWm9vbSkgKyAicHgiLAoKICAgICAgICB3aWR0aDogYW5jaG8gKiB0aGlzLmZhY3Rvclpvb20gKyAicHgiLAogICAgICAgIGhlaWdodDogYWx0byAqIHRoaXMuZmFjdG9yWm9vbSArICJweCIsCiAgICAgIH07CiAgICB9LAogICAgbm9kb3NDb25SZXF1ZXJpbWVudG9zKCkgewogICAgICB2YXIgbnIgPSB0aGlzLnRvZG9zTm9kb3MuZmlsdGVyKChuKSA9PiBuLnZpbmN1bG9zLmxlbmd0aCA+IDApOwoKICAgICAgcmV0dXJuIG5yOwogICAgfSwKICAgIG5vZG9zUmVuZGVyKCkgewogICAgICBpZiAodGhpcy4kcm91dGUubmFtZSAhPSAiYXRsYXMiKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlkTm9kb1RhcmdldCkgewogICAgICAgIHJldHVybiB0aGlzLnRvZG9zTm9kb3MKICAgICAgICAgIC5maWx0ZXIoKG4pID0+IHRoaXMuaWRzTmVjZXNhcmlvc1BhcmFUYXJnZXQuaW5jbHVkZXMobi5pZCkpCiAgICAgICAgICAuY29uY2F0KFt0aGlzLnRvZG9zTm9kb3MuZmluZCgobikgPT4gdGhpcy5pZE5vZG9UYXJnZXQgPT09IG4uaWQpXSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2xlY2Npb25TZWxlY2Npb25hZGEpIHsKICAgICAgICBsZXQgZ3VhcmRhID0gMDsKICAgICAgICBsZXQgaWRzTm9kb3NBY3R1YWxlcyA9IHRoaXMuY29sZWNjaW9uU2VsZWNjaW9uYWRhLmlkc05vZG9zOwogICAgICAgIGxldCB0b2Rvc05vZG9zQ29sZWNjaW9uID0gW107CiAgICAgICAgbGV0IG5vZG9zQWN0dWFsZXMgPSBbXTsKCiAgICAgICAgd2hpbGUgKGd1YXJkYSA8IDEwMCAmJiBpZHNOb2Rvc0FjdHVhbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIG5vZG9zQWN0dWFsZXMgPSB0aGlzLnRvZG9zTm9kb3MuZmlsdGVyKChuKSA9PgogICAgICAgICAgICBpZHNOb2Rvc0FjdHVhbGVzLmluY2x1ZGVzKG4uaWQpCiAgICAgICAgICApOwogICAgICAgICAgdG9kb3NOb2Rvc0NvbGVjY2lvbi5wdXNoKC4uLm5vZG9zQWN0dWFsZXMpOwogICAgICAgICAgbGV0IGlkc1RvZG9zTm9kb3NDb2xlY2Npb24gPSB0b2Rvc05vZG9zQ29sZWNjaW9uLm1hcCgobikgPT4gbi5pZCk7CgogICAgICAgICAgaWRzTm9kb3NBY3R1YWxlcyA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCBub2RvQWN0dWFsIG9mIG5vZG9zQWN0dWFsZXMpIHsKICAgICAgICAgICAgbGV0IGlkc1ZpbmN1bG9zUmVxdWVyaWRvcyA9IG5vZG9BY3R1YWwudmluY3Vsb3MKICAgICAgICAgICAgICAuZmlsdGVyKCh2KSA9PiB2LnRpcG8gPT09ICJjb250aW51YWNpb24iICYmIHYucm9sID09PSAidGFyZ2V0IikKICAgICAgICAgICAgICAubWFwKCh2KSA9PiB2LmlkUmVmKTsKICAgICAgICAgICAgbGV0IGlkc1ZpbmN1bG9zTnVldm9zID0gaWRzVmluY3Vsb3NSZXF1ZXJpZG9zLmZpbHRlcigKICAgICAgICAgICAgICAoaWRWKSA9PiAhaWRzVG9kb3NOb2Rvc0NvbGVjY2lvbi5pbmNsdWRlcyhpZFYpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlkc05vZG9zQWN0dWFsZXMucHVzaCguLi5pZHNWaW5jdWxvc051ZXZvcyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG9kb3NOb2Rvc0NvbGVjY2lvbjsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zOwogICAgfSwKICAgIGlkc05vZG9zUmVuZGVyKCl7CiAgICAgIHJldHVybiB0aGlzLm5vZG9zUmVuZGVyLm1hcChuPT5uLmlkKTsKICAgIH0sCiAgICBpZHNUb2Rvc05vZG9zUmVuZGVyKCkgewogICAgICByZXR1cm4gdGhpcy5ub2Rvc1JlbmRlci5tYXAoKG4pID0+IG4uaWQpOwogICAgfSwKICAgIG9mZnNldExvYWRpbmdDcmVhbmRvTm9kbygpIHsKICAgICAgaWYgKCF0aGlzLnBvc2ljaW9uQ3JlYW5kb05vZG8pIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBsZWZ0ID0KICAgICAgICAodGhpcy5wb3NpY2lvbkNyZWFuZG9Ob2RvLnggLSB0aGlzLmVzcXVpbmFzRGlhZ3JhbWEueDEpICoKICAgICAgICB0aGlzLmZhY3Rvclpvb207CiAgICAgIGNvbnN0IHRvcCA9CiAgICAgICAgKHRoaXMucG9zaWNpb25DcmVhbmRvTm9kby55IC0gdGhpcy5lc3F1aW5hc0RpYWdyYW1hLnkxKSAqCiAgICAgICAgdGhpcy5mYWN0b3Jab29tOwogICAgICByZXR1cm4gewogICAgICAgIGxlZnQ6IGxlZnQgKyAicHgiLAogICAgICAgIHRvcDogdG9wICsgInB4IiwKICAgICAgfTsKICAgIH0sCiAgICBub2RvQWJpZXJ0bygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLm5hbWUgPT09ICJ2aXNvck5vZG9Db25vY2ltaWVudG8iOwogICAgfSwKICAgIG5vZG9zQ29uZWN0YWRvc0FsU2VsZWNjaW9uYWRvKCkgewogICAgICBpZiAoIXRoaXMubm9kb1NlbGVjY2lvbmFkbykgcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zLmZpbHRlcigobikgPT4KICAgICAgICB0aGlzLm5vZG9TZWxlY2Npb25hZG8udmluY3Vsb3Muc29tZSgodikgPT4gdi5pZFJlZiA9PT0gbi5pZCkKICAgICAgKTsKICAgIH0sCiAgICBpZHNOb2Rvc1ByZXZpb3NTZWxlY2Npb25hZG8oKSB7CiAgICAgIGlmICghdGhpcy5ub2RvU2VsZWNjaW9uYWRvKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIHZhciBpZHNBY3R1YWxlcyA9IFt0aGlzLmlkTm9kb1NlbGVjY2lvbmFkb107CiAgICAgIHZhciBjYWRlbmFUb3RhbCA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDIwOyBpKyspIHsKICAgICAgICBsZXQgcHJldmlvcyA9IHRoaXMubm9kb3NSZW5kZXIuZmlsdGVyKChuKSA9PgogICAgICAgICAgbi52aW5jdWxvcy5zb21lKAogICAgICAgICAgICAodikgPT4gdi5yb2wgPT09ICJzb3VyY2UiICYmIGlkc0FjdHVhbGVzLmluY2x1ZGVzKHYuaWRSZWYpCiAgICAgICAgICApCiAgICAgICAgKTsKCiAgICAgICAgaWYgKHByZXZpb3MubGVuZ3RoIDwgMSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBsZXQgaWRzUHJldmlvcyA9IHByZXZpb3MubWFwKChwcmV2aW8pID0+IHByZXZpby5pZCk7CgogICAgICAgIGNhZGVuYVRvdGFsLnB1c2goLi4uaWRzUHJldmlvcyk7CgogICAgICAgIGlkc0FjdHVhbGVzID0gaWRzUHJldmlvczsKICAgICAgfQoKICAgICAgcmV0dXJuIGNhZGVuYVRvdGFsOwogICAgfSwKICAgIGlkc05vZG9zQ29udGludWFjaW9uU2VsZWNjaW9uYWRvKCkgewogICAgICBpZiAoIXRoaXMubm9kb1NlbGVjY2lvbmFkbykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubm9kb1NlbGVjY2lvbmFkby52aW5jdWxvcwogICAgICAgIC5maWx0ZXIoKHYpID0+IHYudGlwbyA9PT0gImNvbnRpbnVhY2lvbiIgJiYgdi5yb2wgPT09ICJzb3VyY2UiKQogICAgICAgIC5tYXAoKHYpID0+IHYuaWRSZWYpOwogICAgfSwKICAgIGlkc05vZG9zQ29uZWN0YWRvc1NlbGVjY2lvbmFkbygpIHsKICAgICAgaWYgKCF0aGlzLm5vZG9TZWxlY2Npb25hZG8pIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubm9kb1NlbGVjY2lvbmFkby52aW5jdWxvcy5tYXAoKHYpID0+IHYuaWRSZWYpOwogICAgfSwKICAgIGlkVGFyZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5pZE5vZG9UYXJnZXQgfHwgdGhpcy5pZENvbGVjY2lvblNlbGVjY2lvbmFkYTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2NhbGl6YXJOZXh0KHRpcG8pIHsKICAgICAgbGV0IG5vZG9zQ29uc2lkZXJhZG9zID0gWy4uLnRoaXMubm9kb3NSZW5kZXJdOwoKICAgICAgdGhpcy5pZENvbGVjY2lvblRhcmdldE9uTGFzdExvY2FsaXphY2lvbiA9IHRoaXMuaWRDb2xlY2Npb25TZWxlY2Npb25hZGE7CiAgICAgIGlmICh0aXBvID09PSAiYXZhaWxhYmxlIikgewogICAgICAgIGxldCBpbmRleEVuY29udHJhZG9zID0gMDsKICAgICAgICBsZXQgbmV4dE5vZG8gPSBub2Rvc0NvbnNpZGVyYWRvcy5maW5kKChuKSA9PiB7CiAgICAgICAgICBpZiAodGhpcy5pZHNOb2Rvc1ByZXNlbnRlc0NhYmV6YS5pbmNsdWRlcyhuLmlkKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuaW5kZXhMYXN0TG9jYXRlTmV4dEF2YWlsYWJsZSA9PT0gbi5pZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IGlkc05vZG9zUmVxdWVyaWRvcyA9IG4udmluY3Vsb3MKICAgICAgICAgICAgLmZpbHRlcigodikgPT4gdi50aXBvID09PSAiY29udGludWFjaW9uIiAmJiB2LnJvbCA9PT0gInRhcmdldCIpCiAgICAgICAgICAgIC5tYXAoKHYpID0+IHYuaWRSZWYpOwoKICAgICAgICAgIGxldCBub2Rvc1JlcXVlcmlkb3MgPSBub2Rvc0NvbnNpZGVyYWRvcy5maWx0ZXIoKG4pID0+CiAgICAgICAgICAgIGlkc05vZG9zUmVxdWVyaWRvcy5pbmNsdWRlcyhuLmlkKQogICAgICAgICAgKTsKCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIG5vZG9zUmVxdWVyaWRvcy5zb21lKAogICAgICAgICAgICAgIChub2RvKSA9PiAhdGhpcy5pZHNOb2Rvc1ByZXNlbnRlc0NhYmV6YS5pbmNsdWRlcyhub2RvLmlkKQogICAgICAgICAgICApCiAgICAgICAgICApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGluZGV4RW5jb250cmFkb3MrKzsKCiAgICAgICAgICBpZiAoaW5kZXhFbmNvbnRyYWRvcyA8PSB0aGlzLmluZGV4TGFzdExvY2F0ZU5leHRBdmFpbGFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChuZXh0Tm9kbykgewogICAgICAgICAgdGhpcy5jZW50cmFyRW5Ob2RvQnlJZChuZXh0Tm9kby5pZCk7CiAgICAgICAgICB0aGlzLmluZGV4TGFzdExvY2F0ZU5leHRBdmFpbGFibGUgPSBpbmRleEVuY29udHJhZG9zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmluZGV4TGFzdExvY2F0ZU5leHRBdmFpbGFibGUgPSAwOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aXBvID09PSAiY2hlY2siKSB7CiAgICAgICAgbGV0IGluZGV4RW5jb250cmFkb3MgPSAwOwogICAgICAgIGxldCBuZXh0Tm9kbyA9IG5vZG9zQ29uc2lkZXJhZG9zLmZpbmQoKG4pID0+IHsKICAgICAgICAgIGlmICh0aGlzLmlkc05vZG9zUHJlc2VudGVzQ2FiZXphLmluY2x1ZGVzKG4uaWQpKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFc3RhYmEgZnJlc2NvIik7CgogICAgICAgICAgICBpbmRleEVuY29udHJhZG9zKys7CgogICAgICAgICAgICBpZiAoaW5kZXhFbmNvbnRyYWRvcyA8PSB0aGlzLmluZGV4TGFzdExvY2F0ZUNoZWNrKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAobmV4dE5vZG8pIHsKICAgICAgICAgIHRoaXMuY2VudHJhckVuTm9kb0J5SWQobmV4dE5vZG8uaWQpOwogICAgICAgICAgdGhpcy5pbmRleExhc3RMb2NhdGVDaGVjayA9IGluZGV4RW5jb250cmFkb3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW5kZXhMYXN0TG9jYXRlQ2hlY2sgPSAwOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aXBvID09PSAicmVwYXNvIikgewogICAgICAgIGlmICghdGhpcy5pZHNOb2Rvc1JlcGFzYXJQcmVzZW50ZXM/Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pbmRleExhc3RMb2NhdGVOZXh0UmVwYXNvKys7CiAgICAgICAgaWYgKHRoaXMuaW5kZXhMYXN0TG9jYXRlTmV4dFJlcGFzbyA+PSB0aGlzLmlkc05vZG9zUmVwYXNhclByZXNlbnRlcy5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuaW5kZXhMYXN0TG9jYXRlTmV4dFJlcGFzbyA9IDA7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNlbnRyYXJFbk5vZG9CeUlkKAogICAgICAgICAgdGhpcy5pZHNOb2Rvc1JlcGFzYXJQcmVzZW50ZXNbdGhpcy5pbmRleExhc3RMb2NhdGVOZXh0UmVwYXNvXQogICAgICAgICk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRJZENvbGVjY2lvblNlbGVjY2lvbmFkYShudWV2b0lkKSB7CiAgICAgIHRoaXMuaW5kZXhMYXN0TG9jYXRlTmV4dEF2YWlsYWJsZSA9IDA7CiAgICAgIHRoaXMuaW5kZXhMYXN0TG9jYXRlTmV4dENoZWNrID0gMDsKCiAgICAgIHRoaXMuaWRDb2xlY2Npb25TZWxlY2Npb25hZGEgPSBudWV2b0lkOwogICAgfSwKICAgIGluaWNpYXJDYWxsaW5nUG9zaWNpb25lcygpIHsKICAgICAgdmFyIGNpY2xvcyA9IHByb21wdCgiwr9DdWFudG9zIGNpY2xvcz8iKTsKICAgICAgaWYgKGlzTmFOKGNpY2xvcykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNpY2xvcyA9IE1hdGgucm91bmQoY2ljbG9zKTsKICAgICAgaWYgKGNpY2xvcyA8IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYEVudmlhbmRvIHJlcG9zaWNpb25hbWllbnRvIGRlICR7Y2ljbG9zfSBjaWNsb3NgKTsKICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IHRydWU7CgogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkY2ljbG9zOiBJbnQhKSB7CiAgICAgICAgICAgICAgcG9zaWNpb25hck5vZG9zQ29ub2NpbWllbnRvQnlGdWVyemFzKGNpY2xvczogJGNpY2xvcykKICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBjaWNsb3MsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZVBvc2ljaW9uYW1pZW50bygpIHsKICAgICAgdGhpcy5lbnZpYW5kb1F1ZXJ5Q29uZmlndXJhY2lvbkF0bGFzID0gdHJ1ZTsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLm11dGF0ZSh7CiAgICAgICAgICBtdXRhdGlvbjogZ3FsYAogICAgICAgICAgICBtdXRhdGlvbiAoJG5vbWJyZUF0bGFzOiBTdHJpbmchKSB7CiAgICAgICAgICAgICAgdG9nZ2xlUG9zaWNpb25hbWllbnRvQXV0b21hdGljb0F0bGFzKG5vbWJyZUF0bGFzOiAkbm9tYnJlQXRsYXMpIHsKICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICBwb3NpY2lvbmFuZG8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgbm9tYnJlQXRsYXM6ICJjb25vY2ltaWVudG8iLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9RdWVyeUNvbmZpZ3VyYWNpb25BdGxhcyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9RdWVyeUNvbmZpZ3VyYWNpb25BdGxhcyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFicmlyTWVudUNvbnRleHR1YWwoZSkgewogICAgICBsZXQgcG9zRGlhZ3JhbWEgPSB0aGlzLiRyZWZzLmNvbnRlbmVkb3JEaWFncmFtYS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIGxldCB0b3BDbGljayA9IE1hdGgucm91bmQoZS5wYWdlWSAtIHBvc0RpYWdyYW1hLnRvcCk7CiAgICAgIGxldCBsZWZ0Q2xpY2sgPSBNYXRoLnJvdW5kKGUucGFnZVggLSBwb3NEaWFncmFtYS5sZWZ0KTsKCiAgICAgIHRoaXMuJHNldCh0aGlzLm9mZnNldE1lbnVDb250ZXh0dWFsLCAidG9wIiwgdG9wQ2xpY2sgKyAicHgiKTsKICAgICAgdGhpcy4kc2V0KHRoaXMub2Zmc2V0TWVudUNvbnRleHR1YWwsICJsZWZ0IiwgbGVmdENsaWNrICsgInB4Iik7CiAgICAgIHRoaXMubW9zdHJhbmRvTWVudUNvbnRleHR1YWwgPSB0cnVlOwogICAgICAvL3RoaXMuY3JlYXJOb2RvKHt4OiBsZWZ0Q2xpY2ssIHk6IHRvcENsaWNrfSk7CiAgICB9LAogICAgY3JlYXJOb2RvRW5NZW51Q29udGV4dHVhbCgpIHsKICAgICAgY29uc3QgcG9zQ29udGVuZWRvck5vZG9zID0KICAgICAgICB0aGlzLiRyZWZzLmNvbnRlbmVkb3JOb2Rvcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgY29uc3QgZGlzdGFuY2lhTGVmdFB4ID0KICAgICAgICBwYXJzZUludCh0aGlzLm9mZnNldE1lbnVDb250ZXh0dWFsLmxlZnQpIC0KICAgICAgICBwYXJzZUludChwb3NDb250ZW5lZG9yTm9kb3MubGVmdCk7CiAgICAgIGNvbnN0IGRpc3RhbmNpYVRvcFB4ID0KICAgICAgICBwYXJzZUludCh0aGlzLm9mZnNldE1lbnVDb250ZXh0dWFsLnRvcCkgLQogICAgICAgIChwYXJzZUludChwb3NDb250ZW5lZG9yTm9kb3MudG9wKSAtIHBhcnNlSW50KHRoaXMuJGVsLm9mZnNldFRvcCkpOwoKICAgICAgY29uc3QgcG9zUHhYID0gZGlzdGFuY2lhTGVmdFB4OwogICAgICBjb25zdCBwb3NQeFkgPSBkaXN0YW5jaWFUb3BQeDsKCiAgICAgIGNvbnNvbGUubG9nKGB4UGl4OiAke3BhcnNlSW50KHRoaXMub2Zmc2V0TWVudUNvbnRleHR1YWwubGVmdCl9YCk7CiAgICAgIGNvbnNvbGUubG9nKAogICAgICAgIGBwb3NYQ29udGVuZWRvck5vZG9zOiAke3BhcnNlSW50KHBvc0NvbnRlbmVkb3JOb2Rvcy5sZWZ0KX0sICR7CiAgICAgICAgICBwb3NDb250ZW5lZG9yTm9kb3MudG9wCiAgICAgICAgfWAKICAgICAgKTsKICAgICAgY29uc29sZS5sb2coYGRpc3RhbmNpYUxlZnRQeDogJHtkaXN0YW5jaWFMZWZ0UHh9YCk7CiAgICAgIGNvbnNvbGUubG9nKGBkaXN0YW5jaWFUb3BQeDogJHtkaXN0YW5jaWFUb3BQeH1gKTsKICAgICAgY29uc29sZS5sb2coCiAgICAgICAgYFNjcm9sbCB4IGNvbnRlbmVkb3JEaWFncmFtYTogJHt0aGlzLiRyZWZzLmNvbnRlbmVkb3JEaWFncmFtYS5zY3JvbGxMZWZ0fWAKICAgICAgKTsKCiAgICAgIHZhciBwb3NpY2lvbk51ZXZvTm9kbyA9IHsKICAgICAgICB4OiBwYXJzZUludChwb3NQeFggLyB0aGlzLmZhY3Rvclpvb20gKyB0aGlzLmVzcXVpbmFzRGlhZ3JhbWEueDEpLAogICAgICAgIHk6IHBhcnNlSW50KHBvc1B4WSAvIHRoaXMuZmFjdG9yWm9vbSArIHRoaXMuZXNxdWluYXNEaWFncmFtYS55MSksCiAgICAgIH07CgogICAgICBjb25zb2xlLmxvZyhgQ3JlYW5kbyBudWV2byBub2RvIGVuICR7SlNPTi5zdHJpbmdpZnkocG9zaWNpb25OdWV2b05vZG8pfWApOwoKICAgICAgdGhpcy5jcmVhck5vZG8ocG9zaWNpb25OdWV2b05vZG8pOwogICAgfSwKICAgIGVuY29udHJhck5vZG9zTmVjZXNhcmlvc0RlTm9kbyhpZE5vZG8sIGxpc3RhVG90YWwpIHsKICAgICAgY29uc3QgZWxOb2RvID0gdGhpcy50b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT0gaWROb2RvKTsKICAgICAgaWYgKCFlbE5vZG8pIHsKICAgICAgICByZXR1cm4gbGlzdGFUb3RhbDsKICAgICAgfQogICAgICBjb25zdCBuZWNlc2FyaW9zID0gZWxOb2RvLnZpbmN1bG9zCiAgICAgICAgLmZpbHRlcigodikgPT4gdi5yb2wgPT0gInRhcmdldCIpCiAgICAgICAgLm1hcCgodikgPT4gdi5pZFJlZik7CiAgICAgIG5lY2VzYXJpb3MuZm9yRWFjaCgobmVjZXNhcmlvKSA9PiB7CiAgICAgICAgaWYgKCFsaXN0YVRvdGFsLmluY2x1ZGVzKG5lY2VzYXJpbykpIHsKICAgICAgICAgIGxpc3RhVG90YWwucHVzaChuZWNlc2FyaW8pOwogICAgICAgICAgbGlzdGFUb3RhbCA9IHRoaXMuZW5jb250cmFyTm9kb3NOZWNlc2FyaW9zRGVOb2RvKAogICAgICAgICAgICBuZWNlc2FyaW8sCiAgICAgICAgICAgIGxpc3RhVG90YWwKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGxpc3RhVG90YWw7CiAgICB9LAogICAgY2xpY2tGb25kb0F0bGFzKCkgewogICAgICAvLyBjb25zb2xlLmxvZyhgQ2xpY2sgZW4gZWwgZm9uZG8gZGVsIGF0bGFzLiBSb3V0ZSBuYW1lOiAke3RoaXMuJHJvdXRlLm5hbWV9YCk7CiAgICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lICE9ICJhdGxhcyIpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJhdGxhcyIgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghdGhpcy52aXN0YVBhbm5lZCkgdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8gPSBudWxsOwogICAgICB0aGlzLnBhbm5pbmdWaXN0YSA9IGZhbHNlOwogICAgICB0aGlzLnZpc3RhUGFubmVkID0gZmFsc2U7CiAgICAgIHRoaXMuJHJlZnMucGFuZWxDb25qdW50b3NOb2Rvcy5hYmllcnRvID0gZmFsc2U7CiAgICAgIHRoaXMubW9zdHJhbmRvTWVudUNvbnRleHR1YWwgPSBmYWxzZTsKICAgIH0sCiAgICBzZXRFc3RhZG9PYmpldGl2b05vZG9DYWNoZShudWV2b0VzdGFkbywgaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKAogICAgICAgIGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29uIGVzdGFkbyBvYmpldGl2bzogJHtudWV2b0VzdGFkb31gCiAgICAgICk7CiAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgIGNvbnN0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgfSk7CiAgICAgIHZhciBudWV2b0NhY2hlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYWNoZSkpOwoKICAgICAgdmFyIGluZGV4TiA9IG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgKG4pID0+IG4uaWROb2RvID09IGlkTm9kbwogICAgICApOwogICAgICBpZiAoaW5kZXhOID4gLTEpIHsKICAgICAgICBudWV2b0NhY2hlLnlvLmF0bGFzLmRhdG9zTm9kb3NbaW5kZXhOXS5vYmpldGl2byA9IG51ZXZvRXN0YWRvOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKGBObyBlc3RhYmEgZW4gY2FjaMOpLiBQdXNoaW5nYCk7CiAgICAgICAgbnVldm9DYWNoZS55by5hdGxhcy5kYXRvc05vZG9zLnB1c2goewogICAgICAgICAgX190eXBlbmFtZTogIkRhdG9Ob2RvVXN1YXJpbyIsCiAgICAgICAgICBpZE5vZG8sCiAgICAgICAgICBvYmpldGl2bzogbnVldm9Fc3RhZG8sCiAgICAgICAgICBhcHJlbmRpZG86IGZhbHNlLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgIHF1ZXJ5OiBRVUVSWV9EQVRPU19VU1VBUklPX05PRE9TLAogICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUsCiAgICAgIH0pOwogICAgfSwKICAgIHNldE5vZG9BcHJlbmRpZG9DYWNoZShudWV2b0VzdGFkbywgaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKAogICAgICAgIGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29uIGVzdGFkbyBhcHJlbmRpZG86ICR7bnVldm9Fc3RhZG99YAogICAgICApOwogICAgICBjb25zdCBzdG9yZSA9IHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50OwogICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgcXVlcnk6IFFVRVJZX0RBVE9TX1VTVUFSSU9fTk9ET1MsCiAgICAgIH0pOwogICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgdmFyIGluZGV4TiA9IG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgKG4pID0+IG4uaWROb2RvID09IGlkTm9kbwogICAgICApOwogICAgICBpZiAoaW5kZXhOID4gLTEpIHsKICAgICAgICBudWV2b0NhY2hlLnlvLmF0bGFzLmRhdG9zTm9kb3NbaW5kZXhOXS5hcHJlbmRpZG8gPSBudWV2b0VzdGFkbzsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gZXN0YWJhIGVuIGNhY2jDqS4gUHVzaGluZ2ApOwogICAgICAgIG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5wdXNoKHsKICAgICAgICAgIF9fdHlwZW5hbWU6ICJEYXRvTm9kb1VzdWFyaW8iLAogICAgICAgICAgaWROb2RvLAogICAgICAgICAgb2JqZXRpdm86IGZhbHNlLAogICAgICAgICAgYXByZW5kaWRvOiBudWV2b0VzdGFkbywKICAgICAgICB9KTsKICAgICAgfQogICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICB9KTsKICAgIH0sCiAgICBzZXROb2RvVGFyZ2V0Q2FjaGUoaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29tbyB0YXJnZXRgKTsKICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLiRhcG9sbG8ucHJvdmlkZXIuZGVmYXVsdENsaWVudDsKICAgICAgY29uc3QgY2FjaGUgPSBzdG9yZS5yZWFkUXVlcnkoewogICAgICAgIHF1ZXJ5OiBRVUVSWV9EQVRPU19VU1VBUklPX05PRE9TLAogICAgICB9KTsKICAgICAgdmFyIG51ZXZvQ2FjaGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CiAgICAgIG51ZXZvQ2FjaGUueW8uYXRsYXMuaWROb2RvVGFyZ2V0ID0gaWROb2RvOwogICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICB9KTsKICAgIH0sCiAgICBzZXRNb2RvKG1vZG8pIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW9Mb2dlYWRvKSByZXR1cm47CiAgICAgIHRoaXMubW9kb0F0bGFzID0gbW9kbzsKICAgICAgLy8gdGhpcy5lbnZpYW5kb1F1ZXJ5TW9kbyA9IHRydWU7CgogICAgICAvLyB0aGlzLiRhcG9sbG8KICAgICAgLy8gICAubXV0YXRlKHsKICAgICAgLy8gICAgIG11dGF0aW9uOiBncWxgCiAgICAgIC8vICAgICAgIG11dGF0aW9uICgkaWRVc3VhcmlvOiBJRCEsICRudWV2b01vZG86IFN0cmluZyEpIHsKICAgICAgLy8gICAgICAgICBzZXRNb2RvVXN1YXJpb0F0bGFzKGlkVXN1YXJpbzogJGlkVXN1YXJpbywgbnVldm9Nb2RvOiAkbnVldm9Nb2RvKXsKICAgICAgLy8gICAgICAgICAgICAgaWQKICAgICAgLy8gICAgICAgICAgICAgYXRsYXN7CiAgICAgIC8vICAgICAgICAgICAgICAgICBjb25maWd1cmFjaW9uewogICAgICAvLyAgICAgICAgICAgICAgICAgICAgIG1vZG8KICAgICAgLy8gICAgICAgICAgICAgICAgIH0KICAgICAgLy8gICAgICAgICAgICAgfQogICAgICAvLyAgICAgICAgIH0KICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgYCwKICAgICAgLy8gICAgIHZhcmlhYmxlczogewogICAgICAvLyAgICAgICBpZFVzdWFyaW86IHRoaXMudXN1YXJpby5pZCwKICAgICAgLy8gICAgICAgbnVldm9Nb2RvOiBtb2RvLAogICAgICAvLyAgICAgfSwKICAgICAgLy8gICB9KQogICAgICAvLyAgIC50aGVuKCgpID0+IHsKICAgICAgLy8gICAgIHRoaXMuZW52aWFuZG9RdWVyeU1vZG8gPSBmYWxzZTsKCiAgICAgIC8vICAgfSkKICAgICAgLy8gICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgIC8vICAgICB0aGlzLmVudmlhbmRvUXVlcnlNb2RvID0gZmFsc2U7CiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgIC8vICAgfSk7CiAgICB9LAogICAgY29uZmlndXJhck5vZG9UYXJnZXQoaWROb2RvKSB7CiAgICAgIHRoaXMuZW52aWFuZG9RdWVyeVRhcmdldCA9IHRydWU7CgogICAgICBjb25zb2xlLmxvZyhgQ29uZmlndXJhbmRvIG5vZG8gdGFyZ2V0YCk7CiAgICAgIGlmICghaWROb2RvIHx8IGlkTm9kbyA9PT0gdGhpcy5pZE5vZG9UYXJnZXQpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTnVsaWZpY2FuZG9gKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMubnVsaWZpY2FyTm9kb1RhcmdldCgpOwogICAgICAgIH0sIDEwMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnNldE5vZG9UYXJnZXQoaWROb2RvKTsKICAgICAgICB9LCAxMDApOwogICAgICB9CiAgICB9LAogICAgc2V0Tm9kb1RhcmdldChpZE5vZG8pIHsKICAgICAgaWYgKCFpZE5vZG8pIHJldHVybjsKICAgICAgaWYgKHRoaXMuaWROb2RvVGFyZ2V0ID09IGlkTm9kbykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5pZE5vZG9UYXJnZXQgPSBpZE5vZG87CiAgICB9LAogICAgbnVsaWZpY2FyTm9kb1RhcmdldCgpIHsKICAgICAgY29uc29sZS5sb2coYE51bGlmaWNhbmRvIG5vZG8gdGFyZ2V0YCk7CiAgICAgIHRoaXMuaWROb2RvVGFyZ2V0ID0gbnVsbDsKICAgIH0sCiAgICBjZW50cmFyRW5Ob2RvKG4pIHsKICAgICAgY29uc3QgcG9zRGlhZ3JhbWEgPSB0aGlzLiRyZWZzLmNvbnRlbmVkb3JEaWFncmFtYS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgY29uc3QgcG9zTm9kbyA9IHsKICAgICAgICB4OiAobi5hdXRvQ29vcmRzLnggLSB0aGlzLmVzcXVpbmFzRGlhZ3JhbWEueDEpICogdGhpcy5mYWN0b3Jab29tLAogICAgICAgIHk6IChuLmF1dG9Db29yZHMueSAtIHRoaXMuZXNxdWluYXNEaWFncmFtYS55MSkgKiB0aGlzLmZhY3Rvclpvb20sCiAgICAgIH07CgogICAgICBjb25zdCBwb3NJZGVhbFNjcm9sbCA9IHsKICAgICAgICB4OiBwYXJzZUludChwb3NOb2RvLnggLSBwb3NEaWFncmFtYS53aWR0aCAvIDIpLAogICAgICAgIHk6IHBhcnNlSW50KHBvc05vZG8ueSAtIHBvc0RpYWdyYW1hLmhlaWdodCAvIDIpLAogICAgICB9OwoKICAgICAgdGhpcy4kcmVmcy5jb250ZW5lZG9yRGlhZ3JhbWEuc2Nyb2xsTGVmdCA9IHBvc0lkZWFsU2Nyb2xsLng7CiAgICAgIHRoaXMuJHJlZnMuY29udGVuZWRvckRpYWdyYW1hLnNjcm9sbFRvcCA9IHBvc0lkZWFsU2Nyb2xsLnk7CgogICAgICB0aGlzLnNlbGVjY2lvbk5vZG8obik7CiAgICAgIC8vdGhpcy5jZW50cm9WaXN0YT1lOwogICAgfSwKICAgIGNlbnRyYXJFbk5vZG9CeUlkKGlkTm9kbykgewogICAgICBjb25zb2xlLmxvZyhgQ2VudHJhbmRvIGVuIG5vZG8gY29uIGlkICR7aWROb2RvfWApOwogICAgICB2YXIgZWxOb2RvID0gdGhpcy50b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT09IGlkTm9kbyk7CiAgICAgIGlmIChlbE5vZG8pIHsKICAgICAgICB0aGlzLmNlbnRyYXJFbk5vZG8oZWxOb2RvKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLnF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgICAgIHF1ZXJ5ICgkaWROb2RvOiBJRCEpIHsKICAgICAgICAgICAgICBub2RvKGlkTm9kbzogJGlkTm9kbykgewogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgIGF1dG9Db29yZHMgewogICAgICAgICAgICAgICAgICB4CiAgICAgICAgICAgICAgICAgIHkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaWROb2RvLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCh7IGRhdGE6IHsgbm9kbyB9IH0pID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBSZWNpYmlkbyBub2RvIGFzw606ICR7SlNPTi5zdHJpbmdpZnkobm9kbyl9YCk7CiAgICAgICAgICB0aGlzLmNlbnRyYXJFbk5vZG8obm9kbyk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgaW5pY2lhTW92aW1pZW50b1RvdWNoKGUpIHsKICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDIpIHsKICAgICAgICB2YXIgZGlzdCA9IE1hdGguaHlwb3QoCiAgICAgICAgICBlLnRvdWNoZXNbMF0ucGFnZVggLSBlLnRvdWNoZXNbMV0ucGFnZVgsCiAgICAgICAgICBlLnRvdWNoZXNbMF0ucGFnZVkgLSBlLnRvdWNoZXNbMV0ucGFnZVkKICAgICAgICApOwogICAgICAgIHRoaXMubGFzdFBpbmNoRGlzdGFuY2UgPSBkaXN0OwogICAgICAgIHRoaXMucGluY2hpbmcgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy51bHRpbW9Ub3VjaFggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7CiAgICAgIHRoaXMudWx0aW1vVG91Y2hZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZOwogICAgfSwKICAgIGZpblRvdWNoKCkgewogICAgICB0aGlzLnBpbmNoaW5nID0gZmFsc2U7CiAgICB9LAogICAgY2FtYmlhckNvb3Jkc01hbnVhbGVzTm9kbyhpZE5vZG8sIGNvb3Jkc01hbnVhbGVzKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnRvZG9zTm9kb3NbdGhpcy50b2Rvc05vZG9zLmZpbmRJbmRleCgobikgPT4gbi5pZCA9PSBpZE5vZG8pXS5jb29yZHMgPQogICAgICAgIGNvb3Jkc01hbnVhbGVzOwogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaWROb2RvOiBTdHJpbmcsICRjb29yZHNNYW51YWxlczogQ29vcmRzSW5wdXQpIHsKICAgICAgICAgICAgICBzZXRDb29yZHNNYW51YWxlcygKICAgICAgICAgICAgICAgIGlkTm9kbzogJGlkTm9kbwogICAgICAgICAgICAgICAgY29vcmRzTWFudWFsZXM6ICRjb29yZHNNYW51YWxlcwogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgbW9kaWZpY2Fkb3MgewogICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgICBjb29yZHNNYW51YWxlcyB7CiAgICAgICAgICAgICAgICAgICAgeAogICAgICAgICAgICAgICAgICAgIHkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBjb29yZHMgewogICAgICAgICAgICAgICAgICAgIHgKICAgICAgICAgICAgICAgICAgICB5CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaWROb2RvLAogICAgICAgICAgICBjb29yZHNNYW51YWxlcywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLiRyZWZzLmNhbnZhc2VzLmNyZWFySW1hZ2VuVG9kb3NWaW5jdWxvcygpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIGVsaW1pbmFyTm9kbyhpZE5vZG8pIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW9TdXBlcmFkbWluaXN0cmFkb3IgJiYgIXRoaXMudXN1YXJpb0FkbWluaXN0cmFkb3JBdGxhcykgewogICAgICAgIGNvbnNvbGUubG9nKGBObyBhdXRvcml6YWRvYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghY29uZmlybSgiwr9TZWd1cm8gZGUgcXVlIHF1aWVyZXMgZWxpbWluYXIgZXN0ZSBub2RvPyIpKSByZXR1cm47CiAgICAgIGNvbnNvbGUubG9nKGBlbnZpYW5kbyBtdXRhY2lvbiBkZSBlbGltaW5hciBub2RvYCk7CiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5tdXRhdGUoewogICAgICAgICAgbXV0YXRpb246IGdxbGAKICAgICAgICAgICAgbXV0YXRpb24gKCRpZE5vZG86IElEISkgewogICAgICAgICAgICAgIGVsaW1pbmFyTm9kbyhpZE5vZG86ICRpZE5vZG8pCiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaWROb2RvLAogICAgICAgICAgfSwKICAgICAgICAgIHVwZGF0ZShzdG9yZSwgeyBkYXRhOiB7IGVsaW1pbmFyTm9kbyB9IH0pIHsKICAgICAgICAgICAgaWYgKCFlbGltaW5hck5vZG8pIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm9kbyBubyBmdWUgZWxpbWluYWRvYCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICAgICAgICBxdWVyeTogUVVFUllfTk9ET1MsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgICAgICAgY29uc3QgaW5kZXhOID0gbnVldm9DYWNoZS50b2Rvc05vZG9zLmZpbmRJbmRleCgKICAgICAgICAgICAgICAobikgPT4gbi5pZCA9PSBpZE5vZG8KICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKGluZGV4TiA+IC0xKSB7CiAgICAgICAgICAgICAgbnVldm9DYWNoZS50b2Rvc05vZG9zLnNwbGljZShpbmRleE4sIDEpOwogICAgICAgICAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgICAgICAgICAgcXVlcnk6IFFVRVJZX05PRE9TLAogICAgICAgICAgICAgICAgZGF0YTogbnVldm9DYWNoZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRWwgbm9kbyBubyBlc3RhYmEgcHJlc2VudGVgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgcXVpdGFuZG8gZWwgb2JqZXRvIGRlbCBhcnJheS4gJHtkYXRhfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIGNyZWFyTm9kbyhwb3NpY2lvbikgewogICAgICBpZiAoIXRoaXMudXN1YXJpb1N1cGVyYWRtaW5pc3RyYWRvciAmJiAhdGhpcy51c3VhcmlvQWRtaW5pc3RyYWRvckF0bGFzKSB7CiAgICAgICAgY29uc29sZS5sb2coYEVycm9yIHVzdWFyaW8gbm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZyhgZW52aWFuZG8gdW5hIG11dGFjacOzbiBkZSBjcmVhciBub2RvYCk7CgogICAgICBsZXQgaW5mb05vZG8gPSB7CiAgICAgICAgY29vcmRzTWFudWFsZXM6IHsKICAgICAgICAgIHg6IHBvc2ljaW9uLngsCiAgICAgICAgICB5OiBwb3NpY2lvbi55LAogICAgICAgIH0sCiAgICAgICAgY29vcmRzOiB7CiAgICAgICAgICB4OiBwb3NpY2lvbi54LAogICAgICAgICAgeTogcG9zaWNpb24ueSwKICAgICAgICB9LAogICAgICAgIGF1dG9Db29yZHM6IHsKICAgICAgICAgIHg6IHBvc2ljaW9uLngsCiAgICAgICAgICB5OiBwb3NpY2lvbi55LAogICAgICAgIH0sCiAgICAgIH07CiAgICAgIGNvbnNvbGUubG9nKGBlbiBsYXMgY29vcmRlbmFkYXM6ICR7cG9zaWNpb24ueH0sICR7cG9zaWNpb24ueX0gYCk7CiAgICAgIHRoaXMucG9zaWNpb25DcmVhbmRvTm9kbyA9IHsKICAgICAgICB4OiBwb3NpY2lvbi54LAogICAgICAgIHk6IHBvc2ljaW9uLnksCiAgICAgIH07CiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5tdXRhdGUoewogICAgICAgICAgbXV0YXRpb246IGdxbGAKICAgICAgICAgICAgbXV0YXRpb24gKCRpbmZvTm9kbzogTm9kb0Nvbm9jaW1pZW50b0lucHV0KSB7CiAgICAgICAgICAgICAgY3JlYXJOb2RvKGluZm9Ob2RvOiAkaW5mb05vZG8pIHsKICAgICAgICAgICAgICAgIC4uLmZyYWdOb2RvQ29ub2NpbWllbnRvCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICR7ZnJhZ21lbnRvTm9kb0Nvbm9jaW1pZW50b30KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaW5mb05vZG8sCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHsgZGF0YTogeyBjcmVhck5vZG8gfSB9KSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYWRvICR7Y3JlYXJOb2RvLmlkfWApOwogICAgICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLiRhcG9sbG8ucHJvdmlkZXIuZGVmYXVsdENsaWVudDsKICAgICAgICAgIGNvbnN0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICAgICAgcXVlcnk6IFFVRVJZX05PRE9TLAogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgICAgIGNvbnNvbGUubG9nKGAxYCk7CiAgICAgICAgICB2YXIgbG9zTm9kb3MgPSBudWV2b0NhY2hlLnRvZG9zTm9kb3M7CiAgICAgICAgICBjb25zb2xlLmxvZyhgMmApOwoKICAgICAgICAgIGNvbnN0IGluZGV4TiA9IGxvc05vZG9zLmZpbmRJbmRleCgobikgPT4gbi5pZCA9PT0gY3JlYXJOb2RvLmlkKTsKICAgICAgICAgIGlmIChpbmRleE4gPiAtMSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgRWwgbm9kbyB5YSBlc3RhYmEgZW4gY2FjaMOpYCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb3NOb2Rvcy5wdXNoKGNyZWFyTm9kbyk7CiAgICAgICAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPUywKICAgICAgICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucG9zaWNpb25DcmVhbmRvTm9kbyA9IG51bGw7CiAgICAgICAgICAvL3RoaXMuJHJvdXRlci5wdXNoKCIvbm9kb0Nvbm9jaW1pZW50by8iK2NyZWFyTm9kby5pZCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aGlzLnBvc2ljaW9uQ3JlYW5kb05vZG8gPSBudWxsOwogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yLiBFOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIGRlc2NhcmdhckNlbnRyb1Zpc3RhKCkgewogICAgICBsZXQgZGlzID0gdGhpczsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLnF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgICAgIHF1ZXJ5IHsKICAgICAgICAgICAgICB5byB7CiAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgYXRsYXMgewogICAgICAgICAgICAgICAgICBjZW50cm9WaXN0YSB7CiAgICAgICAgICAgICAgICAgICAgeAogICAgICAgICAgICAgICAgICAgIHkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBpZFVzdWFyaW86IHRoaXMuJHN0b3JlLnN0YXRlLnVzdWFyaW8uaWQsCiAgICAgICAgICB9LAogICAgICAgICAgZmV0Y2hQb2xpY3k6ICJuZXR3b3JrLW9ubHkiLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHsgZGF0YTogeyB5byB9IH0pIHsKICAgICAgICAgIGxldCBjb29yZHMgPSB5by5hdGxhcy5jZW50cm9WaXN0YTsKICAgICAgICAgIGRpcy4kc2V0KGRpcy5jZW50cm9WaXN0YSwgIngiLCBjb29yZHMueCk7CiAgICAgICAgICBkaXMuJHNldChkaXMuY2VudHJvVmlzdGEsICJ5IiwgY29vcmRzLnkpOwogICAgICAgICAgZGlzLiRzdG9yZS5jb21taXQoInNldENlbnRyb1Zpc3RhQXRsYXMiLCBjb29yZHMpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5sb2coYGVycm9yIGZldGNoaW5nIGNlbnRybyB2aXN0YTogJHtlcnJvcn1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBzZWxlY2Npb25Ob2RvKG5vZG8pIHsKICAgICAgdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8gPSBub2RvLmlkOwogICAgfSwKICAgIGFzeW5jIGVsaW1pbmFyVmluY3VsbyhhcmdzKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygKICAgICAgICBgZWxpbWluYW5kbyB1biB2aW5jdWxvIGVudHJlICR7YXJncy5pZE5vZG9Gcm9tfSB5ICR7YXJncy5pZE5vZG9Ub30gYAogICAgICApOwogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaWROb2RvRnJvbTogSUQhLCAkaWROb2RvVG86IElEISkgewogICAgICAgICAgICAgIGVsaW1pbmFyVmluY3Vsb0Zyb21UbygKICAgICAgICAgICAgICAgIGlkU291cmNlOiAkaWROb2RvRnJvbQogICAgICAgICAgICAgICAgaWRUYXJnZXQ6ICRpZE5vZG9UbwogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgbW9kaWZpY2Fkb3MgewogICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgICB2aW5jdWxvcyB7CiAgICAgICAgICAgICAgICAgICAgaWRSZWYKICAgICAgICAgICAgICAgICAgICB0aXBvCiAgICAgICAgICAgICAgICAgICAgcm9sCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaWROb2RvRnJvbTogYXJncy5pZE5vZG9Gcm9tLAogICAgICAgICAgICBpZE5vZG9UbzogYXJncy5pZE5vZG9UbywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7fSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZGlidWphclZpbmN1bG9zR3Jpc2VzKCkgewogICAgICB0aGlzLmFjdHVhbGl6YXJWaW5jdWxvc0dyaXNlcysrOwogICAgfSwKICAgIGFzeW5jIGNyZWFyVmluY3VsbyhhcmdzKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZyhgY3JlYW5kbyB1biB2aW5jdWxvICR7SlNPTi5zdHJpbmdpZnkoYXJncyl9IGApOwogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkdGlwbzogU3RyaW5nISwgJGlkTm9kb0Zyb206IElEISwgJGlkTm9kb1RvOiBJRCEpIHsKICAgICAgICAgICAgICBjcmVhclZpbmN1bG8oCiAgICAgICAgICAgICAgICB0aXBvOiAkdGlwbwogICAgICAgICAgICAgICAgaWRTb3VyY2U6ICRpZE5vZG9Gcm9tCiAgICAgICAgICAgICAgICBpZFRhcmdldDogJGlkTm9kb1RvCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBtb2RpZmljYWRvcyB7CiAgICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICAgIHZpbmN1bG9zIHsKICAgICAgICAgICAgICAgICAgICBpZFJlZgogICAgICAgICAgICAgICAgICAgIHJvbAogICAgICAgICAgICAgICAgICAgIHRpcG8KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICB0aXBvOiAiY29udGludWFjaW9uIiwKICAgICAgICAgICAgaWROb2RvRnJvbTogYXJncy5pZE5vZG9Gcm9tLAogICAgICAgICAgICBpZE5vZG9UbzogYXJncy5pZE5vZG9UbywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7fSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgc2VuZFVwZGF0ZXNOb2RvcygpIHsKICAgICAgLy8gZm9yKHZhciBub2RvIG9mIHRoaXMuJHJlZnMubm9kb3NSZW5kZXIpewogICAgICAvLyAgIGlmKCkKICAgICAgLy8gfQogICAgfSwKCiAgICB6b29tVmlzdGEoZGVsdGFab29tKSB7CiAgICAgIHZhciBudWV2b1pvb20gPSB0aGlzLnpvb20gKyBkZWx0YVpvb207CiAgICAgIGlmIChudWV2b1pvb20gPCB0aGlzLm1pblpvb20pIHsKICAgICAgICB0aGlzLnpvb20gPSB0aGlzLm1pblpvb207CiAgICAgIH0gZWxzZSBpZiAobnVldm9ab29tID4gdGhpcy5tYXhab29tKSB7CiAgICAgICAgdGhpcy56b29tID0gdGhpcy5tYXhab29tOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuem9vbSA9IG51ZXZvWm9vbTsKICAgICAgfQoKICAgICAgLy9QYW4gdmlzdGEgZGUgYWN1ZXJkbyBjb24gbGEgcG9zaWNpw7NuIGRlbCBtb3VzZSByZXNwZWN0byBkZWwgYXRsYXMKICAgIH0sCiAgICB6b29tV2hlZWwoZSkgewogICAgICBpZiAoIXRoaXMuaG92ZXJlZCB8fCAhZS5jdHJsS2V5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgIHZhciBjb250ZW5lZG9yID0gdGhpcy4kZWw7CiAgICAgIGxldCBwb3NDb250ZW5lZG9yID0gY29udGVuZWRvci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIGNvbnN0IHBvc1pvb20gPSB7CiAgICAgICAgeDoKICAgICAgICAgIE1hdGgucm91bmQoKGUuY2xpZW50WCAtIHBvc0NvbnRlbmVkb3IubGVmdCkgLyB0aGlzLmZhY3Rvclpvb20pICsKICAgICAgICAgIHRoaXMuY2VudHJvVmlzdGEueCwKICAgICAgICB5OgogICAgICAgICAgTWF0aC5yb3VuZCgoZS5jbGllbnRZIC0gcG9zQ29udGVuZWRvci50b3ApIC8gdGhpcy5mYWN0b3Jab29tKSArCiAgICAgICAgICB0aGlzLmNlbnRyb1Zpc3RhLnksCiAgICAgIH07CgogICAgICAvLyBjb25zdCBwcm9wb3JjaW9uZXMgPSB7CiAgICAgIC8vICAgeDoKICAgICAgLy8gICAgIChwb3Nab29tLnggLSB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC54KSAvCiAgICAgIC8vICAgICAocG9zQ29udGVuZWRvci53aWR0aCAvIHRoaXMuZmFjdG9yWm9vbSksCiAgICAgIC8vICAgeToKICAgICAgLy8gICAgIChwb3Nab29tLnkgLSB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC55KSAvCiAgICAgIC8vICAgICAocG9zQ29udGVuZWRvci5oZWlnaHQgLyB0aGlzLmZhY3Rvclpvb20pLAogICAgICAvLyB9OwoKICAgICAgY29uc3QgZmFjdG9yWm9vbSA9IDAuMjsKICAgICAgdGhpcy56b29tVmlzdGEoLU1hdGgucm91bmQoZS5kZWx0YVkgKiBmYWN0b3Jab29tKSwgewogICAgICAgIHg6IHBvc1pvb20ueCwKICAgICAgICB5OiBwb3Nab29tLnksCiAgICAgIH0pOwogICAgfSwKICAgIGhpZGVab29tSW5mbzogZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnNob3dpbmdab29tSW5mbyA9IGZhbHNlOwogICAgfSwgMTAwMCksCiAgfSwKICB3YXRjaDogewogICAgaWRDb2xlY2Npb25TZWxlY2Npb25hZGEoaWRDb2xlY2Npb24pIHsKICAgICAgdGhpcy5zZWxlY2Npb25hbmRvQ29sZWNjaW9uID0gZmFsc2U7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKAogICAgICAgICJhdGxhc0Nvbm9jaW1pZW50b0lkTGFzdENvbGVjY2lvblRhcmdldCIsCiAgICAgICAgaWRDb2xlY2Npb24KICAgICAgKTsKICAgICAgaWYgKGlkQ29sZWNjaW9uKSB7CiAgICAgICAgY29uc29sZS5sb2coIlNldHRpbmcgbGFzdFRhcmdldCIpOwogICAgICB9CiAgICB9LAogICAgc2VsZWNjaW9uYW5kb0NvbGVjY2lvbigpIHsKICAgICAgdGhpcy5tb3N0cmFuZG9PcGNpb25lc0NvbGVjY2lvbiA9IGZhbHNlOwogICAgfSwKICAgIG5vZG9TZWxlY2Npb25hZG86IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5hY3R1YWxpemFyVHJhem9zKys7CiAgICB9LAogICAgcm91dGU6IGZ1bmN0aW9uICh0bykgewogICAgICBjb25zb2xlLmxvZyhgY2FtYmlvIGRlIG5hdmVnYWNpw7NuIGEgJHt0by5wYXRofWApOwogICAgfSwKICAgIGlkTm9kb1RhcmdldChpZE5vZG9UYXJnZXQpIHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImF0bGFzQ29ub2NpbWllbnRvSWRMYXN0Tm9kb1RhcmdldCIsIGlkTm9kb1RhcmdldCk7CgogICAgICBpZiAoIWlkTm9kb1RhcmdldCkgewogICAgICAgIHRoaXMuaWRzTmVjZXNhcmlvc1BhcmFUYXJnZXQgPSBbXTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pZHNOZWNlc2FyaW9zUGFyYVRhcmdldCA9IHRoaXMuZW5jb250cmFyTm9kb3NOZWNlc2FyaW9zRGVOb2RvKAogICAgICAgIGlkTm9kb1RhcmdldCwKICAgICAgICBbXQogICAgICApOwogICAgfSwKICAgIHpvb20oKSB7CiAgICAgIHRoaXMuc2hvd2luZ1pvb21JbmZvID0gdHJ1ZTsKICAgICAgdGhpcy5oaWRlWm9vbUluZm8oKTsKICAgIH0sCiAgICBub2Rvc1JlbmRlcigpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLiRyZWZzLmVubGFjZXNOb2RvcykgewogICAgICAgICAgY29uc29sZS5sb2coIk5vIGhheSBlbmxhY2VzIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKGBIYXkgJHt0aGlzLiRyZWZzLmVubGFjZXNOb2Rvcy5sZW5ndGh9IGVubGFjZXMgZGUgbm9kb3NgKTsKICAgICAgICBmb3IgKGNvbnN0IGVubGFjZSBvZiB0aGlzLiRyZWZzLmVubGFjZXNOb2RvcykgewogICAgICAgICAgZW5sYWNlLnNldFZpbmN1bG9zR3Jpc2VzKCk7CiAgICAgICAgfQogICAgICB9LCAxMDAwKTsKICAgIH0sCiAgICAvLwogIH0sCiAgbW91bnRlZCgpIHsKICAgIC8vIGlmICghdGhpcy51c3VhcmlvLmF0bGFzIHx8ICF0aGlzLnVzdWFyaW8uYXRsYXMuY2VudHJvVmlzdGEpIHsKICAgIC8vICAgY29uc29sZS5sb2coYE5vIGhhYsOtYSBpbmZvIGRlIGNlbnRybyB2aXN0YSBlbiBsYSBzdG9yZS4gRGVzY2FyZ2FuZG9gKTsKICAgIC8vICAgdGhpcy5kZXNjYXJnYXJDZW50cm9WaXN0YSgpOwogICAgLy8gICByZXR1cm47CiAgICAvLyB9CiAgICAvLyB0aGlzLiRzZXQodGhpcy5jZW50cm9WaXN0YURlY2ltYWwsICJ4IiwgdGhpcy51c3VhcmlvLmF0bGFzLmNlbnRyb1Zpc3RhLngpOwogICAgLy8gdGhpcy4kc2V0KHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLCAieSIsIHRoaXMudXN1YXJpby5hdGxhcy5jZW50cm9WaXN0YS55KTsKCiAgICBpZiAoc2NyZWVuLndpZHRoIDwgNjAwKSB7CiAgICAgIHRoaXMuem9vbSA9IDcwOwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIHRoaXMuem9vbVdoZWVsLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogIH0sCiAgcmVtb3ZlZCgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJ3aGVlbCIsIHRoaXMuem9vbVdoZWVsKTsKICB9LAogIC8vIGJlZm9yZVJvdXRlTGVhdmUoXywgX18sIG5leHQpIHsKICAvLyAgIGNvbnNvbGUubG9nKAogIC8vICAgICBgZW52aWFuZG8gbnVldm8gY2VudHJvVmlzdGEgcGFyYSBlbCB1c3VhcmlvICR7CiAgLy8gICAgICAgdGhpcy51c3VhcmlvLmlkCiAgLy8gICAgIH0uIENlbnRybyB2aXN0YTogJHtKU09OLnN0cmluZ2lmeSh0aGlzLmNlbnRyb1Zpc3RhKX1gCiAgLy8gICApOwogIC8vICAgdGhpcy4kc3RvcmUuY29tbWl0KCJzZXRDZW50cm9WaXN0YUF0bGFzIiwgdGhpcy5jZW50cm9WaXN0YSk7CgogIC8vICAgdGhpcy4kYXBvbGxvCiAgLy8gICAgIC5tdXRhdGUoewogIC8vICAgICAgIG11dGF0aW9uOiBncWxgCiAgLy8gICAgICAgICBtdXRhdGlvbigkaWRVc3VhcmlvOiBJRCwgJGNlbnRyb1Zpc3RhOiBDb29yZHNJbnB1dCkgewogIC8vICAgICAgICAgICBzZXRDZW50cm9WaXN0YShpZFVzdWFyaW86ICRpZFVzdWFyaW8sIGNlbnRyb1Zpc3RhOiAkY2VudHJvVmlzdGEpCiAgLy8gICAgICAgICB9CiAgLy8gICAgICAgYCwKICAvLyAgICAgICB2YXJpYWJsZXM6IHsKICAvLyAgICAgICAgIGlkVXN1YXJpbzogdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5pZCwKICAvLyAgICAgICAgIGNlbnRyb1Zpc3RhOiB0aGlzLmNlbnRyb1Zpc3RhLAogIC8vICAgICAgIH0sCiAgLy8gICAgIH0pCiAgLy8gICAgIC50aGVuKGZ1bmN0aW9uICgpIHsKICAvLyAgICAgICBuZXh0KCk7CiAgLy8gICAgIH0pCiAgLy8gICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAvLyAgICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgLy8gICAgICAgbmV4dCgpOwogIC8vICAgICB9KTsKICAvLyB9LAp9Owo="},{"version":3,"sources":["AtlasConocimiento.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AtlasConocimiento.vue","sourceRoot":"src/components/atlasConocimiento","sourcesContent":["<template>\n  <div\n    class=\"atlasConocimiento\"\n    :style=\"{ overflowY: nodoAbierto ? 'scroll' : 'hidden' }\"\n    @mousedown.left.exact.stop=\"panningVista = true\"\n    @mouseenter=\"hovered = true\"\n    @mouseleave=\"hovered = false\"\n    @click=\"\n      idNodoMenuCx = null;\n      cerrarBusqueda++;\n    \"\n  >\n    <router-view\n      :yo=\"yo\"\n      :datosNodosRepasar=\"datosNodosRepasar\"\n      :datosNodosUrgentes=\"datosNodosRepasar\"\n      @centrarEnNodo=\"centrarEnNodoById($event)\"\n    />\n    <div\n      id=\"zonaSeleccionColeccion\"\n      v-if=\"yo.atlas && yo.atlas.colecciones\"\n      v-show=\"!idNodoTarget\"\n    >\n      <div\n        id=\"nombreColeccion\"\n        @click.stop=\"seleccionandoColeccion = !seleccionandoColeccion\"\n      >\n        <pie-progreso\n          v-if=\"coleccionSeleccionada && progresoColeccionSeleccionada\"\n          :progreso=\"progresoColeccionSeleccionada\"\n          style=\"margin-right: 10px\"\n        />\n        <span style=\"z-index: 1\">\n          {{ nombreColeccionSeleccionada }}\n        </span>\n      </div>\n\n      <div\n        class=\"boton\"\n        id=\"botonMostrarOpcionesColeccion\"\n        v-show=\"!seleccionandoColeccion\"\n        @click=\"mostrandoOpcionesColeccion = !mostrandoOpcionesColeccion\"\n      >\n        <img\n          src=\"@/assets/iconos/ellipsisVertical.svg\"\n          alt=\"Opciones\"\n          style=\"\"\n        />\n      </div>\n\n      <div\n        id=\"contenedorControlesColeccion\"\n        v-show=\"mostrandoOpcionesColeccion\"\n      >\n        <div class=\"boton controlColeccion\" @click=\"localizarNext('available')\">\n          <img\n            src=\"@/assets/iconos/atlas/locationCrosshair.svg\"\n            alt=\"Localizar\"\n            style=\"filter: var(--filtroAtlasAvailable)\"\n          />\n        </div>\n        <div class=\"boton controlColeccion\" @click=\"localizarNext('check')\">\n          <img\n            src=\"@/assets/iconos/atlas/locationCrosshair.svg\"\n            alt=\"Localizar\"\n            style=\"filter: var(--filtroAtlasCheck)\"\n          />\n        </div>\n        <div class=\"boton controlColeccion\" @click=\"localizarNext('repaso')\" :class=\"{deshabilitado:!idsNodosRepasarPresentes || idsNodosRepasarPresentes.length===0}\">\n          <img\n            src=\"@/assets/iconos/atlas/locationCrosshair.svg\"\n            alt=\"Localizar\"\n            style=\"filter: var(--filtroAtlasRepaso)\"\n          />\n        </div>\n      </div>\n\n      <div id=\"listaSelectoresColeccion\" v-show=\"seleccionandoColeccion\">\n        <div\n          class=\"selectorColeccion\"\n          @click.stop=\"setIdColeccionSeleccionada(null)\"\n          v-show=\"idColeccionSeleccionada\"\n        >\n          <img\n            src=\"@/assets/iconos/userNodes.png\"\n            alt=\"Coleccion\"\n            style=\"height: 15px\"\n          />\n          Atlas\n        </div>\n        <div\n          class=\"selectorColeccion\"\n          @click.stop=\"setIdColeccionSeleccionada(coleccion.id)\"\n          v-for=\"coleccion of coleccionesUsuario.filter(\n            (col) => idColeccionSeleccionada != col.id\n          )\"\n          :key=\"coleccion.id\"\n        >\n          <img\n            src=\"@/assets/iconos/userNodes.png\"\n            alt=\"Coleccion\"\n            style=\"height: 15px\"\n          />\n          {{ coleccion.nombre }}\n        </div>\n      </div>\n    </div>\n    <transition name=\"fadeOut\">\n      <div v-show=\"showingZoomInfo\" id=\"infoZoom\">x{{ factorZoom }}</div>\n    </transition>\n    <div\n      id=\"menuContextual\"\n      :style=\"[offsetMenuContextual]\"\n      v-show=\"mostrandoMenuContextual\"\n    >\n      <div\n        class=\"botonMenuContextual\"\n        id=\"botonCrearNuevoNodo\"\n        :class=\"{ deshabilitado: posicionCreandoNodo }\"\n        v-if=\"usuarioAdministradorAtlas || usuarioProfe\"\n        @click=\"crearNodoEnMenuContextual\"\n      >\n        Crear Nodo de conocimiento\n      </div>\n    </div>\n\n    <div id=\"zonaNodoTarget\" v-show=\"idNodoTarget\">\n      <div\n        id=\"nombreNodoTarget\"\n        v-if=\"nodoTarget\"\n        @click=\"centrarEnNodo(nodoTarget)\"\n      >\n        <pie-progreso\n          v-show=\"\n            progresoNodoTarget && !$apollo.queries.progresoNodoTarget.loading\n          \"\n          :progreso=\"progresoNodoTarget\"\n          :size=\"40\"\n          :cifrasDecimales=\"0\"\n        />\n        <img\n          style=\"\n            height: 25px;\n            filter: var(--filtroBlanco);\n            margin: 2px 5px;\n            margin-right: 15px;\n          \"\n          src=\"@/assets/iconos/target.png\"\n          alt=\"Target\"\n        />\n\n        {{ nodoTarget.nombre }}\n      </div>\n\n      <div class=\"boton\" @click.stop=\"configurarNodoTarget(null)\">\n        <img src=\"@/assets/iconos/equis.svg\" alt=\"Equis\" />\n      </div>\n    </div>\n\n    <div\n      id=\"botonCallingPosiciones\"\n      v-if=\"usuarioSuperadministrador && usuario.username == 'juanMamian'\"\n      @click.stop=\"iniciarCallingPosiciones\"\n      :class=\"{ deshabilitado: callingPosiciones }\"\n      :style=\"[\n        { backgroundColor: callingPosiciones ? 'green' : 'transparent' },\n      ]\"\n    ></div>\n    <buscador-nodos-conocimiento\n      @nodoSeleccionado=\"centrarEnNodo\"\n      ref=\"buscadorNodos\"\n      :cerrarBusqueda=\"cerrarBusqueda\"\n    />\n\n    <panel-conjuntos-nodos\n      ref=\"panelConjuntosNodos\"\n      :yo=\"yo\"\n      :modoAtlas=\"modoAtlas\"\n      @centrarEnNodo=\"centrarEnNodo(todosNodos.find((n) => n.id == $event))\"\n    />\n\n    <div\n      id=\"contenedorDiagrama\"\n      v-show=\"!$apollo.queries.yo.loading\"\n      ref=\"contenedorDiagrama\"\n      @contextmenu.self.exact.prevent=\"abrirMenuContextual\"\n      @mouseup.left.self=\"clickFondoAtlas\"\n    >\n      <div id=\"contenedorVinculosNodos\" :style=\"[offsetContenedorNodos]\">\n        <enlaces-nodo-conocimiento\n          v-for=\"nodo of nodosRender\"\n          :key=\"nodo.id\"\n          :yo=\"yo\"\n          ref=\"enlacesNodos\"\n          :idNodoSeleccionado=\"idNodoSeleccionado\"\n          :esteNodo=\"nodo\"\n          :todosNodos=\"todosNodos\"\n          :factorZoom=\"factorZoom\"\n          :esquinasDiagrama=\"esquinasDiagrama\"\n          :nodoSeleccionado=\"nodoSeleccionado\"\n          :redibujarEnlaces=\"redibujarEnlacesNodos\"\n          :idsTodosNodosRender=\"idsTodosNodosRender\"\n          :callingPosiciones=\"callingPosiciones\"\n          :conectadoSeleccionado=\"\n            idsNodosConectadosSeleccionado.includes(nodo.id)\n          \"\n          :idsNodosConectadosSeleccionado=\"idsNodosConectadosSeleccionado\"\n          :idsNodosContinuacionSeleccionado=\"idsNodosContinuacionSeleccionado\"\n          :idsNodosPreviosSeleccionado=\"idsNodosPreviosSeleccionado\"\n          :idsNodosPresentesCabeza=\"idsNodosPresentesCabeza\"\n        />\n      </div>\n      <div\n        id=\"contenedorNodos\"\n        ref=\"contenedorNodos\"\n        :style=\"[offsetContenedorNodos]\"\n      >\n        <loading\n          texto=\"\"\n          v-show=\"posicionCreandoNodo\"\n          style=\"position: absolute\"\n          :style=\"[offsetLoadingCreandoNodo]\"\n        />\n        <nodo-conocimiento\n          :key=\"nodo.id\"\n          v-for=\"nodo of nodosRender\"\n          :esteNodo=\"nodo\"\n          ref=\"nodosRender\"\n          :nodoSeleccionado=\"nodoSeleccionado\"\n          :todosNodos=\"todosNodos\"\n          :idNodoMenuCx=\"idNodoMenuCx\"\n          :usuarioAdministradorAtlas=\"usuarioAdministradorAtlas\"\n          :yo=\"yo\"\n          :modoAtlas=\"modoAtlas\"\n          :esquinasDiagrama=\"esquinasDiagrama\"\n          :centroVista=\"centroVista\"\n          :esNodoObjetivo=\"idsNodosObjetivos.includes(nodo.id)\"\n          :esTarget=\"idNodoTarget == nodo.id\"\n          :idsNodosAprendidos=\"idsNodosAprendidos\"\n          :idsNodosEstudiados=\"idsNodosEstudiados\"\n          :idsNodosFrescos=\"idsNodosFrescos\"\n          :idsNodosPresentesCabeza=\"idsNodosPresentesCabeza\"\n          :idsNodosRepasar=\"idsNodosRepasar\"\n          :factorZoom=\"factorZoom\"\n          :seleccionado=\"idNodoSeleccionado === nodo.id\"\n          :escondido=\"\n            idNodoTarget &&\n            !idsNecesariosParaTarget.includes(nodo.id) &&\n            idNodoTarget != nodo.id\n          \"\n          :configuracionAtlas=\"configuracionAtlas\"\n          :callingPosiciones=\"callingPosiciones\"\n          :datosUsuarioEsteNodo=\"\n            yo.atlas.datosNodos.find((dn) => dn.idNodo === nodo.id) || {}\n          \"\n          :fantasmeado=\"\n            idNodoSeleccionado &&\n            idNodoSeleccionado != nodo.id &&\n            !idsNodosPreviosSeleccionado.includes(nodo.id) &&\n            !idsNodosContinuacionSeleccionado.includes(nodo.id)\n          \"\n          :previoDeSeleccionado=\"\n            idNodoSeleccionado && idsNodosPreviosSeleccionado.includes(nodo.id)\n          \"\n          :continuacionDeSeleccionado=\"\n            idNodoSeleccionado &&\n            idsNodosContinuacionSeleccionado.includes(nodo.id)\n          \"\n          :enviandoQueryTarget=\"enviandoQueryTarget\"\n          @contextmenu.native.exact.stop.prevent=\"idNodoMenuCx = nodo.id\"\n          @abroMenuContextual=\"idNodoMenuCx = nodo.id\"\n          @click.native.stop=\"seleccionNodo(nodo)\"\n          @creacionVinculo=\"crearVinculo\"\n          @eliminacionVinculo=\"eliminarVinculo\"\n          @cambioDePosicionManual=\"cambiarCoordsManualesNodo\"\n          @eliminar=\"eliminarNodo\"\n          @cambieEstadoObjetivo=\"setEstadoObjetivoNodoCache($event, nodo.id)\"\n          @tengoNuevoValorAprendido=\"setNodoAprendidoCache($event, nodo.id)\"\n          @mePongoEnMira=\"configurarNodoTarget(nodo.id)\"\n        />\n      </div>\n    </div>\n\n    <div id=\"barraInferior\">\n      <div\n        class=\"boton\"\n        title=\"Mostrar colecciones\"\n        @click=\"$refs.panelConjuntosNodos.abierto = true\"\n      >\n        <img src=\"@/assets/iconos/userNodes.png\" alt=\"Nodos de usuario\" />\n      </div>\n\n      <div\n        class=\"boton\"\n        :title=\"\n          'Cambiar a modo ' + modoAtlas === 'experto' ? 'estudiante' : 'experto'\n        \"\n        :class=\"{ deshabilitado: enviandoQueryModo }\"\n        @click=\"setModo(modoAtlas === 'estudiante' ? 'experto' : 'estudiante')\"\n      >\n        <img\n          src=\"@/assets/iconos/teacher.svg\"\n          v-if=\"modoAtlas === 'experto'\"\n          alt=\"Experto\"\n        />\n        <img\n          src=\"@/assets/iconos/estudiante.png\"\n          v-if=\"modoAtlas === 'estudiante'\"\n          alt=\"Estudiante\"\n        />\n      </div>\n\n      <div\n        class=\"boton\"\n        title=\"Mostrar temas para repasar\"\n        @click=\"$router.push({ name: 'ventanaRepasos' })\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n          <path\n            d=\"M256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512zM232 256C232 264 236 271.5 242.7 275.1L338.7 339.1C349.7 347.3 364.6 344.3 371.1 333.3C379.3 322.3 376.3 307.4 365.3 300L280 243.2V120C280 106.7 269.3 96 255.1 96C242.7 96 231.1 106.7 231.1 120L232 256z\"\n            :fill=\"\n              datosNodosRepasar.length > 0\n                ? 'var(--atlasConocimientoRepaso)'\n                : ''\n            \"\n          />\n        </svg>\n      </div>\n    </div>\n\n    <loading\n      id=\"simboloDescargandoNodos\"\n      v-show=\"!nodosDescargados || $apollo.queries.yo.loading\"\n      texto=\"descargando nodos de conocimiento\"\n    />\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport NodoConocimiento from \"./NodoConocimiento.vue\";\nimport BuscadorNodosConocimiento from \"./BuscadorNodosConocimiento.vue\";\nimport Loading from \"../utilidades/Loading.vue\";\nimport PanelConjuntosNodos from \"./PanelConjuntosNodos.vue\";\nimport EnlacesNodoConocimiento from \"./EnlacesNodoConocimiento.vue\";\nimport { fragmentoDatoNodoConocimiento } from \"./fragsAtlasConocimiento\";\nimport PieProgreso from \"../utilidades/PieProgreso.vue\";\nconst debounce = require(\"debounce\");\n\nexport const fragmentoColecciones = gql`\n  fragment fragColecciones on ColeccionNodosAtlasConocimiento {\n    id\n    nombre\n    idsNodos\n    nodos {\n      id\n      nombre\n    }\n  }\n`;\n\nconst fragmentoNodoConocimiento = gql`\n  fragment fragNodoConocimiento on NodoConocimiento {\n    id\n    nombre\n    descripcion\n    expertos\n    tipoNodo\n    clases {\n      id\n      nombre\n      idExperto\n      interesados\n    }\n    coordsManuales {\n      x\n      y\n    }\n    coords {\n      x\n      y\n    }\n    autoCoords {\n      x\n      y\n    }\n    centroMasa {\n      x\n      y\n    }\n    stuck\n    angulo\n    puntaje\n    vinculos {\n      id\n      idRef\n      rol\n      tipo\n    }\n    fuerzaCentroMasa {\n      fuerza\n      direccion\n    }\n    fuerzaColision {\n      fuerza\n      direccion\n    }\n  }\n`;\n\nconst QUERY_NODOS = gql`\n  query todosNodos {\n    todosNodos {\n      ...fragNodoConocimiento\n    }\n  }\n  ${fragmentoNodoConocimiento}\n`;\n\nexport const QUERY_DATOS_USUARIO_NODOS = gql`\n  query {\n    yo {\n      id\n      atlas {\n        datosNodos {\n          ...fragDatoNodoConocimiento\n        }\n        configuracion {\n          modo\n        }\n        colecciones {\n          ...fragColecciones\n        }\n      }\n    }\n  }\n  ${fragmentoDatoNodoConocimiento}\n  ${fragmentoColecciones}\n`;\n\nexport default {\n  components: {\n    NodoConocimiento,\n    BuscadorNodosConocimiento,\n    Loading,\n    PanelConjuntosNodos,\n    EnlacesNodoConocimiento,\n    PieProgreso,\n  },\n  name: \"AtlasConocimiento\",\n  apollo: {\n    todosNodos: {\n      query: QUERY_NODOS,\n      result: function () {\n        this.dibujarVinculosGrises();\n      },\n      update({ todosNodos }) {\n        this.nodosDescargados = true;\n        var nuevoTodosNodos = JSON.parse(JSON.stringify(todosNodos));\n        nuevoTodosNodos.forEach((nodo) => {\n          nodo.coordsManuales = nodo.autoCoords;\n          nodo.coords = nodo.autoCoords;\n        });\n\n        const idLastNodoTarget = localStorage.getItem(\n          \"atlasConocimientoIdLastNodoTarget\"\n        );\n\n        if (idLastNodoTarget) {\n          const nodoLast = todosNodos.find((n) => n.id === idLastNodoTarget);\n          if (nodoLast) {\n            this.idNodoTarget = nodoLast.id;\n          }\n        }\n        return nuevoTodosNodos;\n      },\n      fetchPolicy: \"cache-first\",\n    },\n    yo: {\n      query: QUERY_DATOS_USUARIO_NODOS,\n      skip() {\n        return !this.usuarioLogeado || this.todosNodos.length < 1;\n      },\n      update({ yo }) {\n        const idLastColeccionTarget = localStorage.getItem(\n          \"atlasConocimientoIdLastColeccionTarget\"\n        );\n\n        console.log(`ID lastColeccionTarget: ${idLastColeccionTarget}`);\n\n        if (idLastColeccionTarget && yo.atlas?.colecciones) {\n          const coleccionLast = yo.atlas?.colecciones.find(\n            (col) => col.id === idLastColeccionTarget\n          );\n          if (coleccionLast) {\n            this.idColeccionSeleccionada = coleccionLast.id;\n          }\n        }\n        return yo;\n      },\n    },\n    configuracionAtlas: {\n      query: gql`\n        query ($nombreAtlas: String!) {\n          configuracionAtlas(nombreAtlas: $nombreAtlas) {\n            id\n            posicionando\n          }\n        }\n      `,\n      variables: {\n        nombreAtlas: \"conocimiento\",\n      },\n      fetchPolicy: \"network-only\",\n    },\n    progresoNodoTarget: {\n      query: gql`\n        query ($idNodo: ID!) {\n          nodo(idNodo: $idNodo) {\n            id\n            porcentajeCompletado\n          }\n        }\n      `,\n      variables() {\n        return {\n          idNodo: this.idNodoTarget,\n        };\n      },\n      skip() {\n        return !this.idNodoTarget;\n      },\n      update({ nodo }) {\n        return nodo.porcentajeCompletado;\n      },\n    },\n    progresoColeccionSeleccionada: {\n      query: gql`\n        query ($idColeccion: ID!, $idUsuario: ID!) {\n          coleccionNodosConocimiento(\n            idColeccion: $idColeccion\n            idUsuario: $idUsuario\n          ) {\n            id\n            progreso\n          }\n        }\n      `,\n      variables() {\n        return {\n          idColeccion: this.idColeccionSeleccionada,\n          idUsuario: this.usuario.id,\n        };\n      },\n      update({ coleccionNodosConocimiento }) {\n        return coleccionNodosConocimiento.progreso;\n      },\n      skip() {\n        return !this.idColeccionSeleccionada;\n      },\n    },\n  },\n  data() {\n    return {\n      configuracionAtlas: {\n        posicionando: false,\n      },\n      hovered: false,\n      todosNodos: [],\n      nodosDescargados: false,\n      posicionCreandoNodo: null,\n      idNodoSeleccionado: null,\n      idsNodosCadenaPreviaSeleccionado: [],\n      idNodoMenuCx: null,\n      idsNecesariosParaTarget: [],\n      enviandoQueryModo: false,\n      modoAtlas: \"estudiante\",\n      enviandoQueryTarget: false,\n\n      redibujarEnlacesNodos: 0,\n\n      yo: {\n        atlas: {\n          datosNodos: [],\n          configuracion: {\n            modo: \"estudiante\",\n          },\n        },\n      },\n\n      centroVistaDecimal: {\n        x: 218,\n        y: 39,\n      },\n      showingZoomInfo: false,\n      zoom: 80,\n      minZoom: 20,\n      maxZoom: 200,\n      pinching: false,\n      lastPinchDistance: 0,\n      actualizarTrazos: 0,\n      panningVista: false,\n      vistaPanned: false,\n\n      actualizarVinculosGrises: 0,\n\n      ultimoTouchX: 0,\n      ultimoTouchY: 0,\n\n      cerrarBusqueda: 0,\n\n      callingPosiciones: false,\n\n      mostrandoMenuContextual: false,\n      offsetMenuContextual: {\n        top: \"0px\",\n        left: \"0px\",\n      },\n      enviandoQueryConfiguracionAtlas: false,\n\n      idColeccionSeleccionada: null,\n      seleccionandoColeccion: false,\n      mostrandoOpcionesColeccion: false,\n\n      indexLastLocateNextAvailable: 0,\n      indexLastLocateNextCheck: 0,\n      indexLastLocateNextRepaso: 0,\n\n      idColeccionTargetOnLastLocalizacion: null,\n\n      idNodoTarget: null,\n    };\n  },\n  computed: {\n    nombreColeccionSeleccionada() {\n      if (!this.idColeccionSeleccionada) {\n        return \"Atlas\";\n      }\n\n      return this.coleccionSeleccionada?.nombre || \"Cargando\";\n    },\n    coleccionSeleccionada() {\n      if (!this.idColeccionSeleccionada) {\n        return null;\n      }\n      return this.coleccionesUsuario.find(\n        (col) => col.id === this.idColeccionSeleccionada\n      );\n    },\n    coleccionesUsuario() {\n      if (!this.yo?.atlas?.colecciones) {\n        return [];\n      }\n\n      return this.yo.atlas.colecciones;\n    },\n    idsNodosObjetivos() {\n      if (!this.yo || !this.yo.atlas || !this.yo.atlas.datosNodos) {\n        return [];\n      }\n      return this.yo.atlas.datosNodos\n        .filter((n) => n.objetivo == true)\n        .map((n) => n.idNodo);\n    },\n    nodosObjetivo() {\n      if (!this.todosNodos) return [];\n      return this.todosNodos.filter((n) =>\n        this.idsNodosObjetivos.includes(n.id)\n      );\n    },\n    nodoSeleccionado: function () {\n      if (!this.idNodoSeleccionado) {\n        return null;\n      }\n      return this.todosNodos.find((n) => n.id === this.idNodoSeleccionado);\n    },\n    idUsuario: function () {\n      return this.$store.state.usuario.id;\n    },\n    usuarioAdministradorAtlas: function () {\n      if (!this.$store.state.usuario.permisos) return false;\n      return this.$store.state.usuario.permisos.includes(\"atlasAdministrador\")\n        ? true\n        : false;\n    },\n\n    nodoTarget() {\n      if (!this.idNodoTarget) return null;\n      return this.todosNodos.find((n) => n.id === this.idNodoTarget);\n    },\n    idsNodosAprendidos() {\n      return this.yo.atlas.datosNodos\n        .filter((n) => n.aprendido === true)\n        .map((n) => n.idNodo);\n    },\n    datosNodosEstudiados() {\n      return this.yo.atlas.datosNodos.filter(\n        (n) => !n.aprendido && n.estudiado\n      );\n    },\n    idsNodosEstudiados() {\n      return this.datosNodosEstudiados.map((ne) => ne.idNodo);\n    },\n    datosNodosRepasar() {\n      if (!this.yo || !this.yo.atlas || !this.yo.atlas.datosNodos) {\n        return [];\n      }\n\n      var datosNodoConRepasoConfigurado = this.datosNodosEstudiados.filter(\n        (dn) => dn.periodoRepaso\n      );\n      let dateHoy = new Date();\n\n      let dateHoyMin = dateHoy;\n      dateHoyMin.setHours(0);\n      dateHoyMin.setMinutes(0);\n      dateHoyMin.setSeconds(0);\n\n      let datosNodoParaRepasar = datosNodoConRepasoConfigurado.filter((dn) => {\n        return (\n          new Date(dn.estudiado).getTime() + dn.periodoRepaso <\n          dateHoyMin.getTime()\n        );\n      });\n      return datosNodoParaRepasar;\n    },\n    idsNodosRepasar() {\n      return this.datosNodosRepasar.map((dn) => dn.idNodo);\n    },\n    idsNodosRepasarPresentes() {\n      if (!this.idTarget) {\n        return this.idsNodosRepasar;\n      }\n\n      return this.idsNodosRepasar.filter((id) =>\n        this.idsNodosRender.includes(id)\n      );\n    },\n    datosNodosFrescos() {\n      return this.datosNodosEstudiados.filter(\n        (dn) => !this.idsNodosRepasar.includes(dn.idNodo)\n      );\n    },\n    idsNodosFrescos() {\n      return this.datosNodosFrescos.map((nf) => nf.idNodo);\n    },\n    idsNodosPresentesCabeza() {\n      return this.idsNodosFrescos\n        .filter((idNe) => !this.idsNodosAprendidos.includes(idNe))\n        .concat(this.idsNodosAprendidos);\n    },\n    centroVista() {\n      return {\n        x: Math.round(this.centroVistaDecimal.x),\n        y: Math.round(this.centroVistaDecimal.y),\n      };\n    },\n    factorZoom() {\n      return Number((this.zoom / 100).toFixed(2));\n    },\n    esquinasDiagrama() {\n      const maxX = this.todosNodos.reduce(\n        (acc, n) => (n.autoCoords.x > acc ? n.autoCoords.x : acc),\n        0\n      );\n      const maxY = this.todosNodos.reduce(\n        (acc, n) => (n.autoCoords.y > acc ? n.autoCoords.y : acc),\n        0\n      );\n      const minX = this.todosNodos.reduce(\n        (acc, n) => (n.autoCoords.x < acc ? n.autoCoords.x : acc),\n        0\n      );\n      const minY = this.todosNodos.reduce(\n        (acc, n) => (n.autoCoords.y < acc ? n.autoCoords.y : acc),\n        0\n      );\n\n      return {\n        x1: minX,\n        y1: minY,\n\n        x2: maxX,\n        y2: maxY,\n      };\n    },\n    offsetContenedorNodos() {\n      const ancho = this.esquinasDiagrama.x2 - this.esquinasDiagrama.x1;\n      const alto = this.esquinasDiagrama.y2 - this.esquinasDiagrama.y1;\n      return {\n        // left: -(this.centroVista.x * this.factorZoom) + \"px\",\n        // top: -(this.centroVista.y * this.factorZoom) + \"px\",\n\n        width: ancho * this.factorZoom + \"px\",\n        height: alto * this.factorZoom + \"px\",\n      };\n    },\n    nodosConRequerimentos() {\n      var nr = this.todosNodos.filter((n) => n.vinculos.length > 0);\n\n      return nr;\n    },\n    nodosRender() {\n      if (this.$route.name != \"atlas\") {\n        return [];\n      }\n      if (this.idNodoTarget) {\n        return this.todosNodos\n          .filter((n) => this.idsNecesariosParaTarget.includes(n.id))\n          .concat([this.todosNodos.find((n) => this.idNodoTarget === n.id)]);\n      } else if (this.coleccionSeleccionada) {\n        let guarda = 0;\n        let idsNodosActuales = this.coleccionSeleccionada.idsNodos;\n        let todosNodosColeccion = [];\n        let nodosActuales = [];\n\n        while (guarda < 100 && idsNodosActuales.length > 0) {\n          nodosActuales = this.todosNodos.filter((n) =>\n            idsNodosActuales.includes(n.id)\n          );\n          todosNodosColeccion.push(...nodosActuales);\n          let idsTodosNodosColeccion = todosNodosColeccion.map((n) => n.id);\n\n          idsNodosActuales = [];\n          for (const nodoActual of nodosActuales) {\n            let idsVinculosRequeridos = nodoActual.vinculos\n              .filter((v) => v.tipo === \"continuacion\" && v.rol === \"target\")\n              .map((v) => v.idRef);\n            let idsVinculosNuevos = idsVinculosRequeridos.filter(\n              (idV) => !idsTodosNodosColeccion.includes(idV)\n            );\n            idsNodosActuales.push(...idsVinculosNuevos);\n          }\n        }\n\n        return todosNodosColeccion;\n      }\n      return this.todosNodos;\n    },\n    idsNodosRender(){\n      return this.nodosRender.map(n=>n.id);\n    },\n    idsTodosNodosRender() {\n      return this.nodosRender.map((n) => n.id);\n    },\n    offsetLoadingCreandoNodo() {\n      if (!this.posicionCreandoNodo) {\n        return null;\n      }\n      const left =\n        (this.posicionCreandoNodo.x - this.esquinasDiagrama.x1) *\n        this.factorZoom;\n      const top =\n        (this.posicionCreandoNodo.y - this.esquinasDiagrama.y1) *\n        this.factorZoom;\n      return {\n        left: left + \"px\",\n        top: top + \"px\",\n      };\n    },\n    nodoAbierto() {\n      return this.$route.name === \"visorNodoConocimiento\";\n    },\n    nodosConectadosAlSeleccionado() {\n      if (!this.nodoSeleccionado) return [];\n      return this.todosNodos.filter((n) =>\n        this.nodoSeleccionado.vinculos.some((v) => v.idRef === n.id)\n      );\n    },\n    idsNodosPreviosSeleccionado() {\n      if (!this.nodoSeleccionado) {\n        return [];\n      }\n      var idsActuales = [this.idNodoSeleccionado];\n      var cadenaTotal = [];\n      for (var i = 0; i < 20; i++) {\n        let previos = this.nodosRender.filter((n) =>\n          n.vinculos.some(\n            (v) => v.rol === \"source\" && idsActuales.includes(v.idRef)\n          )\n        );\n\n        if (previos.length < 1) {\n          break;\n        }\n\n        let idsPrevios = previos.map((previo) => previo.id);\n\n        cadenaTotal.push(...idsPrevios);\n\n        idsActuales = idsPrevios;\n      }\n\n      return cadenaTotal;\n    },\n    idsNodosContinuacionSeleccionado() {\n      if (!this.nodoSeleccionado) {\n        return [];\n      }\n\n      return this.nodoSeleccionado.vinculos\n        .filter((v) => v.tipo === \"continuacion\" && v.rol === \"source\")\n        .map((v) => v.idRef);\n    },\n    idsNodosConectadosSeleccionado() {\n      if (!this.nodoSeleccionado) {\n        return [];\n      }\n      return this.nodoSeleccionado.vinculos.map((v) => v.idRef);\n    },\n    idTarget() {\n      return this.idNodoTarget || this.idColeccionSeleccionada;\n    },\n  },\n  methods: {\n    localizarNext(tipo) {\n      let nodosConsiderados = [...this.nodosRender];\n\n      this.idColeccionTargetOnLastLocalizacion = this.idColeccionSeleccionada;\n      if (tipo === \"available\") {\n        let indexEncontrados = 0;\n        let nextNodo = nodosConsiderados.find((n) => {\n          if (this.idsNodosPresentesCabeza.includes(n.id)) {\n            return false;\n          }\n\n          if (this.indexLastLocateNextAvailable === n.id) {\n            return false;\n          }\n\n          let idsNodosRequeridos = n.vinculos\n            .filter((v) => v.tipo === \"continuacion\" && v.rol === \"target\")\n            .map((v) => v.idRef);\n\n          let nodosRequeridos = nodosConsiderados.filter((n) =>\n            idsNodosRequeridos.includes(n.id)\n          );\n\n          if (\n            nodosRequeridos.some(\n              (nodo) => !this.idsNodosPresentesCabeza.includes(nodo.id)\n            )\n          ) {\n            return false;\n          }\n\n          indexEncontrados++;\n\n          if (indexEncontrados <= this.indexLastLocateNextAvailable) {\n            return false;\n          }\n          return true;\n        });\n\n        if (nextNodo) {\n          this.centrarEnNodoById(nextNodo.id);\n          this.indexLastLocateNextAvailable = indexEncontrados;\n        } else {\n          this.indexLastLocateNextAvailable = 0;\n        }\n      } else if (tipo === \"check\") {\n        let indexEncontrados = 0;\n        let nextNodo = nodosConsiderados.find((n) => {\n          if (this.idsNodosPresentesCabeza.includes(n.id)) {\n            console.log(\"Estaba fresco\");\n\n            indexEncontrados++;\n\n            if (indexEncontrados <= this.indexLastLocateCheck) {\n              return false;\n            }\n            return true;\n          }\n        });\n\n        if (nextNodo) {\n          this.centrarEnNodoById(nextNodo.id);\n          this.indexLastLocateCheck = indexEncontrados;\n        } else {\n          this.indexLastLocateCheck = 0;\n        }\n      } else if (tipo === \"repaso\") {\n        if (!this.idsNodosRepasarPresentes?.length > 0) {\n          return;\n        }\n        this.indexLastLocateNextRepaso++;\n        if (this.indexLastLocateNextRepaso >= this.idsNodosRepasarPresentes.length) {\n          this.indexLastLocateNextRepaso = 0;\n        }\n\n        this.centrarEnNodoById(\n          this.idsNodosRepasarPresentes[this.indexLastLocateNextRepaso]\n        );\n      }\n    },\n    setIdColeccionSeleccionada(nuevoId) {\n      this.indexLastLocateNextAvailable = 0;\n      this.indexLastLocateNextCheck = 0;\n\n      this.idColeccionSeleccionada = nuevoId;\n    },\n    iniciarCallingPosiciones() {\n      var ciclos = prompt(\"¿Cuantos ciclos?\");\n      if (isNaN(ciclos)) {\n        return;\n      }\n\n      ciclos = Math.round(ciclos);\n      if (ciclos < 1) {\n        return;\n      }\n      console.log(`Enviando reposicionamiento de ${ciclos} ciclos`);\n      this.callingPosiciones = true;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($ciclos: Int!) {\n              posicionarNodosConocimientoByFuerzas(ciclos: $ciclos)\n            }\n          `,\n          variables: {\n            ciclos,\n          },\n        })\n        .then(() => {\n          this.callingPosiciones = false;\n        })\n        .catch((error) => {\n          this.callingPosiciones = false;\n          console.log(`Error: ${error}`);\n        });\n    },\n    togglePosicionamiento() {\n      this.enviandoQueryConfiguracionAtlas = true;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($nombreAtlas: String!) {\n              togglePosicionamientoAutomaticoAtlas(nombreAtlas: $nombreAtlas) {\n                id\n                posicionando\n              }\n            }\n          `,\n          variables: {\n            nombreAtlas: \"conocimiento\",\n          },\n        })\n        .then(() => {\n          this.enviandoQueryConfiguracionAtlas = false;\n        })\n        .catch(() => {\n          this.enviandoQueryConfiguracionAtlas = false;\n        });\n    },\n    abrirMenuContextual(e) {\n      let posDiagrama = this.$refs.contenedorDiagrama.getBoundingClientRect();\n\n      let topClick = Math.round(e.pageY - posDiagrama.top);\n      let leftClick = Math.round(e.pageX - posDiagrama.left);\n\n      this.$set(this.offsetMenuContextual, \"top\", topClick + \"px\");\n      this.$set(this.offsetMenuContextual, \"left\", leftClick + \"px\");\n      this.mostrandoMenuContextual = true;\n      //this.crearNodo({x: leftClick, y: topClick});\n    },\n    crearNodoEnMenuContextual() {\n      const posContenedorNodos =\n        this.$refs.contenedorNodos.getBoundingClientRect();\n      const distanciaLeftPx =\n        parseInt(this.offsetMenuContextual.left) -\n        parseInt(posContenedorNodos.left);\n      const distanciaTopPx =\n        parseInt(this.offsetMenuContextual.top) -\n        (parseInt(posContenedorNodos.top) - parseInt(this.$el.offsetTop));\n\n      const posPxX = distanciaLeftPx;\n      const posPxY = distanciaTopPx;\n\n      console.log(`xPix: ${parseInt(this.offsetMenuContextual.left)}`);\n      console.log(\n        `posXContenedorNodos: ${parseInt(posContenedorNodos.left)}, ${\n          posContenedorNodos.top\n        }`\n      );\n      console.log(`distanciaLeftPx: ${distanciaLeftPx}`);\n      console.log(`distanciaTopPx: ${distanciaTopPx}`);\n      console.log(\n        `Scroll x contenedorDiagrama: ${this.$refs.contenedorDiagrama.scrollLeft}`\n      );\n\n      var posicionNuevoNodo = {\n        x: parseInt(posPxX / this.factorZoom + this.esquinasDiagrama.x1),\n        y: parseInt(posPxY / this.factorZoom + this.esquinasDiagrama.y1),\n      };\n\n      console.log(`Creando nuevo nodo en ${JSON.stringify(posicionNuevoNodo)}`);\n\n      this.crearNodo(posicionNuevoNodo);\n    },\n    encontrarNodosNecesariosDeNodo(idNodo, listaTotal) {\n      const elNodo = this.todosNodos.find((n) => n.id == idNodo);\n      if (!elNodo) {\n        return listaTotal;\n      }\n      const necesarios = elNodo.vinculos\n        .filter((v) => v.rol == \"target\")\n        .map((v) => v.idRef);\n      necesarios.forEach((necesario) => {\n        if (!listaTotal.includes(necesario)) {\n          listaTotal.push(necesario);\n          listaTotal = this.encontrarNodosNecesariosDeNodo(\n            necesario,\n            listaTotal\n          );\n        }\n      });\n      return listaTotal;\n    },\n    clickFondoAtlas() {\n      // console.log(`Click en el fondo del atlas. Route name: ${this.$route.name}`);\n      if (this.$route.name != \"atlas\") {\n        this.$router.push({ name: \"atlas\" });\n        return;\n      }\n      if (!this.vistaPanned) this.idNodoSeleccionado = null;\n      this.panningVista = false;\n      this.vistaPanned = false;\n      this.$refs.panelConjuntosNodos.abierto = false;\n      this.mostrandoMenuContextual = false;\n    },\n    setEstadoObjetivoNodoCache(nuevoEstado, idNodo) {\n      console.log(\n        `Seting en cache al nodo ${idNodo} con estado objetivo: ${nuevoEstado}`\n      );\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      var indexN = nuevoCache.yo.atlas.datosNodos.findIndex(\n        (n) => n.idNodo == idNodo\n      );\n      if (indexN > -1) {\n        nuevoCache.yo.atlas.datosNodos[indexN].objetivo = nuevoEstado;\n      } else {\n        console.log(`No estaba en caché. Pushing`);\n        nuevoCache.yo.atlas.datosNodos.push({\n          __typename: \"DatoNodoUsuario\",\n          idNodo,\n          objetivo: nuevoEstado,\n          aprendido: false,\n        });\n      }\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n    setNodoAprendidoCache(nuevoEstado, idNodo) {\n      console.log(\n        `Seting en cache al nodo ${idNodo} con estado aprendido: ${nuevoEstado}`\n      );\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n      var indexN = nuevoCache.yo.atlas.datosNodos.findIndex(\n        (n) => n.idNodo == idNodo\n      );\n      if (indexN > -1) {\n        nuevoCache.yo.atlas.datosNodos[indexN].aprendido = nuevoEstado;\n      } else {\n        console.log(`No estaba en caché. Pushing`);\n        nuevoCache.yo.atlas.datosNodos.push({\n          __typename: \"DatoNodoUsuario\",\n          idNodo,\n          objetivo: false,\n          aprendido: nuevoEstado,\n        });\n      }\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n    setNodoTargetCache(idNodo) {\n      console.log(`Seting en cache al nodo ${idNodo} como target`);\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n      nuevoCache.yo.atlas.idNodoTarget = idNodo;\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n    setModo(modo) {\n      if (!this.usuarioLogeado) return;\n      this.modoAtlas = modo;\n      // this.enviandoQueryModo = true;\n\n      // this.$apollo\n      //   .mutate({\n      //     mutation: gql`\n      //       mutation ($idUsuario: ID!, $nuevoModo: String!) {\n      //         setModoUsuarioAtlas(idUsuario: $idUsuario, nuevoModo: $nuevoModo){\n      //             id\n      //             atlas{\n      //                 configuracion{\n      //                     modo\n      //                 }\n      //             }\n      //         }\n      //       }\n      //     `,\n      //     variables: {\n      //       idUsuario: this.usuario.id,\n      //       nuevoModo: modo,\n      //     },\n      //   })\n      //   .then(() => {\n      //     this.enviandoQueryModo = false;\n\n      //   })\n      //   .catch((error) => {\n      //     this.enviandoQueryModo = false;\n      //     console.log(`Error: ${error}`);\n      //   });\n    },\n    configurarNodoTarget(idNodo) {\n      this.enviandoQueryTarget = true;\n\n      console.log(`Configurando nodo target`);\n      if (!idNodo || idNodo === this.idNodoTarget) {\n        console.log(`Nulificando`);\n        setTimeout(() => {\n          this.nulificarNodoTarget();\n        }, 100);\n      } else {\n        setTimeout(() => {\n          this.setNodoTarget(idNodo);\n        }, 100);\n      }\n    },\n    setNodoTarget(idNodo) {\n      if (!idNodo) return;\n      if (this.idNodoTarget == idNodo) {\n        return;\n      }\n\n      this.idNodoTarget = idNodo;\n    },\n    nulificarNodoTarget() {\n      console.log(`Nulificando nodo target`);\n      this.idNodoTarget = null;\n    },\n    centrarEnNodo(n) {\n      const posDiagrama = this.$refs.contenedorDiagrama.getBoundingClientRect();\n      const posNodo = {\n        x: (n.autoCoords.x - this.esquinasDiagrama.x1) * this.factorZoom,\n        y: (n.autoCoords.y - this.esquinasDiagrama.y1) * this.factorZoom,\n      };\n\n      const posIdealScroll = {\n        x: parseInt(posNodo.x - posDiagrama.width / 2),\n        y: parseInt(posNodo.y - posDiagrama.height / 2),\n      };\n\n      this.$refs.contenedorDiagrama.scrollLeft = posIdealScroll.x;\n      this.$refs.contenedorDiagrama.scrollTop = posIdealScroll.y;\n\n      this.seleccionNodo(n);\n      //this.centroVista=e;\n    },\n    centrarEnNodoById(idNodo) {\n      console.log(`Centrando en nodo con id ${idNodo}`);\n      var elNodo = this.todosNodos.find((n) => n.id === idNodo);\n      if (elNodo) {\n        this.centrarEnNodo(elNodo);\n        return;\n      }\n      this.$apollo\n        .query({\n          query: gql`\n            query ($idNodo: ID!) {\n              nodo(idNodo: $idNodo) {\n                id\n                autoCoords {\n                  x\n                  y\n                }\n              }\n            }\n          `,\n          variables: {\n            idNodo,\n          },\n        })\n        .then(({ data: { nodo } }) => {\n          console.log(`Recibido nodo así: ${JSON.stringify(nodo)}`);\n          this.centrarEnNodo(nodo);\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n        });\n    },\n    iniciaMovimientoTouch(e) {\n      if (e.touches.length === 2) {\n        var dist = Math.hypot(\n          e.touches[0].pageX - e.touches[1].pageX,\n          e.touches[0].pageY - e.touches[1].pageY\n        );\n        this.lastPinchDistance = dist;\n        this.pinching = true;\n        return;\n      }\n\n      this.ultimoTouchX = e.changedTouches[0].clientX;\n      this.ultimoTouchY = e.changedTouches[0].clientY;\n    },\n    finTouch() {\n      this.pinching = false;\n    },\n    cambiarCoordsManualesNodo(idNodo, coordsManuales) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      this.todosNodos[this.todosNodos.findIndex((n) => n.id == idNodo)].coords =\n        coordsManuales;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodo: String, $coordsManuales: CoordsInput) {\n              setCoordsManuales(\n                idNodo: $idNodo\n                coordsManuales: $coordsManuales\n              ) {\n                modificados {\n                  id\n                  coordsManuales {\n                    x\n                    y\n                  }\n                  coords {\n                    x\n                    y\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idNodo,\n            coordsManuales,\n          },\n        })\n        .then(() => {\n          this.$refs.canvases.crearImagenTodosVinculos();\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n        });\n    },\n    eliminarNodo(idNodo) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      if (!confirm(\"¿Seguro de que quieres eliminar este nodo?\")) return;\n      console.log(`enviando mutacion de eliminar nodo`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodo: ID!) {\n              eliminarNodo(idNodo: $idNodo)\n            }\n          `,\n          variables: {\n            idNodo,\n          },\n          update(store, { data: { eliminarNodo } }) {\n            if (!eliminarNodo) {\n              console.log(`Nodo no fue eliminado`);\n              return;\n            }\n            const cache = store.readQuery({\n              query: QUERY_NODOS,\n            });\n            var nuevoCache = JSON.parse(JSON.stringify(cache));\n            const indexN = nuevoCache.todosNodos.findIndex(\n              (n) => n.id == idNodo\n            );\n            if (indexN > -1) {\n              nuevoCache.todosNodos.splice(indexN, 1);\n              store.writeQuery({\n                query: QUERY_NODOS,\n                data: nuevoCache,\n              });\n            } else {\n              console.log(`El nodo no estaba presente`);\n            }\n          },\n        })\n        .then((data) => {\n          console.log(`quitando el objeto del array. ${data}`);\n        });\n    },\n    crearNodo(posicion) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`Error usuario no autorizado`);\n        return;\n      }\n      console.log(`enviando una mutación de crear nodo`);\n\n      let infoNodo = {\n        coordsManuales: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n        coords: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n        autoCoords: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n      };\n      console.log(`en las coordenadas: ${posicion.x}, ${posicion.y} `);\n      this.posicionCreandoNodo = {\n        x: posicion.x,\n        y: posicion.y,\n      };\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($infoNodo: NodoConocimientoInput) {\n              crearNodo(infoNodo: $infoNodo) {\n                ...fragNodoConocimiento\n              }\n            }\n            ${fragmentoNodoConocimiento}\n          `,\n          variables: {\n            infoNodo,\n          },\n        })\n        .then(({ data: { crearNodo } }) => {\n          console.log(`Creado ${crearNodo.id}`);\n          const store = this.$apollo.provider.defaultClient;\n          const cache = store.readQuery({\n            query: QUERY_NODOS,\n          });\n          var nuevoCache = JSON.parse(JSON.stringify(cache));\n          console.log(`1`);\n          var losNodos = nuevoCache.todosNodos;\n          console.log(`2`);\n\n          const indexN = losNodos.findIndex((n) => n.id === crearNodo.id);\n          if (indexN > -1) {\n            console.log(`El nodo ya estaba en caché`);\n          } else {\n            losNodos.push(crearNodo);\n            store.writeQuery({\n              query: QUERY_NODOS,\n              data: nuevoCache,\n            });\n          }\n          this.posicionCreandoNodo = null;\n          //this.$router.push(\"/nodoConocimiento/\"+crearNodo.id);\n        })\n        .catch((error) => {\n          this.posicionCreandoNodo = null;\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    descargarCentroVista() {\n      let dis = this;\n      this.$apollo\n        .query({\n          query: gql`\n            query {\n              yo {\n                id\n                atlas {\n                  centroVista {\n                    x\n                    y\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idUsuario: this.$store.state.usuario.id,\n          },\n          fetchPolicy: \"network-only\",\n        })\n        .then(function ({ data: { yo } }) {\n          let coords = yo.atlas.centroVista;\n          dis.$set(dis.centroVista, \"x\", coords.x);\n          dis.$set(dis.centroVista, \"y\", coords.y);\n          dis.$store.commit(\"setCentroVistaAtlas\", coords);\n        })\n        .catch(function (error) {\n          console.log(`error fetching centro vista: ${error}`);\n        });\n    },\n    seleccionNodo(nodo) {\n      this.idNodoSeleccionado = nodo.id;\n    },\n    async eliminarVinculo(args) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      console.log(\n        `eliminando un vinculo entre ${args.idNodoFrom} y ${args.idNodoTo} `\n      );\n      await this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodoFrom: ID!, $idNodoTo: ID!) {\n              eliminarVinculoFromTo(\n                idSource: $idNodoFrom\n                idTarget: $idNodoTo\n              ) {\n                modificados {\n                  id\n                  vinculos {\n                    idRef\n                    tipo\n                    rol\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idNodoFrom: args.idNodoFrom,\n            idNodoTo: args.idNodoTo,\n          },\n        })\n        .then(() => {})\n        .catch((error) => {\n          console.log(`error: ${error}`);\n        });\n    },\n    dibujarVinculosGrises() {\n      this.actualizarVinculosGrises++;\n    },\n    async crearVinculo(args) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      console.log(`creando un vinculo ${JSON.stringify(args)} `);\n      await this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($tipo: String!, $idNodoFrom: ID!, $idNodoTo: ID!) {\n              crearVinculo(\n                tipo: $tipo\n                idSource: $idNodoFrom\n                idTarget: $idNodoTo\n              ) {\n                modificados {\n                  id\n                  vinculos {\n                    idRef\n                    rol\n                    tipo\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            tipo: \"continuacion\",\n            idNodoFrom: args.idNodoFrom,\n            idNodoTo: args.idNodoTo,\n          },\n        })\n        .then(() => {})\n        .catch((error) => {\n          console.log(`error: ${error}`);\n        });\n    },\n    sendUpdatesNodos() {\n      // for(var nodo of this.$refs.nodosRender){\n      //   if()\n      // }\n    },\n\n    zoomVista(deltaZoom) {\n      var nuevoZoom = this.zoom + deltaZoom;\n      if (nuevoZoom < this.minZoom) {\n        this.zoom = this.minZoom;\n      } else if (nuevoZoom > this.maxZoom) {\n        this.zoom = this.maxZoom;\n      } else {\n        this.zoom = nuevoZoom;\n      }\n\n      //Pan vista de acuerdo con la posición del mouse respecto del atlas\n    },\n    zoomWheel(e) {\n      if (!this.hovered || !e.ctrlKey) {\n        return;\n      }\n      e.preventDefault();\n\n      var contenedor = this.$el;\n      let posContenedor = contenedor.getBoundingClientRect();\n\n      const posZoom = {\n        x:\n          Math.round((e.clientX - posContenedor.left) / this.factorZoom) +\n          this.centroVista.x,\n        y:\n          Math.round((e.clientY - posContenedor.top) / this.factorZoom) +\n          this.centroVista.y,\n      };\n\n      // const proporciones = {\n      //   x:\n      //     (posZoom.x - this.centroVistaDecimal.x) /\n      //     (posContenedor.width / this.factorZoom),\n      //   y:\n      //     (posZoom.y - this.centroVistaDecimal.y) /\n      //     (posContenedor.height / this.factorZoom),\n      // };\n\n      const factorZoom = 0.2;\n      this.zoomVista(-Math.round(e.deltaY * factorZoom), {\n        x: posZoom.x,\n        y: posZoom.y,\n      });\n    },\n    hideZoomInfo: debounce(function () {\n      this.showingZoomInfo = false;\n    }, 1000),\n  },\n  watch: {\n    idColeccionSeleccionada(idColeccion) {\n      this.seleccionandoColeccion = false;\n      localStorage.setItem(\n        \"atlasConocimientoIdLastColeccionTarget\",\n        idColeccion\n      );\n      if (idColeccion) {\n        console.log(\"Setting lastTarget\");\n      }\n    },\n    seleccionandoColeccion() {\n      this.mostrandoOpcionesColeccion = false;\n    },\n    nodoSeleccionado: function () {\n      this.actualizarTrazos++;\n    },\n    route: function (to) {\n      console.log(`cambio de navegación a ${to.path}`);\n    },\n    idNodoTarget(idNodoTarget) {\n      localStorage.setItem(\"atlasConocimientoIdLastNodoTarget\", idNodoTarget);\n\n      if (!idNodoTarget) {\n        this.idsNecesariosParaTarget = [];\n        return;\n      }\n      this.idsNecesariosParaTarget = this.encontrarNodosNecesariosDeNodo(\n        idNodoTarget,\n        []\n      );\n    },\n    zoom() {\n      this.showingZoomInfo = true;\n      this.hideZoomInfo();\n    },\n    nodosRender() {\n      setTimeout(() => {\n        if (!this.$refs.enlacesNodos) {\n          console.log(\"No hay enlaces\");\n          return;\n        }\n        console.log(`Hay ${this.$refs.enlacesNodos.length} enlaces de nodos`);\n        for (const enlace of this.$refs.enlacesNodos) {\n          enlace.setVinculosGrises();\n        }\n      }, 1000);\n    },\n    //\n  },\n  mounted() {\n    // if (!this.usuario.atlas || !this.usuario.atlas.centroVista) {\n    //   console.log(`No había info de centro vista en la store. Descargando`);\n    //   this.descargarCentroVista();\n    //   return;\n    // }\n    // this.$set(this.centroVistaDecimal, \"x\", this.usuario.atlas.centroVista.x);\n    // this.$set(this.centroVistaDecimal, \"y\", this.usuario.atlas.centroVista.y);\n\n    if (screen.width < 600) {\n      this.zoom = 70;\n    }\n  },\n  created() {\n    window.addEventListener(\"wheel\", this.zoomWheel, { passive: false });\n  },\n  removed() {\n    window.removeEventListener(\"wheel\", this.zoomWheel);\n  },\n  // beforeRouteLeave(_, __, next) {\n  //   console.log(\n  //     `enviando nuevo centroVista para el usuario ${\n  //       this.usuario.id\n  //     }. Centro vista: ${JSON.stringify(this.centroVista)}`\n  //   );\n  //   this.$store.commit(\"setCentroVistaAtlas\", this.centroVista);\n\n  //   this.$apollo\n  //     .mutate({\n  //       mutation: gql`\n  //         mutation($idUsuario: ID, $centroVista: CoordsInput) {\n  //           setCentroVista(idUsuario: $idUsuario, centroVista: $centroVista)\n  //         }\n  //       `,\n  //       variables: {\n  //         idUsuario: this.$store.state.usuario.id,\n  //         centroVista: this.centroVista,\n  //       },\n  //     })\n  //     .then(function () {\n  //       next();\n  //     })\n  //     .catch(function (error) {\n  //       console.log(`error: ${error}`);\n  //       next();\n  //     });\n  // },\n};\n</script>\n\n\n<style>\n@import \"./estilosGlobalesAtlasConocimiento.css\";\n</style>\n\n<style>\n:root {\n  --atlasConocimientoFondo: #f3eff5;\n  --atlasConocimientoCheck: #3f7d20;\n  --atlasConocimientoAvailable: #e2c044;\n  --atlasConocimientoRepaso: #ff5f5f;\n  --atlasConocimientoOff: #d3d3d3;\n  --atlasConocimientoSeleccion: #ad58d8;\n  --atlasConocimientoContinuacion: #3066be;\n\n  --filtroAtlasSeleccion: invert(43%) sepia(84%) saturate(539%)\n    hue-rotate(236deg) brightness(88%) contrast(92%);\n\n  --filtroAtlasAvailable: invert(79%) sepia(70%) saturate(443%)\n    hue-rotate(349deg) brightness(92%) contrast(91%);\n  --filtroAtlasCheck: invert(34%) sepia(99%) saturate(407%) hue-rotate(56deg)\n    brightness(95%) contrast(81%);\n  --filtroAtlasRepaso: invert(50%) sepia(95%) saturate(2482%) hue-rotate(328deg)\n    brightness(106%) contrast(101%);\n}\n</style>\n<style scoped>\n.atlasConocimiento {\n  position: relative;\n  overflow-x: hidden;\n}\n.ventanaRepasos {\n  z-index: 100;\n  position: absolute;\n  top: 0px;\n  left: 0%;\n  background-color: rgb(255 252 249);\n  box-shadow: 3px 4px 4px rgba(0, 0, 0, 0.25);\n}\n#zonaNodoTarget {\n  position: absolute;\n  top: 0px;\n  left: 50%;\n  transform: translate(-50%);\n  display: flex;\n  align-items: center;\n  padding: 10px;\n  max-width: min(400px, 50%);\n  z-index: 50;\n}\n#zonaNodoTarget .boton {\n  width: 25px;\n  height: 25px;\n}\n#nombreNodoTarget {\n  background-color: var(--atlasConocimientoSeleccion);\n  padding: 5px 10px;\n  padding-right: 20px;\n  border-radius: 9px;\n  cursor: pointer;\n  font-size: 13px;\n  display: flex;\n  align-items: center;\n}\n#zonaSeleccionColeccion {\n  position: absolute;\n  top: 10px;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 1;\n}\n\n#nombreColeccion {\n  padding: 10px 30px;\n  background-color: var(--atlasConocimientoSeleccion);\n  border-radius: 45px;\n  cursor: pointer;\n  display: flex;\n  gap: 5px;\n  align-items: center;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n\n#listaSelectoresColeccion {\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  transform: translateX(-50%);\n  width: min(200px, 90vw);\n}\n#botonMostrarOpcionesColeccion {\n  position: absolute;\n  top: 50%;\n  left: calc(100% + 5px);\n  transform: translateY(-50%);\n}\n#contenedorControlesColeccion {\n  position: absolute;\n  top: calc(100% + 5px);\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 15px;\n  justify-content: center;\n}\n.controlColeccion {\n  background-color: rgb(58, 58, 58);\n}\n.selectorColeccion {\n  padding: 10px 15px;\n  font-size: 16px;\n  cursor: pointer;\n  background-color: var(--atlasConocimientoAvailable);\n  display: flex;\n  gap: 10px;\n  align-items: center;\n}\n#menuContextual {\n  position: absolute;\n  background-color: gray;\n  z-index: 110;\n}\n.botonMenuContextual {\n  font-size: 12px;\n  color: rgb(221, 221, 221);\n  cursor: pointer;\n  padding: 10px;\n}\n.botonMenuContextual:hover {\n  background-color: rgb(68, 68, 68);\n}\n#contenedorDiagrama {\n  position: relative;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  overflow: scroll;\n  z-index: 0;\n}\n#contenedorVinculosNodos {\n  position: absolute;\n  top: 50px;\n  left: 50px;\n  user-select: none;\n\n  pointer-events: none;\n}\n#contenedorNodos {\n  position: absolute;\n  top: 50px;\n  left: 50px;\n  user-select: none;\n\n  pointer-events: none;\n}\n#buscadorNodosConocimiento {\n  position: absolute;\n  top: 1%;\n  right: 1%;\n  /* transform: translateX(-50%); */\n  z-index: 1;\n  width: min(100vh, 350px);\n}\n#panelConjuntosNodos {\n  z-index: 100;\n}\n\n#panelObjetivos {\n  position: absolute;\n  top: 2%;\n  left: 50%;\n  transform: translateX(-50%);\n  opacity: 0.2;\n  z-index: 100;\n}\n#panelObjetivos:hover {\n  opacity: 1;\n}\n#infoZoom {\n  position: absolute;\n  top: 2%;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 10px;\n  display: inline-block;\n  font-weight: bold;\n  color: rgb(102, 102, 102);\n}\n#botonCallingPosiciones {\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  border: 1px solid black;\n  position: absolute;\n  top: 1%;\n  right: 1%;\n  cursor: pointer;\n  z-index: 1;\n}\n\n#simboloDescargandoNodos {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 100;\n}\n\n.visorNodoConocimiento {\n  width: 100%;\n  min-height: 100%;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  z-index: 1000;\n  background-color: whitesmoke;\n}\n\n#barraInferior {\n  position: absolute;\n  bottom: 12px;\n  padding: 10px;\n  display: flex;\n  flex-direction: row-reverse;\n  right: 0px;\n  box-sizing: border-box;\n}\n\n#barraInferior .boton {\n  height: 30px;\n  width: 30px;\n  margin: 0px 5px;\n  z-index: 0;\n}\n\n.fadeOut-leave-to {\n  opacity: 0;\n}\n.fadeOut-leave-active {\n  transition: opacity 1s;\n}\n.fadeOut-leave {\n  opacity: 1;\n}\n</style>"]}]}