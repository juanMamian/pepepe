{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/visorNodoConocimiento/SeccionNodoConocimiento.vue?vue&type=style&index=0&id=6a06d2c0&scoped=true&lang=css&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/visorNodoConocimiento/SeccionNodoConocimiento.vue","mtime":1674661111806},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnNlY2Npb25Ob2RvQ29ub2NpbWllbnRvIHsKICB3aWR0aDogMTAwJTsgIAp9CiN6b25hRnJvbnR7ICAKICBtYXgtd2lkdGg6MTAwdnc7CiAgbWFyZ2luOiA1cHggYXV0bzsKfQojem9uYUZyb250IGlmcmFtZXsKICAKICB3aWR0aDogMTAwJTsKfQojem9uYUZyb250IGltZ3sKICBtYXgtd2lkdGg6IDEwMCU7CiAgbWFyZ2luOiAwcHggYXV0bzsKICBkaXNwbGF5OmJsb2NrOwp9CiNpbnB1dE51ZXZvRW5sYWNlewogIG1hcmdpbjogMTBweCBhdXRvOwogIGRpc3BsYXk6IGJsb2NrOwp9CiNpZnJhbWVTZWNjaW9uIHsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMHZoOwp9CiN6b25hQWRtaW5pc3RyYWNpb24gewogIHdpZHRoOiBtaW4oNTAwcHgsIDkwdncpOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgbWFyZ2luOiAwcHggYXV0bzsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1wYWxldGFNYWluKTsKICBwYWRkaW5nOiAxMHB4IDBweDsKICBtaW4taGVpZ2h0OiAzMDBweDsKfQojbm9tYnJlIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KI2lucHV0TnVldm9Ob21icmUgewogIGRpc3BsYXk6IGJsb2NrOwogIG1hcmdpbjogMTVweCBhdXRvOwogIHBhZGRpbmc6IDVweDsKICBib3JkZXItcmFkaXVzOiA1cHg7CiAgZm9udC1zaXplOiAxNnB4OwogIGNvbG9yOiByZ2IoNDgsIDQ4LCA0OCk7Cn0K"},{"version":3,"sources":["SeccionNodoConocimiento.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SeccionNodoConocimiento.vue","sourceRoot":"src/components/visorNodoConocimiento","sourcesContent":["<template>\n  <div class=\"seccionNodoConocimiento\">\n    <div class=\"contenedorControles\">\n      <div class=\"boton\" v-if=\"usuarioExperto || usuarioSuperadministrador\" @click=\"editando = !editando\">\n        <img src=\"@/assets/iconos/edit.svg\" alt=\"Editar\" />\n      </div>\n    </div>\n    <div id=\"zonaFront\" class=\"frontDeSeccion\" v-show=\"!editando\" :key=\"versionArchivo\">\n      <iframe\n        id=\"iframeSeccion\"\n        :src=\"srcIframe\"\n        v-if=\"estaSeccion.modo==='enlace' || (estaSeccion.tipoPrimario && estaSeccion.tipoPrimario.substring(0,5)!='image')\"\n        frameborder=\"0\"\n      ></iframe>\n      <img\n      :src=\"direccionNodo + '/' + estaSeccion.id + '/?v=' + versionArchivo\"\n      v-if=\"estaSeccion.modo==='archivo' && estaSeccion.tipoPrimario && estaSeccion.tipoPrimario.substring(0,5)==='image'\"\n      />\n    </div>\n\n    <div id=\"zonaAdministracion\" v-if=\"usuarioExperto || usuarioSuperadministrador\" v-show=\"editando\">\n      <div id=\"nombre\" v-show=\"!editandoNombre\" @click=\"iniciarEdicionNombre\">\n        {{ estaSeccion.nombre }}\n      </div>\n      <input\n        v-show=\"editandoNombre\"\n        type=\"text\"\n        name=\"\"\n        :value=\"estaSeccion.nombre\"\n        id=\"inputNuevoNombre\"\n        ref=\"inputNuevoNombre\"\n        :class=\"{deshabilitado: enviandoNuevoNombre}\"\n        @blur=\"guardarNuevoNombre\"\n        @keypress.enter=\"guardarNuevoNombre\"\n      />\n      <loading texto=\"\" v-show=\"enviandoNuevoNombre\"/>\n      <div class=\"contenedorControles\">\n        <div\n          class=\"boton\"\n          title=\"Subir un archivo\"\n          @click=\"$refs.inputArchivoContenido.click()\"\n          v-if=\"modo==='archivo'\"\n          v-show=\"!subiendoArchivo\"\n        >\n          <img src=\"@/assets/iconos/plusCircle.svg\" alt=\"Plus\" />\n        </div>\n        <loading texto=\"\" v-show=\"subiendoArchivo\" />\n\n        <div\n          class=\"boton\"\n          :title=\"\n            estaSeccion.modo === 'archivo'\n              ? 'Cambiar modo a enlace'\n              : 'Cambiar modo a archivo'\n          \"\n          @click.stop=\"toggleModo\"\n        >\n          <img\n            src=\"@/assets/iconos/file.svg\"\n            v-show=\"modo === 'archivo'\"\n            alt=\"Archivo\"\n          />\n          <img\n            src=\"@/assets/iconos/link.svg\"\n            v-show=\"modo === 'enlace'\"\n            alt=\"Archivo\"\n          />\n        </div>\n      </div>\n\n      <div id=\"listaArchivos\" v-show=\"modo === 'archivo'\">\n        <input\n          type=\"file\"\n          class=\"inputArchivoContenido\"\n          ref=\"inputArchivoContenido\"\n          v-show=\"false\"\n          @change=\"subirArchivoContenido($event)\"\n        />\n        <archivo-seccion-nodo\n          :esteArchivo=\"archivo\"\n          :usuarioExperto=\"usuarioExperto\"\n          :idNodo=\"idNodo\"\n          :idSeccion=\"estaSeccion.id\"\n          v-for=\"archivo of archivosOrdenados\"\n          :key=\"archivo.id\"\n          @meElimine=\"$emit('archivoEliminado', archivo.nombre)\"\n          @soyPrimario=\"\n            $emit('tengoNuevoPrimario', archivo.nombre);\n            versionArchivo++;\n          \"\n        />\n      </div>\n\n      <div id=\"zonaEnlace\" v-show=\"modo==='enlace'\">\n        \n        <input type=\"text\" id=\"inputNuevoEnlace\" ref=\"inputNuevoEnlace\" v-model=\"inputNuevoEnlace\" @blur=\"guardarNuevoEnlace\" placeholder=\"Enlace al recurso\" @keypress.enter=\"guardarNuevoEnlace\">\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\n\nimport ArchivoSeccionNodo from \"./archivoSeccionNodo.vue\";\nimport Loading from \"../utilidades/Loading.vue\";\nimport { charProhibidosNombreCosa } from \"../configs\";\nimport gql from \"graphql-tag\";\n\nexport default {\n  props: {\n    estaSeccion: Object,\n    idNodo: String,\n    usuarioExperto: Boolean,\n  },\n  components: {\n    ArchivoSeccionNodo,\n    Loading,\n  },\n  name: \"SeccionNodoConocimiento\",\n  data() {\n    return {\n      editando: false,\n      subiendoArchivo: false,\n      versionArchivo: 0,\n\n      editandoNombre: false,\n      enviandoNuevoNombre: false,\n      guardandoNuevoEnlace:false,\n      inputNuevoEnlace:this.estaSeccion.enlace,\n      modo:\"\",\n    };\n  },\n  methods: {\n    subirArchivoContenido(e) {\n      const inputArchivo = e.target;\n      var datos = new FormData();\n      const nuevoArchivo = inputArchivo.files[0];\n\n      datos.append(\"nuevoArchivo\", nuevoArchivo);\n      datos.append(\"idNodo\", this.idNodo);\n      datos.append(\"idSeccion\", this.estaSeccion.id);\n      this.subiendoArchivo = true;\n      axios({\n        method: \"post\",\n        url: this.serverUrl + \"/api/atlas/subirArchivoContenidoSeccionNodo\",\n        data: datos,\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: \"Bearer \" + this.$store.state.token,\n        },\n      })\n        .then(({ data: { infoArchivo } }) => {\n          this.subiendoArchivo = false;\n          this.versionArchivo++;\n          this.$emit(\"subiArchivo\", infoArchivo);\n        })\n        .catch((error) => {\n          this.subiendoArchivo = false;\n\n          console.log(`Error subiendo archivo. E: ${error}`);\n        });\n    },\n    iniciarEdicionNombre() {\n      this.$refs.inputNuevoNombre.value = this.estaSeccion.nombre;\n      this.editandoNombre = true;\n    },\n    guardarNuevoNombre() {\n      var nuevoNombre = this.$refs.inputNuevoNombre.value.trim();\n      if (nuevoNombre == this.estaSeccion.nombre) {\n        this.editandoNombre = false;\n        return;\n      }\n\n      if (nuevoNombre.length < 1) {\n        return;\n      }\n      if (charProhibidosNombreCosa.test(nuevoNombre)) {\n        console.log(`Caracteres ilegales`);\n        return;\n      }\n\n      console.log(`guardando nuevo nombre`);\n      this.enviandoNuevoNombre = true;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation (\n              $idNodo: ID!\n              $idSeccion: ID!\n              $nuevoNombre: String!\n            ) {\n              editarNombreSeccionNodoConocimiento(\n                idNodo: $idNodo\n                idSeccion: $idSeccion\n                nuevoNombre: $nuevoNombre\n              ) {\n                id\n                nombre\n              }\n            }\n          `,\n          variables: {\n            idNodo: this.idNodo,\n            idSeccion: this.estaSeccion.id,\n            nuevoNombre: nuevoNombre,\n          },\n        })\n        .then((data) => {\n          console.log(`fin de la mutacion. Data: ${JSON.stringify(data)} `);\n          this.enviandoNuevoNombre = false;\n          this.editandoNombre = false;\n        })\n        .catch((error) => {\n          this.enviandoNuevoNombre = false;\n          console.log(`Error. E :${error}`);\n        });\n    },\n    toggleModo(){\n      const nuevoModo=this.modo==='archivo'?'enlace':'archivo';\n      console.log(\"Cambiando a \"+nuevoModo);\n      this.modo=nuevoModo;\n    },\n    guardarNuevoEnlace(){\n      console.log(\"guardar nuevo enlace\");\n      var nuevoEnlace=this.$refs.inputNuevoEnlace.value.trim();\n      console.log(nuevoEnlace);\n\n      if(nuevoEnlace===this.estaSeccion.enlace || !nuevoEnlace || nuevoEnlace.length<5){\n        return \n      }\n\n      if(!this.usuarioExperto && !this.usuarioSuperadministrador){\n        return\n      }\n      this.guardandoNuevoEnlace=true;\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation($idNodo: ID!, $idSeccion:ID!, $nuevoEnlace:String!){\n            setNuevoEnlaceSeccionNodo(idNodo: $idNodo, idSeccion: $idSeccion, nuevoEnlace: $nuevoEnlace){\n              id\n              modo\n              enlace\n            }\n          }\n        `,\n        variables:{\n          idNodo:this.idNodo,\n          idSeccion: this.estaSeccion.id,\n          nuevoEnlace,\n        }\n\n      }).then(()=>{\n        this.guardandoNuevoEnlace=false;\n      }).catch((error)=>{\n        console.log(\"Error: \"+error);\n        this.guardandoNuevoEnlace=true;\n\n      })\n\n    }\n  },\n  computed: {\n    direccionNodo: function () {\n      return this.serverUrl + \"/assetsAtlas/contenidosNodos/\" + this.idNodo;\n    },\n    archivosOrdenados() {\n      var archivos = JSON.parse(JSON.stringify(this.estaSeccion.archivos));\n      archivos.sort((a) => {\n        if (a.primario) return -1;\n        return 0;\n      });\n      return archivos;\n    },\n    srcIframe(){\n      if(this.estaSeccion.modo==='enlace' && this.estaSeccion.enlace){\n        var elEnlace=this.estaSeccion.enlace;\n        let laUrl=window.location.href;\n        if(elEnlace.substring(0, 25) === 'http://192.168.1.100:3000' && laUrl.substring(0, 20) != \"http://192.168.1.100\") {\n          elEnlace=\"https://pe-pe-pe.herokuapp.com\"+elEnlace.substring(25);\n          console.log(\"Enlace queda: \"+ elEnlace)\n        }\n        return elEnlace;\n      }\n      return this.direccionNodo + '/' + this.estaSeccion.id + '/?v=' + this.versionArchivo;\n    },\n    \n  },\n  watch:{\n    'estaSeccion.modo':{\n      handler: function(){\n        this.modo=this.estaSeccion.modo\n      },\n      immediate: true,\n    }\n  }\n};\n</script>\n\n<style scoped>\n.seccionNodoConocimiento {\n  width: 100%;  \n}\n#zonaFront{  \n  max-width:100vw;\n  margin: 5px auto;\n}\n#zonaFront iframe{\n  \n  width: 100%;\n}\n#zonaFront img{\n  max-width: 100%;\n  margin: 0px auto;\n  display:block;\n}\n#inputNuevoEnlace{\n  margin: 10px auto;\n  display: block;\n}\n#iframeSeccion {\n  width: 100%;\n  height: 100vh;\n}\n#zonaAdministracion {\n  width: min(500px, 90vw);\n  border-radius: 10px;\n  margin: 0px auto;\n  background-color: var(--paletaMain);\n  padding: 10px 0px;\n  min-height: 300px;\n}\n#nombre {\n  text-align: center;\n}\n#inputNuevoNombre {\n  display: block;\n  margin: 15px auto;\n  padding: 5px;\n  border-radius: 5px;\n  font-size: 16px;\n  color: rgb(48, 48, 48);\n}\n</style>\n"]}]}