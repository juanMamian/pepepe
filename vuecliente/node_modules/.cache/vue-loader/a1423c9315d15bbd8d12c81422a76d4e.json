{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/LoginArea.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/LoginArea.vue","mtime":1649279652037},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMb2FkaW5nIGZyb20gIi4vdXRpbGlkYWRlcy9Mb2FkaW5nLnZ1ZSI7CmltcG9ydCBncWwgZnJvbSAnZ3JhcGhxbC10YWcnOwoKdmFyIGNoYXJQcm9oaWJpZG9zVXNlcm5hbWUgPSAvW15hLXpBLVowLTlfw7HDkV0vZzsKY29uc3QgbWluUGFzc3dvcmQgPSA2Owpjb25zdCBtaW5Vc2VybmFtZSA9IDQ7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkxvZ2luQXJlYSIsCiAgY29tcG9uZW50czogeyBMb2FkaW5nIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgcGFzc3dvcmQ6ICIiLAogICAgICBsb2dpbkZhaWw6IGZhbHNlLAogICAgICBsb2dpbkZhaWxNc2c6ICIiLAogICAgICBlbnZpYW5kb0RhdG9zOiBmYWxzZSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgdXN1YXJpb0NvbmVjdGFkbygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzdWFyaW8udXNlcm5hbWUgIT0gbnVsbCA/IHRydWUgOiBmYWxzZTsKICAgIH0sCiAgICBub21icmVVc3VhcmlvKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby51c2VybmFtZTsKICAgIH0sCiAgICBjb2xvclVzZXJuYW1lKCkgewogICAgICByZXR1cm4gewogICAgICAgIGNvbG9yOgogICAgICAgICAgY2hhclByb2hpYmlkb3NVc2VybmFtZS50ZXN0KHRoaXMudXNlcm5hbWUpIHx8CiAgICAgICAgICB0aGlzLnVzZXJuYW1lLmxlbmd0aCA8IG1pblVzZXJuYW1lCiAgICAgICAgICAgID8gInJlZCIKICAgICAgICAgICAgOiAiYmxhY2siLAogICAgICB9OwogICAgfSwKICAgIHBhc3NJbGVnYWwoKSB7CiAgICAgIGlmICh0aGlzLnBhc3N3b3JkLmxlbmd0aCA8IG1pblBhc3N3b3JkKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHVzZXJuYW1lSWxlZ2FsKCkgewogICAgICBpZiAoCiAgICAgICAgIXRoaXMudXNlcm5hbWUgfHwKICAgICAgICBjaGFyUHJvaGliaWRvc1VzZXJuYW1lLnRlc3QodGhpcy51c2VybmFtZSkgfHwKICAgICAgICB0aGlzLnVzZXJuYW1lLmxlbmd0aCA8IG1pblVzZXJuYW1lCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBpbmljaWFyU2VzaW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKGBJbmljaWFuZG8gbG9naW5gKTsKICAgICAgbGV0IGRpcyA9IHRoaXM7CgogICAgICB2YXIgcGFzc3dvcmQgPSB0aGlzLiRyZWZzLmlucHV0UGFzc3dvcmQudmFsdWU7CiAgICAgIHZhciB1c2VybmFtZSA9IHRoaXMuJHJlZnMuaW5wdXRVc2VybmFtZS52YWx1ZTsKICAgICAgY29uc29sZS5sb2coIkNvbiBwYXNzIGxlbmd0aDogIit0aGlzLnBhc3N3b3JkLmxlbmd0aCkKICAgICAgaWYgKHRoaXMucGFzc3dvcmQubGVuZ3RoIDwgbWluUGFzc3dvcmQpIHsKICAgICAgICBjb25zb2xlLmxvZyhgUGFzc3dvcmQgaWxlZ2FsYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgY2hhclByb2hpYmlkb3NVc2VybmFtZS50ZXN0KHRoaXMudXNlcm5hbWUpIHx8CiAgICAgICAgdGhpcy51c2VybmFtZS5sZW5ndGggPCBtaW5Vc2VybmFtZQogICAgICApIHsKICAgICAgICBjb25zb2xlLmxvZyhgVXNlcm5hbWUgaWxlZ2FsYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmVudmlhbmRvRGF0b3MgPSB0cnVlOwogICAgICBjb25zb2xlLmxvZygicXVlcnkiKTsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLnF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgICAgIHF1ZXJ5ICgkdXNlcm5hbWU6IFN0cmluZyEsICRwYXNzd29yZDogU3RyaW5nISkgewogICAgICAgICAgICAgIGxvZ2luKHVzZXJuYW1lOiAkdXNlcm5hbWUsIHBhc3N3b3JkOiAkcGFzc3dvcmQpCiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgdXNlcm5hbWUsCiAgICAgICAgICAgIHBhc3N3b3JkLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCh7IGRhdGE6IHsgbG9naW4gfSB9KSA9PiB7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoImxvZ2VhcnNlIiwgbG9naW4pOwogICAgICAgICAgZGlzLiRyb3V0ZXIucHVzaCgiLyIpOwoKICAgICAgICAgIHRoaXMuZW52aWFuZG9EYXRvcyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycm9yfWApOwogICAgICAgICAgdGhpcy5lbnZpYW5kb0RhdG9zID0gZmFsc2U7CiAgICAgICAgfSk7CgogICAgICAvLyBheGlvcwogICAgICAvLyAgIC5wb3N0KHRoaXMuc2VydmVyVXJsICsgIi9hcGkvdXN1YXJpb3MvbG9naW4iLCB7CiAgICAgIC8vICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZSwKICAgICAgLy8gICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkLAogICAgICAvLyAgIH0pCiAgICAgIC8vICAgLnRoZW4oZnVuY3Rpb24gKHJlc3B1ZXN0YSkgewogICAgICAvLyAgICAgY29uc29sZS5sb2coYExvZ2VhZG9gKTsKCiAgICAgIC8vICAgICBpZiAocmVzcHVlc3RhLmRhdGEudXNlcm5hbWUgPT0gZGlzLnVzZXJuYW1lKSB7CiAgICAgIC8vICAgICAgIGRpcy4kc3RvcmUuY29tbWl0KCJsb2dlYXJzZSIsIHJlc3B1ZXN0YS5kYXRhLnRva2VuKTsKICAgICAgLy8gICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhyZWYgPSBkaXMuY2xpZW50ZVVybDsKICAgICAgLy8gICAgICAgZGlzLmVudmlhbmRvRGF0b3MgPSBmYWxzZTsKICAgICAgLy8gICAgICAgZGlzLiRyb3V0ZXIucHVzaCgiLyIpOwogICAgICAvLyAgICAgfQogICAgICAvLyAgIH0pCiAgICAgIC8vICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAvLyAgICAgZGlzLmVudmlhbmRvRGF0b3MgPSBmYWxzZTsKICAgICAgLy8gICAgIGRpcy4kc3RvcmUuY29tbWl0KCJkZXNsb2dlYXJzZSIpOwoKICAgICAgLy8gICAgIGlmIChlcnJvci5yZXNwb25zZSAmJiBlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKSB7CiAgICAgIC8vICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yID09ICJiYWRMb2dpbiIpIHsKICAgICAgLy8gICAgICAgICBkaXMubG9naW5GYWlsID0gdHJ1ZTsKICAgICAgLy8gICAgICAgICBkaXMubG9naW5GYWlsTXNnID0gIkRhdG9zIGludsOhbGlkb3MiOwogICAgICAvLyAgICAgICAgIHJldHVybjsKICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvciA9PSAic2ViYXN0aWFuIikgewogICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGBVc3VhcmlvIGJsb3F1ZWFkbyB0ZW1wb3JhbG1lbnRlYCk7CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmIChlcnJvci5yZXNwb25zZSAmJiBlcnJvci5yZXNwb25zZS5kYXRhLm1zalVzdWFyaW8pIHsKICAgICAgLy8gICAgICAgYWxlcnQoZXJyb3IucmVzcG9uc2UuZGF0YS5tc2pVc3VhcmlvKTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGBlcnJvcjogJHtlcnJvcn1gKTsKICAgICAgLy8gICB9KTsKICAgIH0sCiAgICBkZXNsb2dlYXJzZTogZnVuY3Rpb24gKCkgewogICAgICAvL0xvZ291dCBlbiB2dWV4IHkgZW4gYXBvbGxvCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgiZGVzbG9nZWFyc2UiKTsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB0aGlzLmNsaWVudGVVcmw7CgogICAgICAvLy8vLy8vLy8KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["LoginArea.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"LoginArea.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"loginArea\">\n    <div id=\"ventanaCentral\">\n      <form>\n        <p id=\"tituloVentana\">¡Bienvenidx!</p>\n        <br />\n        <div class=\"instruccion\">Escribe tus datos de login</div>\n        <input\n          type=\"text\"\n          name=\"username\"\n          :style=\"colorUsername\"\n          v-model=\"username\"\n          ref=\"inputUsername\"\n          placeholder=\"Nombre de usuario\"\n          class=\"inputs\"\n          @input=\"loginFail = false\"\n        />\n        <br />\n        <input\n          type=\"password\"\n          name=\"password\"\n          ref=\"inputPassword\"\n          class=\"inputs\"\n          v-model=\"password\"\n          placeholder=\"password\"\n          @input=\"loginFail = false\"\n          @keypress.enter=\"iniciarSesion\"\n        />\n        <br />\n        <br />\n        <loading v-show=\"enviandoDatos\" :texto=\"'Conectando...'\" />\n        <div\n          class=\"botonEnviar\"\n          @click.stop.prevent=\"iniciarSesion\"\n          :class=\"{\n            loginFail,\n            desaparecido: enviandoDatos,\n            deshabilitado: passIlegal,\n          }\"\n        >\n          {{ loginFail ? loginFailMsg : \"Ingresar\" }}\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Loading from \"./utilidades/Loading.vue\";\nimport gql from 'graphql-tag';\n\nvar charProhibidosUsername = /[^a-zA-Z0-9_ñÑ]/g;\nconst minPassword = 6;\nconst minUsername = 4;\n\nexport default {\n  name: \"LoginArea\",\n  components: { Loading },\n  data() {\n    return {\n      username: \"\",\n      password: \"\",\n      loginFail: false,\n      loginFailMsg: \"\",\n      enviandoDatos: false,\n    };\n  },\n  computed: {\n    usuarioConectado() {\n      return this.$store.state.usuario.username != null ? true : false;\n    },\n    nombreUsuario() {\n      return this.$store.state.usuario.username;\n    },\n    colorUsername() {\n      return {\n        color:\n          charProhibidosUsername.test(this.username) ||\n          this.username.length < minUsername\n            ? \"red\"\n            : \"black\",\n      };\n    },\n    passIlegal() {\n      if (this.password.length < minPassword) {\n        return true;\n      }\n      return false;\n    },\n    usernameIlegal() {\n      if (\n        !this.username ||\n        charProhibidosUsername.test(this.username) ||\n        this.username.length < minUsername\n      ) {\n        return true;\n      }\n      return false;\n    },\n  },\n  methods: {\n    iniciarSesion: function () {\n      console.log(`Iniciando login`);\n      let dis = this;\n\n      var password = this.$refs.inputPassword.value;\n      var username = this.$refs.inputUsername.value;\n      console.log(\"Con pass length: \"+this.password.length)\n      if (this.password.length < minPassword) {\n        console.log(`Password ilegal`);\n        return;\n      }\n\n      if (\n        charProhibidosUsername.test(this.username) ||\n        this.username.length < minUsername\n      ) {\n        console.log(`Username ilegal`);\n        return;\n      }\n\n      this.enviandoDatos = true;\n      console.log(\"query\");\n      this.$apollo\n        .query({\n          query: gql`\n            query ($username: String!, $password: String!) {\n              login(username: $username, password: $password)\n            }\n          `,\n          variables: {\n            username,\n            password,\n          },\n        })\n        .then(({ data: { login } }) => {\n          this.$store.commit(\"logearse\", login);\n          dis.$router.push(\"/\");\n\n          this.enviandoDatos = false;\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n          this.enviandoDatos = false;\n        });\n\n      // axios\n      //   .post(this.serverUrl + \"/api/usuarios/login\", {\n      //     username: this.username,\n      //     password: this.password,\n      //   })\n      //   .then(function (respuesta) {\n      //     console.log(`Logeado`);\n\n      //     if (respuesta.data.username == dis.username) {\n      //       dis.$store.commit(\"logearse\", respuesta.data.token);\n      //       // window.location.href = dis.clienteUrl;\n      //       dis.enviandoDatos = false;\n      //       dis.$router.push(\"/\");\n      //     }\n      //   })\n      //   .catch(function (error) {\n      //     dis.enviandoDatos = false;\n      //     dis.$store.commit(\"deslogearse\");\n\n      //     if (error.response && error.response.data.error) {\n      //       if (error.response.data.error == \"badLogin\") {\n      //         dis.loginFail = true;\n      //         dis.loginFailMsg = \"Datos inválidos\";\n      //         return;\n      //       }\n      //       if (error.response.data.error == \"sebastian\") {\n      //         console.log(`Usuario bloqueado temporalmente`);\n      //       }\n      //     }\n      //     if (error.response && error.response.data.msjUsuario) {\n      //       alert(error.response.data.msjUsuario);\n      //     }\n      //     console.log(`error: ${error}`);\n      //   });\n    },\n    deslogearse: function () {\n      //Logout en vuex y en apollo\n      this.$store.commit(\"deslogearse\");\n      window.location.href = this.clienteUrl;\n\n      /////////\n    },\n  },\n};\n</script>\n\n<style scoped>\n#tituloVentana {\n  font-size: 35px;\n  margin: 5px auto;\n  text-align: center;\n  font-family: sans-serif;\n}\n.instruccion {\n  font-size: 18;\n  text-align: center;\n  margin: 40px 0px;\n  margin-bottom: 0px;\n}\n.inputs {\n  font-size: 20px;\n  padding: 10px 20px;\n  border-radius: 10px;\n  margin-right: auto;\n  margin-left: auto;\n  margin-top: 15px;\n  display: block;\n}\n#ventanaCentral {\n  margin: 5% auto;\n  padding: 20px;\n  width: min(550px, 90%);\n}\n.botonEnviar {\n  width: min(300px, 90vw);\n  text-align: center;\n  display: block;\n  margin-left: auto;\n  margin-right: auto;\n  font-size: 20px;\n  padding: 15px 5px;\n  background-color: var(--mainColor);\n  border-radius: 30px;\n  cursor: pointer;\n}\n.loginFail {\n  color: red;\n  pointer-events: none;\n  opacity: 0.5;\n  font-style: italic;\n  font-size: 12px;\n}\n.desaparecido {\n  display: none;\n  pointer-events: none;\n}\n</style>"]}]}