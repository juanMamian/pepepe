{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/Proyectos.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/Proyectos.vue","mtime":1643654906492},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwppbXBvcnQgSWNvbm9Qcm95ZWN0byBmcm9tICIuL3Byb3llY3Rvcy9JY29ub1Byb3llY3RvLnZ1ZSI7CmltcG9ydCBMb2FkaW5nIGZyb20gJy4vdXRpbGlkYWRlcy9Mb2FkaW5nLnZ1ZSc7Cgpjb25zdCBRVUVSWV9QUk9ZRUNUT1M9Z3FsYApxdWVyeSB7CiAgICBwcm95ZWN0b3MgewogICAgICBpZAogICAgICBub21icmUKICAgICAgcmVzcG9uc2FibGVzCiAgICB9CiAgfQpgOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgSWNvbm9Qcm95ZWN0bywgTG9hZGluZyB9LAogIG5hbWU6ICJQcm95ZWN0b3MiLAogIGFwb2xsbzogewogICAgcHJveWVjdG9zOiB7CiAgICAgIHF1ZXJ5OiBRVUVSWV9QUk9ZRUNUT1MsCiAgICAgIGZldGNoUG9saWN5OiAiY2FjaGUtYW5kLW5ldHdvcmsiLAogICAgICB1cGRhdGU6ZnVuY3Rpb24oe3Byb3llY3Rvc30pewogICAgICAgIHJldHVybiBwcm95ZWN0b3Muc29ydCgoYSwgYik9PnsKICAgICAgICAgIGxldCByZXM9MDsKICAgICAgICAgIGlmKGEucmVzcG9uc2FibGVzLnNvbWUocj0+ci5pZD09dGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5pZCkpewogICAgICAgICAgICByZXMtLTsKICAgICAgICAgIH0KICAgICAgICAgIGlmKGIucmVzcG9uc2FibGVzLnNvbWUocj0+ci5pZD09dGhpcy4kc3RvcmUuc3RhdGUudXN1YXJpby5pZCkpewogICAgICAgICAgICByZXMrKzsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMubG9hZGluZz1mYWxzZTsKICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfSkKICAgICAgfQogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwcm95ZWN0b3M6IFtdLAogICAgICBpZFByb3llY3RvU2VsZWNjaW9uYWRvOm51bGwsCiAgICAgIGxvYWRpbmc6dHJ1ZSwKICAgIH07CiAgfSwKICBtZXRob2RzOnsKICAgIGNyZWFyTnVldm9Qcm95ZWN0bygpewogICAgICBjb25zb2xlLmxvZyhgQ3JlYW5kbyBudWV2byBwcm95ZWN0b2ApOwogICAgICB0aGlzLiRhcG9sbG8ubXV0YXRlKHsKICAgICAgICBtdXRhdGlvbjogZ3FsYAogICAgICAgICAgbXV0YXRpb257CiAgICAgICAgICAgIGNyZWFyUHJveWVjdG97CiAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICBub21icmUKICAgICAgICAgICAgICByZXNwb25zYWJsZXMgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgYCwKICAgICAgfSkudGhlbigoe2RhdGE6e2NyZWFyUHJveWVjdG99fSk9PnsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL3Byb3llY3RvLycrY3JlYXJQcm95ZWN0by5pZCk7CiAgICAgIH0pLmNhdGNoKChlcnJvcik9PnsKICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3IuZXJyb3JzfWApOwogICAgICB9KTsKICAgIH0sCiAgICBlbGltaW5hclByb3llY3RvKGlkUHJveWVjdG8pewogICAgICBpZighY29uZmlybSgiwr9Db25maXJtYXIgbGEgZWxpbWluYWNpw7NuIGRlbCBncnVwbz8gKEVzdGEgYWNjacOzbiBubyBzZSBwdWVkZSBkZXNoYWNlcikiKSlyZXR1cm4KICAgICAgY29uc29sZS5sb2coYEVsaW1pbmFuZG8gcHJveWVjdG8gJHtpZFByb3llY3RvfWApOwogICAgICB0aGlzLiRhcG9sbG8ubXV0YXRlKHsKICAgICAgICBtdXRhdGlvbjpncWxgCiAgICAgICAgICBtdXRhdGlvbigkaWRQcm95ZWN0bzpJRCEpewogICAgICAgICAgICBlbGltaW5hclByb3llY3RvKGlkUHJveWVjdG86ICRpZFByb3llY3RvKQogICAgICAgICAgfQogICAgICAgIGAsCiAgICAgICAgdmFyaWFibGVzOnsKICAgICAgICAgIGlkUHJveWVjdG8KICAgICAgICB9LAogICAgICAgIHVwZGF0ZTogKHN0b3JlLCB7ZGF0YTp7ZWxpbWluYXJQcm95ZWN0b319KT0+ewogICAgICAgICAgY29uc29sZS5sb2coYEFjdHVhbGl6YW5kbyBjYWNoZWApOwogICAgICAgICAgaWYoZWxpbWluYXJQcm95ZWN0byl7CiAgICAgICAgICAgIGxldCBjYWNoZT1zdG9yZS5yZWFkUXVlcnkoe3F1ZXJ5OiBRVUVSWV9QUk9ZRUNUT1N9KTsKICAgICAgICAgICAgbGV0IG51ZXZvQ2FjaGU9SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYWNoZSkpOwogICAgICAgICAgICBsZXQgaW5kZXhQPW51ZXZvQ2FjaGUucHJveWVjdG9zLmZpbmRJbmRleChwPT5wLmlkPT1pZFByb3llY3RvKTsKICAgICAgICAgICAgaWYoaW5kZXhQPi0xKXsKICAgICAgICAgICAgICBudWV2b0NhY2hlLnByb3llY3Rvcy5zcGxpY2UoaW5kZXhQLCAxKTsKICAgICAgICAgICAgICBzdG9yZS53cml0ZVF1ZXJ5KHtxdWVyeTogUVVFUllfUFJPWUVDVE9TLCBkYXRhOiBudWV2b0NhY2hlfSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYENhY2jDqSBhY3R1YWxpemFkb2ApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vIGV4aXN0w61hIGVzZSBwcm95ZWN0byBlbiBlbCBjYWNoZWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkudGhlbigoKT0+ewoKICAgICAgfSkuY2F0Y2goKGVycm9yKT0+ewogICAgICAgIGNvbnNvbGUubG9nKGBFcnJvci4gRToke2Vycm9yfWApOwogICAgICB9KQogICAgfQogIH0sCiAgY29tcHV0ZWQ6ewogICAgdXNlcm5hbWU6ZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzdWFyaW8udXNlcm5hbWU7CiAgICB9LAogICAgcHJveWVjdG9zT3JkZW5hZG9zU2VndW5Vc3VhcmlvKCl7CiAgICAgIGlmKCF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5pZClyZXR1cm4gdGhpcy5wcm95ZWN0b3M7CgogICAgICByZXR1cm4gWy4uLnRoaXMucHJveWVjdG9zXS5zb3J0KChhLCBiKT0+ewogICAgICAgIHZhciByZXNwPTA7CiAgICAgICAgaWYoYS5yZXNwb25zYWJsZXMuaW5jbHVkZXModGhpcy51c3VhcmlvLmlkKSlyZXNwLS07CiAgICAgICAgaWYoYi5yZXNwb25zYWJsZXMuaW5jbHVkZXModGhpcy51c3VhcmlvLmlkKSlyZXNwKys7CiAgICAgICAgcmV0dXJuIHJlc3A7CiAgICAgIH0pCiAgICB9CiAgfQoKfTsK"},{"version":3,"sources":["Proyectos.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"Proyectos.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"proyectos\">\n    <center><h3>Grupos</h3></center>\n    <div id=\"controles\" v-show=\"!loading\">\n      <div\n        v-if=\"usuarioLogeado\"\n        id=\"crearProyecto\"\n        class=\"controles hoverGris\"\n        @click=\"crearNuevoProyecto\"\n      >\n        Crear nuevo grupo\n      </div>\n      <div\n        v-if=\"\n          usuarioSuperadministrador &&\n          proyectos.some((p) => p.id == idProyectoSeleccionado)\n        \"\n        id=\"bEliminarProyecto\"\n        class=\"controles hoverGris\"\n        @click=\"eliminarProyecto(idProyectoSeleccionado)\"\n      >\n        Eliminar grupo\n      </div>\n    </div>\n    <div id=\"listaProyectos\" @click.self=\"idProyectoSeleccionado=null\">\n      <loading texto=\"Cargando lista de grupos...\" v-show=\"loading\"/>\n      <icono-proyecto\n        v-for=\"proyecto of proyectosOrdenadosSegunUsuario\"\n        :key=\"proyecto.id\"\n        :esteProyecto=\"proyecto\"\n        :seleccionado=\"idProyectoSeleccionado == proyecto.id\"\n        @click.native=\"idProyectoSeleccionado = proyecto.id\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport IconoProyecto from \"./proyectos/IconoProyecto.vue\";\nimport Loading from './utilidades/Loading.vue';\n\nconst QUERY_PROYECTOS=gql`\nquery {\n    proyectos {\n      id\n      nombre\n      responsables\n    }\n  }\n`;\n\nexport default {\n  components: { IconoProyecto, Loading },\n  name: \"Proyectos\",\n  apollo: {\n    proyectos: {\n      query: QUERY_PROYECTOS,\n      fetchPolicy: \"cache-and-network\",\n      update:function({proyectos}){\n        return proyectos.sort((a, b)=>{\n          let res=0;\n          if(a.responsables.some(r=>r.id==this.$store.state.usuario.id)){\n            res--;\n          }\n          if(b.responsables.some(r=>r.id==this.$store.state.usuario.id)){\n            res++;\n          }\n          this.loading=false;\n          return res;\n        })\n      }\n    },\n  },\n  data() {\n    return {\n      proyectos: [],\n      idProyectoSeleccionado:null,\n      loading:true,\n    };\n  },\n  methods:{\n    crearNuevoProyecto(){\n      console.log(`Creando nuevo proyecto`);\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation{\n            crearProyecto{\n              id\n              nombre\n              responsables              \n            }\n          }\n        `,\n      }).then(({data:{crearProyecto}})=>{\n        this.$router.push('/proyecto/'+crearProyecto.id);\n      }).catch((error)=>{\n        console.log(`Error: ${error.errors}`);\n      });\n    },\n    eliminarProyecto(idProyecto){\n      if(!confirm(\"¿Confirmar la eliminación del grupo? (Esta acción no se puede deshacer)\"))return\n      console.log(`Eliminando proyecto ${idProyecto}`);\n      this.$apollo.mutate({\n        mutation:gql`\n          mutation($idProyecto:ID!){\n            eliminarProyecto(idProyecto: $idProyecto)\n          }\n        `,\n        variables:{\n          idProyecto\n        },\n        update: (store, {data:{eliminarProyecto}})=>{\n          console.log(`Actualizando cache`);\n          if(eliminarProyecto){\n            let cache=store.readQuery({query: QUERY_PROYECTOS});\n            let nuevoCache=JSON.parse(JSON.stringify(cache));\n            let indexP=nuevoCache.proyectos.findIndex(p=>p.id==idProyecto);\n            if(indexP>-1){\n              nuevoCache.proyectos.splice(indexP, 1);\n              store.writeQuery({query: QUERY_PROYECTOS, data: nuevoCache});\n              console.log(`Caché actualizado`);\n            }\n            else{\n              console.log(`No existía ese proyecto en el cache`);\n            }\n            \n          }\n        }\n      }).then(()=>{\n\n      }).catch((error)=>{\n        console.log(`Error. E:${error}`);\n      })\n    }\n  },\n  computed:{\n    username:function(){\n      return this.$store.state.usuario.username;\n    },\n    proyectosOrdenadosSegunUsuario(){\n      if(!this.usuario || !this.usuario.id)return this.proyectos;\n\n      return [...this.proyectos].sort((a, b)=>{\n        var resp=0;\n        if(a.responsables.includes(this.usuario.id))resp--;\n        if(b.responsables.includes(this.usuario.id))resp++;\n        return resp;\n      })\n    }\n  }\n\n};\n</script>\n\n<style scoped>\n.loading{\n  margin: 20px auto;\n}\n#listaProyectos {\n  display: flex;\n  padding-left: 30px;\n  padding-right: 30px;\n  max-width: 100%;\n  flex-flow: row wrap;\n}\n\n#controles {\n  display: flex;\n}\n.controles {\n  padding: 5px;\n  cursor: pointer;\n}\n</style>"]}]}