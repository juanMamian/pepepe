{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/Espacios.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/Espacios.vue","mtime":1644587546118},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwppbXBvcnQgRXNwYWNpbyBmcm9tICIuL0VzcGFjaW8udnVlIjsKaW1wb3J0IExvYWRpbmcgZnJvbSAnLi91dGlsaWRhZGVzL0xvYWRpbmcudnVlJzsKY29uc3QgZnJhZ21lbnRvRXNwYWNpbyA9IGdxbGAKICBmcmFnbWVudCBmcmFnRXNwYWNpbyBvbiBFc3BhY2lvIHsKICAgIGlkCiAgICBub21icmUKICAgIGRlc2NyaXBjaW9uCiAgICBpZEFkbWluaXN0cmFkb3IKICB9CmA7CmNvbnN0IFFVRVJZX0VTUEFDSU9TID0gZ3FsYAogIHF1ZXJ5IHsKICAgIHRvZG9zRXNwYWNpb3MgewogICAgICAuLi5mcmFnRXNwYWNpbwogICAgfQogIH0KICAke2ZyYWdtZW50b0VzcGFjaW99CmA7CgoKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IEVzcGFjaW8sIExvYWRpbmcgfSwKICBhcG9sbG86IHsKICAgIHRvZG9zRXNwYWNpb3M6IHsKICAgICAgcXVlcnk6IFFVRVJZX0VTUEFDSU9TLAogICAgfSwKICB9LAogIG5hbWU6ICJFc3BhY2lvcyIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRvZG9zRXNwYWNpb3M6IFtdLAoKICAgICAgdmVyVG9kb3M6ZmFsc2UsCiAgICAgIGNyZWFuZG9Fc3BhY2lvOiBmYWxzZSwKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBjcmVhck51ZXZvRXNwYWNpbygpIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW9Qcm9mZSAmJiAhdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yKSByZXR1cm47CgogICAgICB0aGlzLmNyZWFuZG9Fc3BhY2lvID0gdHJ1ZTsKCiAgICAgIHRoaXMuJGFwb2xsby5tdXRhdGUoewogICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICBtdXRhdGlvbiAoJGluZm86IElucHV0Q3JlYXJFc3BhY2lvKSB7CiAgICAgICAgICAgIGNyZWFyRXNwYWNpbyhpbmZvOiAkaW5mbykgewogICAgICAgICAgICAgIC4uLmZyYWdFc3BhY2lvCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgICR7ZnJhZ21lbnRvRXNwYWNpb30KICAgICAgICBgLAogICAgICAgIHZhcmlhYmxlczp7CiAgICAgICAgICAgIGluZm86ewogICAgICAgICAgICAgICAgaWRBZG1pbmlzdHJhZG9yOiB0aGlzLnVzdWFyaW8uaWQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkudGhlbigoe2RhdGE6e2NyZWFyRXNwYWNpb319KT0+ewogICAgICAgICAgY29uc3Qgc3RvcmU9dGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgICAgICBjb25zdCBjYWNoZT1zdG9yZS5yZWFkUXVlcnkoewogICAgICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9FU1BBQ0lPUwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCBudWV2b0NhY2hlPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKCiAgICAgICAgICBjb25zdCBpbmRleEU9bnVldm9DYWNoZS50b2Rvc0VzcGFjaW9zLmZpbmRJbmRleChlPT5lLmlkPT09Y3JlYXJFc3BhY2lvLmlkKTsKICAgICAgICAgIGlmKGluZGV4RT09PS0xKXsKICAgICAgICAgICAgICBudWV2b0NhY2hlLnRvZG9zRXNwYWNpb3MucHVzaChjcmVhckVzcGFjaW8pOwogICAgICAgICAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgICAgICAgICAgICBxdWVyeTogUVVFUllfRVNQQUNJT1MsCiAgICAgICAgICAgICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUKICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRWwgZXNwYWNpbyB5YSBlc3RhYmEgZW4gY2FjaMOpYCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmNyZWFuZG9Fc3BhY2lvID0gZmFsc2U7CgogICAgICB9KS5jYXRjaCgoZXJyb3IpPT57CiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgICB0aGlzLmNyZWFuZG9Fc3BhY2lvID0gZmFsc2U7CgogICAgICB9KQogICAgfSwKICAgIGVsaW1pbmFyRXNwYWNpb0NhY2hlKGlkRXNwYWNpbykgewogICAgICBjb25zdCBzdG9yZSA9IHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50OwogICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgcXVlcnk6IFFVRVJZX0VTUEFDSU9TLCAgICAgICAgCiAgICAgIH0pOwogICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgY29uc3QgaW5kZXhFID0gbnVldm9DYWNoZS50b2Rvc0VzcGFjaW9zLmZpbmRJbmRleCgKICAgICAgICAoZSkgPT4gZS5pZCA9PT0gaWRFc3BhY2lvCiAgICAgICk7CiAgICAgIGlmIChpbmRleEUgPiAtMSkgewogICAgICAgIG51ZXZvQ2FjaGUudG9kb3NFc3BhY2lvcy5zcGxpY2UoaW5kZXhFLCAxKTsKICAgICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9FU1BBQ0lPUywgICAgICAgICAgCiAgICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgbWFuZWphckNyZWFjaW9uRXZlbnRvcyhldmVudG9zKXsKICAgICAgY29uc29sZS5sb2coYE1hbmVqYW5kbyBsYSByZXBldGljaW9uIGRlIGxvcyBldmVudG9zIGRlIHVuIGVzcGFjaW8gY29uIGlkICR7ZXZlbnRvc1swXS5pZFBhcmVudH1gKTsgICAgICAKICAgIH0sCiAgICBoYW5kbGVDYW1iaW9GZWNoYUV2ZW50bygpewogICAgICBjb25zb2xlLmxvZyhgSGFuZGxpbmdgKTsKCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgdXN1YXJpb1Byb2ZlKCkgewogICAgICBpZiAoIXRoaXMudXN1YXJpb0xvZ2VhZG8pIHJldHVybiBmYWxzZTsKCiAgICAgIHJldHVybiB0aGlzLnVzdWFyaW8ucGVybWlzb3MuaW5jbHVkZXMoIm1hZXN0cmFWaWRhLXByb2Zlc29yIik7CiAgICB9LAogICAgZXNwYWNpb3NWaXNpYmxlcygpewogICAgICBpZih0aGlzLnZlclRvZG9zKXJldHVybiB0aGlzLmVzcGFjaW9zVXN1YXJpby5jb25jYXQodGhpcy5lc3BhY2lvc05vVXN1YXJpbyk7CiAgICAgIHJldHVybiB0aGlzLmVzcGFjaW9zVXN1YXJpbwogICAgfSwgICAgCiAgICBlc3BhY2lvc1VzdWFyaW8oKXsKICAgICAgaWYoIXRoaXMudXN1YXJpb0xvZ2VhZG8pcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy50b2Rvc0VzcGFjaW9zLmZpbHRlcihlPT5lLmlkQWRtaW5pc3RyYWRvcj09PXRoaXMudXN1YXJpby5pZCk7CiAgICB9LAogICAgZXNwYWNpb3NOb1VzdWFyaW8oKXsKICAgICAgaWYoIXRoaXMudXN1YXJpb0xvZ2VhZG8pcmV0dXJuIHRoaXMudG9kb3NFc3BhY2lvczsKICAgICAgcmV0dXJuIHRoaXMudG9kb3NFc3BhY2lvcy5maWx0ZXIoZT0+ZS5pZEFkbWluaXN0cmFkb3IhPXRoaXMudXN1YXJpby5pZCkKICAgIH0KICB9LAp9Owo="},{"version":3,"sources":["Espacios.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Espacios.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"espacios\">\n    <router-view id=\"visorVentanaEventoPublico\" @meRepetiPeriodicamente=\"manejarCreacionEventos\" @eventoCambioFecha=\"manejarCreacionEventos([$event])\">\n      \n    </router-view>\n    <div id=\"barraControles\">\n      \n      <div\n        class=\"boton botonControl\"\n        title=\"Crear nuevo espacio\"\n        v-show=\"usuarioProfe && !creandoEspacio\"\n        @click=\"crearNuevoEspacio\"\n      >\n        <img src=\"@/assets/iconos/plusCircle.svg\" alt=\"Nuevo\" />\n      </div>\n      <loading texto=\"\" v-show=\"creandoEspacio\" />\n\n      <div class=\"boton\" @click=\"verTodos=!verTodos\" style=\"margin-right:15px\">\n        <img src=\"@/assets/iconos/users.svg\" alt=\"Todos\" v-show=\"verTodos\">\n        <img src=\"@/assets/iconos/user.svg\" alt=\"Usuario\" v-show=\"!verTodos\">\n      </div>\n    </div>\n    <div id=\"listaEspacios\">\n      <espacio\n        v-for=\"espacio of espaciosVisibles\"\n        ref=\"espacios\"\n        :key=\"espacio.id\"\n        :esteEspacio=\"espacio\"\n        @meElimine=\"eliminarEspacioCache(espacio.id)\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport Espacio from \"./Espacio.vue\";\nimport Loading from './utilidades/Loading.vue';\nconst fragmentoEspacio = gql`\n  fragment fragEspacio on Espacio {\n    id\n    nombre\n    descripcion\n    idAdministrador\n  }\n`;\nconst QUERY_ESPACIOS = gql`\n  query {\n    todosEspacios {\n      ...fragEspacio\n    }\n  }\n  ${fragmentoEspacio}\n`;\n\n\n\nexport default {\n  components: { Espacio, Loading },\n  apollo: {\n    todosEspacios: {\n      query: QUERY_ESPACIOS,\n    },\n  },\n  name: \"Espacios\",\n  data() {\n    return {\n      todosEspacios: [],\n\n      verTodos:false,\n      creandoEspacio: false,\n    };\n  },\n  methods: {\n    crearNuevoEspacio() {\n      if (!this.usuarioProfe && !this.usuarioSuperadministrador) return;\n\n      this.creandoEspacio = true;\n\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation ($info: InputCrearEspacio) {\n            crearEspacio(info: $info) {\n              ...fragEspacio\n            }\n          }\n          ${fragmentoEspacio}\n        `,\n        variables:{\n            info:{\n                idAdministrador: this.usuario.id\n            }\n        }\n      }).then(({data:{crearEspacio}})=>{\n          const store=this.$apollo.provider.defaultClient;\n          const cache=store.readQuery({\n              query: QUERY_ESPACIOS\n          });\n          const nuevoCache=JSON.parse(JSON.stringify(cache));\n\n          const indexE=nuevoCache.todosEspacios.findIndex(e=>e.id===crearEspacio.id);\n          if(indexE===-1){\n              nuevoCache.todosEspacios.push(crearEspacio);\n              store.writeQuery({\n                  query: QUERY_ESPACIOS,\n                  data: nuevoCache\n              })\n          }\n          else{\n              console.log(`El espacio ya estaba en cachÃ©`);\n          }\n          this.creandoEspacio = false;\n\n      }).catch((error)=>{\n          console.log(`Error: ${error}`);\n          this.creandoEspacio = false;\n\n      })\n    },\n    eliminarEspacioCache(idEspacio) {\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_ESPACIOS,        \n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n      const indexE = nuevoCache.todosEspacios.findIndex(\n        (e) => e.id === idEspacio\n      );\n      if (indexE > -1) {\n        nuevoCache.todosEspacios.splice(indexE, 1);\n        store.writeQuery({\n          query: QUERY_ESPACIOS,          \n          data: nuevoCache,\n        });\n      }\n    },\n    manejarCreacionEventos(eventos){\n      console.log(`Manejando la repeticion de los eventos de un espacio con id ${eventos[0].idParent}`);      \n    },\n    handleCambioFechaEvento(){\n      console.log(`Handling`);\n\n    }\n  },\n  computed: {\n    usuarioProfe() {\n      if (!this.usuarioLogeado) return false;\n\n      return this.usuario.permisos.includes(\"maestraVida-profesor\");\n    },\n    espaciosVisibles(){\n      if(this.verTodos)return this.espaciosUsuario.concat(this.espaciosNoUsuario);\n      return this.espaciosUsuario\n    },    \n    espaciosUsuario(){\n      if(!this.usuarioLogeado)return [];\n      return this.todosEspacios.filter(e=>e.idAdministrador===this.usuario.id);\n    },\n    espaciosNoUsuario(){\n      if(!this.usuarioLogeado)return this.todosEspacios;\n      return this.todosEspacios.filter(e=>e.idAdministrador!=this.usuario.id)\n    }\n  },\n};\n</script>\n\n<style scoped>\n#barraControles {\n  display: flex;\n  flex-direction: row-reverse;\n    padding: 10px 20px;\n}\n\n.botonControl {\n  width: 20px;\n  height: 20px;\n}\n#listaEspacios{\n    margin: 20px auto;\n    width: min(600px, 95vw);\n    margin-bottom: 40vh;\n}\n.espacio{\n  margin:10px 0px;\n}\n.espacio:hover{\n    background-color: var(--grisHover);\n}\n</style>"]}]}