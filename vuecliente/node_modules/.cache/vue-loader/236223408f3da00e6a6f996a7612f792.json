{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/usuario/Notificacion.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/usuario/Notificacion.vue","mtime":1643654906679},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwppbXBvcnQgeyBRVUVSWV9ZTyB9IGZyb20gIi4uLy4uL0FwcC52dWUiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk5vdGlmaWNhY2lvbiIsCiAgcHJvcHM6IHsKICAgIGVzdGFOb3RpZmljYWNpb246IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9LAogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIHZpc2l0YXIoKSB7CiAgICAgIHZhciBlbmxhY2UgPSAiLyI7CiAgICAgIGlmICh0aGlzLmVzdGFOb3RpZmljYWNpb24uZWxlbWVudG9UYXJnZXQudGlwbyA9PSAiYWN0aXZpZGFkRXN0dWRpYW50aWwiKSB7CiAgICAgICAgZW5sYWNlICs9ICJhY3RpdmlkYWQvIiArIHRoaXMuZXN0YU5vdGlmaWNhY2lvbi5lbGVtZW50b1RhcmdldC5pZDsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0aGlzLmVzdGFOb3RpZmljYWNpb24uZWxlbWVudG9UYXJnZXQudGlwbyA9PT0gIm5vZG9BdGxhc1NvbGlkYXJpZGFkIgogICAgICApIHsKICAgICAgICBlbmxhY2UgKz0gImF0bGFzU29saWRhcmlkYWQvIiArIHRoaXMuZXN0YU5vdGlmaWNhY2lvbi5lbGVtZW50b1RhcmdldC5pZDsKICAgICAgfQogICAgICB0aGlzLmVsaW1pbmFyc2UoKTsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goZW5sYWNlKS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3IgZGUgbmF2ZWdhY2nDs246ICR7ZXJyb3IubWVzc2FnZS5zdWJzdHIoMCwgMjgpfWApOwogICAgICAgIGlmIChlcnJvci5tZXNzYWdlLnN1YnN0cigwLCAyOCkgPT0gIkF2b2lkZWQgcmVkdW5kYW50IG5hdmlnYXRpb24iKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgUmVmcmVzaGluZ2ApOwogICAgICAgICAgLy90aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy5lc3RhTm90aWZpY2FjaW9uLmVsZW1lbnRvVGFyZ2V0LnRpcG8gPT0gImFjdGl2aWRhZEVzdHVkaWFudGlsIgogICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJyZWZyZXNoQWN0aXZpZGFkRXNwZWNpZmljYSIpOwoKICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHRoaXMuZXN0YU5vdGlmaWNhY2lvbi5lbGVtZW50b1RhcmdldC50aXBvID09PSAibm9kb0F0bGFzU29saWRhcmlkYWQiCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJyZWZyZXNoTm9kb1ZlbnRhbml0YUF0bGFzU29saWRhcmlkYWQiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVsaW1pbmFyc2UoKSB7CiAgICAgIGxldCBpZE5vdGlmaWNhY2lvbiA9IHRoaXMuZXN0YU5vdGlmaWNhY2lvbi5pZDsKICAgICAgY29uc29sZS5sb2coYEVsaW1pbmFuZG9zZTogJHtpZE5vdGlmaWNhY2lvbn1gKTsKICAgICAgdGhpcy4kYXBvbGxvLm11dGF0ZSh7CiAgICAgICAgbXV0YXRpb246IGdxbGAKICAgICAgICAgIG11dGF0aW9uICgkaWROb3RpZmljYWNpb246IElEISkgewogICAgICAgICAgICBlbGltaW5hck5vdGlmaWNhY2lvbihpZE5vdGlmaWNhY2lvbjogJGlkTm90aWZpY2FjaW9uKQogICAgICAgICAgfQogICAgICAgIGAsCiAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICBpZE5vdGlmaWNhY2lvbiwKICAgICAgICB9LAogICAgICAgIHVwZGF0ZTogKHN0b3JlLCB7IGRhdGE6IHsgZWxpbWluYXJOb3RpZmljYWNpb24gfSB9KSA9PiB7CiAgICAgICAgICBpZiAoZWxpbWluYXJOb3RpZmljYWNpb24pIHsKICAgICAgICAgICAgbGV0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICAgICAgICBxdWVyeTogUVVFUllfWU8sCiAgICAgICAgICAgICAgdmFyaWFibGVzOiB7IGlkTm90aWZpY2FjaW9uIH0sCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgICAgICAgbGV0IGluZGV4TiA9IG51ZXZvQ2FjaGUueW8ubm90aWZpY2FjaW9uZXMuZmluZEluZGV4KAogICAgICAgICAgICAgIChuKSA9PiBuLmlkID09IGlkTm90aWZpY2FjaW9uCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmIChpbmRleE4gPiAtMSkgewogICAgICAgICAgICAgIG51ZXZvQ2FjaGUueW8ubm90aWZpY2FjaW9uZXMuc3BsaWNlKGluZGV4TiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RvcmUud3JpdGVRdWVyeSh7CiAgICAgICAgICAgICAgcXVlcnk6IFFVRVJZX1lPLAogICAgICAgICAgICAgIHZhcmlhYmxlczogeyBpZE5vdGlmaWNhY2lvbiB9LAogICAgICAgICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIH0pOwogICAgfSwKICB9LAogIGNvbXB1dGVkOiB7CiAgICBtZW5zYWplOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBtZW5zYWplID0gIiI7CiAgICAgIGlmICh0aGlzLmVzdGFOb3RpZmljYWNpb24uZWxlbWVudG9UYXJnZXQudGlwbyA9PSAiYWN0aXZpZGFkRXN0dWRpYW50aWwiKSB7CiAgICAgICAgaWYgKHRoaXMuZXN0YU5vdGlmaWNhY2lvbi5lbGVtZW50b1RhcmdldC5ub21icmUpIHsKICAgICAgICAgIG1lbnNhamUgKz0KICAgICAgICAgICAgIlRpZW5lcyB1bmEgbnVldmEgcmVzcHVlc3RhIGVuIGxhIGFjdGl2aWRhZCA8c3BhbiBzdHlsZT0nY29sb3I6IHdoaXRlJyBjbGFzcz0ndGV4dG9UYXJnZXQnPiIgKwogICAgICAgICAgICB0aGlzLmVzdGFOb3RpZmljYWNpb24uZWxlbWVudG9UYXJnZXQubm9tYnJlICsKICAgICAgICAgICAgIjwvc3Bhbj4iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZW5zYWplICs9ICJUaWVuZXMgdW5hIG51ZXZhIHJlc3B1ZXN0YSBlbiB1bmEgYWN0aXZpZGFkIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWVuc2FqZSA9IHRoaXMuZXN0YU5vdGlmaWNhY2lvbi50ZXh0bzsKICAgICAgfQogICAgICByZXR1cm4gbWVuc2FqZTsKICAgIH0sCiAgICBmZWNoYUZvcm1hdGVhZGE6IGZ1bmN0aW9uICgpIHsKICAgICAgbGV0IGxhRmVjaGEgPSBuZXcgRGF0ZSh0aGlzLmVzdGFOb3RpZmljYWNpb24uZmVjaGEpLnRvU3RyaW5nKCk7CiAgICAgIGxldCBpbmRleFBhcmVudGVzaXMgPSBsYUZlY2hhLmluZGV4T2YoIigiKTsKICAgICAgbGV0IGZlY2hhQ29ydGEgPSBsYUZlY2hhLnN1YnN0cigwLCBpbmRleFBhcmVudGVzaXMpOwogICAgICBsZXQgaW5kZXhHTVQgPSBmZWNoYUNvcnRhLmluZGV4T2YoIkdNVCIpOwogICAgICBpZiAoaW5kZXhHTVQgPiAtMSkgewogICAgICAgIGZlY2hhQ29ydGEgPSBmZWNoYUNvcnRhLnN1YnN0cigwLCBpbmRleEdNVCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZlY2hhQ29ydGE7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["Notificacion.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Notificacion.vue","sourceRoot":"src/components/usuario","sourcesContent":["<template>\n  <transition name=\"recogerseArriba\">\n    <div class=\"notificacion\" @click=\"visitar\">\n      <div id=\"info\">{{ fechaFormateada }}</div>\n      <img\n        :src=\"\n          this.serverUrl +\n          '/api/usuarios/fotografias/' +\n          estaNotificacion.causante.id\n        \"\n        alt=\"\"\n        id=\"caritaCausante\"\n      />\n      <div id=\"texto\" v-html=\"mensaje\"></div>\n    </div>\n  </transition>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport { QUERY_YO } from \"../../App.vue\";\nexport default {\n  name: \"Notificacion\",\n  props: {\n    estaNotificacion: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n  },\n  methods: {\n    visitar() {\n      var enlace = \"/\";\n      if (this.estaNotificacion.elementoTarget.tipo == \"actividadEstudiantil\") {\n        enlace += \"actividad/\" + this.estaNotificacion.elementoTarget.id;\n      } else if (\n        this.estaNotificacion.elementoTarget.tipo === \"nodoAtlasSolidaridad\"\n      ) {\n        enlace += \"atlasSolidaridad/\" + this.estaNotificacion.elementoTarget.id;\n      }\n      this.eliminarse();\n      this.$router.push(enlace).catch((error) => {\n        console.log(`Error de navegaciÃ³n: ${error.message.substr(0, 28)}`);\n        if (error.message.substr(0, 28) == \"Avoided redundant navigation\") {\n          console.log(`Refreshing`);\n          //this.$router.go();\n          if (\n            this.estaNotificacion.elementoTarget.tipo == \"actividadEstudiantil\"\n          ) {\n              this.$store.commit(\"refreshActividadEspecifica\");\n\n          } else if (\n            this.estaNotificacion.elementoTarget.tipo === \"nodoAtlasSolidaridad\"\n          ) {\n            this.$store.commit(\"refreshNodoVentanitaAtlasSolidaridad\");\n          }\n        }\n      });\n    },\n    eliminarse() {\n      let idNotificacion = this.estaNotificacion.id;\n      console.log(`Eliminandose: ${idNotificacion}`);\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation ($idNotificacion: ID!) {\n            eliminarNotificacion(idNotificacion: $idNotificacion)\n          }\n        `,\n        variables: {\n          idNotificacion,\n        },\n        update: (store, { data: { eliminarNotificacion } }) => {\n          if (eliminarNotificacion) {\n            let cache = store.readQuery({\n              query: QUERY_YO,\n              variables: { idNotificacion },\n            });\n            let nuevoCache = JSON.parse(JSON.stringify(cache));\n            let indexN = nuevoCache.yo.notificaciones.findIndex(\n              (n) => n.id == idNotificacion\n            );\n            if (indexN > -1) {\n              nuevoCache.yo.notificaciones.splice(indexN, 1);\n            }\n            store.writeQuery({\n              query: QUERY_YO,\n              variables: { idNotificacion },\n              data: nuevoCache,\n            });\n          }\n        },\n      });\n    },\n  },\n  computed: {\n    mensaje: function () {\n      var mensaje = \"\";\n      if (this.estaNotificacion.elementoTarget.tipo == \"actividadEstudiantil\") {\n        if (this.estaNotificacion.elementoTarget.nombre) {\n          mensaje +=\n            \"Tienes una nueva respuesta en la actividad <span style='color: white' class='textoTarget'>\" +\n            this.estaNotificacion.elementoTarget.nombre +\n            \"</span>\";\n        } else {\n          mensaje += \"Tienes una nueva respuesta en una actividad\";\n        }\n      } else {\n        mensaje = this.estaNotificacion.texto;\n      }\n      return mensaje;\n    },\n    fechaFormateada: function () {\n      let laFecha = new Date(this.estaNotificacion.fecha).toString();\n      let indexParentesis = laFecha.indexOf(\"(\");\n      let fechaCorta = laFecha.substr(0, indexParentesis);\n      let indexGMT = fechaCorta.indexOf(\"GMT\");\n      if (indexGMT > -1) {\n        fechaCorta = fechaCorta.substr(0, indexGMT);\n      }\n      return fechaCorta;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.notificacion {\n  width: 300px;\n  height: 130px;\n  border: 1px solid rgb(238, 227, 219);\n  background-color: rgb(243, 138, 58);\n  display: grid;\n  grid-template-columns: 100px 1fr;\n  grid-template-rows: 15px 1fr;\n  grid-template-areas:\n    \"info info\"\n    \"imagen texto\";\n  align-items: center;\n  justify-items: center;\n  cursor: pointer;\n  overflow: hidden;\n}\n.notificacion:hover {\n  background-color: rgb(231, 168, 119);\n}\n#info {\n  grid-area: info;\n  font-size: 11px;\n  color: white;\n}\n#caritaCausante {\n  grid-area: imagen;\n  width: 70px;\n  height: 70px;\n  border-radius: 50%;\n}\n#texto {\n  grid-area: texto;\n}\n.textoTarget {\n  color: white;\n}\n.recogerseArriba-leave-to {\n  height: 0px;\n}\n.recogerseArriba-leave-active {\n  transition: height 0.3s;\n}\n</style>"]}]}