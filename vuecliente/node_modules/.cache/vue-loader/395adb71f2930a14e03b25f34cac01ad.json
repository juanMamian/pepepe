{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/AtlasConocimiento.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/AtlasConocimiento.vue","mtime":1644587546118},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwppbXBvcnQgTm9kb0Nvbm9jaW1pZW50byBmcm9tICIuL2F0bGFzQ29ub2NpbWllbnRvL05vZG9Db25vY2ltaWVudG8udnVlIjsKaW1wb3J0IENhbnZhc2VzIGZyb20gIi4vYXRsYXNDb25vY2ltaWVudG8vQ2FudmFzZXMudnVlIjsKaW1wb3J0IEJ1c2NhZG9yTm9kb3NDb25vY2ltaWVudG8gZnJvbSAiLi9hdGxhc0Nvbm9jaW1pZW50by9CdXNjYWRvck5vZG9zQ29ub2NpbWllbnRvLnZ1ZSI7CmltcG9ydCBMb2FkaW5nIGZyb20gIi4vdXRpbGlkYWRlcy9Mb2FkaW5nLnZ1ZSI7CmltcG9ydCBQYW5lbENvbmp1bnRvc05vZG9zIGZyb20gIi4vYXRsYXNDb25vY2ltaWVudG8vUGFuZWxDb25qdW50b3NOb2Rvcy52dWUiOwppbXBvcnQgUGFuZWxDb25maWd1cmFjaW9uQXRsYXMgZnJvbSAiLi9hdGxhc0Nvbm9jaW1pZW50by9QYW5lbENvbmZpZ3VyYWNpb25BdGxhcy52dWUiOwpjb25zdCBkZWJvdW5jZSA9IHJlcXVpcmUoImRlYm91bmNlIik7Cgpjb25zdCBmcmFnbWVudG9Ob2RvQ29ub2NpbWllbnRvID0gZ3FsYAogIGZyYWdtZW50IGZyYWdOb2RvQ29ub2NpbWllbnRvIG9uIE5vZG9Db25vY2ltaWVudG8gewogICAgaWQKICAgIG5vbWJyZQogICAgZGVzY3JpcGNpb24KICAgIGV4cGVydG9zCiAgICBjbGFzZXMgewogICAgICBpZAogICAgICBub21icmUKICAgICAgaWRFeHBlcnRvCiAgICAgIGludGVyZXNhZG9zCiAgICB9CiAgICBjb29yZHNNYW51YWxlcyB7CiAgICAgIHgKICAgICAgeQogICAgfQogICAgY29vcmRzIHsKICAgICAgeAogICAgICB5CiAgICB9CiAgICBhdXRvQ29vcmRzIHsKICAgICAgeAogICAgICB5CiAgICB9CiAgICBjZW50cm9NYXNhIHsKICAgICAgeAogICAgICB5CiAgICB9CiAgICBzdHVjawogICAgYW5ndWxvCiAgICBwdW50YWplCiAgICB2aW5jdWxvcyB7CiAgICAgIGlkUmVmCiAgICAgIHJvbAogICAgICB0aXBvCiAgICB9CiAgICBmdWVyemFDZW50cm9NYXNhIHsKICAgICAgZnVlcnphCiAgICAgIGRpcmVjY2lvbgogICAgfQogICAgZnVlcnphQ29saXNpb24gewogICAgICBmdWVyemEKICAgICAgZGlyZWNjaW9uCiAgICB9CiAgfQpgOwoKY29uc3QgUVVFUllfTk9ET1MgPSBncWxgCiAgcXVlcnkgewogICAgdG9kb3NOb2RvcyB7CiAgICAgIC4uLmZyYWdOb2RvQ29ub2NpbWllbnRvCiAgICB9CiAgfQogICR7ZnJhZ21lbnRvTm9kb0Nvbm9jaW1pZW50b30KYDsKCmNvbnN0IFFVRVJZX0RBVE9TX1VTVUFSSU9fTk9ET1MgPSBncWxgCiAgcXVlcnkgewogICAgeW8gewogICAgICBpZAogICAgICBhdGxhcyB7CiAgICAgICAgZGF0b3NOb2RvcyB7CiAgICAgICAgICBpZE5vZG8KICAgICAgICAgIG9iamV0aXZvCiAgICAgICAgICBhcHJlbmRpZG8KICAgICAgICB9CiAgICAgICAgY29uZmlndXJhY2lvbiB7CiAgICAgICAgICBtb2RvCiAgICAgICAgfQogICAgICAgIGlkTm9kb1RhcmdldAogICAgICAgIGNvbGVjY2lvbmVzIHsKICAgICAgICAgIGlkCiAgICAgICAgICBub21icmUKICAgICAgICAgIGlkc05vZG9zCiAgICAgICAgICBub2RvcyB7CiAgICAgICAgICAgIGlkCiAgICAgICAgICAgIG5vbWJyZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KYDsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBOb2RvQ29ub2NpbWllbnRvLAogICAgQ2FudmFzZXMsCiAgICBCdXNjYWRvck5vZG9zQ29ub2NpbWllbnRvLAogICAgTG9hZGluZywKICAgIFBhbmVsQ29uanVudG9zTm9kb3MsCiAgICBQYW5lbENvbmZpZ3VyYWNpb25BdGxhcywKICB9LAogIG5hbWU6ICJBdGxhc0Nvbm9jaW1pZW50byIsCiAgYXBvbGxvOiB7CiAgICB0b2Rvc05vZG9zOiB7CiAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPUywKICAgICAgcmVzdWx0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kaWJ1amFyVmluY3Vsb3NHcmlzZXMoKTsKICAgICAgfSwKICAgICAgcG9sbEludGVydmFsKCkgewogICAgICAgIHJldHVybiB0aGlzLmNhbGxpbmdQb3NpY2lvbmVzID8gNTAwMCA6IG51bGw7CiAgICAgIH0sCiAgICAgIHVwZGF0ZSh7IHRvZG9zTm9kb3MgfSkgewogICAgICAgIHRoaXMubm9kb3NEZXNjYXJnYWRvcyA9IHRydWU7CiAgICAgICAgdmFyIG51ZXZvVG9kb3NOb2RvcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodG9kb3NOb2RvcykpOwogICAgICAgIG51ZXZvVG9kb3NOb2Rvcy5mb3JFYWNoKChub2RvKSA9PiB7CiAgICAgICAgICBub2RvLmNvb3Jkc01hbnVhbGVzID0gbm9kby5hdXRvQ29vcmRzOwogICAgICAgICAgbm9kby5jb29yZHMgPSBub2RvLmF1dG9Db29yZHM7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG51ZXZvVG9kb3NOb2RvczsKICAgICAgfSwKICAgICAgZmV0Y2hQb2xpY3k6ICJjYWNoZS1hbmQtbmV0d29yayIsCiAgICB9LAogICAgeW86IHsKICAgICAgcXVlcnk6IFFVRVJZX0RBVE9TX1VTVUFSSU9fTk9ET1MsCiAgICAgIHNraXAoKSB7CiAgICAgICAgcmV0dXJuICF0aGlzLnVzdWFyaW9Mb2dlYWRvIHx8IHRoaXMudG9kb3NOb2Rvcy5sZW5ndGggPCAxOwogICAgICB9LAogICAgfSwKICAgIGNvbmZpZ3VyYWNpb25BdGxhczogewogICAgICBxdWVyeTogZ3FsYAogICAgICAgIHF1ZXJ5ICgkbm9tYnJlQXRsYXM6IFN0cmluZyEpIHsKICAgICAgICAgIGNvbmZpZ3VyYWNpb25BdGxhcyhub21icmVBdGxhczogJG5vbWJyZUF0bGFzKSB7CiAgICAgICAgICAgIGlkCiAgICAgICAgICAgIHBvc2ljaW9uYW5kbwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgYCwKICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgbm9tYnJlQXRsYXM6ICJjb25vY2ltaWVudG8iLAogICAgICB9LAogICAgICBmZXRjaFBvbGljeTogIm5ldHdvcmstb25seSIsCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbmZpZ3VyYWNpb25BdGxhczogewogICAgICAgIHBvc2ljaW9uYW5kbzogZmFsc2UsCiAgICAgIH0sCiAgICAgIGhvdmVyZWQ6IGZhbHNlLAogICAgICB0b2Rvc05vZG9zOiBbXSwKICAgICAgbm9kb3NEZXNjYXJnYWRvczogZmFsc2UsCiAgICAgIGlkTm9kb1NlbGVjY2lvbmFkbzogIi0xIiwKICAgICAgaWROb2RvTWVudUN4OiAiLTEiLAogICAgICBpZHNOZWNlc2FyaW9zUGFyYVRhcmdldDogW10sCgogICAgICB5bzogewogICAgICAgIGF0bGFzOiB7CiAgICAgICAgICBkYXRvc05vZG9zOiBbXSwKICAgICAgICAgIGNvbmZpZ3VyYWNpb246IHsKICAgICAgICAgICAgbW9kbzogImVzdHVkaWFudGUiLAogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICB9LAoKICAgICAgY2VudHJvVmlzdGFEZWNpbWFsOiB7CiAgICAgICAgeDogMjE4LAogICAgICAgIHk6IDM5LAogICAgICB9LAogICAgICBzaG93aW5nWm9vbUluZm86IGZhbHNlLAogICAgICB6b29tOiA4MCwKICAgICAgbWluWm9vbTogMjAsCiAgICAgIG1heFpvb206IDIwMCwKICAgICAgcGluY2hpbmc6IGZhbHNlLAogICAgICBsYXN0UGluY2hEaXN0YW5jZTogMCwKICAgICAgYWN0dWFsaXphclRyYXpvczogMCwKICAgICAgcGFubmluZ1Zpc3RhOiBmYWxzZSwKICAgICAgdmlzdGFQYW5uZWQ6IGZhbHNlLAogICAgICBub2Rvc0NvbmVjdGFkb3NBbFNlbGVjY2lvbmFkbzogewogICAgICAgIGxpc3RhQ29tcGxldGE6IFtdLAogICAgICAgIGxpc3RhUG9yTml2ZWxlczogW10sCiAgICAgIH0sCiAgICAgIHByb2Z1bmRpZGFkTm9kb3NDb25lY3RhZG9zQWxTZWxlY2Npb25hZG86IDEsCiAgICAgIGFjdHVhbGl6YXJWaW5jdWxvc0dyaXNlczogMCwKCiAgICAgIHVsdGltb1RvdWNoWDogMCwKICAgICAgdWx0aW1vVG91Y2hZOiAwLAoKICAgICAgY2VycmFyQnVzcXVlZGE6IDAsCgogICAgICBjYWxsaW5nUG9zaWNpb25lczogZmFsc2UsCgogICAgICBtb3N0cmFuZG9NZW51Q29udGV4dHVhbDogZmFsc2UsCiAgICAgIG9mZnNldE1lbnVDb250ZXh0dWFsOiB7CiAgICAgICAgdG9wOiAiMHB4IiwKICAgICAgICBsZWZ0OiAiMHB4IiwKICAgICAgfSwKICAgICAgZW52aWFuZG9RdWVyeUNvbmZpZ3VyYWNpb25BdGxhczogZmFsc2UsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGlkc05vZG9zT2JqZXRpdm9zKCkgewogICAgICBpZiAoIXRoaXMueW8gfHwgIXRoaXMueW8uYXRsYXMgfHwgIXRoaXMueW8uYXRsYXMuZGF0b3NOb2RvcykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5kYXRvc05vZG9zCiAgICAgICAgLmZpbHRlcigobikgPT4gbi5vYmpldGl2byA9PSB0cnVlKQogICAgICAgIC5tYXAoKG4pID0+IG4uaWROb2RvKTsKICAgIH0sCiAgICBub2Rvc09iamV0aXZvKCkgewogICAgICBpZiAoIXRoaXMudG9kb3NOb2RvcykgcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zLmZpbHRlcigobikgPT4KICAgICAgICB0aGlzLmlkc05vZG9zT2JqZXRpdm9zLmluY2x1ZGVzKG4uaWQpCiAgICAgICk7CiAgICB9LAogICAgbm9kb1NlbGVjY2lvbmFkbzogZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMudG9kb3NOb2RvcykgewogICAgICAgIGNvbnNvbGUubG9nKGBOTyBIQVkgTk9ET1NgKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudG9kb3NOb2Rvcy5zb21lKChuKSA9PiBuLmlkID09IHRoaXMuaWROb2RvU2VsZWNjaW9uYWRvKSkgewogICAgICAgIGxldCBpbmRleFNlbGVjY2lvbmFkbyA9IHRoaXMudG9kb3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgICAobikgPT4gbi5pZCA9PSB0aGlzLmlkTm9kb1NlbGVjY2lvbmFkbwogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRoaXMudG9kb3NOb2Rvc1tpbmRleFNlbGVjY2lvbmFkb107CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogIi0xIiwKICAgICAgICB2aW5jdWxvczogW10sCiAgICAgIH07CiAgICB9LAogICAgaWRVc3VhcmlvOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c3VhcmlvLmlkOwogICAgfSwKICAgIHVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXM6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLiRzdG9yZS5zdGF0ZS51c3VhcmlvLnBlcm1pc29zKSByZXR1cm4gZmFsc2U7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c3VhcmlvLnBlcm1pc29zLmluY2x1ZGVzKCJhdGxhc0FkbWluaXN0cmFkb3IiKQogICAgICAgID8gdHJ1ZQogICAgICAgIDogZmFsc2U7CiAgICB9LAogICAgaWROb2RvVGFyZ2V0KCkgewogICAgICBpZiAoIXRoaXMueW8gfHwgIXRoaXMueW8uYXRsYXMpIHJldHVybiBudWxsOwogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5pZE5vZG9UYXJnZXQ7CiAgICB9LAogICAgaWRzTm9kb3NBcHJlbmRpZG9zKCkgewogICAgICByZXR1cm4gdGhpcy55by5hdGxhcy5kYXRvc05vZG9zCiAgICAgICAgLmZpbHRlcigobikgPT4gbi5hcHJlbmRpZG8gPT0gdHJ1ZSkKICAgICAgICAubWFwKChuKSA9PiBuLmlkTm9kbyk7CiAgICB9LAogICAgY2VudHJvVmlzdGEoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogTWF0aC5yb3VuZCh0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC54KSwKICAgICAgICB5OiBNYXRoLnJvdW5kKHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLnkpLAogICAgICB9OwogICAgfSwKICAgIGZhY3Rvclpvb20oKSB7CiAgICAgIHJldHVybiBOdW1iZXIoKHRoaXMuem9vbSAvIDEwMCkudG9GaXhlZCgyKSk7CiAgICB9LAogICAgb2Zmc2V0Q29udGVuZWRvck5vZG9zKCkgewogICAgICByZXR1cm4gewogICAgICAgIGxlZnQ6IC0odGhpcy5jZW50cm9WaXN0YS54ICogdGhpcy5mYWN0b3Jab29tKSArICJweCIsCiAgICAgICAgdG9wOiAtKHRoaXMuY2VudHJvVmlzdGEueSAqIHRoaXMuZmFjdG9yWm9vbSkgKyAicHgiLAogICAgICB9OwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaWNpYXJDYWxsaW5nUG9zaWNpb25lcygpIHsKICAgICAgdmFyIGNpY2xvcyA9IHByb21wdCgiwr9DdWFudG9zIGNpY2xvcz8iKTsKICAgICAgaWYgKGlzTmFOKGNpY2xvcykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNpY2xvcyA9IE1hdGgucm91bmQoY2ljbG9zKTsKICAgICAgaWYgKGNpY2xvcyA8IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYEVudmlhbmRvIHJlcG9zaWNpb25hbWllbnRvIGRlICR7Y2ljbG9zfSBjaWNsb3NgKTsKICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IHRydWU7CgogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkY2ljbG9zOiBJbnQhKSB7CiAgICAgICAgICAgICAgcG9zaWNpb25hck5vZG9zQ29ub2NpbWllbnRvQnlGdWVyemFzKGNpY2xvczogJGNpY2xvcykKICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBjaWNsb3MsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdGhpcy5jYWxsaW5nUG9zaWNpb25lcyA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZVBvc2ljaW9uYW1pZW50bygpIHsKICAgICAgdGhpcy5lbnZpYW5kb1F1ZXJ5Q29uZmlndXJhY2lvbkF0bGFzID0gdHJ1ZTsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLm11dGF0ZSh7CiAgICAgICAgICBtdXRhdGlvbjogZ3FsYAogICAgICAgICAgICBtdXRhdGlvbiAoJG5vbWJyZUF0bGFzOiBTdHJpbmchKSB7CiAgICAgICAgICAgICAgdG9nZ2xlUG9zaWNpb25hbWllbnRvQXV0b21hdGljb0F0bGFzKG5vbWJyZUF0bGFzOiAkbm9tYnJlQXRsYXMpIHsKICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICBwb3NpY2lvbmFuZG8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgbm9tYnJlQXRsYXM6ICJjb25vY2ltaWVudG8iLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9RdWVyeUNvbmZpZ3VyYWNpb25BdGxhcyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9RdWVyeUNvbmZpZ3VyYWNpb25BdGxhcyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFicmlyTWVudUNvbnRleHR1YWwoZSkgewogICAgICBsZXQgcG9zQ2FsZW5kYXJpbyA9IHRoaXMuJGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgbGV0IHRvcENsaWNrID0gTWF0aC5yb3VuZChlLnBhZ2VZIC0gcG9zQ2FsZW5kYXJpby50b3ApOwogICAgICBsZXQgbGVmdENsaWNrID0gTWF0aC5yb3VuZChlLnBhZ2VYIC0gcG9zQ2FsZW5kYXJpby5sZWZ0KTsKCiAgICAgIHRoaXMuJHNldCh0aGlzLm9mZnNldE1lbnVDb250ZXh0dWFsLCAidG9wIiwgdG9wQ2xpY2sgKyAicHgiKTsKICAgICAgdGhpcy4kc2V0KHRoaXMub2Zmc2V0TWVudUNvbnRleHR1YWwsICJsZWZ0IiwgbGVmdENsaWNrICsgInB4Iik7CiAgICAgIHRoaXMubW9zdHJhbmRvTWVudUNvbnRleHR1YWwgPSB0cnVlOwogICAgICAvL3RoaXMuY3JlYXJOb2RvKHt4OiBsZWZ0Q2xpY2ssIHk6IHRvcENsaWNrfSk7CiAgICB9LAogICAgY3JlYXJOb2RvRW5NZW51Q29udGV4dHVhbCgpIHsKICAgICAgbGV0IHBvc0NvbnRlbmVkb3IgPSBkb2N1bWVudAogICAgICAgIC5nZXRFbGVtZW50QnlJZCgiY29udGVuZWRvck5vZG9zIikKICAgICAgICAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICBjb25zb2xlLmxvZyhgT2Zmc2V0IG1lbsO6IGN4OiAke3RoaXMub2Zmc2V0TWVudUNvbnRleHR1YWwudG9wfWApOwogICAgICBjb25zb2xlLmxvZyhgT2Zmc2V0IG1lbsO6IGN4OiAke3BhcnNlSW50KHRoaXMub2Zmc2V0TWVudUNvbnRleHR1YWwudG9wKX1gKTsKCiAgICAgIHZhciBwb3NpY2lvbk51ZXZvTm9kbyA9IHsKICAgICAgICB4OiBwYXJzZUludCgKICAgICAgICAgIChwYXJzZUludCh0aGlzLm9mZnNldE1lbnVDb250ZXh0dWFsLmxlZnQpIC0gcG9zQ29udGVuZWRvci5sZWZ0KSAvCiAgICAgICAgICAgIHRoaXMuZmFjdG9yWm9vbQogICAgICAgICksCiAgICAgICAgeTogcGFyc2VJbnQoCiAgICAgICAgICAocGFyc2VJbnQodGhpcy5vZmZzZXRNZW51Q29udGV4dHVhbC50b3ApIC0gcG9zQ29udGVuZWRvci50b3ApIC8KICAgICAgICAgICAgdGhpcy5mYWN0b3Jab29tCiAgICAgICAgKSwKICAgICAgfTsKCiAgICAgIGNvbnNvbGUubG9nKGBDcmVhbmRvIG51ZXZvIG5vZG8gZW4gJHtKU09OLnN0cmluZ2lmeShwb3NpY2lvbk51ZXZvTm9kbyl9YCk7CgogICAgICB0aGlzLmNyZWFyTm9kbyhwb3NpY2lvbk51ZXZvTm9kbyk7CiAgICB9LAogICAgZW5jb250cmFyTm9kb3NOZWNlc2FyaW9zRGVOb2RvKGlkTm9kbywgbGlzdGFUb3RhbCkgewogICAgICBjb25zdCBlbE5vZG8gPSB0aGlzLnRvZG9zTm9kb3MuZmluZCgobikgPT4gbi5pZCA9PSBpZE5vZG8pOwogICAgICBpZiAoIWVsTm9kbykgewogICAgICAgIHJldHVybiBsaXN0YVRvdGFsOwogICAgICB9CiAgICAgIGNvbnN0IG5lY2VzYXJpb3MgPSBlbE5vZG8udmluY3Vsb3MKICAgICAgICAuZmlsdGVyKCh2KSA9PiB2LnJvbCA9PSAidGFyZ2V0IikKICAgICAgICAubWFwKCh2KSA9PiB2LmlkUmVmKTsKICAgICAgbmVjZXNhcmlvcy5mb3JFYWNoKChuZWNlc2FyaW8pID0+IHsKICAgICAgICBpZiAoIWxpc3RhVG90YWwuaW5jbHVkZXMobmVjZXNhcmlvKSkgewogICAgICAgICAgbGlzdGFUb3RhbC5wdXNoKG5lY2VzYXJpbyk7CiAgICAgICAgICBsaXN0YVRvdGFsID0gdGhpcy5lbmNvbnRyYXJOb2Rvc05lY2VzYXJpb3NEZU5vZG8oCiAgICAgICAgICAgIG5lY2VzYXJpbywKICAgICAgICAgICAgbGlzdGFUb3RhbAogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gbGlzdGFUb3RhbDsKICAgIH0sCiAgICBjbGlja0ZvbmRvQXRsYXMoKSB7CiAgICAgIGNvbnNvbGUubG9nKGBDbGljayBlbiBlbCBmb25kbyBkZWwgYXRsYXNgKTsKICAgICAgaWYgKCF0aGlzLnZpc3RhUGFubmVkKSB0aGlzLmlkTm9kb1NlbGVjY2lvbmFkbyA9ICItMSI7CiAgICAgIHRoaXMucGFubmluZ1Zpc3RhID0gZmFsc2U7CiAgICAgIHRoaXMudmlzdGFQYW5uZWQgPSBmYWxzZTsKICAgICAgdGhpcy4kcmVmcy5wYW5lbENvbmp1bnRvc05vZG9zLmFiaWVydG8gPSBmYWxzZTsKICAgICAgdGhpcy4kcmVmcy5wYW5lbENvbmZpZ3VyYWNpb25BdGxhcy5hYmllcnRvID0gZmFsc2U7CiAgICAgIHRoaXMubW9zdHJhbmRvTWVudUNvbnRleHR1YWwgPSBmYWxzZTsKICAgIH0sCiAgICBzZXRFc3RhZG9PYmpldGl2b05vZG9DYWNoZShudWV2b0VzdGFkbywgaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKAogICAgICAgIGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29uIGVzdGFkbyBvYmpldGl2bzogJHtudWV2b0VzdGFkb31gCiAgICAgICk7CiAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgIGNvbnN0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgfSk7CiAgICAgIHZhciBudWV2b0NhY2hlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYWNoZSkpOwoKICAgICAgdmFyIGluZGV4TiA9IG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgKG4pID0+IG4uaWROb2RvID09IGlkTm9kbwogICAgICApOwogICAgICBpZiAoaW5kZXhOID4gLTEpIHsKICAgICAgICBudWV2b0NhY2hlLnlvLmF0bGFzLmRhdG9zTm9kb3NbaW5kZXhOXS5vYmpldGl2byA9IG51ZXZvRXN0YWRvOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKGBObyBlc3RhYmEgZW4gY2FjaMOpLiBQdXNoaW5nYCk7CiAgICAgICAgbnVldm9DYWNoZS55by5hdGxhcy5kYXRvc05vZG9zLnB1c2goewogICAgICAgICAgX190eXBlbmFtZTogIkRhdG9Ob2RvVXN1YXJpbyIsCiAgICAgICAgICBpZE5vZG8sCiAgICAgICAgICBvYmpldGl2bzogbnVldm9Fc3RhZG8sCiAgICAgICAgICBhcHJlbmRpZG86IGZhbHNlLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgIHF1ZXJ5OiBRVUVSWV9EQVRPU19VU1VBUklPX05PRE9TLAogICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUsCiAgICAgIH0pOwogICAgfSwKICAgIHNldE5vZG9BcHJlbmRpZG9DYWNoZShudWV2b0VzdGFkbywgaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKAogICAgICAgIGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29uIGVzdGFkbyBhcHJlbmRpZG86ICR7bnVldm9Fc3RhZG99YAogICAgICApOwogICAgICBjb25zdCBzdG9yZSA9IHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50OwogICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgcXVlcnk6IFFVRVJZX0RBVE9TX1VTVUFSSU9fTk9ET1MsCiAgICAgIH0pOwogICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgdmFyIGluZGV4TiA9IG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgKG4pID0+IG4uaWROb2RvID09IGlkTm9kbwogICAgICApOwogICAgICBpZiAoaW5kZXhOID4gLTEpIHsKICAgICAgICBudWV2b0NhY2hlLnlvLmF0bGFzLmRhdG9zTm9kb3NbaW5kZXhOXS5hcHJlbmRpZG8gPSBudWV2b0VzdGFkbzsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gZXN0YWJhIGVuIGNhY2jDqS4gUHVzaGluZ2ApOwogICAgICAgIG51ZXZvQ2FjaGUueW8uYXRsYXMuZGF0b3NOb2Rvcy5wdXNoKHsKICAgICAgICAgIF9fdHlwZW5hbWU6ICJEYXRvTm9kb1VzdWFyaW8iLAogICAgICAgICAgaWROb2RvLAogICAgICAgICAgb2JqZXRpdm86IGZhbHNlLAogICAgICAgICAgYXByZW5kaWRvOiBudWV2b0VzdGFkbywKICAgICAgICB9KTsKICAgICAgfQogICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICB9KTsKICAgIH0sCiAgICBzZXROb2RvVGFyZ2V0Q2FjaGUoaWROb2RvKSB7CiAgICAgIGNvbnNvbGUubG9nKGBTZXRpbmcgZW4gY2FjaGUgYWwgbm9kbyAke2lkTm9kb30gY29tbyB0YXJnZXRgKTsKICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLiRhcG9sbG8ucHJvdmlkZXIuZGVmYXVsdENsaWVudDsKICAgICAgY29uc3QgY2FjaGUgPSBzdG9yZS5yZWFkUXVlcnkoewogICAgICAgIHF1ZXJ5OiBRVUVSWV9EQVRPU19VU1VBUklPX05PRE9TLAogICAgICB9KTsKICAgICAgdmFyIG51ZXZvQ2FjaGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CiAgICAgIG51ZXZvQ2FjaGUueW8uYXRsYXMuaWROb2RvVGFyZ2V0ID0gaWROb2RvOwogICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19OT0RPUywKICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICB9KTsKICAgIH0sCgogICAgY2VudHJhckVuTm9kbyhuKSB7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbCwKICAgICAgICAieCIsCiAgICAgICAgbi5jb29yZHMueCAtIHRoaXMuJGVsLm9mZnNldFdpZHRoIC8gKDIgKiB0aGlzLmZhY3Rvclpvb20pCiAgICAgICk7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbCwKICAgICAgICAieSIsCiAgICAgICAgbi5jb29yZHMueSAtIHRoaXMuJGVsLm9mZnNldEhlaWdodCAvICgyICogdGhpcy5mYWN0b3Jab29tKQogICAgICApOwogICAgICB0aGlzLnNlbGVjY2lvbk5vZG8obik7CiAgICAgIC8vdGhpcy5jZW50cm9WaXN0YT1lOwogICAgfSwKICAgIGluaWNpYU1vdmltaWVudG9Ub3VjaChlKSB7CiAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgdmFyIGRpc3QgPSBNYXRoLmh5cG90KAogICAgICAgICAgZS50b3VjaGVzWzBdLnBhZ2VYIC0gZS50b3VjaGVzWzFdLnBhZ2VYLAogICAgICAgICAgZS50b3VjaGVzWzBdLnBhZ2VZIC0gZS50b3VjaGVzWzFdLnBhZ2VZCiAgICAgICAgKTsKICAgICAgICB0aGlzLmxhc3RQaW5jaERpc3RhbmNlID0gZGlzdDsKICAgICAgICB0aGlzLnBpbmNoaW5nID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMudWx0aW1vVG91Y2hYID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYOwogICAgICB0aGlzLnVsdGltb1RvdWNoWSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WTsKICAgIH0sCiAgICBtb3ZpbWllbnRvTW9iaWxlKGUpIHsKICAgICAgaWYgKHRoaXMucGluY2hpbmcpIHsKICAgICAgICB2YXIgY29udGVuZWRvciA9IHRoaXMuJGVsOwogICAgICAgIGxldCBwb3NDb250ZW5lZG9yID0gY29udGVuZWRvci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgICAgY29uc3QgcG9zWm9vbSA9IHsKICAgICAgICAgIHg6CiAgICAgICAgICAgIE1hdGgucm91bmQocG9zQ29udGVuZWRvci53aWR0aCAvIDIgLyB0aGlzLmZhY3Rvclpvb20pICsKICAgICAgICAgICAgdGhpcy5jZW50cm9WaXN0YS54LAogICAgICAgICAgeToKICAgICAgICAgICAgTWF0aC5yb3VuZChwb3NDb250ZW5lZG9yLmhlaWdodCAvIDIgLyB0aGlzLmZhY3Rvclpvb20pICsKICAgICAgICAgICAgdGhpcy5jZW50cm9WaXN0YS55LAogICAgICAgIH07CgogICAgICAgIGNvbnN0IHByb3BvcmNpb25lcyA9IHsKICAgICAgICAgIHg6CiAgICAgICAgICAgIChwb3Nab29tLnggLSB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC54KSAvCiAgICAgICAgICAgIChwb3NDb250ZW5lZG9yLndpZHRoIC8gdGhpcy5mYWN0b3Jab29tKSwKICAgICAgICAgIHk6CiAgICAgICAgICAgIChwb3Nab29tLnkgLSB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbC55KSAvCiAgICAgICAgICAgIChwb3NDb250ZW5lZG9yLmhlaWdodCAvIHRoaXMuZmFjdG9yWm9vbSksCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGRpc3QgPSBNYXRoLmh5cG90KAogICAgICAgICAgZS50b3VjaGVzWzBdLnBhZ2VYIC0gZS50b3VjaGVzWzFdLnBhZ2VYLAogICAgICAgICAgZS50b3VjaGVzWzBdLnBhZ2VZIC0gZS50b3VjaGVzWzFdLnBhZ2VZCiAgICAgICAgKTsKICAgICAgICB2YXIgcGluY2ggPSBkaXN0IC0gdGhpcy5sYXN0UGluY2hEaXN0YW5jZTsKICAgICAgICBwaW5jaCA9IHBpbmNoICogMC41OwogICAgICAgIHRoaXMuem9vbVZpc3RhKHBpbmNoKTsKICAgICAgICB0aGlzLmxhc3RQaW5jaERpc3RhbmNlID0gZGlzdDsKCiAgICAgICAgdGhpcy4kc2V0KAogICAgICAgICAgdGhpcy5jZW50cm9WaXN0YURlY2ltYWwsCiAgICAgICAgICAieCIsCiAgICAgICAgICBwb3Nab29tLnggLSAocG9zQ29udGVuZWRvci53aWR0aCAvIHRoaXMuZmFjdG9yWm9vbSkgKiBwcm9wb3JjaW9uZXMueAogICAgICAgICk7CiAgICAgICAgdGhpcy4kc2V0KAogICAgICAgICAgdGhpcy5jZW50cm9WaXN0YURlY2ltYWwsCiAgICAgICAgICAieSIsCiAgICAgICAgICBwb3Nab29tLnkgLSAocG9zQ29udGVuZWRvci5oZWlnaHQgLyB0aGlzLmZhY3Rvclpvb20pICogcHJvcG9yY2lvbmVzLnkKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZGVsdGFYID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYIC0gdGhpcy51bHRpbW9Ub3VjaFg7CiAgICAgIGNvbnN0IGRlbHRhWSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSAtIHRoaXMudWx0aW1vVG91Y2hZOwogICAgICB0aGlzLnVsdGltb1RvdWNoWCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgdGhpcy51bHRpbW9Ub3VjaFkgPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFk7CgogICAgICB0aGlzLmRlc3BsYXphclZpc3RhKGRlbHRhWCwgZGVsdGFZKTsKICAgIH0sCiAgICBmaW5Ub3VjaCgpIHsKICAgICAgdGhpcy5waW5jaGluZyA9IGZhbHNlOwogICAgfSwKICAgIGNhbWJpYXJDb29yZHNNYW51YWxlc05vZG8oaWROb2RvLCBjb29yZHNNYW51YWxlcykgewogICAgICBpZiAoIXRoaXMudXN1YXJpb1N1cGVyYWRtaW5pc3RyYWRvciAmJiAhdGhpcy51c3VhcmlvQWRtaW5pc3RyYWRvckF0bGFzKSB7CiAgICAgICAgY29uc29sZS5sb2coYE5vIGF1dG9yaXphZG9gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy50b2Rvc05vZG9zW3RoaXMudG9kb3NOb2Rvcy5maW5kSW5kZXgoKG4pID0+IG4uaWQgPT0gaWROb2RvKV0uY29vcmRzID0KICAgICAgICBjb29yZHNNYW51YWxlczsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLm11dGF0ZSh7CiAgICAgICAgICBtdXRhdGlvbjogZ3FsYAogICAgICAgICAgICBtdXRhdGlvbiAoJGlkTm9kbzogU3RyaW5nLCAkY29vcmRzTWFudWFsZXM6IENvb3Jkc0lucHV0KSB7CiAgICAgICAgICAgICAgc2V0Q29vcmRzTWFudWFsZXMoCiAgICAgICAgICAgICAgICBpZE5vZG86ICRpZE5vZG8KICAgICAgICAgICAgICAgIGNvb3Jkc01hbnVhbGVzOiAkY29vcmRzTWFudWFsZXMKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIG1vZGlmaWNhZG9zIHsKICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgICAgY29vcmRzTWFudWFsZXMgewogICAgICAgICAgICAgICAgICAgIHgKICAgICAgICAgICAgICAgICAgICB5CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgY29vcmRzIHsKICAgICAgICAgICAgICAgICAgICB4CiAgICAgICAgICAgICAgICAgICAgeQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGlkTm9kbywKICAgICAgICAgICAgY29vcmRzTWFudWFsZXMsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy5jYW52YXNlcy5jcmVhckltYWdlblRvZG9zVmluY3Vsb3MoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJvcn1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBlbGltaW5hck5vZG8oaWROb2RvKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIWNvbmZpcm0oIsK/U2VndXJvIGRlIHF1ZSBxdWllcmVzIGVsaW1pbmFyIGVzdGUgbm9kbz8iKSkgcmV0dXJuOwogICAgICBjb25zb2xlLmxvZyhgZW52aWFuZG8gbXV0YWNpb24gZGUgZWxpbWluYXIgbm9kb2ApOwogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaWROb2RvOiBJRCEpIHsKICAgICAgICAgICAgICBlbGltaW5hck5vZG8oaWROb2RvOiAkaWROb2RvKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGlkTm9kbywKICAgICAgICAgIH0sCiAgICAgICAgICB1cGRhdGUoc3RvcmUsIHsgZGF0YTogeyBlbGltaW5hck5vZG8gfSB9KSB7CiAgICAgICAgICAgIGlmICghZWxpbWluYXJOb2RvKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vZG8gbm8gZnVlIGVsaW1pbmFkb2ApOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgICAgICAgcXVlcnk6IFFVRVJZX05PRE9TLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG51ZXZvQ2FjaGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4TiA9IG51ZXZvQ2FjaGUudG9kb3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgICAgICAgKG4pID0+IG4uaWQgPT0gaWROb2RvCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmIChpbmRleE4gPiAtMSkgewogICAgICAgICAgICAgIG51ZXZvQ2FjaGUudG9kb3NOb2Rvcy5zcGxpY2UoaW5kZXhOLCAxKTsKICAgICAgICAgICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPUywKICAgICAgICAgICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYEVsIG5vZG8gbm8gZXN0YWJhIHByZXNlbnRlYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoZGF0YSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYHF1aXRhbmRvIGVsIG9iamV0byBkZWwgYXJyYXkuICR7ZGF0YX1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBjcmVhck5vZG8ocG9zaWNpb24pIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW9TdXBlcmFkbWluaXN0cmFkb3IgJiYgIXRoaXMudXN1YXJpb0FkbWluaXN0cmFkb3JBdGxhcykgewogICAgICAgIGNvbnNvbGUubG9nKGBFcnJvciB1c3VhcmlvIG5vIGF1dG9yaXphZG9gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYGVudmlhbmRvIHVuYSBtdXRhY2nDs24gZGUgY3JlYXIgbm9kb2ApOwoKICAgICAgbGV0IGluZm9Ob2RvID0gewogICAgICAgIGNvb3Jkc01hbnVhbGVzOiB7CiAgICAgICAgICB4OiBwb3NpY2lvbi54LAogICAgICAgICAgeTogcG9zaWNpb24ueSwKICAgICAgICB9LAogICAgICAgIGNvb3JkczogewogICAgICAgICAgeDogcG9zaWNpb24ueCwKICAgICAgICAgIHk6IHBvc2ljaW9uLnksCiAgICAgICAgfSwKICAgICAgICBhdXRvQ29vcmRzOiB7CiAgICAgICAgICB4OiBwb3NpY2lvbi54LAogICAgICAgICAgeTogcG9zaWNpb24ueSwKICAgICAgICB9LAogICAgICB9OwogICAgICBjb25zb2xlLmxvZyhgZW4gbGFzIGNvb3JkZW5hZGFzOiAke3Bvc2ljaW9uLnh9LCAke3Bvc2ljaW9uLnl9IGApOwogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaW5mb05vZG86IE5vZG9Db25vY2ltaWVudG9JbnB1dCkgewogICAgICAgICAgICAgIGNyZWFyTm9kbyhpbmZvTm9kbzogJGluZm9Ob2RvKSB7CiAgICAgICAgICAgICAgICAuLi5mcmFnTm9kb0Nvbm9jaW1pZW50bwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAke2ZyYWdtZW50b05vZG9Db25vY2ltaWVudG99CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGluZm9Ob2RvLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCh7IGRhdGE6IHsgY3JlYXJOb2RvIH0gfSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYENyZWFkbyAke2NyZWFyTm9kby5pZH1gKTsKICAgICAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPUywKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG51ZXZvQ2FjaGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CiAgICAgICAgICB2YXIgbG9zTm9kb3MgPSBudWV2b0NhY2hlLnRvZG9zTm9kb3M7CiAgICAgICAgICBjb25zdCBpbmRleE4gPSBsb3NOb2Rvcy5maW5kSW5kZXgoKG4pID0+IG4uaWQgPT09IGNyZWFyTm9kby5pZCk7CiAgICAgICAgICBpZiAoaW5kZXhOID4gLTEpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYEVsIG5vZG8geWEgZXN0YWJhIGVuIGNhY2jDqWApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9zTm9kb3MucHVzaChjcmVhck5vZG8pOwogICAgICAgICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICAgICAgICBxdWVyeTogUVVFUllfTk9ET1MsCiAgICAgICAgICAgICAgZGF0YTogbnVldm9DYWNoZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy90aGlzLiRyb3V0ZXIucHVzaCgiL25vZG9Db25vY2ltaWVudG8vIitjcmVhck5vZG8uaWQpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yLiBFOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIGRlc2NhcmdhckNlbnRyb1Zpc3RhKCkgewogICAgICBsZXQgZGlzID0gdGhpczsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLnF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgICAgIHF1ZXJ5IHsKICAgICAgICAgICAgICB5byB7CiAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgYXRsYXMgewogICAgICAgICAgICAgICAgICBjZW50cm9WaXN0YSB7CiAgICAgICAgICAgICAgICAgICAgeAogICAgICAgICAgICAgICAgICAgIHkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBpZFVzdWFyaW86IHRoaXMuJHN0b3JlLnN0YXRlLnVzdWFyaW8uaWQsCiAgICAgICAgICB9LAogICAgICAgICAgZmV0Y2hQb2xpY3k6ICJuZXR3b3JrLW9ubHkiLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHsgZGF0YTogeyB5byB9IH0pIHsKICAgICAgICAgIGxldCBjb29yZHMgPSB5by5hdGxhcy5jZW50cm9WaXN0YTsKICAgICAgICAgIGRpcy4kc2V0KGRpcy5jZW50cm9WaXN0YSwgIngiLCBjb29yZHMueCk7CiAgICAgICAgICBkaXMuJHNldChkaXMuY2VudHJvVmlzdGEsICJ5IiwgY29vcmRzLnkpOwogICAgICAgICAgZGlzLiRzdG9yZS5jb21taXQoInNldENlbnRyb1Zpc3RhQXRsYXMiLCBjb29yZHMpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5sb2coYGVycm9yIGZldGNoaW5nIGNlbnRybyB2aXN0YTogJHtlcnJvcn1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBkZXNwbGF6YXJWaXN0YShkZWx0YVgsIGRlbHRhWSkgewogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5jZW50cm9WaXN0YURlY2ltYWwsCiAgICAgICAgIngiLAogICAgICAgIE1hdGgucm91bmQodGhpcy5jZW50cm9WaXN0YURlY2ltYWwueCAtIGRlbHRhWCAvIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgKTsKICAgICAgdGhpcy4kc2V0KAogICAgICAgIHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLAogICAgICAgICJ5IiwKICAgICAgICBNYXRoLnJvdW5kKHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLnkgLSBkZWx0YVkgLyB0aGlzLmZhY3Rvclpvb20pCiAgICAgICk7CiAgICAgIHRoaXMuYWN0dWFsaXphclRyYXpvcysrOwogICAgfSwKICAgIHBhblZpc3RhKGUpIHsKICAgICAgaWYgKCF0aGlzLnBhbm5pbmdWaXN0YSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmRlc3BsYXphclZpc3RhKGUubW92ZW1lbnRYLCBlLm1vdmVtZW50WSk7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy52aXN0YVBhbm5lZCA9IHRydWU7CgogICAgICAvKnRoaXMuY2VudHJvVmlzdGEueCAtPSBlLm1vdmVtZW50WDsKICAgICAgdGhpcy5jZW50cm9WaXN0YS55IC09IGUubW92ZW1lbnRZOwogICAgICAqLwogICAgfSwKICAgIHNlbGVjY2lvbk5vZG8obm9kbykgewogICAgICB0aGlzLmlkTm9kb1NlbGVjY2lvbmFkbyA9IG5vZG8uaWQ7CiAgICAgIGlmICghdGhpcy50b2Rvc05vZG9zLnNvbWUoKG4pID0+IG4uaWQgPT0gdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8pKSB7CiAgICAgICAgY29uc29sZS5sb2coYE5vIGVuY29udHJhZG9gKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgbGV0IHByb2Z1bmRpZGFkID0gcGFyc2VJbnQodGhpcy5wcm9mdW5kaWRhZE5vZG9zQ29uZWN0YWRvc0FsU2VsZWNjaW9uYWRvKTsKICAgICAgbGV0IGxpc3RhUG9yTml2ZWxlcyA9IFtdOwogICAgICBsZXQgaWROb2RvU2VsID0gdGhpcy5pZE5vZG9TZWxlY2Npb25hZG87CiAgICAgIGxldCBsaXN0YUNvbXBsZXRhID0gW2lkTm9kb1NlbF07CiAgICAgIGlmIChwcm9mdW5kaWRhZCA+IDApIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb2Z1bmRpZGFkOyBpKyspIHsKICAgICAgICAgIGxpc3RhUG9yTml2ZWxlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgICAoeyBsaXN0YUNvbXBsZXRhLCBsaXN0YVBvck5pdmVsZXMgfSA9CiAgICAgICAgICB0aGlzLmVuY29udHJhck5vZG9zQ29uZWN0YWRvc1JlY3Vyc2l2YW1lbnRlKAogICAgICAgICAgICBpZE5vZG9TZWwsCiAgICAgICAgICAgIFsidGFyZ2V0IiwgInNvdXJjZSJdLAogICAgICAgICAgICBbImNvbnRpbnVhY2lvbiJdLAogICAgICAgICAgICBsaXN0YUNvbXBsZXRhLAogICAgICAgICAgICBsaXN0YVBvck5pdmVsZXMsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHByb2Z1bmRpZGFkCiAgICAgICAgICApKTsKICAgICAgfQogICAgICB0aGlzLm5vZG9zQ29uZWN0YWRvc0FsU2VsZWNjaW9uYWRvID0gewogICAgICAgIGxpc3RhQ29tcGxldGEsCiAgICAgICAgbGlzdGFQb3JOaXZlbGVzLAogICAgICB9OwogICAgfSwKICAgIGFzeW5jIGVsaW1pbmFyVmluY3VsbyhhcmdzKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygKICAgICAgICBgZWxpbWluYW5kbyB1biB2aW5jdWxvIGVudHJlICR7YXJncy5pZE5vZG9Gcm9tfSB5ICR7YXJncy5pZE5vZG9Ub30gYAogICAgICApOwogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaWROb2RvRnJvbTogSUQhLCAkaWROb2RvVG86IElEISkgewogICAgICAgICAgICAgIGVsaW1pbmFyVmluY3Vsb0Zyb21UbygKICAgICAgICAgICAgICAgIGlkU291cmNlOiAkaWROb2RvRnJvbQogICAgICAgICAgICAgICAgaWRUYXJnZXQ6ICRpZE5vZG9UbwogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgbW9kaWZpY2Fkb3MgewogICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgICB2aW5jdWxvcyB7CiAgICAgICAgICAgICAgICAgICAgaWRSZWYKICAgICAgICAgICAgICAgICAgICB0aXBvCiAgICAgICAgICAgICAgICAgICAgcm9sCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaWROb2RvRnJvbTogYXJncy5pZE5vZG9Gcm9tLAogICAgICAgICAgICBpZE5vZG9UbzogYXJncy5pZE5vZG9UbywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7fSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZGlidWphclZpbmN1bG9zR3Jpc2VzKCkgewogICAgICB0aGlzLmFjdHVhbGl6YXJWaW5jdWxvc0dyaXNlcysrOwogICAgfSwKICAgIGFzeW5jIGNyZWFyVmluY3VsbyhhcmdzKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yICYmICF0aGlzLnVzdWFyaW9BZG1pbmlzdHJhZG9yQXRsYXMpIHsKICAgICAgICBjb25zb2xlLmxvZyhgTm8gYXV0b3JpemFkb2ApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZyhgY3JlYW5kbyB1biB2aW5jdWxvICR7SlNPTi5zdHJpbmdpZnkoYXJncyl9IGApOwogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkdGlwbzogU3RyaW5nISwgJGlkTm9kb0Zyb206IElEISwgJGlkTm9kb1RvOiBJRCEpIHsKICAgICAgICAgICAgICBjcmVhclZpbmN1bG8oCiAgICAgICAgICAgICAgICB0aXBvOiAkdGlwbwogICAgICAgICAgICAgICAgaWRTb3VyY2U6ICRpZE5vZG9Gcm9tCiAgICAgICAgICAgICAgICBpZFRhcmdldDogJGlkTm9kb1RvCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBtb2RpZmljYWRvcyB7CiAgICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICAgIHZpbmN1bG9zIHsKICAgICAgICAgICAgICAgICAgICBpZFJlZgogICAgICAgICAgICAgICAgICAgIHJvbAogICAgICAgICAgICAgICAgICAgIHRpcG8KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICB0aXBvOiAiY29udGludWFjaW9uIiwKICAgICAgICAgICAgaWROb2RvRnJvbTogYXJncy5pZE5vZG9Gcm9tLAogICAgICAgICAgICBpZE5vZG9UbzogYXJncy5pZE5vZG9UbywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7fSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgZXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZW5jb250cmFyTm9kb3NDb25lY3RhZG9zUmVjdXJzaXZhbWVudGUoCiAgICAgIGlkTm9kbywKICAgICAgcm9sZXMsCiAgICAgIHRpcG9zLAogICAgICBsaXN0YUNvbXBsZXRhLAogICAgICBsaXN0YVBvck5pdmVsZXMsCiAgICAgIG5pdmVsLAogICAgICBwcm9mdW5kaWRhZAogICAgKSB7CiAgICAgIC8vIFJvbCBkZWJlIHNlciB1biBhcnJheSBxdWUgaW5jbHV5ZSBsb3Mgcm9sZXMgdmFsaWRvcyBlbiBlc3RhIGLDunNxdWVkYS4KICAgICAgLy8gVGlwbyBkZWJlciBzZXIgdW4gYXJyYXkgcXVlIGluY2x1eWUgdG9kb3MgbG9zIHRpcG9zIHbDoWxpZG9zIGVuIGVzdGEgYsO6c3F1ZWRhCiAgICAgIGxldCBub2RvID0gdGhpcy50b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT0gaWROb2RvKTsKICAgICAgZm9yIChsZXQgdmluY3VsbyBvZiBub2RvLnZpbmN1bG9zKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgdGhpcy50b2Rvc05vZG9zLnNvbWUoKG4pID0+IG4uaWQgPT0gdmluY3Vsby5pZFJlZikgJiYKICAgICAgICAgIHJvbGVzLnNvbWUoKHIpID0+IHIgPT0gdmluY3Vsby5yb2wpICYmCiAgICAgICAgICB0aXBvcy5zb21lKCh0KSA9PiB0ID09IHZpbmN1bG8udGlwbykgJiYKICAgICAgICAgICFsaXN0YUNvbXBsZXRhLnNvbWUoKGlkTikgPT4gaWROID09IHZpbmN1bG8uaWRSZWYpCiAgICAgICAgKSB7CiAgICAgICAgICBsaXN0YVBvck5pdmVsZXNbbml2ZWxdLnB1c2godmluY3Vsby5pZFJlZik7CiAgICAgICAgICBsaXN0YUNvbXBsZXRhLnB1c2godmluY3Vsby5pZFJlZik7CgogICAgICAgICAgaWYgKG5pdmVsICsgMSA8IHByb2Z1bmRpZGFkKSB7CiAgICAgICAgICAgICh7IGxpc3RhQ29tcGxldGEsIGxpc3RhUG9yTml2ZWxlcyB9ID0KICAgICAgICAgICAgICB0aGlzLmVuY29udHJhck5vZG9zQ29uZWN0YWRvc1JlY3Vyc2l2YW1lbnRlKAogICAgICAgICAgICAgICAgdmluY3Vsby5pZFJlZiwKICAgICAgICAgICAgICAgIHJvbGVzLAogICAgICAgICAgICAgICAgdGlwb3MsCiAgICAgICAgICAgICAgICBsaXN0YUNvbXBsZXRhLAogICAgICAgICAgICAgICAgbGlzdGFQb3JOaXZlbGVzLAogICAgICAgICAgICAgICAgbml2ZWwgKyAxLAogICAgICAgICAgICAgICAgcHJvZnVuZGlkYWQKICAgICAgICAgICAgICApKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coYE5vYCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7IGxpc3RhQ29tcGxldGEsIGxpc3RhUG9yTml2ZWxlcyB9OwogICAgfSwKICAgIHpvb21WaXN0YShkZWx0YVpvb20pIHsKICAgICAgdmFyIG51ZXZvWm9vbSA9IHRoaXMuem9vbSArIGRlbHRhWm9vbTsKICAgICAgaWYgKG51ZXZvWm9vbSA8IHRoaXMubWluWm9vbSkgewogICAgICAgIHRoaXMuem9vbSA9IHRoaXMubWluWm9vbTsKICAgICAgfSBlbHNlIGlmIChudWV2b1pvb20gPiB0aGlzLm1heFpvb20pIHsKICAgICAgICB0aGlzLnpvb20gPSB0aGlzLm1heFpvb207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy56b29tID0gbnVldm9ab29tOwogICAgICB9CgogICAgICAvL1BhbiB2aXN0YSBkZSBhY3VlcmRvIGNvbiBsYSBwb3NpY2nDs24gZGVsIG1vdXNlIHJlc3BlY3RvIGRlbCBhdGxhcwogICAgfSwKICAgIHpvb21XaGVlbChlKSB7CiAgICAgIGlmICghdGhpcy5ob3ZlcmVkIHx8ICFlLmN0cmxLZXkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgdmFyIGNvbnRlbmVkb3IgPSB0aGlzLiRlbDsKICAgICAgbGV0IHBvc0NvbnRlbmVkb3IgPSBjb250ZW5lZG9yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgY29uc3QgcG9zWm9vbSA9IHsKICAgICAgICB4OgogICAgICAgICAgTWF0aC5yb3VuZCgoZS5jbGllbnRYIC0gcG9zQ29udGVuZWRvci5sZWZ0KSAvIHRoaXMuZmFjdG9yWm9vbSkgKwogICAgICAgICAgdGhpcy5jZW50cm9WaXN0YS54LAogICAgICAgIHk6CiAgICAgICAgICBNYXRoLnJvdW5kKChlLmNsaWVudFkgLSBwb3NDb250ZW5lZG9yLnRvcCkgLyB0aGlzLmZhY3Rvclpvb20pICsKICAgICAgICAgIHRoaXMuY2VudHJvVmlzdGEueSwKICAgICAgfTsKCiAgICAgIGNvbnN0IHByb3BvcmNpb25lcyA9IHsKICAgICAgICB4OgogICAgICAgICAgKHBvc1pvb20ueCAtIHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLngpIC8KICAgICAgICAgIChwb3NDb250ZW5lZG9yLndpZHRoIC8gdGhpcy5mYWN0b3Jab29tKSwKICAgICAgICB5OgogICAgICAgICAgKHBvc1pvb20ueSAtIHRoaXMuY2VudHJvVmlzdGFEZWNpbWFsLnkpIC8KICAgICAgICAgIChwb3NDb250ZW5lZG9yLmhlaWdodCAvIHRoaXMuZmFjdG9yWm9vbSksCiAgICAgIH07CgogICAgICBjb25zdCBmYWN0b3Jab29tID0gMC4yOwogICAgICB0aGlzLnpvb21WaXN0YSgtTWF0aC5yb3VuZChlLmRlbHRhWSAqIGZhY3Rvclpvb20pLCB7CiAgICAgICAgeDogcG9zWm9vbS54LAogICAgICAgIHk6IHBvc1pvb20ueSwKICAgICAgfSk7CgogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5jZW50cm9WaXN0YURlY2ltYWwsCiAgICAgICAgIngiLAogICAgICAgIHBvc1pvb20ueCAtIChwb3NDb250ZW5lZG9yLndpZHRoIC8gdGhpcy5mYWN0b3Jab29tKSAqIHByb3BvcmNpb25lcy54CiAgICAgICk7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbCwKICAgICAgICAieSIsCiAgICAgICAgcG9zWm9vbS55IC0gKHBvc0NvbnRlbmVkb3IuaGVpZ2h0IC8gdGhpcy5mYWN0b3Jab29tKSAqIHByb3BvcmNpb25lcy55CiAgICAgICk7CiAgICB9LAogICAgaGlkZVpvb21JbmZvOiBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2hvd2luZ1pvb21JbmZvID0gZmFsc2U7CiAgICB9LCAxMDAwKSwKICB9LAogIHdhdGNoOiB7CiAgICBub2RvU2VsZWNjaW9uYWRvOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuYWN0dWFsaXphclRyYXpvcysrOwogICAgfSwKICAgIHJvdXRlOiBmdW5jdGlvbiAodG8pIHsKICAgICAgY29uc29sZS5sb2coYGNhbWJpbyBkZSBuYXZlZ2FjacOzbiBhICR7dG8ucGF0aH1gKTsKICAgIH0sCiAgICBpZE5vZG9UYXJnZXQoaWROb2RvVGFyZ2V0KSB7CiAgICAgIGlmICghaWROb2RvVGFyZ2V0KSB7CiAgICAgICAgdGhpcy5pZHNOZWNlc2FyaW9zUGFyYVRhcmdldCA9IFtdOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZyhgaW5pY2lhbmRvIGJ1c3F1ZWRhIGRlIHJlcXVlcmlkb3MgZGUgbm9kbyAke2lkTm9kb1RhcmdldH1gKTsKICAgICAgdGhpcy5pZHNOZWNlc2FyaW9zUGFyYVRhcmdldCA9IHRoaXMuZW5jb250cmFyTm9kb3NOZWNlc2FyaW9zRGVOb2RvKAogICAgICAgIGlkTm9kb1RhcmdldCwKICAgICAgICBbXQogICAgICApOwogICAgfSwKICAgIHpvb20oKSB7CiAgICAgIHRoaXMuc2hvd2luZ1pvb21JbmZvID0gdHJ1ZTsKICAgICAgdGhpcy5oaWRlWm9vbUluZm8oKTsKICAgIH0sCiAgfSwKICBtb3VudGVkKCkgewogICAgLy8gaWYgKCF0aGlzLnVzdWFyaW8uYXRsYXMgfHwgIXRoaXMudXN1YXJpby5hdGxhcy5jZW50cm9WaXN0YSkgewogICAgLy8gICBjb25zb2xlLmxvZyhgTm8gaGFiw61hIGluZm8gZGUgY2VudHJvIHZpc3RhIGVuIGxhIHN0b3JlLiBEZXNjYXJnYW5kb2ApOwogICAgLy8gICB0aGlzLmRlc2NhcmdhckNlbnRyb1Zpc3RhKCk7CiAgICAvLyAgIHJldHVybjsKICAgIC8vIH0KICAgIC8vIHRoaXMuJHNldCh0aGlzLmNlbnRyb1Zpc3RhRGVjaW1hbCwgIngiLCB0aGlzLnVzdWFyaW8uYXRsYXMuY2VudHJvVmlzdGEueCk7CiAgICAvLyB0aGlzLiRzZXQodGhpcy5jZW50cm9WaXN0YURlY2ltYWwsICJ5IiwgdGhpcy51c3VhcmlvLmF0bGFzLmNlbnRyb1Zpc3RhLnkpOwoKICAgIGlmIChzY3JlZW4ud2lkdGggPCA2MDApIHsKICAgICAgdGhpcy56b29tID0gNzA7CiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdGhpcy56b29tV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgfSwKICByZW1vdmVkKCkgewogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdGhpcy56b29tV2hlZWwpOwogIH0sCiAgLy8gYmVmb3JlUm91dGVMZWF2ZShfLCBfXywgbmV4dCkgewogIC8vICAgY29uc29sZS5sb2coCiAgLy8gICAgIGBlbnZpYW5kbyBudWV2byBjZW50cm9WaXN0YSBwYXJhIGVsIHVzdWFyaW8gJHsKICAvLyAgICAgICB0aGlzLnVzdWFyaW8uaWQKICAvLyAgICAgfS4gQ2VudHJvIHZpc3RhOiAke0pTT04uc3RyaW5naWZ5KHRoaXMuY2VudHJvVmlzdGEpfWAKICAvLyAgICk7CiAgLy8gICB0aGlzLiRzdG9yZS5jb21taXQoInNldENlbnRyb1Zpc3RhQXRsYXMiLCB0aGlzLmNlbnRyb1Zpc3RhKTsKCiAgLy8gICB0aGlzLiRhcG9sbG8KICAvLyAgICAgLm11dGF0ZSh7CiAgLy8gICAgICAgbXV0YXRpb246IGdxbGAKICAvLyAgICAgICAgIG11dGF0aW9uKCRpZFVzdWFyaW86IElELCAkY2VudHJvVmlzdGE6IENvb3Jkc0lucHV0KSB7CiAgLy8gICAgICAgICAgIHNldENlbnRyb1Zpc3RhKGlkVXN1YXJpbzogJGlkVXN1YXJpbywgY2VudHJvVmlzdGE6ICRjZW50cm9WaXN0YSkKICAvLyAgICAgICAgIH0KICAvLyAgICAgICBgLAogIC8vICAgICAgIHZhcmlhYmxlczogewogIC8vICAgICAgICAgaWRVc3VhcmlvOiB0aGlzLiRzdG9yZS5zdGF0ZS51c3VhcmlvLmlkLAogIC8vICAgICAgICAgY2VudHJvVmlzdGE6IHRoaXMuY2VudHJvVmlzdGEsCiAgLy8gICAgICAgfSwKICAvLyAgICAgfSkKICAvLyAgICAgLnRoZW4oZnVuY3Rpb24gKCkgewogIC8vICAgICAgIG5leHQoKTsKICAvLyAgICAgfSkKICAvLyAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogIC8vICAgICAgIGNvbnNvbGUubG9nKGBlcnJvcjogJHtlcnJvcn1gKTsKICAvLyAgICAgICBuZXh0KCk7CiAgLy8gICAgIH0pOwogIC8vIH0sCn07Cg=="},{"version":3,"sources":["AtlasConocimiento.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AtlasConocimiento.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"atlasConocimiento\"\n    @mousedown.left.exact.stop=\"panningVista = true\"\n    @mouseenter=\"hovered = true\"\n    @mouseleave=\"hovered = false\"\n    @click=\"\n      idNodoMenuCx = '-1';\n      cerrarBusqueda++;\n    \"\n    @mousemove=\"panVista($event)\"\n    @mouseup.left=\"clickFondoAtlas\"\n    @touchmove.prevent.stop=\"movimientoMobile\"\n    @touchstart=\"iniciaMovimientoTouch\"\n    @touchend=\"finTouch\"\n    @contextmenu.self.exact.prevent=\"abrirMenuContextual\"\n  >\n    <transition name=\"fadeOut\">\n      <div v-show=\"showingZoomInfo\" id=\"infoZoom\">x{{ factorZoom }}</div>\n    </transition>\n    <div\n      id=\"menuContextual\"\n      :style=\"[offsetMenuContextual]\"\n      v-show=\"mostrandoMenuContextual\"\n    >\n      <div\n        class=\"botonMenuContextual\"\n        id=\"botonCrearNuevoNodo\"\n        @click=\"crearNodoEnMenuContextual\"\n      >\n        Crear Nodo de conocimiento\n      </div>\n    </div>\n    <div\n      id=\"botonCallingPosiciones\"\n      v-if=\"usuarioSuperadministrador && usuario.username == 'juanMamian'\"\n      @click.stop=\"iniciarCallingPosiciones\"\n      :class=\"{ deshabilitado: callingPosiciones }\"\n      :style=\"[\n        { backgroundColor: callingPosiciones ? 'green' : 'transparent' },\n      ]\"\n    ></div>\n    <buscador-nodos-conocimiento\n      @nodoSeleccionado=\"centrarEnNodo\"\n      ref=\"buscadorNodos\"\n      :cerrarBusqueda=\"cerrarBusqueda\"\n    />\n\n    <panel-conjuntos-nodos\n      ref=\"panelConjuntosNodos\"\n      :yo=\"yo\"\n      :todosNodos=\"todosNodos\"\n      :idNodoTarget=\"idNodoTarget\"\n      @targetSeleccionado=\"setNodoTargetCache\"\n      @centrarEnNodo=\"centrarEnNodo(todosNodos.find((n) => n.id == $event))\"\n    />\n    <panel-configuracion-atlas ref=\"panelConfiguracionAtlas\" :yo=\"yo\" />\n    <canvases\n      :todosNodos=\"todosNodos\"\n      :nodoSeleccionado=\"nodoSeleccionado\"\n      :idNodoTarget=\"idNodoTarget\"\n      :idsNecesariosParaTarget=\"idsNecesariosParaTarget\"\n      :centroVista=\"centroVista\"\n      :callingPosiciones=\"callingPosiciones\"\n      :factorZoom=\"factorZoom\"\n      :style=\"[offsetContenedorNodos]\"\n      ref=\"canvases\"\n      v-if=\"todosNodos.length > 1\"\n    />\n    <div id=\"contenedorNodos\" :style=\"[offsetContenedorNodos]\">\n      <nodo-conocimiento\n        :nodoSeleccionado=\"nodoSeleccionado\"\n        :todosNodos=\"todosNodos\"\n        :idNodoMenuCx=\"idNodoMenuCx\"\n        :usuarioAdministradorAtlas=\"usuarioAdministradorAtlas\"\n        :yo=\"yo\"\n        :key=\"nodo.id\"\n        v-for=\"nodo of todosNodos\"\n        :esteNodo=\"nodo\"\n        :centroVista=\"centroVista\"\n        :esNodoObjetivo=\"idsNodosObjetivos.includes(nodo.id)\"\n        :esTarget=\"idNodoTarget == nodo.id\"\n        :idsNodosAprendidos=\"idsNodosAprendidos\"\n        :factorZoom=\"factorZoom\"\n        :escondido=\"\n          idNodoTarget &&\n          !idsNecesariosParaTarget.includes(nodo.id) &&\n          idNodoTarget != nodo.id\n        \"\n        :configuracionAtlas=\"configuracionAtlas\"\n        :callingPosiciones=\"callingPosiciones\"\n        @click.right.native.exact.stop.prevent=\"idNodoMenuCx = nodo.id\"\n        @click.native.stop=\"seleccionNodo(nodo)\"\n        @creacionVinculo=\"crearVinculo\"\n        @eliminacionVinculo=\"eliminarVinculo\"\n        @cambioDePosicionManual=\"cambiarCoordsManualesNodo\"\n        @eliminar=\"eliminarNodo\"\n        @cambieEstadoObjetivo=\"setEstadoObjetivoNodoCache($event, nodo.id)\"\n        @tengoNuevoValorAprendido=\"setNodoAprendidoCache($event, nodo.id)\"\n      />\n    </div>\n\n    <loading\n      id=\"simboloDescargandoNodos\"\n      v-show=\"!nodosDescargados\"\n      texto=\"descargando nodos de conocimiento\"\n    />\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport NodoConocimiento from \"./atlasConocimiento/NodoConocimiento.vue\";\nimport Canvases from \"./atlasConocimiento/Canvases.vue\";\nimport BuscadorNodosConocimiento from \"./atlasConocimiento/BuscadorNodosConocimiento.vue\";\nimport Loading from \"./utilidades/Loading.vue\";\nimport PanelConjuntosNodos from \"./atlasConocimiento/PanelConjuntosNodos.vue\";\nimport PanelConfiguracionAtlas from \"./atlasConocimiento/PanelConfiguracionAtlas.vue\";\nconst debounce = require(\"debounce\");\n\nconst fragmentoNodoConocimiento = gql`\n  fragment fragNodoConocimiento on NodoConocimiento {\n    id\n    nombre\n    descripcion\n    expertos\n    clases {\n      id\n      nombre\n      idExperto\n      interesados\n    }\n    coordsManuales {\n      x\n      y\n    }\n    coords {\n      x\n      y\n    }\n    autoCoords {\n      x\n      y\n    }\n    centroMasa {\n      x\n      y\n    }\n    stuck\n    angulo\n    puntaje\n    vinculos {\n      idRef\n      rol\n      tipo\n    }\n    fuerzaCentroMasa {\n      fuerza\n      direccion\n    }\n    fuerzaColision {\n      fuerza\n      direccion\n    }\n  }\n`;\n\nconst QUERY_NODOS = gql`\n  query {\n    todosNodos {\n      ...fragNodoConocimiento\n    }\n  }\n  ${fragmentoNodoConocimiento}\n`;\n\nconst QUERY_DATOS_USUARIO_NODOS = gql`\n  query {\n    yo {\n      id\n      atlas {\n        datosNodos {\n          idNodo\n          objetivo\n          aprendido\n        }\n        configuracion {\n          modo\n        }\n        idNodoTarget\n        colecciones {\n          id\n          nombre\n          idsNodos\n          nodos {\n            id\n            nombre\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport default {\n  components: {\n    NodoConocimiento,\n    Canvases,\n    BuscadorNodosConocimiento,\n    Loading,\n    PanelConjuntosNodos,\n    PanelConfiguracionAtlas,\n  },\n  name: \"AtlasConocimiento\",\n  apollo: {\n    todosNodos: {\n      query: QUERY_NODOS,\n      result: function () {\n        this.dibujarVinculosGrises();\n      },\n      pollInterval() {\n        return this.callingPosiciones ? 5000 : null;\n      },\n      update({ todosNodos }) {\n        this.nodosDescargados = true;\n        var nuevoTodosNodos = JSON.parse(JSON.stringify(todosNodos));\n        nuevoTodosNodos.forEach((nodo) => {\n          nodo.coordsManuales = nodo.autoCoords;\n          nodo.coords = nodo.autoCoords;\n        });\n        return nuevoTodosNodos;\n      },\n      fetchPolicy: \"cache-and-network\",\n    },\n    yo: {\n      query: QUERY_DATOS_USUARIO_NODOS,\n      skip() {\n        return !this.usuarioLogeado || this.todosNodos.length < 1;\n      },\n    },\n    configuracionAtlas: {\n      query: gql`\n        query ($nombreAtlas: String!) {\n          configuracionAtlas(nombreAtlas: $nombreAtlas) {\n            id\n            posicionando\n          }\n        }\n      `,\n      variables: {\n        nombreAtlas: \"conocimiento\",\n      },\n      fetchPolicy: \"network-only\",\n    },\n  },\n  data() {\n    return {\n      configuracionAtlas: {\n        posicionando: false,\n      },\n      hovered: false,\n      todosNodos: [],\n      nodosDescargados: false,\n      idNodoSeleccionado: \"-1\",\n      idNodoMenuCx: \"-1\",\n      idsNecesariosParaTarget: [],\n\n      yo: {\n        atlas: {\n          datosNodos: [],\n          configuracion: {\n            modo: \"estudiante\",\n          },\n        },\n      },\n\n      centroVistaDecimal: {\n        x: 218,\n        y: 39,\n      },\n      showingZoomInfo: false,\n      zoom: 80,\n      minZoom: 20,\n      maxZoom: 200,\n      pinching: false,\n      lastPinchDistance: 0,\n      actualizarTrazos: 0,\n      panningVista: false,\n      vistaPanned: false,\n      nodosConectadosAlSeleccionado: {\n        listaCompleta: [],\n        listaPorNiveles: [],\n      },\n      profundidadNodosConectadosAlSeleccionado: 1,\n      actualizarVinculosGrises: 0,\n\n      ultimoTouchX: 0,\n      ultimoTouchY: 0,\n\n      cerrarBusqueda: 0,\n\n      callingPosiciones: false,\n\n      mostrandoMenuContextual: false,\n      offsetMenuContextual: {\n        top: \"0px\",\n        left: \"0px\",\n      },\n      enviandoQueryConfiguracionAtlas: false,\n    };\n  },\n  computed: {\n    idsNodosObjetivos() {\n      if (!this.yo || !this.yo.atlas || !this.yo.atlas.datosNodos) {\n        return [];\n      }\n      return this.yo.atlas.datosNodos\n        .filter((n) => n.objetivo == true)\n        .map((n) => n.idNodo);\n    },\n    nodosObjetivo() {\n      if (!this.todosNodos) return [];\n      return this.todosNodos.filter((n) =>\n        this.idsNodosObjetivos.includes(n.id)\n      );\n    },\n    nodoSeleccionado: function () {\n      if (!this.todosNodos) {\n        console.log(`NO HAY NODOS`);\n        return false;\n      }\n      if (this.todosNodos.some((n) => n.id == this.idNodoSeleccionado)) {\n        let indexSeleccionado = this.todosNodos.findIndex(\n          (n) => n.id == this.idNodoSeleccionado\n        );\n        return this.todosNodos[indexSeleccionado];\n      }\n      return {\n        id: \"-1\",\n        vinculos: [],\n      };\n    },\n    idUsuario: function () {\n      return this.$store.state.usuario.id;\n    },\n    usuarioAdministradorAtlas: function () {\n      if (!this.$store.state.usuario.permisos) return false;\n      return this.$store.state.usuario.permisos.includes(\"atlasAdministrador\")\n        ? true\n        : false;\n    },\n    idNodoTarget() {\n      if (!this.yo || !this.yo.atlas) return null;\n      return this.yo.atlas.idNodoTarget;\n    },\n    idsNodosAprendidos() {\n      return this.yo.atlas.datosNodos\n        .filter((n) => n.aprendido == true)\n        .map((n) => n.idNodo);\n    },\n    centroVista() {\n      return {\n        x: Math.round(this.centroVistaDecimal.x),\n        y: Math.round(this.centroVistaDecimal.y),\n      };\n    },\n    factorZoom() {\n      return Number((this.zoom / 100).toFixed(2));\n    },\n    offsetContenedorNodos() {\n      return {\n        left: -(this.centroVista.x * this.factorZoom) + \"px\",\n        top: -(this.centroVista.y * this.factorZoom) + \"px\",\n      };\n    },\n  },\n  methods: {\n    iniciarCallingPosiciones() {\n      var ciclos = prompt(\"¿Cuantos ciclos?\");\n      if (isNaN(ciclos)) {\n        return;\n      }\n\n      ciclos = Math.round(ciclos);\n      if (ciclos < 1) {\n        return;\n      }\n      console.log(`Enviando reposicionamiento de ${ciclos} ciclos`);\n      this.callingPosiciones = true;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($ciclos: Int!) {\n              posicionarNodosConocimientoByFuerzas(ciclos: $ciclos)\n            }\n          `,\n          variables: {\n            ciclos,\n          },\n        })\n        .then(() => {\n          this.callingPosiciones = false;\n        })\n        .catch((error) => {\n          this.callingPosiciones = false;\n          console.log(`Error: ${error}`);\n        });\n    },\n    togglePosicionamiento() {\n      this.enviandoQueryConfiguracionAtlas = true;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($nombreAtlas: String!) {\n              togglePosicionamientoAutomaticoAtlas(nombreAtlas: $nombreAtlas) {\n                id\n                posicionando\n              }\n            }\n          `,\n          variables: {\n            nombreAtlas: \"conocimiento\",\n          },\n        })\n        .then(() => {\n          this.enviandoQueryConfiguracionAtlas = false;\n        })\n        .catch(() => {\n          this.enviandoQueryConfiguracionAtlas = false;\n        });\n    },\n    abrirMenuContextual(e) {\n      let posCalendario = this.$el.getBoundingClientRect();\n\n      let topClick = Math.round(e.pageY - posCalendario.top);\n      let leftClick = Math.round(e.pageX - posCalendario.left);\n\n      this.$set(this.offsetMenuContextual, \"top\", topClick + \"px\");\n      this.$set(this.offsetMenuContextual, \"left\", leftClick + \"px\");\n      this.mostrandoMenuContextual = true;\n      //this.crearNodo({x: leftClick, y: topClick});\n    },\n    crearNodoEnMenuContextual() {\n      let posContenedor = document\n        .getElementById(\"contenedorNodos\")\n        .getBoundingClientRect();\n\n      console.log(`Offset menú cx: ${this.offsetMenuContextual.top}`);\n      console.log(`Offset menú cx: ${parseInt(this.offsetMenuContextual.top)}`);\n\n      var posicionNuevoNodo = {\n        x: parseInt(\n          (parseInt(this.offsetMenuContextual.left) - posContenedor.left) /\n            this.factorZoom\n        ),\n        y: parseInt(\n          (parseInt(this.offsetMenuContextual.top) - posContenedor.top) /\n            this.factorZoom\n        ),\n      };\n\n      console.log(`Creando nuevo nodo en ${JSON.stringify(posicionNuevoNodo)}`);\n\n      this.crearNodo(posicionNuevoNodo);\n    },\n    encontrarNodosNecesariosDeNodo(idNodo, listaTotal) {\n      const elNodo = this.todosNodos.find((n) => n.id == idNodo);\n      if (!elNodo) {\n        return listaTotal;\n      }\n      const necesarios = elNodo.vinculos\n        .filter((v) => v.rol == \"target\")\n        .map((v) => v.idRef);\n      necesarios.forEach((necesario) => {\n        if (!listaTotal.includes(necesario)) {\n          listaTotal.push(necesario);\n          listaTotal = this.encontrarNodosNecesariosDeNodo(\n            necesario,\n            listaTotal\n          );\n        }\n      });\n      return listaTotal;\n    },\n    clickFondoAtlas() {\n      console.log(`Click en el fondo del atlas`);\n      if (!this.vistaPanned) this.idNodoSeleccionado = \"-1\";\n      this.panningVista = false;\n      this.vistaPanned = false;\n      this.$refs.panelConjuntosNodos.abierto = false;\n      this.$refs.panelConfiguracionAtlas.abierto = false;\n      this.mostrandoMenuContextual = false;\n    },\n    setEstadoObjetivoNodoCache(nuevoEstado, idNodo) {\n      console.log(\n        `Seting en cache al nodo ${idNodo} con estado objetivo: ${nuevoEstado}`\n      );\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      var indexN = nuevoCache.yo.atlas.datosNodos.findIndex(\n        (n) => n.idNodo == idNodo\n      );\n      if (indexN > -1) {\n        nuevoCache.yo.atlas.datosNodos[indexN].objetivo = nuevoEstado;\n      } else {\n        console.log(`No estaba en caché. Pushing`);\n        nuevoCache.yo.atlas.datosNodos.push({\n          __typename: \"DatoNodoUsuario\",\n          idNodo,\n          objetivo: nuevoEstado,\n          aprendido: false,\n        });\n      }\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n    setNodoAprendidoCache(nuevoEstado, idNodo) {\n      console.log(\n        `Seting en cache al nodo ${idNodo} con estado aprendido: ${nuevoEstado}`\n      );\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n      var indexN = nuevoCache.yo.atlas.datosNodos.findIndex(\n        (n) => n.idNodo == idNodo\n      );\n      if (indexN > -1) {\n        nuevoCache.yo.atlas.datosNodos[indexN].aprendido = nuevoEstado;\n      } else {\n        console.log(`No estaba en caché. Pushing`);\n        nuevoCache.yo.atlas.datosNodos.push({\n          __typename: \"DatoNodoUsuario\",\n          idNodo,\n          objetivo: false,\n          aprendido: nuevoEstado,\n        });\n      }\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n    setNodoTargetCache(idNodo) {\n      console.log(`Seting en cache al nodo ${idNodo} como target`);\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n      nuevoCache.yo.atlas.idNodoTarget = idNodo;\n      store.writeQuery({\n        query: QUERY_DATOS_USUARIO_NODOS,\n        data: nuevoCache,\n      });\n    },\n\n    centrarEnNodo(n) {\n      this.$set(\n        this.centroVistaDecimal,\n        \"x\",\n        n.coords.x - this.$el.offsetWidth / (2 * this.factorZoom)\n      );\n      this.$set(\n        this.centroVistaDecimal,\n        \"y\",\n        n.coords.y - this.$el.offsetHeight / (2 * this.factorZoom)\n      );\n      this.seleccionNodo(n);\n      //this.centroVista=e;\n    },\n    iniciaMovimientoTouch(e) {\n      if (e.touches.length === 2) {\n        var dist = Math.hypot(\n          e.touches[0].pageX - e.touches[1].pageX,\n          e.touches[0].pageY - e.touches[1].pageY\n        );\n        this.lastPinchDistance = dist;\n        this.pinching = true;\n        return;\n      }\n\n      this.ultimoTouchX = e.changedTouches[0].clientX;\n      this.ultimoTouchY = e.changedTouches[0].clientY;\n    },\n    movimientoMobile(e) {\n      if (this.pinching) {\n        var contenedor = this.$el;\n        let posContenedor = contenedor.getBoundingClientRect();\n\n        const posZoom = {\n          x:\n            Math.round(posContenedor.width / 2 / this.factorZoom) +\n            this.centroVista.x,\n          y:\n            Math.round(posContenedor.height / 2 / this.factorZoom) +\n            this.centroVista.y,\n        };\n\n        const proporciones = {\n          x:\n            (posZoom.x - this.centroVistaDecimal.x) /\n            (posContenedor.width / this.factorZoom),\n          y:\n            (posZoom.y - this.centroVistaDecimal.y) /\n            (posContenedor.height / this.factorZoom),\n        };\n\n        var dist = Math.hypot(\n          e.touches[0].pageX - e.touches[1].pageX,\n          e.touches[0].pageY - e.touches[1].pageY\n        );\n        var pinch = dist - this.lastPinchDistance;\n        pinch = pinch * 0.5;\n        this.zoomVista(pinch);\n        this.lastPinchDistance = dist;\n\n        this.$set(\n          this.centroVistaDecimal,\n          \"x\",\n          posZoom.x - (posContenedor.width / this.factorZoom) * proporciones.x\n        );\n        this.$set(\n          this.centroVistaDecimal,\n          \"y\",\n          posZoom.y - (posContenedor.height / this.factorZoom) * proporciones.y\n        );\n        return;\n      }\n\n      const deltaX = e.changedTouches[0].clientX - this.ultimoTouchX;\n      const deltaY = e.changedTouches[0].clientY - this.ultimoTouchY;\n      this.ultimoTouchX = e.changedTouches[0].clientX;\n      this.ultimoTouchY = e.changedTouches[0].clientY;\n\n      this.desplazarVista(deltaX, deltaY);\n    },\n    finTouch() {\n      this.pinching = false;\n    },\n    cambiarCoordsManualesNodo(idNodo, coordsManuales) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      this.todosNodos[this.todosNodos.findIndex((n) => n.id == idNodo)].coords =\n        coordsManuales;\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodo: String, $coordsManuales: CoordsInput) {\n              setCoordsManuales(\n                idNodo: $idNodo\n                coordsManuales: $coordsManuales\n              ) {\n                modificados {\n                  id\n                  coordsManuales {\n                    x\n                    y\n                  }\n                  coords {\n                    x\n                    y\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idNodo,\n            coordsManuales,\n          },\n        })\n        .then(() => {\n          this.$refs.canvases.crearImagenTodosVinculos();\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n        });\n    },\n    eliminarNodo(idNodo) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      if (!confirm(\"¿Seguro de que quieres eliminar este nodo?\")) return;\n      console.log(`enviando mutacion de eliminar nodo`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodo: ID!) {\n              eliminarNodo(idNodo: $idNodo)\n            }\n          `,\n          variables: {\n            idNodo,\n          },\n          update(store, { data: { eliminarNodo } }) {\n            if (!eliminarNodo) {\n              console.log(`Nodo no fue eliminado`);\n              return;\n            }\n            const cache = store.readQuery({\n              query: QUERY_NODOS,\n            });\n            var nuevoCache = JSON.parse(JSON.stringify(cache));\n            const indexN = nuevoCache.todosNodos.findIndex(\n              (n) => n.id == idNodo\n            );\n            if (indexN > -1) {\n              nuevoCache.todosNodos.splice(indexN, 1);\n              store.writeQuery({\n                query: QUERY_NODOS,\n                data: nuevoCache,\n              });\n            } else {\n              console.log(`El nodo no estaba presente`);\n            }\n          },\n        })\n        .then((data) => {\n          console.log(`quitando el objeto del array. ${data}`);\n        });\n    },\n    crearNodo(posicion) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`Error usuario no autorizado`);\n        return;\n      }\n      console.log(`enviando una mutación de crear nodo`);\n\n      let infoNodo = {\n        coordsManuales: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n        coords: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n        autoCoords: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n      };\n      console.log(`en las coordenadas: ${posicion.x}, ${posicion.y} `);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($infoNodo: NodoConocimientoInput) {\n              crearNodo(infoNodo: $infoNodo) {\n                ...fragNodoConocimiento\n              }\n            }\n            ${fragmentoNodoConocimiento}\n          `,\n          variables: {\n            infoNodo,\n          },\n        })\n        .then(({ data: { crearNodo } }) => {\n          console.log(`Creado ${crearNodo.id}`);\n          const store = this.$apollo.provider.defaultClient;\n          const cache = store.readQuery({\n            query: QUERY_NODOS,\n          });\n          var nuevoCache = JSON.parse(JSON.stringify(cache));\n          var losNodos = nuevoCache.todosNodos;\n          const indexN = losNodos.findIndex((n) => n.id === crearNodo.id);\n          if (indexN > -1) {\n            console.log(`El nodo ya estaba en caché`);\n          } else {\n            losNodos.push(crearNodo);\n            store.writeQuery({\n              query: QUERY_NODOS,\n              data: nuevoCache,\n            });\n          }\n\n          //this.$router.push(\"/nodoConocimiento/\"+crearNodo.id);\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    descargarCentroVista() {\n      let dis = this;\n      this.$apollo\n        .query({\n          query: gql`\n            query {\n              yo {\n                id\n                atlas {\n                  centroVista {\n                    x\n                    y\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idUsuario: this.$store.state.usuario.id,\n          },\n          fetchPolicy: \"network-only\",\n        })\n        .then(function ({ data: { yo } }) {\n          let coords = yo.atlas.centroVista;\n          dis.$set(dis.centroVista, \"x\", coords.x);\n          dis.$set(dis.centroVista, \"y\", coords.y);\n          dis.$store.commit(\"setCentroVistaAtlas\", coords);\n        })\n        .catch(function (error) {\n          console.log(`error fetching centro vista: ${error}`);\n        });\n    },\n    desplazarVista(deltaX, deltaY) {\n      this.$set(\n        this.centroVistaDecimal,\n        \"x\",\n        Math.round(this.centroVistaDecimal.x - deltaX / this.factorZoom)\n      );\n      this.$set(\n        this.centroVistaDecimal,\n        \"y\",\n        Math.round(this.centroVistaDecimal.y - deltaY / this.factorZoom)\n      );\n      this.actualizarTrazos++;\n    },\n    panVista(e) {\n      if (!this.panningVista) {\n        return;\n      }\n      this.desplazarVista(e.movementX, e.movementY);\n      e.preventDefault();\n      this.vistaPanned = true;\n\n      /*this.centroVista.x -= e.movementX;\n      this.centroVista.y -= e.movementY;\n      */\n    },\n    seleccionNodo(nodo) {\n      this.idNodoSeleccionado = nodo.id;\n      if (!this.todosNodos.some((n) => n.id == this.idNodoSeleccionado)) {\n        console.log(`No encontrado`);\n        return null;\n      }\n\n      let profundidad = parseInt(this.profundidadNodosConectadosAlSeleccionado);\n      let listaPorNiveles = [];\n      let idNodoSel = this.idNodoSeleccionado;\n      let listaCompleta = [idNodoSel];\n      if (profundidad > 0) {\n        for (let i = 0; i < profundidad; i++) {\n          listaPorNiveles[i] = [];\n        }\n        ({ listaCompleta, listaPorNiveles } =\n          this.encontrarNodosConectadosRecursivamente(\n            idNodoSel,\n            [\"target\", \"source\"],\n            [\"continuacion\"],\n            listaCompleta,\n            listaPorNiveles,\n            0,\n            profundidad\n          ));\n      }\n      this.nodosConectadosAlSeleccionado = {\n        listaCompleta,\n        listaPorNiveles,\n      };\n    },\n    async eliminarVinculo(args) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      console.log(\n        `eliminando un vinculo entre ${args.idNodoFrom} y ${args.idNodoTo} `\n      );\n      await this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idNodoFrom: ID!, $idNodoTo: ID!) {\n              eliminarVinculoFromTo(\n                idSource: $idNodoFrom\n                idTarget: $idNodoTo\n              ) {\n                modificados {\n                  id\n                  vinculos {\n                    idRef\n                    tipo\n                    rol\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            idNodoFrom: args.idNodoFrom,\n            idNodoTo: args.idNodoTo,\n          },\n        })\n        .then(() => {})\n        .catch((error) => {\n          console.log(`error: ${error}`);\n        });\n    },\n    dibujarVinculosGrises() {\n      this.actualizarVinculosGrises++;\n    },\n    async crearVinculo(args) {\n      if (!this.usuarioSuperadministrador && !this.usuarioAdministradorAtlas) {\n        console.log(`No autorizado`);\n        return;\n      }\n      console.log(`creando un vinculo ${JSON.stringify(args)} `);\n      await this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($tipo: String!, $idNodoFrom: ID!, $idNodoTo: ID!) {\n              crearVinculo(\n                tipo: $tipo\n                idSource: $idNodoFrom\n                idTarget: $idNodoTo\n              ) {\n                modificados {\n                  id\n                  vinculos {\n                    idRef\n                    rol\n                    tipo\n                  }\n                }\n              }\n            }\n          `,\n          variables: {\n            tipo: \"continuacion\",\n            idNodoFrom: args.idNodoFrom,\n            idNodoTo: args.idNodoTo,\n          },\n        })\n        .then(() => {})\n        .catch((error) => {\n          console.log(`error: ${error}`);\n        });\n    },\n    encontrarNodosConectadosRecursivamente(\n      idNodo,\n      roles,\n      tipos,\n      listaCompleta,\n      listaPorNiveles,\n      nivel,\n      profundidad\n    ) {\n      // Rol debe ser un array que incluye los roles validos en esta búsqueda.\n      // Tipo deber ser un array que incluye todos los tipos válidos en esta búsqueda\n      let nodo = this.todosNodos.find((n) => n.id == idNodo);\n      for (let vinculo of nodo.vinculos) {\n        if (\n          this.todosNodos.some((n) => n.id == vinculo.idRef) &&\n          roles.some((r) => r == vinculo.rol) &&\n          tipos.some((t) => t == vinculo.tipo) &&\n          !listaCompleta.some((idN) => idN == vinculo.idRef)\n        ) {\n          listaPorNiveles[nivel].push(vinculo.idRef);\n          listaCompleta.push(vinculo.idRef);\n\n          if (nivel + 1 < profundidad) {\n            ({ listaCompleta, listaPorNiveles } =\n              this.encontrarNodosConectadosRecursivamente(\n                vinculo.idRef,\n                roles,\n                tipos,\n                listaCompleta,\n                listaPorNiveles,\n                nivel + 1,\n                profundidad\n              ));\n          }\n        } else {\n          console.log(`No`);\n        }\n      }\n      return { listaCompleta, listaPorNiveles };\n    },\n    zoomVista(deltaZoom) {\n      var nuevoZoom = this.zoom + deltaZoom;\n      if (nuevoZoom < this.minZoom) {\n        this.zoom = this.minZoom;\n      } else if (nuevoZoom > this.maxZoom) {\n        this.zoom = this.maxZoom;\n      } else {\n        this.zoom = nuevoZoom;\n      }\n\n      //Pan vista de acuerdo con la posición del mouse respecto del atlas\n    },\n    zoomWheel(e) {\n      if (!this.hovered || !e.ctrlKey) {\n        return;\n      }\n      e.preventDefault();\n\n      var contenedor = this.$el;\n      let posContenedor = contenedor.getBoundingClientRect();\n\n      const posZoom = {\n        x:\n          Math.round((e.clientX - posContenedor.left) / this.factorZoom) +\n          this.centroVista.x,\n        y:\n          Math.round((e.clientY - posContenedor.top) / this.factorZoom) +\n          this.centroVista.y,\n      };\n\n      const proporciones = {\n        x:\n          (posZoom.x - this.centroVistaDecimal.x) /\n          (posContenedor.width / this.factorZoom),\n        y:\n          (posZoom.y - this.centroVistaDecimal.y) /\n          (posContenedor.height / this.factorZoom),\n      };\n\n      const factorZoom = 0.2;\n      this.zoomVista(-Math.round(e.deltaY * factorZoom), {\n        x: posZoom.x,\n        y: posZoom.y,\n      });\n\n      this.$set(\n        this.centroVistaDecimal,\n        \"x\",\n        posZoom.x - (posContenedor.width / this.factorZoom) * proporciones.x\n      );\n      this.$set(\n        this.centroVistaDecimal,\n        \"y\",\n        posZoom.y - (posContenedor.height / this.factorZoom) * proporciones.y\n      );\n    },\n    hideZoomInfo: debounce(function () {\n      this.showingZoomInfo = false;\n    }, 1000),\n  },\n  watch: {\n    nodoSeleccionado: function () {\n      this.actualizarTrazos++;\n    },\n    route: function (to) {\n      console.log(`cambio de navegación a ${to.path}`);\n    },\n    idNodoTarget(idNodoTarget) {\n      if (!idNodoTarget) {\n        this.idsNecesariosParaTarget = [];\n        return;\n      }\n      console.log(`iniciando busqueda de requeridos de nodo ${idNodoTarget}`);\n      this.idsNecesariosParaTarget = this.encontrarNodosNecesariosDeNodo(\n        idNodoTarget,\n        []\n      );\n    },\n    zoom() {\n      this.showingZoomInfo = true;\n      this.hideZoomInfo();\n    },\n  },\n  mounted() {\n    // if (!this.usuario.atlas || !this.usuario.atlas.centroVista) {\n    //   console.log(`No había info de centro vista en la store. Descargando`);\n    //   this.descargarCentroVista();\n    //   return;\n    // }\n    // this.$set(this.centroVistaDecimal, \"x\", this.usuario.atlas.centroVista.x);\n    // this.$set(this.centroVistaDecimal, \"y\", this.usuario.atlas.centroVista.y);\n\n    if (screen.width < 600) {\n      this.zoom = 70;\n    }\n  },\n  created() {\n    window.addEventListener(\"wheel\", this.zoomWheel, { passive: false });\n  },\n  removed() {\n    window.removeEventListener(\"wheel\", this.zoomWheel);\n  },\n  // beforeRouteLeave(_, __, next) {\n  //   console.log(\n  //     `enviando nuevo centroVista para el usuario ${\n  //       this.usuario.id\n  //     }. Centro vista: ${JSON.stringify(this.centroVista)}`\n  //   );\n  //   this.$store.commit(\"setCentroVistaAtlas\", this.centroVista);\n\n  //   this.$apollo\n  //     .mutate({\n  //       mutation: gql`\n  //         mutation($idUsuario: ID, $centroVista: CoordsInput) {\n  //           setCentroVista(idUsuario: $idUsuario, centroVista: $centroVista)\n  //         }\n  //       `,\n  //       variables: {\n  //         idUsuario: this.$store.state.usuario.id,\n  //         centroVista: this.centroVista,\n  //       },\n  //     })\n  //     .then(function () {\n  //       next();\n  //     })\n  //     .catch(function (error) {\n  //       console.log(`error: ${error}`);\n  //       next();\n  //     });\n  // },\n};\n</script>\n\n<style scoped>\n.atlasConocimiento {\n  position: relative;\n  overflow: hidden;\n}\n#menuContextual {\n  position: absolute;\n  background-color: gray;\n  z-index: 100;\n}\n.botonMenuContextual {\n  font-size: 12px;\n  color: rgb(221, 221, 221);\n  cursor: pointer;\n  padding: 10px;\n}\n.botonMenuContextual:hover {\n  background-color: rgb(68, 68, 68);\n}\n\n#canvases {\n  position: absolute;\n  pointer-events: none;\n}\n#contenedorNodos {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  user-select: none;\n\n  pointer-events: none;\n}\n#buscadorNodosConocimiento {\n  position: absolute;\n  top: 1%;\n  left: 1%;\n  /* transform: translateX(-50%); */\n  z-index: 1;\n}\n#panelConjuntosNodos {\n  z-index: 100;\n}\n#panelConfiguracionAtlas {\n  z-index: 100;\n}\n#panelObjetivos {\n  position: absolute;\n  top: 2%;\n  left: 50%;\n  transform: translateX(-50%);\n  opacity: 0.2;\n  z-index: 100;\n}\n#panelObjetivos:hover {\n  opacity: 1;\n}\n#infoZoom {\n  position: absolute;\n  top: 2%;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 10px;\n  display: inline-block;\n  font-weight: bold;\n  color: rgb(102, 102, 102);\n}\n#botonCallingPosiciones {\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  border: 1px solid black;\n  position: absolute;\n  top: 1%;\n  right: 1%;\n  cursor: pointer;\n}\n\n#simboloDescargandoNodos {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 100;\n}\n\n.fadeOut-leave-to {\n  opacity: 0;\n}\n.fadeOut-leave-active {\n  transition: opacity 1s;\n}\n.fadeOut-leave {\n  opacity: 1;\n}\n</style>"]}]}