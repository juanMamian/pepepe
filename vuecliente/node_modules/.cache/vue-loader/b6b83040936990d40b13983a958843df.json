{"remainingRequest":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vida1/webpj/pepepe/vuecliente/src/components/atlasSolidaridad/AtlasSolidaridad.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vida1/webpj/pepepe/vuecliente/src/components/atlasSolidaridad/AtlasSolidaridad.vue","mtime":1643654906499},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vida1/webpj/pepepe/vuecliente/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBncWwgZnJvbSAiZ3JhcGhxbC10YWciOwoKaW1wb3J0IExvYWRpbmcgZnJvbSAiLi4vdXRpbGlkYWRlcy9Mb2FkaW5nLnZ1ZSI7CmltcG9ydCBOb2RvIGZyb20gIi4vTm9kby52dWUiOwppbXBvcnQgRW5sYWNlc05vZG8gZnJvbSAiLi9FbmxhY2VzTm9kby52dWUiOwppbXBvcnQgZGVib3VuY2UgZnJvbSAiZGVib3VuY2UiOwppbXBvcnQgeyBmcmFnbWVudG9Ob2RvU29saWRhcmlkYWQsIGZyYWdtZW50b1BlcnNvbmFBdGxhcyB9IGZyb20gIi4vZnJhZ3MiOwppbXBvcnQgTm9kb1BlcnNvbmEgZnJvbSAiLi9Ob2RvUGVyc29uYS52dWUiOwppbXBvcnQgeyBNaXhpbkF0bGFzU29saWRhcmlkYWQgfSBmcm9tICIuL01peGluQXRsYXNTb2xpZGFyaWRhZCI7CmltcG9ydCB7IFFVRVJZX0RBVE9TX1VTVUFSSU9fQVRMQVNfU09MSURBUklEQUQgfSBmcm9tICIuL0NvbmZpZ3VyYWNpb25Ob2RvU29saWRhcmlkYWQiOwovLyBjb25zdCBRVUVSWV9OT0RPUyA9IGdxbGAKLy8gICBxdWVyeSAoJG5pdmVsOiBJbnQhKSB7Ci8vICAgICBub2Rvc1NvbGlkYXJpZGFkQnlJZChuaXZlbDogJG5pdmVsKSB7Ci8vICAgICAgIC4uLmZyYWdOb2RvU29saWRhcmlkYWQKLy8gICAgIH0KLy8gICB9Ci8vICAgJHtmcmFnbWVudG9Ob2RvU29saWRhcmlkYWR9Ci8vIGA7CgpleHBvcnQgY29uc3QgUVVFUllfUEVSU09OQVNfQVRMQVNfU09MSURBUklEQUQgPSBncWxgCiAgcXVlcnkgKCRpZHNVc3VhcmlvczogW0lEIV0pIHsKICAgIHVzdWFyaW9zQnlJZHMoaWRzVXN1YXJpb3M6ICRpZHNVc3VhcmlvcykgewogICAgICAuLi5mcmFnUGVyc29uYUF0bGFzCiAgICB9CiAgfQogICR7ZnJhZ21lbnRvUGVyc29uYUF0bGFzfQpgOwoKZXhwb3J0IGNvbnN0IFFVRVJZX05PRE9TX0FUTEFTID0gZ3FsYAogIHF1ZXJ5IHsKICAgIG5vZG9zU29saWRhcmlkYWRCeUlkcyB7CiAgICAgIC4uLmZyYWdOb2RvU29saWRhcmlkYWQKICAgIH0KICB9CiAgJHtmcmFnbWVudG9Ob2RvU29saWRhcmlkYWR9CmA7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTG9hZGluZywKICAgIE5vZG8sCiAgICBFbmxhY2VzTm9kbywKICAgIE5vZG9QZXJzb25hLAogIH0sCiAgbmFtZTogIkF0bGFzU29saWRhcmlkYWQiLAogIGFwb2xsbzogeyAgICAgICAgICAgCiAgICB5bzogewogICAgICBxdWVyeTogUVVFUllfREFUT1NfVVNVQVJJT19BVExBU19TT0xJREFSSURBRCwKICAgICAgdXBkYXRlKHsgeW8gfSkgewogICAgICAgIHRoaXMuY2FsY3VsYXJFc3F1aW5hVmlzdGEoeW8uY29vcmRzKTsKICAgICAgICB0aGlzLmRhdG9zWW9EZXNjYXJnYWRvcyA9IHRydWU7CiAgICAgICAgcmV0dXJuIHlvOwogICAgICB9LAogICAgICBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy51c3VhcmlvTG9nZWFkbyB8fCAhdGhpcy5tb250YWRvOwogICAgICB9LAogICAgICBmZXRjaFBvbGljeTogIm5ldHdvcmstb25seSIsCiAgICB9LAogICAgJHN1YnNjcmliZTp7CiAgICAgIG5vZG9zQXRsYXNQb3NpY2lvbmFkb3M6IHsKICAgICAgICBxdWVyeTogZ3FsYAogICAgICAgICAgc3Vic2NyaXB0aW9uICgkaWRBdGxhczogSUQhKSB7CiAgICAgICAgICAgIG5vZG9zQXRsYXNQb3NpY2lvbmFkb3MoaWRBdGxhczogJGlkQXRsYXMpCiAgICAgICAgICB9CiAgICAgICAgYCwKICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgIGlkQXRsYXM6ICI2MWIzZmUwMjgwNTA5MzYwODI1YjI2MzQiLCAvL0lkIGRlbCBhdGxhcyBkZSBzb2xpZGFyaWRhZC4KICAgICAgICB9LAogICAgICAgIHJlc3VsdCgpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgICBgTm9kb3MgZGVsIGF0bGFzIGhhbiBzaWRvIHBvc2ljaW9uYWRvcy4gUmVmZXRjaGluZyBjb29yZHNgCiAgICAgICAgICApOwogICAgICAgICAgdGhpcy5yZWZldGNoQ29vcmRzTm9kb3MoKTsKICAgICAgICB9LAogICAgICB9LAogICAgfSAgICAKICB9LAogIG1peGluczogW01peGluQXRsYXNTb2xpZGFyaWRhZF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRpcG9Ob2RvUm9vdDondXN1YXJpbycsCiAgICAgIG1vbnRhZG86IGZhbHNlLAogICAgICBwZXJzb25hczogW10sCiAgICAgIGRlc2Nhcmdhc1BlcnNvbmFzOiAwLAogICAgICBub2Rvc1JlbmRlclJvb3Q6IFtdLAogICAgICBub2Rvc1NvbGlkYXJpZGFkUmVuZGVyOiBbXSwKCiAgICAgIHBlcnNvbmFzUmVuZGVyUm9vdDogW10sCiAgICAgIHBlcnNvbmFzUmVuZGVyOiBbXSwKCiAgICAgIG1vc3RyYW5kb01lbnVDb250ZXh0dWFsOiBmYWxzZSwKICAgICAgcG9zTWVudUNvbnRleHR1YWw6IHsKICAgICAgICB0b3A6IDAsCiAgICAgICAgbGVmdDogMCwKICAgICAgfSwKCiAgICAgIGVzcXVpbmFWaXN0YURlY2ltYWw6IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgIH0sCiAgICAgIGNlbnRyb0Rlc2NhcmdhOiB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwLAogICAgICB9LAoKICAgICAgcmFkaW9EZXNjYXJnYTogbnVsbCwKICAgICAgc2l6ZUF0bGFzOiB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwLAogICAgICAgIGRpYWdvbmFsOiAwLAogICAgICB9LAogICAgICBwYW5uaW5nVmlzdGE6IGZhbHNlLAogICAgICB2aXN0YVBhbm5lZDogZmFsc2UsCiAgICAgIGhvdmVyZWQ6IGZhbHNlLAoKICAgICAgaWROb2RvU2VsZWNjaW9uYWRvOiBudWxsLAogICAgICBpZE5vZG9NZW51Q3g6IG51bGwsCiAgICAgIGlkTm9kb0NlbnRyYWRvQXJib2w6IG51bGwsCgogICAgICB6b29tOiA4MCwKICAgICAgbWluWm9vbTogMjAsCiAgICAgIG1heFpvb206IDEyMCwKICAgICAgc2hvd2luZ1pvb21JbmZvOiBmYWxzZSwKICAgICAgaW5mb1Bvc1pvb206IG51bGwsCgogICAgICBwaW5jaGluZzogZmFsc2UsCiAgICAgIGxhc3RQaW5jaERpc3RhbmNlOiAwLAoKICAgICAgLy8gcHJveWVjdG9zOiBbXSwKICAgICAgLy8gdHJhYmFqb3M6IFtdLAogICAgICAvLyBvYmpldGl2b3M6IFtdLAoKICAgICAgZW52aWFuZG9RdWVyeU5vZG9zOiBmYWxzZSwKICAgICAgcmVmZXRjaGluZ0Nvb3JkczogZmFsc2UsCiAgICAgIHRyYW5zaWNpb25hclBvc2ljaW9uTm9kb3M6IHRydWUsCgogICAgICBjYWxsaW5nUG9zaWNpb25lczogZmFsc2UsCgogICAgICByZWRpYnVqYXJFbmxhY2VzTm9kb3M6IDAsCgogICAgICBlbnZpYW5kb0Nvb3Jkc1Zpc3RhVXN1YXJpbzogZmFsc2UsCiAgICAgIGVzcXVpbmFWaXN0YUNhbGN1bGFkYTogZmFsc2UsCgogICAgICBtb3N0cmFuZG9QZXJzb25hczogZmFsc2UsCgogICAgICBzaG93aW5nTm9tYnJlTm9kb0VtZXJnZW50ZTogZmFsc2UsCiAgICAgIHZpc3RhOiAiYXRsYXMiLAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsgICAgCiAgICBzZXROb2Rvc1JlbmRlcigpIHsKICAgICAgaWYgKCF0aGlzLmluZGljZU5vZG9zVW5kZXIgfHwgdGhpcy5pbmRpY2VOb2Rvc1VuZGVyLmxlbmd0aCA8IDEpIHJldHVybiBbXTsKICAgICAgY29uc29sZS5sb2coYFNldHRpbmcgbm9kb3MgcmVuZGVyYCk7ICAgICAgCiAgICAgIHZhciBjdXJyZW50VG9kb3NOb2RvcyA9IHsKICAgICAgICBub2Rvc1NvbGlkYXJpZGFkOiB0aGlzLm5vZG9zU29saWRhcmlkYWRSb290LAogICAgICAgIHBlcnNvbmFzOiB0aGlzLnBlcnNvbmFzUm9vdCwKICAgICAgfTsKICAgICAgdmFyIG5vZG9zU29saWRhcmlkYWRSZW5kZXI9dGhpcy5ub2Rvc1NvbGlkYXJpZGFkUm9vdDsKICAgICAgdmFyIHBlcnNvbmFzUmVuZGVyPXRoaXMucGVyc29uYXNSb290OwoKICAgICAgdmFyIGlkc25vZG9zU29saWRhcmlkYWRSZW5kZXJQYXJjaWFsID0gbm9kb3NTb2xpZGFyaWRhZFJlbmRlci5tYXAoKG5yKSA9PiBuci5pZCk7CiAgICAgIHZhciBpZHNQZXJzb25hc1JlbmRlclBhcmNpYWwgPSBwZXJzb25hc1JlbmRlci5tYXAoKHApID0+IHAuaWQpOwogICAgICB2YXIgY3VlbnRhID0gMDsKICAgICAgZG8gewogICAgICAgIGN1ZW50YSsrOwogICAgICAgIGlmIChjdWVudGEgPiAxMDAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgT1ZFUkZMT1dgKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvL25vZG9zVW5kZXIKICAgICAgICBsZXQgbm9kb3NVbmRlciA9IGN1cnJlbnRUb2Rvc05vZG9zLm5vZG9zU29saWRhcmlkYWQKICAgICAgICAgIC5jb25jYXQoY3VycmVudFRvZG9zTm9kb3MucGVyc29uYXMpCiAgICAgICAgICAuZmlsdGVyKChjcikgPT4gdGhpcy5pZHNOb2Rvc0Rlc3BsZWdhZG9zLmluY2x1ZGVzKGNyLmlkKSkKICAgICAgICAgIC5yZWR1Y2UoKGFjYywgY24pID0+IHsKICAgICAgICAgICAgY29uc3QgcmVxdWVyaWRvcyA9IHRoaXMuaW5kaWNlTm9kb3NVbmRlcltjbi5pZF0ubm9kb3NSZXF1ZXJpZG9zOwogICAgICAgICAgICByZXR1cm4gYWNjLmNvbmNhdChyZXF1ZXJpZG9zLmZpbHRlcihyPT4hYWNjLm1hcCh2PT52LmlkKS5pbmNsdWRlcyhyLmlkKSkpOwogICAgICAgICAgfSwgW10pOwogICAgICAgIGxldCBub2Rvc1VuZGVyTnVldm9zID0gbm9kb3NVbmRlci5maWx0ZXIoCiAgICAgICAgICAobnUpID0+ICFpZHNub2Rvc1NvbGlkYXJpZGFkUmVuZGVyUGFyY2lhbC5pbmNsdWRlcyhudS5pZCkKICAgICAgICApOwoKICAgICAgICAvL1BlcnNvbmFzVW5kZXIKICAgICAgICBsZXQgcGVyc29uYXNVbmRlciA9IFtdOwogICAgICAgIGxldCBwZXJzb25hc1VuZGVyTnVldm9zID0gW107CiAgICAgICAgaWYgKHRoaXMubW9zdHJhbmRvUGVyc29uYXMpIHsKICAgICAgICAgIHBlcnNvbmFzVW5kZXIgPSBjdXJyZW50VG9kb3NOb2Rvcy5ub2Rvc1NvbGlkYXJpZGFkCiAgICAgICAgICAgIC5maWx0ZXIoKG4pID0+IHRoaXMuaWRzTm9kb3NEZXNwbGVnYWRvcy5pbmNsdWRlcyhuLmlkKSkKICAgICAgICAgICAgLnJlZHVjZSgoYWNjLCBjbikgPT4gewogICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNhYmxlcz10aGlzLmluZGljZU5vZG9zVW5kZXJbY24uaWRdLnJlc3BvbnNhYmxlczsKICAgICAgICAgICAgICByZXR1cm4gYWNjLmNvbmNhdChyZXNwb25zYWJsZXMuZmlsdGVyKHI9PiFhY2MubWFwKHY9PnYuaWQpLmluY2x1ZGVzKHIuaWQpKSk7CiAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgIHBlcnNvbmFzVW5kZXJOdWV2b3MgPSBwZXJzb25hc1VuZGVyLmZpbHRlcigKICAgICAgICAgICAgKHApID0+ICFpZHNQZXJzb25hc1JlbmRlclBhcmNpYWwuaW5jbHVkZXMocC5pZCkKICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBub2Rvc1NvbGlkYXJpZGFkUmVuZGVyID0gbm9kb3NTb2xpZGFyaWRhZFJlbmRlci5jb25jYXQobm9kb3NVbmRlck51ZXZvcyk7CiAgICAgICAgcGVyc29uYXNSZW5kZXIgPSBwZXJzb25hc1JlbmRlci5jb25jYXQocGVyc29uYXNVbmRlck51ZXZvcyk7CgogICAgICAgIGN1cnJlbnRUb2Rvc05vZG9zLm5vZG9zU29saWRhcmlkYWQgPSBub2Rvc1VuZGVyTnVldm9zOwogICAgICAgIGN1cnJlbnRUb2Rvc05vZG9zLnBlcnNvbmFzID0gcGVyc29uYXNVbmRlck51ZXZvczsKCiAgICAgICAgaWRzbm9kb3NTb2xpZGFyaWRhZFJlbmRlclBhcmNpYWwgPSBub2Rvc1NvbGlkYXJpZGFkUmVuZGVyLm1hcCgobnIpID0+IG5yLmlkKTsKICAgICAgICBpZHNQZXJzb25hc1JlbmRlclBhcmNpYWwgPSBwZXJzb25hc1JlbmRlci5tYXAoKHApID0+IHAuaWQpOwogICAgICB9IHdoaWxlICgKICAgICAgICBjdXJyZW50VG9kb3NOb2Rvcy5ub2Rvc1NvbGlkYXJpZGFkLmxlbmd0aCArIGN1cnJlbnRUb2Rvc05vZG9zLnBlcnNvbmFzLmxlbmd0aCA+CiAgICAgICAgMAogICAgICApOwoKICAgICAgdGhpcy5ub2Rvc1NvbGlkYXJpZGFkUmVuZGVyID0gbm9kb3NTb2xpZGFyaWRhZFJlbmRlcjsKICAgICAgdGhpcy5wZXJzb25hc1JlbmRlciA9IHBlcnNvbmFzUmVuZGVyOwogICAgfSwKICAgIHNldE5vZG9FblZlbnRhbml0YShpZE5vZG8pIHsKICAgICAgY29uc29sZS5sb2coYFNldHRpbmcgcGF0aCB0byAke2lkTm9kb31gKTsKICAgICAgLy8gdmFyIGN1cnJlbnRQYXRoID0gdGhpcy4kcm91dGUuY3VycmVudFJvdXRlLnBhdGg7CiAgICAgIC8vIGNvbnNvbGUubG9nKGBFcmE6ICR7Y3VycmVudFBhdGh9YCk7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogIm5vZG9FblZlbnRhbml0YSIsIHBhcmFtczogeyBpZE52OiBpZE5vZG8gfSB9KTsKICAgIH0sCiAgICBjZXJyYXJOb2RvRW5WZW50YW5pdGEoKSB7CiAgICAgIGNvbnNvbGUubG9nKGBDZXJyYW5kbyBub2RvIGVuIHZlbnRhbml0YWApOwogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJhdGxhc1NvbGlkYXJpZGFkIiB9KTsKICAgIH0sCiAgICBpbmljaWFyQ2FsbGluZ1Bvc2ljaW9uZXMoKSB7CiAgICAgIHZhciBjaWNsb3MgPSBwcm9tcHQoIsK/Q3VhbnRvcyBjaWNsb3M/Iik7CiAgICAgIGlmIChpc05hTihjaWNsb3MpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjaWNsb3MgPSBNYXRoLnJvdW5kKGNpY2xvcyk7CiAgICAgIGlmIChjaWNsb3MgPCAxKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKGBFbnZpYW5kbyByZXBvc2ljaW9uYW1pZW50byBkZSAke2NpY2xvc30gY2ljbG9zYCk7CiAgICAgIHRoaXMuY2FsbGluZ1Bvc2ljaW9uZXMgPSB0cnVlOwoKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLnF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBncWxgCiAgICAgICAgICAgIHF1ZXJ5ICgkY2ljbG9zOiBJbnQhKSB7CiAgICAgICAgICAgICAgcG9zaWNpb25hck5vZG9zU29saWRhcmlkYWRCeUZ1ZXJ6YXMoY2ljbG9zOiAkY2ljbG9zKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGNpY2xvcywKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLmNhbGxpbmdQb3NpY2lvbmVzID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aGlzLmNhbGxpbmdQb3NpY2lvbmVzID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgY2FsY3VsYXJFc3F1aW5hVmlzdGEoY2VudHJvKSB7CiAgICAgIGNvbnNvbGUubG9nKGBDZW50cmFuZG8gZW4gdXN1YXJpb2ApOwogICAgICBpZiAodGhpcy5lc3F1aW5hVmlzdGFDYWxjdWxhZGEpIHJldHVybjsKICAgICAgdGhpcy4kc2V0KAogICAgICAgIHRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbCwKICAgICAgICAieCIsCiAgICAgICAgTWF0aC5yb3VuZChjZW50cm8ueCAtIHRoaXMuc2l6ZUF0bGFzLnggLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkpCiAgICAgICk7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwsCiAgICAgICAgInkiLAogICAgICAgIE1hdGgucm91bmQoY2VudHJvLnkgLSB0aGlzLnNpemVBdGxhcy55IC8gKDIgKiB0aGlzLmZhY3Rvclpvb20pKQogICAgICApOwogICAgICB0aGlzLmVzcXVpbmFWaXN0YUNhbGN1bGFkYSA9IHRydWU7CiAgICB9LAogICAgYWJyaXJNZW51Q29udGV4dHVhbChlKSB7CiAgICAgIGxldCBwb3NBdGxhcyA9IHRoaXMuJGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgbGV0IHRvcENsaWNrID0gTWF0aC5yb3VuZChlLnBhZ2VZIC0gcG9zQXRsYXMudG9wKTsKICAgICAgbGV0IGxlZnRDbGljayA9IE1hdGgucm91bmQoZS5wYWdlWCAtIHBvc0F0bGFzLmxlZnQpOwoKICAgICAgdGhpcy4kc2V0KHRoaXMucG9zTWVudUNvbnRleHR1YWwsICJ5IiwgdG9wQ2xpY2spOwogICAgICB0aGlzLiRzZXQodGhpcy5wb3NNZW51Q29udGV4dHVhbCwgIngiLCBsZWZ0Q2xpY2spOwogICAgICB0aGlzLm1vc3RyYW5kb01lbnVDb250ZXh0dWFsID0gdHJ1ZTsKICAgIH0sCiAgICB1cGxvYWRWaXN0YUFjdHVhbDogZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmVudmlhbmRvQ29vcmRzVmlzdGFVc3VhcmlvID0gdHJ1ZTsKICAgICAgY29uc29sZS5sb2coYFVwbG9hZGluZyB2aXN0YSBkZSB1c3VhcmlvYCk7CiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5tdXRhdGUoewogICAgICAgICAgbXV0YXRpb246IGdxbGAKICAgICAgICAgICAgbXV0YXRpb24gKCRjb29yZHM6IENvb3Jkc0lucHV0ISkgewogICAgICAgICAgICAgIHNldENvb3Jkc1Zpc3RhQXRsYXNTb2xpZGFyaWRhZFVzdWFyaW8oY29vcmRzOiAkY29vcmRzKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGNvb3JkczogewogICAgICAgICAgICAgIHg6IE1hdGgucm91bmQoCiAgICAgICAgICAgICAgICB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueCArCiAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZUF0bGFzLnggLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHk6IE1hdGgucm91bmQoCiAgICAgICAgICAgICAgICB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueSArCiAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZUF0bGFzLnkgLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgICAgICAgICApLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuZW52aWFuZG9Db29yZHNWaXN0YVVzdWFyaW8gPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJvcn1gKTsKICAgICAgICAgIHRoaXMuZW52aWFuZG9Db29yZHNWaXN0YVVzdWFyaW8gPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sIDMwMDApLAogICAgZGVzcGxhemFyVmlzdGEoZGVsdGFYLCBkZWx0YVkpIHsKICAgICAgdGhpcy4kc2V0KAogICAgICAgIHRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbCwKICAgICAgICAieCIsCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLnggLSBkZWx0YVgKICAgICAgKTsKICAgICAgdGhpcy4kc2V0KAogICAgICAgIHRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbCwKICAgICAgICAieSIsCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLnkgLSBkZWx0YVkKICAgICAgKTsKICAgICAgdGhpcy51cGxvYWRWaXN0YUFjdHVhbCgpOwogICAgfSwKICAgIHBhblZpc3RhKGUpIHsKICAgICAgaWYgKCF0aGlzLnBhbm5pbmdWaXN0YSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmRlc3BsYXphclZpc3RhKAogICAgICAgIGUubW92ZW1lbnRYIC8gdGhpcy5mYWN0b3Jab29tLAogICAgICAgIGUubW92ZW1lbnRZIC8gdGhpcy5mYWN0b3Jab29tCiAgICAgICk7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy52aXN0YVBhbm5lZCA9IHRydWU7CiAgICB9LAogICAgY2xpY2tGb25kb0F0bGFzKCkgewogICAgICBpZiAoIXRoaXMudmlzdGFQYW5uZWQpIHsKICAgICAgICBpZiAoIXRoaXMuaWROb2RvUGFWZW50YW5pdGEpIHsKICAgICAgICAgIHRoaXMuaWROb2RvU2VsZWNjaW9uYWRvID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUgPT09ICJub2RvRW5WZW50YW5pdGEiKSB7CiAgICAgICAgICB0aGlzLmNlcnJhck5vZG9FblZlbnRhbml0YSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLmlkTm9kb01lbnVDeCA9IG51bGw7CgogICAgICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09PSAiYXRsYXNDb25MaXN0YSIpIHsKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogImF0bGFzU29saWRhcmlkYWQiIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLm1vc3RyYW5kb01lbnVDb250ZXh0dWFsID0gZmFsc2U7CgogICAgICB0aGlzLnBhbm5pbmdWaXN0YSA9IGZhbHNlOwogICAgICB0aGlzLnZpc3RhUGFubmVkID0gZmFsc2U7CiAgICB9LAogICAgbW92aW1pZW50b01vYmlsZShlKSB7CiAgICAgIGlmICh0aGlzLnBpbmNoaW5nKSB7CiAgICAgICAgdmFyIGNvbnRlbmVkb3IgPSB0aGlzLiRlbDsKICAgICAgICBsZXQgcG9zQ29udGVuZWRvciA9IGNvbnRlbmVkb3IuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICAgIGNvbnN0IHBvc1BpbmNoID0gewogICAgICAgICAgeDoKICAgICAgICAgICAgKGUudG91Y2hlc1swXS5wYWdlWCAtCiAgICAgICAgICAgICAgcG9zQ29udGVuZWRvci5sZWZ0ICsKICAgICAgICAgICAgICAoZS50b3VjaGVzWzFdLnBhZ2VYIC0gcG9zQ29udGVuZWRvci5sZWZ0KSkgLwogICAgICAgICAgICAyLAogICAgICAgICAgeToKICAgICAgICAgICAgKGUudG91Y2hlc1swXS5wYWdlWSAtCiAgICAgICAgICAgICAgcG9zQ29udGVuZWRvci50b3AgKwogICAgICAgICAgICAgIChlLnRvdWNoZXNbMV0ucGFnZVkgLSBwb3NDb250ZW5lZG9yLnRvcCkpIC8KICAgICAgICAgICAgMiwKICAgICAgICB9OyAvL1Bvc2ljacOzbiBlbiBwaXhlbGVzLgoKICAgICAgICBjb25zdCBjb29yZHNQaW5jaCA9IHsKICAgICAgICAgIHg6IE1hdGgucm91bmQoCiAgICAgICAgICAgIHBvc1BpbmNoLnggLyB0aGlzLmZhY3Rvclpvb20gKyB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueAogICAgICAgICAgKSwKICAgICAgICAgIHk6IE1hdGgucm91bmQoCiAgICAgICAgICAgIHBvc1BpbmNoLnkgLyB0aGlzLmZhY3Rvclpvb20gKyB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueQogICAgICAgICAgKSwKICAgICAgICB9OyAvL1Bvc2ljaW9uIGVuIHVuaWRhZGVzIGFic29sdXRhcyAoTGFzIHF1ZSB1c2EgZWwgYXRsYXMpCgogICAgICAgIHZhciBkaXN0ID0gTWF0aC5oeXBvdCgKICAgICAgICAgIGUudG91Y2hlc1swXS5wYWdlWCAtIGUudG91Y2hlc1sxXS5wYWdlWCwKICAgICAgICAgIGUudG91Y2hlc1swXS5wYWdlWSAtIGUudG91Y2hlc1sxXS5wYWdlWQogICAgICAgICk7CiAgICAgICAgdmFyIHBpbmNoID0gZGlzdCAtIHRoaXMubGFzdFBpbmNoRGlzdGFuY2U7CiAgICAgICAgcGluY2ggPSBwaW5jaCAqIDAuMzsKICAgICAgICB0aGlzLnpvb21WaXN0YShwaW5jaCwgY29vcmRzUGluY2gpOwogICAgICAgIHRoaXMubGFzdFBpbmNoRGlzdGFuY2UgPSBkaXN0OwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGRlbHRhWCA9IE1hdGgucm91bmQoCiAgICAgICAgKGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCAtIHRoaXMudWx0aW1vVG91Y2hYKSAvIHRoaXMuZmFjdG9yWm9vbQogICAgICApOwogICAgICBjb25zdCBkZWx0YVkgPSBNYXRoLnJvdW5kKAogICAgICAgIChlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFkgLSB0aGlzLnVsdGltb1RvdWNoWSkgLyB0aGlzLmZhY3Rvclpvb20KICAgICAgKTsKICAgICAgdGhpcy51bHRpbW9Ub3VjaFggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7CiAgICAgIHRoaXMudWx0aW1vVG91Y2hZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZOwoKICAgICAgdGhpcy5kZXNwbGF6YXJWaXN0YShkZWx0YVgsIGRlbHRhWSk7CiAgICB9LAogICAgaW5pY2lhTW92aW1pZW50b1RvdWNoKGUpIHsKICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDIpIHsKICAgICAgICB2YXIgZGlzdCA9IE1hdGguaHlwb3QoCiAgICAgICAgICBlLnRvdWNoZXNbMF0ucGFnZVggLSBlLnRvdWNoZXNbMV0ucGFnZVgsCiAgICAgICAgICBlLnRvdWNoZXNbMF0ucGFnZVkgLSBlLnRvdWNoZXNbMV0ucGFnZVkKICAgICAgICApOwogICAgICAgIHRoaXMubGFzdFBpbmNoRGlzdGFuY2UgPSBkaXN0OwogICAgICAgIHRoaXMucGluY2hpbmcgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy51bHRpbW9Ub3VjaFggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7CiAgICAgIHRoaXMudWx0aW1vVG91Y2hZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZOwogICAgfSwKICAgIGZpblRvdWNoKCkgewogICAgICB0aGlzLnBpbmNoaW5nID0gZmFsc2U7CiAgICB9LAogICAgem9vbVZpc3RhKGRlbHRhWm9vbSwgcG9zWm9vbSkgewogICAgICBjb25zdCB2aWVqb1pvb20gPSB0aGlzLnpvb207CiAgICAgIHZhciBudWV2b1pvb20gPSBNYXRoLnJvdW5kKHRoaXMuem9vbSArIGRlbHRhWm9vbSk7CiAgICAgIGlmIChudWV2b1pvb20gPCB0aGlzLm1pblpvb20pIHsKICAgICAgICB0aGlzLnpvb20gPSB0aGlzLm1pblpvb207CiAgICAgIH0gZWxzZSBpZiAobnVldm9ab29tID4gdGhpcy5tYXhab29tKSB7CiAgICAgICAgdGhpcy56b29tID0gdGhpcy5tYXhab29tOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuem9vbSA9IG51ZXZvWm9vbTsKICAgICAgfQoKICAgICAgLy9QYW4gdmlzdGEgZGUgYWN1ZXJkbyBjb24gbGEgcG9zaWNpw7NuIGRlbCBtb3VzZSByZXNwZWN0byBkZWwgYXRsYXMKICAgICAgY29uc3QgZGlzdGFuY2lhRXNxdWluYSA9IHsKICAgICAgICB4OiBwb3Nab29tLnggLSB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueCwKICAgICAgICB5OiBwb3Nab29tLnkgLSB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwueSwKICAgICAgfTsKICAgICAgY29uc3QgcHJvcG9yY2lvblpvb20gPSB2aWVqb1pvb20gLyB0aGlzLnpvb207CgogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLAogICAgICAgICJ4IiwKICAgICAgICBwb3Nab29tLnggLSBwcm9wb3JjaW9uWm9vbSAqIGRpc3RhbmNpYUVzcXVpbmEueAogICAgICApOwogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLAogICAgICAgICJ5IiwKICAgICAgICBwb3Nab29tLnkgLSBwcm9wb3JjaW9uWm9vbSAqIGRpc3RhbmNpYUVzcXVpbmEueQogICAgICApOwogICAgfSwKICAgIHpvb21XaGVlbChlKSB7CiAgICAgIGlmICghdGhpcy5ob3ZlcmVkIHx8ICFlLmN0cmxLZXkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgY29udGVuZWRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250ZW5lZG9yTm9kb3MiKTsKICAgICAgbGV0IHBvc0NvbnRlbmVkb3IgPSBjb250ZW5lZG9yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgY29uc3QgcG9zWm9vbSA9IHsKICAgICAgICB4OiBNYXRoLnJvdW5kKChlLmNsaWVudFggLSBwb3NDb250ZW5lZG9yLmxlZnQpIC8gdGhpcy5mYWN0b3Jab29tKSwKICAgICAgICB5OiBNYXRoLnJvdW5kKChlLmNsaWVudFkgLSBwb3NDb250ZW5lZG9yLnRvcCkgLyB0aGlzLmZhY3Rvclpvb20pLAogICAgICB9OwoKICAgICAgY29uc3QgZmFjdG9yWm9vbSA9IDAuMjsKICAgICAgdGhpcy56b29tVmlzdGEoLU1hdGgucm91bmQoZS5kZWx0YVkgKiBmYWN0b3Jab29tKSwgcG9zWm9vbSk7CgogICAgICAvLyBjb25zdCBwb3Nab29tPXsKICAgICAgLy8gICB4OiBNYXRoLnJvdW5kKChlLmNsaWVudFgtcG9zQ29udGVuZWRvci5sZWZ0KS90aGlzLmZhY3Rvclpvb20pK3RoaXMuZXNxdWluYVZpc3RhLngsCiAgICAgIC8vICAgeTogTWF0aC5yb3VuZCgoZS5jbGllbnRZLXBvc0NvbnRlbmVkb3IudG9wKS90aGlzLmZhY3Rvclpvb20pK3RoaXMuZXNxdWluYVZpc3RhLnkKICAgICAgLy8gfQoKICAgICAgLy8gY29uc3QgcHJvcG9yY2lvbmVzPXsKICAgICAgLy8gICB4OiAocG9zWm9vbS54LXRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbC54KS8ocG9zQ29udGVuZWRvci53aWR0aC90aGlzLmZhY3Rvclpvb20pLAogICAgICAvLyAgIHk6IChwb3Nab29tLnktdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLnkpLyhwb3NDb250ZW5lZG9yLmhlaWdodC90aGlzLmZhY3Rvclpvb20pLAogICAgICAvLyB9CgogICAgICAvLyBjb25zdCBmYWN0b3Jab29tPTAuMjsKICAgICAgLy8gdGhpcy56b29tVmlzdGEoLU1hdGgucm91bmQoZS5kZWx0YVkqZmFjdG9yWm9vbSksIHt4OnBvc1pvb20ueCwgeTogcG9zWm9vbS55fSk7CgogICAgICAvLyB0aGlzLiRzZXQodGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLCAieCIsIHBvc1pvb20ueC0oKHBvc0NvbnRlbmVkb3Iud2lkdGgvdGhpcy5mYWN0b3Jab29tKSpwcm9wb3JjaW9uZXMueCkgKTsKICAgICAgLy8gdGhpcy4kc2V0KHRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbCwgInkiLCBwb3Nab29tLnktKChwb3NDb250ZW5lZG9yLmhlaWdodC90aGlzLmZhY3Rvclpvb20pKnByb3BvcmNpb25lcy55KSApOwogICAgfSwKICAgIGVsaW1pbmFyTm9kb0NhY2hlKGlkTm9kbykgewogICAgICBjb25zb2xlLmxvZyhgRWxpbWluYW5kbyBub2RvIGRlIGNhY2jDqWApOwogICAgICBjb25zdCBpbmRleE49dGhpcy5ub2Rvc1NvbGlkYXJpZGFkLmZpbmQobj0+bi5pZD09PWlkTm9kbyk7CiAgICAgIGlmKGluZGV4Tj4tMSl7CiAgICAgICAgdGhpcy5ub2Rvc1NvbGlkYXJpZGFkLnNwbGljZShpbmRleE4sIDEpOwogICAgICB9CiAgICAgIGVsc2V7CiAgICAgICAgY29uc29sZS5sb2coYE5vZG8gbm8gZXN0YWJhIGVuIGxpc3RhYCk7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhck5vZG9Fbk1lbnVDb250ZXh0dWFsKHRpcG8pIHsKICAgICAgbGV0IHBvc0NvbnRlbmVkb3IgPSBkb2N1bWVudAogICAgICAgIC5nZXRFbGVtZW50QnlJZCgiY29udGVuZWRvck5vZG9zIikKICAgICAgICAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICB2YXIgcG9zaWNpb25OdWV2b05vZG8gPSB7CiAgICAgICAgeDogcGFyc2VJbnQoCiAgICAgICAgICAocGFyc2VJbnQodGhpcy5wb3NNZW51Q29udGV4dHVhbC54KSAtIHBvc0NvbnRlbmVkb3IubGVmdCkgLwogICAgICAgICAgICB0aGlzLmZhY3Rvclpvb20KICAgICAgICApLAogICAgICAgIHk6IHBhcnNlSW50KAogICAgICAgICAgKHBhcnNlSW50KHRoaXMucG9zTWVudUNvbnRleHR1YWwueSkgLSBwb3NDb250ZW5lZG9yLnRvcCkgLwogICAgICAgICAgICB0aGlzLmZhY3Rvclpvb20KICAgICAgICApLAogICAgICB9OwoKICAgICAgY29uc29sZS5sb2coYENyZWFuZG8gbnVldm8gbm9kbyBlbiAke0pTT04uc3RyaW5naWZ5KHBvc2ljaW9uTnVldm9Ob2RvKX1gKTsKICAgICAgdGhpcy5jcmVhck5vZG8ocG9zaWNpb25OdWV2b05vZG8sIHRpcG8pOwogICAgfSwKICAgIGNyZWFyTm9kbyhwb3NpY2lvbiwgdGlwb05vZG8pIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5pZCkgewogICAgICAgIGNvbnNvbGUubG9nKGBFcnJvciB1c3VhcmlvIG5vIGxvZ2VhZG9gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYGVudmlhbmRvIHVuYSBtdXRhY2nDs24gZGUgY3JlYXIgbm9kb2ApOwogICAgICB0aGlzLmVudmlhbmRvUXVlcnlOb2RvcyA9IHRydWU7CgogICAgICBsZXQgaW5mb05vZG8gPSB7CiAgICAgICAgY29vcmRzOiB7CiAgICAgICAgICB4OiBwb3NpY2lvbi54LAogICAgICAgICAgeTogcG9zaWNpb24ueSwKICAgICAgICB9LAogICAgICAgIHRpcG9Ob2RvLAogICAgICB9OwogICAgICBjb25zb2xlLmxvZyhgZW4gbGFzIGNvb3JkZW5hZGFzOiAke3Bvc2ljaW9uLnh9LCAke3Bvc2ljaW9uLnl9YCk7CiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5tdXRhdGUoewogICAgICAgICAgbXV0YXRpb246IGdxbGAKICAgICAgICAgICAgbXV0YXRpb24gKCRpbmZvTm9kbzogTm9kb1NvbGlkYXJpZGFkSW5wdXQhKSB7CiAgICAgICAgICAgICAgY3JlYXJOb2RvU29saWRhcmlkYWQoaW5mb05vZG86ICRpbmZvTm9kbykgewogICAgICAgICAgICAgICAgLi4uZnJhZ05vZG9Tb2xpZGFyaWRhZAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAke2ZyYWdtZW50b05vZG9Tb2xpZGFyaWRhZH0KICAgICAgICAgIGAsCiAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgaW5mb05vZG8sCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHsgZGF0YTogeyBjcmVhck5vZG9Tb2xpZGFyaWRhZCB9IH0pID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBDcmVhZG8gJHtjcmVhck5vZG9Tb2xpZGFyaWRhZC5pZH1gKTsKICAgICAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9OT0RPU19BVExBUywKICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgY2VudHJvOiB7CiAgICAgICAgICAgICAgICB4OiB0aGlzLmNlbnRyb0Rlc2NhcmdhLngsCiAgICAgICAgICAgICAgICB5OiB0aGlzLmNlbnRyb0Rlc2NhcmdhLnksCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICByYWRpbzogdGhpcy5yYWRpb0Rlc2NhcmdhLAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbnVldm9DYWNoZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTsKICAgICAgICAgIHZhciBsb3NOb2RvcyA9IG51ZXZvQ2FjaGUubm9kb3NTb2xpZGFyaWRhZEJ5SWQ7CiAgICAgICAgICBjb25zdCBpbmRleE4gPSBsb3NOb2Rvcy5maW5kSW5kZXgoCiAgICAgICAgICAgIChuKSA9PiBuLmlkID09PSBjcmVhck5vZG9Tb2xpZGFyaWRhZC5pZAogICAgICAgICAgKTsKICAgICAgICAgIGlmIChpbmRleE4gPiAtMSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgRWwgbm9kbyB5YSBlc3RhYmEgZW4gY2FjaMOpYCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb3NOb2Rvcy5wdXNoKGNyZWFyTm9kb1NvbGlkYXJpZGFkKTsKICAgICAgICAgICAgc3RvcmUud3JpdGVRdWVyeSh7CiAgICAgICAgICAgICAgcXVlcnk6IFFVRVJZX05PRE9TX0FUTEFTLAogICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgY2VudHJvOiB7CiAgICAgICAgICAgICAgICAgIHg6IHRoaXMuY2VudHJvRGVzY2FyZ2EueCwKICAgICAgICAgICAgICAgICAgeTogdGhpcy5jZW50cm9EZXNjYXJnYS55LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJhZGlvOiB0aGlzLnJhZGlvRGVzY2FyZ2EsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc2V0Tm9kb0VuVmVudGFuaXRhKGNyZWFyTm9kb1NvbGlkYXJpZGFkLmlkKTsKICAgICAgICAgIHRoaXMuZW52aWFuZG9RdWVyeU5vZG9zID0gZmFsc2U7CiAgICAgICAgICB0aGlzLm1vc3RyYW5kb01lbnVDb250ZXh0dWFsID0gZmFsc2U7CgogICAgICAgICAgLy90aGlzLiRyb3V0ZXIucHVzaCgiL25vZG9Db25vY2ltaWVudG8vIitjcmVhck5vZG9Tb2xpZGFyaWRhZC5pZCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aGlzLmVudmlhbmRvUXVlcnlOb2RvcyA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yLiBFOiAke2Vycm9yfWApOwogICAgICAgIH0pOwogICAgfSwKICAgIGNlbnRyYXJFbk5vZG8obikgewogICAgICB2YXIgY29udGVuZWRvciA9IHRoaXMuJGVsOwogICAgICBsZXQgcG9zQ29udGVuZWRvciA9IGNvbnRlbmVkb3IuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLAogICAgICAgICJ4IiwKICAgICAgICBuLmNvb3Jkcy54IC0gcG9zQ29udGVuZWRvci53aWR0aCAvICgyICogdGhpcy5mYWN0b3Jab29tKQogICAgICApOwogICAgICB0aGlzLiRzZXQoCiAgICAgICAgdGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLAogICAgICAgICJ5IiwKICAgICAgICBuLmNvb3Jkcy55IC0gcG9zQ29udGVuZWRvci5oZWlnaHQgLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgKTsKICAgICAgdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8gPSBuLmlkOwogICAgICAvL3RoaXMuY2VudHJvVmlzdGE9ZTsKICAgIH0sCiAgICBjZW50cmFyRW5Ob2RvQnlJZChpZE5vZG8pIHsKICAgICAgdmFyIGNvbnRlbmVkb3IgPSB0aGlzLiRlbDsKICAgICAgbGV0IHBvc0NvbnRlbmVkb3IgPSBjb250ZW5lZG9yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgY29uc3QgZWxOb2RvID0gdGhpcy50b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT09IGlkTm9kbyk7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmVzcXVpbmFWaXN0YURlY2ltYWwsCiAgICAgICAgIngiLAogICAgICAgIGVsTm9kby5jb29yZHMueCAtIHBvc0NvbnRlbmVkb3Iud2lkdGggLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgKTsKICAgICAgdGhpcy4kc2V0KAogICAgICAgIHRoaXMuZXNxdWluYVZpc3RhRGVjaW1hbCwKICAgICAgICAieSIsCiAgICAgICAgZWxOb2RvLmNvb3Jkcy55IC0gcG9zQ29udGVuZWRvci5oZWlnaHQgLyAoMiAqIHRoaXMuZmFjdG9yWm9vbSkKICAgICAgKTsKICAgICAgdGhpcy5pZE5vZG9TZWxlY2Npb25hZG8gPSBpZE5vZG87CgogICAgICAvL3RoaXMuY2VudHJvVmlzdGE9ZTsKICAgIH0sCgogICAgdXBsb2FkTm9kb3NEZXNwbGVnYWRvczogZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uICgkaWRzTm9kb3M6IFtJRCFdKSB7CiAgICAgICAgICAgICAgc2V0Tm9kb3NTb2xpZGFyaWRhZERlc3BsZWdhZG9zVXN1YXJpbyhpZHNOb2RvczogJGlkc05vZG9zKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGlkc05vZG9zOiB0aGlzLmlkc05vZG9zRGVzcGxlZ2Fkb3MsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4ge30pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiBFOiR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LCA1MDAwKSwKICAgIHJlZmV0Y2hDb29yZHNOb2RvczogZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZyhgSW5pY2lhbmRvIHJlZmV0Y2ggZGUgY29vcmRzYCk7CiAgICAgIHRoaXMucmVmZXRjaGluZ0Nvb3JkcyA9IHRydWU7CiAgICAgIHRoaXMuJGFwb2xsbwogICAgICAgIC5xdWVyeSh7CiAgICAgICAgICBxdWVyeTogZ3FsYAogICAgICAgICAgICBxdWVyeSAoJGlkc05vZG9zOiBbSUQhXSkgewogICAgICAgICAgICAgIG5vZG9zU29saWRhcmlkYWRCeUlkcyhpZHNOb2RvczogJGlkc05vZG9zKSB7CiAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgY29vcmRzIHsKICAgICAgICAgICAgICAgICAgeAogICAgICAgICAgICAgICAgICB5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGlkc05vZG9zOiB0aGlzLnRvZG9zTm9kb3MubWFwKChuKSA9PiBuLmlkKSwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgQ29vcmRzIHJlZmV0Y2hlZGApOwogICAgICAgICAgdGhpcy5yZWZldGNoaW5nQ29vcmRzID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyb3J9YCk7CiAgICAgICAgICB0aGlzLnJlZmV0Y2hpbmdDb29yZHMgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sIDIwMDApLAogICAgaGlkZU5vbWJyZU5vZG9FbWVyZ2VudGU6IGRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5zaG93aW5nTm9tYnJlTm9kb0VtZXJnZW50ZSA9IGZhbHNlOwogICAgfSwgNDAwMCksCiAgICBoaWRlWm9vbUluZm86IGRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5zaG93aW5nWm9vbUluZm8gPSBmYWxzZTsKICAgIH0sIDEwMDApLAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHBlcnNvbmFzUm9vdCgpewogICAgICBpZih0aGlzLm5vZG9Sb290Ll9fdHlwZW5hbWU9PT0nVXN1YXJpbycpewogICAgICAgIHJldHVybiBbdGhpcy5ub2RvUm9vdF0KICAgICAgfQogICAgICBlbHNlewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICB9LAogICAgbm9kb3NTb2xpZGFyaWRhZFJvb3QoKXsKICAgICAgaWYodGhpcy5ub2RvUm9vdC5fX3R5cGVuYW1lPT09J05vZG9Tb2xpZGFyaWRhZCcpewogICAgICAgIHJldHVybiBbdGhpcy5ub2RvUm9vdF0KICAgICAgfQogICAgICBlbHNlewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICB9LAogICAgbm9kb1lvKCkgewogICAgICBpZiAoIXRoaXMudXN1YXJpb0xvZ2VhZG8pIHJldHVybiBudWxsOwogICAgICByZXR1cm4gdGhpcy5wZXJzb25hcy5maW5kKChwKSA9PiBwLmlkID09PSB0aGlzLnVzdWFyaW8uaWQpOwogICAgfSwKICAgIGlkTm9kb1Jvb3QoKSB7CiAgICAgIHJldHVybiB0aGlzLnVzdWFyaW8gPyB0aGlzLnVzdWFyaW8uaWQgOiBudWxsOwogICAgfSwgICAgCiAgICBpZE5vZG9QYVZlbnRhbml0YSgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnBhcmFtcy5pZE52OwogICAgfSwKICAgIHJlZnJlc2hOb2RvVmVudGFuaXRhKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUucmVmcmVzaE5vZG9WZW50YW5pdGFBdGxhc1NvbGlkYXJpZGFkOwogICAgfSwKICAgIG9mZnNldE1lbnVDb250ZXh0dWFsKCkgewogICAgICByZXR1cm4gewogICAgICAgIHRvcDogdGhpcy5wb3NNZW51Q29udGV4dHVhbC55ICsgInB4IiwKICAgICAgICBsZWZ0OiB0aGlzLnBvc01lbnVDb250ZXh0dWFsLnggKyAicHgiLAogICAgICB9OwogICAgfSwKICAgIGZhY3Rvclpvb20oKSB7CiAgICAgIHJldHVybiBOdW1iZXIoKHRoaXMuem9vbSAvIDEwMCkudG9GaXhlZCgyKSk7CiAgICB9LAogICAgZXNxdWluYVZpc3RhKCkgewogICAgICByZXR1cm4gewogICAgICAgIHg6IE1hdGgucm91bmQodGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLngpLAogICAgICAgIHk6IE1hdGgucm91bmQodGhpcy5lc3F1aW5hVmlzdGFEZWNpbWFsLnkpLAogICAgICB9OwogICAgfSwKICAgIGNlbnRyb1Zpc3RhKCkgewogICAgICByZXR1cm4gewogICAgICAgIHg6IHRoaXMuZXNxdWluYVZpc3RhLnggKyB0aGlzLnNpemVBdGxhcy54IC8gdGhpcy5mYWN0b3Jab29tIC8gMiwKICAgICAgICB5OiB0aGlzLmVzcXVpbmFWaXN0YS55ICsgdGhpcy5zaXplQXRsYXMueSAvIHRoaXMuZmFjdG9yWm9vbSAvIDIsCiAgICAgIH07CiAgICB9LAogICAgcG9zQ29udGVuZWRvcmVzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGxlZnQ6IC0odGhpcy5lc3F1aW5hVmlzdGEueCAqIHRoaXMuZmFjdG9yWm9vbSkgKyAicHgiLAogICAgICAgIHRvcDogLSh0aGlzLmVzcXVpbmFWaXN0YS55ICogdGhpcy5mYWN0b3Jab29tKSArICJweCIsCiAgICAgIH07CiAgICB9LAogICAgcG9zQ3VhZHJvRGVzY2FyZ2EoKSB7CiAgICAgIGNvbnN0IHBvc3ggPQogICAgICAgIHRoaXMuY2VudHJvRGVzY2FyZ2EueCAtIHRoaXMucmFkaW9EZXNjYXJnYSAtIHRoaXMuZXNxdWluYVZpc3RhLng7CiAgICAgIGNvbnN0IHBvc3kgPQogICAgICAgIHRoaXMuY2VudHJvRGVzY2FyZ2EueSAtIHRoaXMucmFkaW9EZXNjYXJnYSAtIHRoaXMuZXNxdWluYVZpc3RhLnk7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGVmdDogcG9zeCAqIHRoaXMuZmFjdG9yWm9vbSArICJweCIsCiAgICAgICAgdG9wOiBwb3N5ICogdGhpcy5mYWN0b3Jab29tICsgInB4IiwKICAgICAgfTsKICAgIH0sCiAgICBub2RvRW5WZW50YW5pdGEoKSB7CiAgICAgIGlmICghdGhpcy5pZE5vZG9QYVZlbnRhbml0YSkgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLm5vZG9zU29saWRhcmlkYWQuZmluZCgobikgPT4gbi5pZCA9PSB0aGlzLmlkTm9kb1BhVmVudGFuaXRhKTsKICAgIH0sCiAgICBub2RvU2VsZWNjaW9uYWRvKCkgewogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zLmZpbmQoKG4pID0+IG4uaWQgPT09IHRoaXMuaWROb2RvU2VsZWNjaW9uYWRvKTsKICAgIH0sCiAgICAvLyBub2RvQ2VudHJhZG9BcmJvbCgpIHsKICAgIC8vICAgcmV0dXJuIHRoaXMubm9kb3NUb2Rvcy5maW5kKChuKSA9PiBuLmlkID09PSB0aGlzLmlkTm9kb0NlbnRyYWRvQXJib2wpOwogICAgLy8gfSwKICAgIHVzdWFyaW9BZG1pbmlzdHJhZG9yTm9kb1NlbGVjY2lvbmFkbygpIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5pZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIXRoaXMubm9kb1NlbGVjY2lvbmFkbykgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdGhpcy5ub2RvU2VsZWNjaW9uYWRvLmFkbWluaXN0cmFkb3Jlcy5pbmNsdWRlcyh0aGlzLnVzdWFyaW8uaWQpOwogICAgfSwKICAgIHVzdWFyaW9SZXNwb25zYWJsZU5vZG9TZWxlY2Npb25hZG8oKSB7CiAgICAgIGlmICghdGhpcy51c3VhcmlvIHx8ICF0aGlzLnVzdWFyaW8uaWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCF0aGlzLm5vZG9TZWxlY2Npb25hZG8pIHJldHVybiBmYWxzZTsKCiAgICAgIHJldHVybiB0aGlzLm5vZG9TZWxlY2Npb25hZG8ucmVzcG9uc2FibGVzLmluY2x1ZGVzKHRoaXMudXN1YXJpby5pZCk7CiAgICB9LAogICAgdXN1YXJpb1Jlc3BvbnNhYmxlQW1wbGlvTm9kb1NlbGVjY2lvbmFkbygpIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW9Mb2dlYWRvIHx8ICF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5pZCkKICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICBpZiAoIXRoaXMubm9kb1NlbGVjY2lvbmFkbykgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gKAogICAgICAgIHRoaXMubm9kb1NlbGVjY2lvbmFkby5yZXNwb25zYWJsZXNBbXBsaW8gJiYKICAgICAgICB0aGlzLm5vZG9TZWxlY2Npb25hZG8ucmVzcG9uc2FibGVzQW1wbGlvLmluY2x1ZGVzKHRoaXMudXN1YXJpby5pZCkKICAgICAgKTsKICAgIH0sCiAgICBub2Rvc1JlcXVpZXJlblNlbGVjY2lvbmFkbygpIHsKICAgICAgaWYgKCF0aGlzLmlkTm9kb1NlbGVjY2lvbmFkbykgcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zLmZpbHRlcigobikgPT4KICAgICAgICBuLnZpbmN1bG9zCiAgICAgICAgICAuZmlsdGVyKCh2KSA9PiB2LnRpcG8gPT0gInJlcXVpZXJlIikKICAgICAgICAgIC5tYXAoKHYpID0+IHYuaWRSZWYpCiAgICAgICAgICAuaW5jbHVkZXModGhpcy5pZE5vZG9TZWxlY2Npb25hZG8pCiAgICAgICk7CiAgICB9LAogICAgbm9kb3NSZXF1ZXJpZG9zU2VsZWNjaW9uYWRvKCkgewogICAgICByZXR1cm4gdGhpcy50b2Rvc05vZG9zLmZpbHRlcigobikgPT4KICAgICAgICB0aGlzLmlkc05vZG9zUmVxdWVyaWRvc1NlbGVjY2lvbmFkby5pbmNsdWRlcyhuLmlkKQogICAgICApOwogICAgfSwKICAgIGlkc05vZG9zQ2hpbGRyZW5TZWxlY2Npb25hZG8oKSB7CiAgICAgIGlmICghdGhpcy5ub2RvU2VsZWNjaW9uYWRvIHx8ICF0aGlzLmluZGljZU5vZG9zVW5kZXIpIHJldHVybiBbXTsKICAgICAgcmV0dXJuIHRoaXMuaW5kaWNlTm9kb3NVbmRlclt0aGlzLmlkTm9kb1NlbGVjY2lvbmFkb10ubm9kb3NDaGlsZHJlbi5tYXAoCiAgICAgICAgKG4pID0+IG4uaWQKICAgICAgKTsKICAgIH0sCiAgICBpZHNOb2Rvc1JlcXVpZXJlblNlbGVjY2lvbmFkbygpIHsKICAgICAgcmV0dXJuIHRoaXMubm9kb3NSZXF1aWVyZW5TZWxlY2Npb25hZG8ubWFwKChuKSA9PiBuLmlkKTsKICAgIH0sCiAgICBpZHNOb2Rvc1JlcXVlcmlkb3NTZWxlY2Npb25hZG8oKSB7CiAgICAgIGlmICghdGhpcy5ub2RvU2VsZWNjaW9uYWRvKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm5vZG9TZWxlY2Npb25hZG8udmluY3Vsb3MKICAgICAgICAuZmlsdGVyKCh2KSA9PiB2LnRpcG8gPT0gInJlcXVpZXJlIikKICAgICAgICAubWFwKCh2KSA9PiB2LmlkUmVmKTsKICAgIH0sCiAgICBpZHNOb2Rvc0Rlc3BsZWdhZG9zKCkgewogICAgICBpZiAoCiAgICAgICAgIXRoaXMueW8gfHwKICAgICAgICAhdGhpcy55by5hdGxhc1NvbGlkYXJpZGFkIHx8CiAgICAgICAgIXRoaXMueW8uYXRsYXNTb2xpZGFyaWRhZC5pZHNOb2Rvc0Rlc3BsZWdhZG9zCiAgICAgICkKICAgICAgICByZXR1cm4gW107CiAgICAgIHJldHVybiB0aGlzLnlvLmF0bGFzU29saWRhcmlkYWQuaWRzTm9kb3NEZXNwbGVnYWRvczsKICAgIH0sICAgCiAgICB0cmFiYWpvcygpIHsKICAgICAgcmV0dXJuIHRoaXMubm9kb3NTb2xpZGFyaWRhZC5maWx0ZXIoKG4pID0+IG4udGlwb05vZG8gPT09ICJ0cmFiYWpvIik7CiAgICB9LAogICAgb2JqZXRpdm9zKCkgewogICAgICByZXR1cm4gdGhpcy5ub2Rvc1NvbGlkYXJpZGFkLmZpbHRlcigobikgPT4gbi50aXBvTm9kbyA9PT0gIm9iamV0aXZvIik7CiAgICB9LAogICAgbm9kb3NDb25SZXF1ZXJpbWVudG9zKCkgewogICAgICB2YXIgbnIgPSB0aGlzLnRvZG9zTm9kb3MuZmlsdGVyKAogICAgICAgICAgKG4pID0+CiAgICAgICAgICAgIG4udmluY3Vsb3MuZmlsdGVyKCh2KSA9PiB2LnRpcG8gPT09ICJyZXF1aWVyZSIpLmxlbmd0aCA+IDAgfHwKICAgICAgICAgICAgKG4uX190eXBlbmFtZT09PSdOb2RvU29saWRhcmlkYWQnICYmIG4ucmVzcG9uc2FibGVzLmxlbmd0aCA+IDApCiAgICAgICAgKTsKCiAgICAgIHJldHVybiBucjsKICAgIH0sICAgICAgICAKICAgIGlkc05vZG9zU29saWRhcmlkYWRSZW5kZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLm5vZG9zU29saWRhcmlkYWRSZW5kZXIubWFwKChuKSA9PiBuLmlkKTsKICAgIH0sCiAgICBpZHNQZXJzb25hc1JlbmRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMucGVyc29uYXNSZW5kZXIubWFwKChuKSA9PiBuLmlkKTsKICAgIH0sCiAgICBpZHNUb2Rvc05vZG9zUmVuZGVyKCkgewogICAgICByZXR1cm4gdGhpcy5pZHNOb2Rvc1NvbGlkYXJpZGFkUmVuZGVyLmNvbmNhdCh0aGlzLmlkc1BlcnNvbmFzUmVuZGVyKTsKICAgIH0sCiAgICAKICB9LAogIHdhdGNoOiB7CiAgICBjZW50cm9WaXN0YShhY3R1YWwpIHsKICAgICAgY29uc3QgZGlzdGFuY2lhQ2VudHJvRGVzY2FyZ2EgPSBNYXRoLmh5cG90KAogICAgICAgIHRoaXMuY2VudHJvRGVzY2FyZ2EueCAtIGFjdHVhbC54LAogICAgICAgIHRoaXMuY2VudHJvRGVzY2FyZ2EueSAtIGFjdHVhbC55CiAgICAgICk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGBEaXN0YW5jaWEgY2VudHJvIGRlc2NhcmdhOiAke2Rpc3RhbmNpYUNlbnRyb0Rlc2NhcmdhfWApOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5yYWRpb0Rlc2NhcmdhIC0gZGlzdGFuY2lhQ2VudHJvRGVzY2FyZ2EgPAogICAgICAgIHRoaXMuc2l6ZUF0bGFzLmRpYWdvbmFsIC8gdGhpcy5mYWN0b3Jab29tIC8gMgogICAgICApIHsKICAgICAgICAvL0hvcmEgZGUgYWN0dWFsaXphciBub2RvcwogICAgICAgIHRoaXMucmFkaW9EZXNjYXJnYSA9IE1hdGguY2VpbCgKICAgICAgICAgIChNYXRoLm1heCh0aGlzLnNpemVBdGxhcy54LCB0aGlzLnNpemVBdGxhcy55KSAqIDIpIC8gdGhpcy5mYWN0b3Jab29tCiAgICAgICAgKTsKICAgICAgICB0aGlzLiRzZXQodGhpcy5jZW50cm9EZXNjYXJnYSwgIngiLCBNYXRoLnJvdW5kKHRoaXMuY2VudHJvVmlzdGEueCkpOwogICAgICAgIHRoaXMuJHNldCh0aGlzLmNlbnRyb0Rlc2NhcmdhLCAieSIsIE1hdGgucm91bmQodGhpcy5jZW50cm9WaXN0YS55KSk7CiAgICAgIH0KICAgIH0sCiAgICBpZE5vZG9TZWxlY2Npb25hZG8obnVldm8pIHsKICAgICAgaWYgKCFudWV2bykgewogICAgICAgIC8vIHRoaXMuY2VycmFyTm9kb0VuVmVudGFuaXRhKCk7CiAgICAgICAgdGhpcy5zaG93aW5nTm9tYnJlTm9kb0VtZXJnZW50ZSA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRoaXMuJHJlZnMubGlzdGFzLmRlc3BsZWdhckNhc2NhZGFIYWNpYU5vZG8obnVldm8pOwogICAgICAgIGlmICh0aGlzLnpvb20gPCA2NSkgewogICAgICAgICAgdGhpcy5zaG93aW5nTm9tYnJlTm9kb0VtZXJnZW50ZSA9IHRydWU7CiAgICAgICAgICB0aGlzLmhpZGVOb21icmVOb2RvRW1lcmdlbnRlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgem9vbSgpIHsKICAgICAgdGhpcy50cmFuc2ljaW9uYXJQb3NpY2lvbk5vZG9zID0gZmFsc2U7CiAgICAgIHRoaXMuc2hvd2luZ1pvb21JbmZvID0gdHJ1ZTsKICAgICAgdGhpcy5oaWRlWm9vbUluZm8oKTsKICAgIH0sCiAgICBpZHNOb2Rvc0Rlc3BsZWdhZG9zKCkgewogICAgICBpZiAodGhpcy51c3VhcmlvTG9nZWFkbykgewogICAgICAgIHRoaXMuc2V0Tm9kb3NSZW5kZXIoKTsKICAgICAgICB0aGlzLnVwbG9hZE5vZG9zRGVzcGxlZ2Fkb3MoKTsKICAgICAgfQogICAgfSwKICAgIHBlcnNvbmFzKCkgewogICAgICB0aGlzLnNldE5vZG9zUmVuZGVyKCk7CiAgICB9LAogICAgdG9kb3NOb2RvcygpIHsKICAgICAgdGhpcy5zZXROb2Rvc1JlbmRlcigpOwogICAgfSwKICAgIG1vc3RyYW5kb1BlcnNvbmFzKCkgewogICAgICB0aGlzLnNldE5vZG9zUmVuZGVyKCk7CiAgICB9LAogICAgaWRzVG9kb3NOb2Rvc1JlbmRlcigpIHsKICAgICAgY29uc3QgaWRzTnVldm9zUGVyc29uYXMgPSB0aGlzLmlkc1BlcnNvbmFzUmVuZGVyLmZpbHRlcigKICAgICAgICAoaWQpID0+ICF0aGlzLmluZm9Ob2Rvc0V2ZXJSZW5kZXJlZC5tYXAoKG5lcikgPT4gbmVyLmlkKS5pbmNsdWRlcyhpZCkKICAgICAgKTsKICAgICAgY29uc3QgaWRzTnVldm9zTm9kb3NTb2xpZGFyaWRhZCA9IHRoaXMuaWRzTm9kb3NTb2xpZGFyaWRhZFJlbmRlci5maWx0ZXIoCiAgICAgICAgKGlkKSA9PiAhdGhpcy5pbmZvTm9kb3NFdmVyUmVuZGVyZWQubWFwKChuZXIpID0+IG5lci5pZCkuaW5jbHVkZXMoaWQpCiAgICAgICk7CgogICAgICBjb25zdCBpbmZvUGVyc29uYXNOdWV2b3NSZW5kZXIgPSBpZHNOdWV2b3NQZXJzb25hcy5tYXAoKGlkcCkgPT4gewogICAgICAgIHJldHVybiB7IGlkOiBpZHAsIHRpcG86ICJ1c3VhcmlvIiB9OwogICAgICB9KTsKICAgICAgY29uc3QgaW5mb05vZG9zU29saWRhcmlkYWROdWV2b3NSZW5kZXIgPSBpZHNOdWV2b3NOb2Rvc1NvbGlkYXJpZGFkLm1hcCgKICAgICAgICAoaWRuKSA9PiB7CiAgICAgICAgICByZXR1cm4geyBpZDogaWRuLCB0aXBvOiAibm9kb1NvbGlkYXJpZGFkIiB9OwogICAgICAgIH0KICAgICAgKTsKCiAgICAgIHRoaXMuaW5mb05vZG9zRXZlclJlbmRlcmVkID0gdGhpcy5pbmZvTm9kb3NFdmVyUmVuZGVyZWQKICAgICAgICAuY29uY2F0KGluZm9QZXJzb25hc051ZXZvc1JlbmRlcikKICAgICAgICAuY29uY2F0KGluZm9Ob2Rvc1NvbGlkYXJpZGFkTnVldm9zUmVuZGVyKTsKICAgIH0sCiAgICAKICB9LAogIG1vdW50ZWQoKSB7CiAgICB2YXIgcG9zQXRsYXMgPSB0aGlzLiRlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIHRoaXMuJHNldCh0aGlzLnNpemVBdGxhcywgIngiLCBwb3NBdGxhcy53aWR0aCk7CiAgICB0aGlzLiRzZXQodGhpcy5zaXplQXRsYXMsICJ5IiwgcG9zQXRsYXMuaGVpZ2h0KTsKICAgIHRoaXMuJHNldCgKICAgICAgdGhpcy5zaXplQXRsYXMsCiAgICAgICJkaWFnb25hbCIsCiAgICAgIE1hdGguaHlwb3QodGhpcy5zaXplQXRsYXMueCwgdGhpcy5zaXplQXRsYXMueSkKICAgICk7CgogICAgdGhpcy5yYWRpb0Rlc2NhcmdhID0gTWF0aC5jZWlsKAogICAgICAoTWF0aC5tYXgodGhpcy5zaXplQXRsYXMueCwgdGhpcy5zaXplQXRsYXMueSkgKiAyKSAvIHRoaXMuZmFjdG9yWm9vbQogICAgKTsKICAgIHRoaXMubW9udGFkbyA9IHRydWU7CiAgICB0aGlzLiRlbC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAic21vb3RoIiB9KTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCB0aGlzLnpvb21XaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICB9LAogIHJlbW92ZWQoKSB7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2hlZWwiLCB0aGlzLnpvb21XaGVlbCk7CiAgfSwKICAvLyBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7CiAgLy8gICBjb25zb2xlLmxvZyhgSGFjaWE6ICR7dG99YCk7CiAgLy8gICBpZiAodGhpcy4kcmVmcy5saXN0YXMuYWJpZXJ0YSkgewogIC8vICAgICB0aGlzLiRyZWZzLmxpc3Rhcy5hYmllcnRhID0gZmFsc2U7CiAgLy8gICAgIHJldHVybiBuZXh0KGZhbHNlKTsKICAvLyAgIH0KICAvLyAgIGlmICh0aGlzLmlkTm9kb1BhVmVudGFuaXRhKSB7CiAgLy8gICAgIHRoaXMuaWROb2RvUGFWZW50YW5pdGEgPSBudWxsOwogIC8vICAgICByZXR1cm4gbmV4dChmYWxzZSk7CiAgLy8gICB9CiAgLy8gICBuZXh0KCk7CiAgLy8gfSwKfTsK"},{"version":3,"sources":["AtlasSolidaridad.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+OA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AtlasSolidaridad.vue","sourceRoot":"src/components/atlasSolidaridad","sourcesContent":["<template>\n  <div\n    class=\"atlasSolidaridad\"\n    @mousedown.left.exact.self.stop=\"panningVista = true\"\n    @mouseenter=\"hovered = true\"\n    @mouseleave=\"hovered = false\"\n    @click.right.self.exact.prevent=\"abrirMenuContextual\"\n    @mousemove=\"panVista\"\n    @mouseup.left=\"clickFondoAtlas\"\n    @touchmove.prevent.stop=\"movimientoMobile\"\n    @touchstart=\"iniciaMovimientoTouch\"\n    @touchend=\"finTouch\"\n  >    \n    <div\n      id=\"botonCallingPosiciones\"\n      v-if=\"usuarioSuperadministrador && usuario.username == 'juanMamian'\"\n      @click.stop=\"iniciarCallingPosiciones\"\n      :class=\"{ deshabilitado: callingPosiciones }\"\n      :style=\"[\n        { backgroundColor: callingPosiciones ? 'green' : 'transparent' },\n      ]\"\n    ></div>\n    <transition name=\"fadeOut\">\n      <div v-show=\"showingZoomInfo\" id=\"infoZoom\">x{{ factorZoom }}</div>\n    </transition>      \n    <div\n      id=\"menuContextual\"\n      v-if=\"usuario && usuario.id\"\n      v-show=\"mostrandoMenuContextual\"\n      :style=\"[offsetMenuContextual]\"\n      :class=\"{ deshabilitado: enviandoQueryNodos }\"\n    >\n      <div\n        class=\"botonMenuContextual\"\n        id=\"botonCrearObjetivo\"\n        v-show=\"usuarioSuperadministrador\"\n        @mouseup.left.stop=\"\"\n        @click.stop=\"crearNodoEnMenuContextual('objetivo')\"\n      >\n        Crear objetivo\n      </div>\n      <div\n        class=\"botonMenuContextual\"\n        id=\"botonCrearObjetivo\"\n        @click.stop=\"crearNodoEnMenuContextual('trabajo')\"\n        @mouseup.left.stop=\"\"\n        v-show=\"usuarioSuperadministrador\"\n      >\n        Crear trabajo\n      </div>\n    </div>\n\n    <div\n      id=\"centroVista\"\n      v-show=\"usuarioSuperadministrador && callingPosiciones\"\n    >\n      {{ centroVista.x + \", \" + centroVista.y }}\n    </div>\n\n    <div id=\"contenedorVinculosNodos\" :style=\"[posContenedores]\">\n      <enlaces-nodo\n        v-for=\"nodo of nodosConRequerimentos\"\n        :yo=\"yo\"\n        :key=\"nodo.id\"\n        :idNodoSeleccionado=\"idNodoSeleccionado\"\n        :esteNodo=\"nodo\"\n        :todosNodos=\"todosNodos\"\n        :factorZoom=\"factorZoom\"\n        :nodoSeleccionado=\"nodoSeleccionado\"\n        :redibujarEnlaces=\"redibujarEnlacesNodos\"\n        :idsTodosNodosRender=\"idsTodosNodosRender\"\n        :callingPosiciones=\"callingPosiciones\"\n        :transicionarPosicionNodos=\"transicionarPosicionNodos\"\n      />\n    </div>\n\n    <div id=\"contenedorNodos\" :style=\"[posContenedores]\">\n      <nodo-persona\n        v-for=\"persona of personasRender\"\n        :esNodoYo=\"nodoYo.id === persona.id\"\n        :key=\"persona.id\"\n        :esteNodo=\"persona\"\n        :idNodoSeleccionado=\"idNodoSeleccionado\"\n        :idsNodosNeedingFetchMore=\"idsNodosNeedingFetchMore\"\n        :nodoSeleccionado=\"nodoSeleccionado\"\n        :nodosUnder=\"indiceNodosUnder[persona.id]\"\n        :requeridoPorSeleccionado=\"\n          idsNodosRequeridosSeleccionado.includes(persona.id)\n        \"\n        :requiereAlSeleccionado=\"\n          idsNodosRequierenSeleccionado.includes(persona.id)\n        \"\n        :idsNodosDesplegados=\"idsNodosDesplegados\"\n        :menuCx=\"idNodoMenuCx && idNodoMenuCx === persona.id\"\n        :factorZoom=\"factorZoom\"\n        :callingPosiciones=\"callingPosiciones\"\n        :transparentoso=\"\n          idNodoSeleccionado &&\n          idNodoSeleccionado != persona.id &&\n          !nodoSeleccionado.responsables.includes(persona.id) &&\n          !idsNodosRequierenSeleccionado.includes(persona.id) &&\n          nodoSeleccionado &&\n          nodoSeleccionado.nodoParent != persona.id\n        \"\n        :todosNodos=\"todosNodos\"\n        :todasPersonas=\"personas\"\n        :transicionarPosicionNodos=\"transicionarPosicionNodos\"\n        @mouseup.native.stop=\"\"\n        @click.native=\"idNodoSeleccionado = persona.id\"\n        @click.native.right.exact.stop.prevent=\"idNodoMenuCx = persona.id\"\n        @nodoSolidaridadCreado=\"addNodoToNodosSolidaridad($event)\"\n\n      />\n      <transition-group name=\"fade\" tag=\"div\" v-if=\"indiceNodosUnder\">\n        <nodo\n          v-for=\"nodo of nodosSolidaridadRender\"\n          :key=\"nodo.id\"\n          :esteNodo=\"nodo\"\n          :nodoYo=\"nodoYo\"\n          :idNodoSeleccionado=\"idNodoSeleccionado\"\n          :idsNodosNeedingFetchMore=\"idsNodosNeedingFetchMore\"\n          :nodoParent=\"todosNodos.find((n) => n.id === nodo.nodoParent)\"\n          :nodoSeleccionado=\"nodoSeleccionado\"\n          :nodosUnder=\"indiceNodosUnder[nodo.id]\"\n          :requeridoPorSeleccionado=\"\n            idsNodosRequeridosSeleccionado.includes(nodo.id)\n          \"\n          :seleccionadoEsResponsable=\"\n            nodo.responsables.includes(idNodoSeleccionado)\n          \"\n          :requiereAlSeleccionado=\"\n            idsNodosRequierenSeleccionado.includes(nodo.id)\n          \"\n          :enVentanita=\"idNodoPaVentanita === nodo.id\"\n          :idsNodosDesplegados=\"idsNodosDesplegados\"\n          :menuCx=\"idNodoMenuCx && idNodoMenuCx == nodo.id\"\n          :factorZoom=\"factorZoom\"\n          :callingPosiciones=\"callingPosiciones\"\n          :usuarioAdministradorNodoSeleccionado=\"\n            usuarioAdministradorNodoSeleccionado\n          \"\n          :usuarioResponsableNodoSeleccionado=\"\n            usuarioResponsableNodoSeleccionado\n          \"\n          :usuarioResponsableAmplioNodoSeleccionado=\"\n            usuarioResponsableAmplioNodoSeleccionado\n          \"\n          :transparentoso=\"\n            idNodoSeleccionado &&\n            idNodoSeleccionado != nodo.id &&\n            !idsNodosRequeridosSeleccionado.includes(nodo.id) &&\n            !idsNodosRequierenSeleccionado.includes(nodo.id) &&\n            !nodo.responsables.includes(idNodoSeleccionado) &&\n            nodoSeleccionado &&\n            nodoSeleccionado.nodoParent != nodo.id\n          \"\n          :childSeleccionado=\"idsNodosChildrenSeleccionado.includes(nodo.id)\"\n          :todosNodos=\"todosNodos\"\n          :transicionarPosicionNodos=\"transicionarPosicionNodos\"\n          @meMovi=\"redibujarEnlacesNodos++\"\n          @mouseup.native.stop=\"\"\n          @click.native=\"idNodoSeleccionado = nodo.id\"\n          @click.native.right.exact.stop.prevent=\"idNodoMenuCx = nodo.id\"\n          @meAbrieron=\"setNodoEnVentanita(nodo.id)\"\n          @meElimine=\"eliminarNodoCache(nodo.id)\"\n          @nodoSolidaridadCreado=\"addNodoToNodosSolidaridad($event)\"\n\n        />\n      </transition-group>\n\n      <div\n        id=\"indicadorCentroDescarga\"\n        :style=\"[\n          {\n            left: centroDescarga.x * factorZoom + 'px',\n            top: centroDescarga.y * factorZoom + 'px',\n            width: 20 * factorZoom + 'px',\n            height: 20 * factorZoom + 'px',\n          },\n        ]\"\n        v-show=\"usuario.username == 'juanMamian'\"\n      ></div>\n      <div\n        id=\"indicadorCentroVista\"\n        :style=\"[\n          {\n            left: centroVista.x * factorZoom + 'px',\n            top: centroVista.y * factorZoom + 'px',\n            width: 20 * factorZoom + 'px',\n            height: 20 * factorZoom + 'px',\n          },\n        ]\"\n        v-show=\"usuario.username == 'juanMamian'\"\n      ></div>\n    </div>\n\n    <!-- <ventanita-nodo\n      v-if=\"idNodoPaVentanita && nodoEnVentanita && !callingPosiciones\"      \n      :key=\"nodoEnVentanita.id\"\n      :esteNodo=\"nodoEnVentanita\"      \n      @cerrarme=\"cerrarNodoEnVentanita()\"\n    /> -->\n\n    <router-view\n      v-if=\"idNodoPaVentanita && nodoEnVentanita && !callingPosiciones\"\n      :key=\"nodoEnVentanita.id\"\n      :esteNodo=\"nodoEnVentanita\"\n      @cerrarme=\"cerrarNodoEnVentanita()\"\n    />\n\n    <transition name=\"fadeOutLento\">\n      <div id=\"nombreNodoEmergente\" v-show=\"showingNombreNodoEmergente\">\n        {{ nodoSeleccionado ? nodoSeleccionado.nombre : \"\" }}\n      </div>\n    </transition>\n\n    <div id=\"panelConfiguracion\" @mouseup.stop=\"\">\n      <div\n        class=\"boton botonPanelConfiguracion\"\n        :class=\"{ activo: mostrandoPersonas }\"\n        :title=\"mostrandoPersonas ? 'Ocultar personas' : 'Mostrar personas'\"\n        @click.stop=\"mostrandoPersonas = !mostrandoPersonas\"\n      >\n        <img src=\"@/assets/iconos/user.svg\" alt=\"Usuarios\" />\n      </div>\n    </div>\n\n    <loading\n      id=\"loadingNodos\"\n      v-show=\"        \n        $apollo.queries.nodoRoot.loading        \n      \"\n      texto=\"Descargando informacin...\"\n      colorLetra=\"white\"\n    />\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\n\nimport Loading from \"../utilidades/Loading.vue\";\nimport Nodo from \"./Nodo.vue\";\nimport EnlacesNodo from \"./EnlacesNodo.vue\";\nimport debounce from \"debounce\";\nimport { fragmentoNodoSolidaridad, fragmentoPersonaAtlas } from \"./frags\";\nimport NodoPersona from \"./NodoPersona.vue\";\nimport { MixinAtlasSolidaridad } from \"./MixinAtlasSolidaridad\";\nimport { QUERY_DATOS_USUARIO_ATLAS_SOLIDARIDAD } from \"./ConfiguracionNodoSolidaridad\";\n// const QUERY_NODOS = gql`\n//   query ($nivel: Int!) {\n//     nodosSolidaridadById(nivel: $nivel) {\n//       ...fragNodoSolidaridad\n//     }\n//   }\n//   ${fragmentoNodoSolidaridad}\n// `;\n\nexport const QUERY_PERSONAS_ATLAS_SOLIDARIDAD = gql`\n  query ($idsUsuarios: [ID!]) {\n    usuariosByIds(idsUsuarios: $idsUsuarios) {\n      ...fragPersonaAtlas\n    }\n  }\n  ${fragmentoPersonaAtlas}\n`;\n\nexport const QUERY_NODOS_ATLAS = gql`\n  query {\n    nodosSolidaridadByIds {\n      ...fragNodoSolidaridad\n    }\n  }\n  ${fragmentoNodoSolidaridad}\n`;\n\nexport default {\n  components: {\n    Loading,\n    Nodo,\n    EnlacesNodo,\n    NodoPersona,\n  },\n  name: \"AtlasSolidaridad\",\n  apollo: {           \n    yo: {\n      query: QUERY_DATOS_USUARIO_ATLAS_SOLIDARIDAD,\n      update({ yo }) {\n        this.calcularEsquinaVista(yo.coords);\n        this.datosYoDescargados = true;\n        return yo;\n      },\n      skip() {\n        return !this.usuarioLogeado || !this.montado;\n      },\n      fetchPolicy: \"network-only\",\n    },\n    $subscribe:{\n      nodosAtlasPosicionados: {\n        query: gql`\n          subscription ($idAtlas: ID!) {\n            nodosAtlasPosicionados(idAtlas: $idAtlas)\n          }\n        `,\n        variables: {\n          idAtlas: \"61b3fe0280509360825b2634\", //Id del atlas de solidaridad.\n        },\n        result() {\n          console.log(\n            `Nodos del atlas han sido posicionados. Refetching coords`\n          );\n          this.refetchCoordsNodos();\n        },\n      },\n    }    \n  },\n  mixins: [MixinAtlasSolidaridad],\n  data() {\n    return {\n      tipoNodoRoot:'usuario',\n      montado: false,\n      personas: [],\n      descargasPersonas: 0,\n      nodosRenderRoot: [],\n      nodosSolidaridadRender: [],\n\n      personasRenderRoot: [],\n      personasRender: [],\n\n      mostrandoMenuContextual: false,\n      posMenuContextual: {\n        top: 0,\n        left: 0,\n      },\n\n      esquinaVistaDecimal: {\n        x: 0,\n        y: 0,\n      },\n      centroDescarga: {\n        x: 0,\n        y: 0,\n      },\n\n      radioDescarga: null,\n      sizeAtlas: {\n        x: 0,\n        y: 0,\n        diagonal: 0,\n      },\n      panningVista: false,\n      vistaPanned: false,\n      hovered: false,\n\n      idNodoSeleccionado: null,\n      idNodoMenuCx: null,\n      idNodoCentradoArbol: null,\n\n      zoom: 80,\n      minZoom: 20,\n      maxZoom: 120,\n      showingZoomInfo: false,\n      infoPosZoom: null,\n\n      pinching: false,\n      lastPinchDistance: 0,\n\n      // proyectos: [],\n      // trabajos: [],\n      // objetivos: [],\n\n      enviandoQueryNodos: false,\n      refetchingCoords: false,\n      transicionarPosicionNodos: true,\n\n      callingPosiciones: false,\n\n      redibujarEnlacesNodos: 0,\n\n      enviandoCoordsVistaUsuario: false,\n      esquinaVistaCalculada: false,\n\n      mostrandoPersonas: false,\n\n      showingNombreNodoEmergente: false,\n      vista: \"atlas\",\n    };\n  },\n  methods: {    \n    setNodosRender() {\n      if (!this.indiceNodosUnder || this.indiceNodosUnder.length < 1) return [];\n      console.log(`Setting nodos render`);      \n      var currentTodosNodos = {\n        nodosSolidaridad: this.nodosSolidaridadRoot,\n        personas: this.personasRoot,\n      };\n      var nodosSolidaridadRender=this.nodosSolidaridadRoot;\n      var personasRender=this.personasRoot;\n\n      var idsnodosSolidaridadRenderParcial = nodosSolidaridadRender.map((nr) => nr.id);\n      var idsPersonasRenderParcial = personasRender.map((p) => p.id);\n      var cuenta = 0;\n      do {\n        cuenta++;\n        if (cuenta > 1000) {\n          console.log(`OVERFLOW`);\n          break;\n        }\n        //nodosUnder\n        let nodosUnder = currentTodosNodos.nodosSolidaridad\n          .concat(currentTodosNodos.personas)\n          .filter((cr) => this.idsNodosDesplegados.includes(cr.id))\n          .reduce((acc, cn) => {\n            const requeridos = this.indiceNodosUnder[cn.id].nodosRequeridos;\n            return acc.concat(requeridos.filter(r=>!acc.map(v=>v.id).includes(r.id)));\n          }, []);\n        let nodosUnderNuevos = nodosUnder.filter(\n          (nu) => !idsnodosSolidaridadRenderParcial.includes(nu.id)\n        );\n\n        //PersonasUnder\n        let personasUnder = [];\n        let personasUnderNuevos = [];\n        if (this.mostrandoPersonas) {\n          personasUnder = currentTodosNodos.nodosSolidaridad\n            .filter((n) => this.idsNodosDesplegados.includes(n.id))\n            .reduce((acc, cn) => {\n              const responsables=this.indiceNodosUnder[cn.id].responsables;\n              return acc.concat(responsables.filter(r=>!acc.map(v=>v.id).includes(r.id)));\n            }, []);\n          personasUnderNuevos = personasUnder.filter(\n            (p) => !idsPersonasRenderParcial.includes(p.id)\n          );\n        }\n\n        nodosSolidaridadRender = nodosSolidaridadRender.concat(nodosUnderNuevos);\n        personasRender = personasRender.concat(personasUnderNuevos);\n\n        currentTodosNodos.nodosSolidaridad = nodosUnderNuevos;\n        currentTodosNodos.personas = personasUnderNuevos;\n\n        idsnodosSolidaridadRenderParcial = nodosSolidaridadRender.map((nr) => nr.id);\n        idsPersonasRenderParcial = personasRender.map((p) => p.id);\n      } while (\n        currentTodosNodos.nodosSolidaridad.length + currentTodosNodos.personas.length >\n        0\n      );\n\n      this.nodosSolidaridadRender = nodosSolidaridadRender;\n      this.personasRender = personasRender;\n    },\n    setNodoEnVentanita(idNodo) {\n      console.log(`Setting path to ${idNodo}`);\n      // var currentPath = this.$route.currentRoute.path;\n      // console.log(`Era: ${currentPath}`);\n      this.$router.push({ name: \"nodoEnVentanita\", params: { idNv: idNodo } });\n    },\n    cerrarNodoEnVentanita() {\n      console.log(`Cerrando nodo en ventanita`);\n      this.$router.push({ name: \"atlasSolidaridad\" });\n    },\n    iniciarCallingPosiciones() {\n      var ciclos = prompt(\"Cuantos ciclos?\");\n      if (isNaN(ciclos)) {\n        return;\n      }\n\n      ciclos = Math.round(ciclos);\n      if (ciclos < 1) {\n        return;\n      }\n      console.log(`Enviando reposicionamiento de ${ciclos} ciclos`);\n      this.callingPosiciones = true;\n\n      this.$apollo\n        .query({\n          query: gql`\n            query ($ciclos: Int!) {\n              posicionarNodosSolidaridadByFuerzas(ciclos: $ciclos)\n            }\n          `,\n          variables: {\n            ciclos,\n          },\n        })\n        .then(() => {\n          this.callingPosiciones = false;\n        })\n        .catch((error) => {\n          this.callingPosiciones = false;\n          console.log(`Error: ${error}`);\n        });\n    },\n    calcularEsquinaVista(centro) {\n      console.log(`Centrando en usuario`);\n      if (this.esquinaVistaCalculada) return;\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"x\",\n        Math.round(centro.x - this.sizeAtlas.x / (2 * this.factorZoom))\n      );\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"y\",\n        Math.round(centro.y - this.sizeAtlas.y / (2 * this.factorZoom))\n      );\n      this.esquinaVistaCalculada = true;\n    },\n    abrirMenuContextual(e) {\n      let posAtlas = this.$el.getBoundingClientRect();\n\n      let topClick = Math.round(e.pageY - posAtlas.top);\n      let leftClick = Math.round(e.pageX - posAtlas.left);\n\n      this.$set(this.posMenuContextual, \"y\", topClick);\n      this.$set(this.posMenuContextual, \"x\", leftClick);\n      this.mostrandoMenuContextual = true;\n    },\n    uploadVistaActual: debounce(function () {\n      this.enviandoCoordsVistaUsuario = true;\n      console.log(`Uploading vista de usuario`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($coords: CoordsInput!) {\n              setCoordsVistaAtlasSolidaridadUsuario(coords: $coords)\n            }\n          `,\n          variables: {\n            coords: {\n              x: Math.round(\n                this.esquinaVistaDecimal.x +\n                  this.sizeAtlas.x / (2 * this.factorZoom)\n              ),\n              y: Math.round(\n                this.esquinaVistaDecimal.y +\n                  this.sizeAtlas.y / (2 * this.factorZoom)\n              ),\n            },\n          },\n        })\n        .then(() => {\n          this.enviandoCoordsVistaUsuario = false;\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n          this.enviandoCoordsVistaUsuario = false;\n        });\n    }, 3000),\n    desplazarVista(deltaX, deltaY) {\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"x\",\n        this.esquinaVistaDecimal.x - deltaX\n      );\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"y\",\n        this.esquinaVistaDecimal.y - deltaY\n      );\n      this.uploadVistaActual();\n    },\n    panVista(e) {\n      if (!this.panningVista) {\n        return;\n      }\n      this.desplazarVista(\n        e.movementX / this.factorZoom,\n        e.movementY / this.factorZoom\n      );\n      e.preventDefault();\n      this.vistaPanned = true;\n    },\n    clickFondoAtlas() {\n      if (!this.vistaPanned) {\n        if (!this.idNodoPaVentanita) {\n          this.idNodoSeleccionado = null;\n        }\n        if (this.$route.name === \"nodoEnVentanita\") {\n          this.cerrarNodoEnVentanita();\n        }\n        this.idNodoMenuCx = null;\n\n        if (this.$route.name === \"atlasConLista\") {\n          this.$router.push({ name: \"atlasSolidaridad\" });\n        }\n      }\n      this.mostrandoMenuContextual = false;\n\n      this.panningVista = false;\n      this.vistaPanned = false;\n    },\n    movimientoMobile(e) {\n      if (this.pinching) {\n        var contenedor = this.$el;\n        let posContenedor = contenedor.getBoundingClientRect();\n\n        const posPinch = {\n          x:\n            (e.touches[0].pageX -\n              posContenedor.left +\n              (e.touches[1].pageX - posContenedor.left)) /\n            2,\n          y:\n            (e.touches[0].pageY -\n              posContenedor.top +\n              (e.touches[1].pageY - posContenedor.top)) /\n            2,\n        }; //Posicin en pixeles.\n\n        const coordsPinch = {\n          x: Math.round(\n            posPinch.x / this.factorZoom + this.esquinaVistaDecimal.x\n          ),\n          y: Math.round(\n            posPinch.y / this.factorZoom + this.esquinaVistaDecimal.y\n          ),\n        }; //Posicion en unidades absolutas (Las que usa el atlas)\n\n        var dist = Math.hypot(\n          e.touches[0].pageX - e.touches[1].pageX,\n          e.touches[0].pageY - e.touches[1].pageY\n        );\n        var pinch = dist - this.lastPinchDistance;\n        pinch = pinch * 0.3;\n        this.zoomVista(pinch, coordsPinch);\n        this.lastPinchDistance = dist;\n\n        return;\n      }\n\n      const deltaX = Math.round(\n        (e.changedTouches[0].clientX - this.ultimoTouchX) / this.factorZoom\n      );\n      const deltaY = Math.round(\n        (e.changedTouches[0].clientY - this.ultimoTouchY) / this.factorZoom\n      );\n      this.ultimoTouchX = e.changedTouches[0].clientX;\n      this.ultimoTouchY = e.changedTouches[0].clientY;\n\n      this.desplazarVista(deltaX, deltaY);\n    },\n    iniciaMovimientoTouch(e) {\n      if (e.touches.length === 2) {\n        var dist = Math.hypot(\n          e.touches[0].pageX - e.touches[1].pageX,\n          e.touches[0].pageY - e.touches[1].pageY\n        );\n        this.lastPinchDistance = dist;\n        this.pinching = true;\n        return;\n      }\n\n      this.ultimoTouchX = e.changedTouches[0].clientX;\n      this.ultimoTouchY = e.changedTouches[0].clientY;\n    },\n    finTouch() {\n      this.pinching = false;\n    },\n    zoomVista(deltaZoom, posZoom) {\n      const viejoZoom = this.zoom;\n      var nuevoZoom = Math.round(this.zoom + deltaZoom);\n      if (nuevoZoom < this.minZoom) {\n        this.zoom = this.minZoom;\n      } else if (nuevoZoom > this.maxZoom) {\n        this.zoom = this.maxZoom;\n      } else {\n        this.zoom = nuevoZoom;\n      }\n\n      //Pan vista de acuerdo con la posicin del mouse respecto del atlas\n      const distanciaEsquina = {\n        x: posZoom.x - this.esquinaVistaDecimal.x,\n        y: posZoom.y - this.esquinaVistaDecimal.y,\n      };\n      const proporcionZoom = viejoZoom / this.zoom;\n\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"x\",\n        posZoom.x - proporcionZoom * distanciaEsquina.x\n      );\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"y\",\n        posZoom.y - proporcionZoom * distanciaEsquina.y\n      );\n    },\n    zoomWheel(e) {\n      if (!this.hovered || !e.ctrlKey) {\n        return;\n      }\n      e.preventDefault();\n      var contenedor = document.getElementById(\"contenedorNodos\");\n      let posContenedor = contenedor.getBoundingClientRect();\n\n      const posZoom = {\n        x: Math.round((e.clientX - posContenedor.left) / this.factorZoom),\n        y: Math.round((e.clientY - posContenedor.top) / this.factorZoom),\n      };\n\n      const factorZoom = 0.2;\n      this.zoomVista(-Math.round(e.deltaY * factorZoom), posZoom);\n\n      // const posZoom={\n      //   x: Math.round((e.clientX-posContenedor.left)/this.factorZoom)+this.esquinaVista.x,\n      //   y: Math.round((e.clientY-posContenedor.top)/this.factorZoom)+this.esquinaVista.y\n      // }\n\n      // const proporciones={\n      //   x: (posZoom.x-this.esquinaVistaDecimal.x)/(posContenedor.width/this.factorZoom),\n      //   y: (posZoom.y-this.esquinaVistaDecimal.y)/(posContenedor.height/this.factorZoom),\n      // }\n\n      // const factorZoom=0.2;\n      // this.zoomVista(-Math.round(e.deltaY*factorZoom), {x:posZoom.x, y: posZoom.y});\n\n      // this.$set(this.esquinaVistaDecimal, \"x\", posZoom.x-((posContenedor.width/this.factorZoom)*proporciones.x) );\n      // this.$set(this.esquinaVistaDecimal, \"y\", posZoom.y-((posContenedor.height/this.factorZoom)*proporciones.y) );\n    },\n    eliminarNodoCache(idNodo) {\n      console.log(`Eliminando nodo de cach`);\n      const indexN=this.nodosSolidaridad.find(n=>n.id===idNodo);\n      if(indexN>-1){\n        this.nodosSolidaridad.splice(indexN, 1);\n      }\n      else{\n        console.log(`Nodo no estaba en lista`);\n      }\n    },\n    crearNodoEnMenuContextual(tipo) {\n      let posContenedor = document\n        .getElementById(\"contenedorNodos\")\n        .getBoundingClientRect();\n\n      var posicionNuevoNodo = {\n        x: parseInt(\n          (parseInt(this.posMenuContextual.x) - posContenedor.left) /\n            this.factorZoom\n        ),\n        y: parseInt(\n          (parseInt(this.posMenuContextual.y) - posContenedor.top) /\n            this.factorZoom\n        ),\n      };\n\n      console.log(`Creando nuevo nodo en ${JSON.stringify(posicionNuevoNodo)}`);\n      this.crearNodo(posicionNuevoNodo, tipo);\n    },\n    crearNodo(posicion, tipoNodo) {\n      if (!this.usuario || !this.usuario.id) {\n        console.log(`Error usuario no logeado`);\n        return;\n      }\n      console.log(`enviando una mutacin de crear nodo`);\n      this.enviandoQueryNodos = true;\n\n      let infoNodo = {\n        coords: {\n          x: posicion.x,\n          y: posicion.y,\n        },\n        tipoNodo,\n      };\n      console.log(`en las coordenadas: ${posicion.x}, ${posicion.y}`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($infoNodo: NodoSolidaridadInput!) {\n              crearNodoSolidaridad(infoNodo: $infoNodo) {\n                ...fragNodoSolidaridad\n              }\n            }\n            ${fragmentoNodoSolidaridad}\n          `,\n          variables: {\n            infoNodo,\n          },\n        })\n        .then(({ data: { crearNodoSolidaridad } }) => {\n          console.log(`Creado ${crearNodoSolidaridad.id}`);\n          const store = this.$apollo.provider.defaultClient;\n          const cache = store.readQuery({\n            query: QUERY_NODOS_ATLAS,\n            variables: {\n              centro: {\n                x: this.centroDescarga.x,\n                y: this.centroDescarga.y,\n              },\n              radio: this.radioDescarga,\n            },\n          });\n          var nuevoCache = JSON.parse(JSON.stringify(cache));\n          var losNodos = nuevoCache.nodosSolidaridadById;\n          const indexN = losNodos.findIndex(\n            (n) => n.id === crearNodoSolidaridad.id\n          );\n          if (indexN > -1) {\n            console.log(`El nodo ya estaba en cach`);\n          } else {\n            losNodos.push(crearNodoSolidaridad);\n            store.writeQuery({\n              query: QUERY_NODOS_ATLAS,\n              variables: {\n                centro: {\n                  x: this.centroDescarga.x,\n                  y: this.centroDescarga.y,\n                },\n                radio: this.radioDescarga,\n              },\n              data: nuevoCache,\n            });\n          }\n          this.setNodoEnVentanita(crearNodoSolidaridad.id);\n          this.enviandoQueryNodos = false;\n          this.mostrandoMenuContextual = false;\n\n          //this.$router.push(\"/nodoConocimiento/\"+crearNodoSolidaridad.id);\n        })\n        .catch((error) => {\n          this.enviandoQueryNodos = false;\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    centrarEnNodo(n) {\n      var contenedor = this.$el;\n      let posContenedor = contenedor.getBoundingClientRect();\n\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"x\",\n        n.coords.x - posContenedor.width / (2 * this.factorZoom)\n      );\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"y\",\n        n.coords.y - posContenedor.height / (2 * this.factorZoom)\n      );\n      this.idNodoSeleccionado = n.id;\n      //this.centroVista=e;\n    },\n    centrarEnNodoById(idNodo) {\n      var contenedor = this.$el;\n      let posContenedor = contenedor.getBoundingClientRect();\n\n      const elNodo = this.todosNodos.find((n) => n.id === idNodo);\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"x\",\n        elNodo.coords.x - posContenedor.width / (2 * this.factorZoom)\n      );\n      this.$set(\n        this.esquinaVistaDecimal,\n        \"y\",\n        elNodo.coords.y - posContenedor.height / (2 * this.factorZoom)\n      );\n      this.idNodoSeleccionado = idNodo;\n\n      //this.centroVista=e;\n    },\n\n    uploadNodosDesplegados: debounce(function () {\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation ($idsNodos: [ID!]) {\n              setNodosSolidaridadDesplegadosUsuario(idsNodos: $idsNodos)\n            }\n          `,\n          variables: {\n            idsNodos: this.idsNodosDesplegados,\n          },\n        })\n        .then(() => {})\n        .catch((error) => {\n          console.log(`Error: E:${error}`);\n        });\n    }, 5000),\n    refetchCoordsNodos: debounce(function () {\n      console.log(`Iniciando refetch de coords`);\n      this.refetchingCoords = true;\n      this.$apollo\n        .query({\n          query: gql`\n            query ($idsNodos: [ID!]) {\n              nodosSolidaridadByIds(idsNodos: $idsNodos) {\n                id\n                coords {\n                  x\n                  y\n                }\n              }\n            }\n          `,\n          variables: {\n            idsNodos: this.todosNodos.map((n) => n.id),\n          },\n        })\n        .then(() => {\n          console.log(`Coords refetched`);\n          this.refetchingCoords = false;\n        })\n        .catch((error) => {\n          console.log(`Error: ${error}`);\n          this.refetchingCoords = false;\n        });\n    }, 2000),\n    hideNombreNodoEmergente: debounce(function () {\n      this.showingNombreNodoEmergente = false;\n    }, 4000),\n    hideZoomInfo: debounce(function () {\n      this.showingZoomInfo = false;\n    }, 1000),\n  },\n  computed: {\n    personasRoot(){\n      if(this.nodoRoot.__typename==='Usuario'){\n        return [this.nodoRoot]\n      }\n      else{\n        return []\n      }\n    },\n    nodosSolidaridadRoot(){\n      if(this.nodoRoot.__typename==='NodoSolidaridad'){\n        return [this.nodoRoot]\n      }\n      else{\n        return []\n      }\n    },\n    nodoYo() {\n      if (!this.usuarioLogeado) return null;\n      return this.personas.find((p) => p.id === this.usuario.id);\n    },\n    idNodoRoot() {\n      return this.usuario ? this.usuario.id : null;\n    },    \n    idNodoPaVentanita() {\n      return this.$route.params.idNv;\n    },\n    refreshNodoVentanita() {\n      return this.$store.state.refreshNodoVentanitaAtlasSolidaridad;\n    },\n    offsetMenuContextual() {\n      return {\n        top: this.posMenuContextual.y + \"px\",\n        left: this.posMenuContextual.x + \"px\",\n      };\n    },\n    factorZoom() {\n      return Number((this.zoom / 100).toFixed(2));\n    },\n    esquinaVista() {\n      return {\n        x: Math.round(this.esquinaVistaDecimal.x),\n        y: Math.round(this.esquinaVistaDecimal.y),\n      };\n    },\n    centroVista() {\n      return {\n        x: this.esquinaVista.x + this.sizeAtlas.x / this.factorZoom / 2,\n        y: this.esquinaVista.y + this.sizeAtlas.y / this.factorZoom / 2,\n      };\n    },\n    posContenedores() {\n      return {\n        left: -(this.esquinaVista.x * this.factorZoom) + \"px\",\n        top: -(this.esquinaVista.y * this.factorZoom) + \"px\",\n      };\n    },\n    posCuadroDescarga() {\n      const posx =\n        this.centroDescarga.x - this.radioDescarga - this.esquinaVista.x;\n      const posy =\n        this.centroDescarga.y - this.radioDescarga - this.esquinaVista.y;\n      return {\n        left: posx * this.factorZoom + \"px\",\n        top: posy * this.factorZoom + \"px\",\n      };\n    },\n    nodoEnVentanita() {\n      if (!this.idNodoPaVentanita) return null;\n      return this.nodosSolidaridad.find((n) => n.id == this.idNodoPaVentanita);\n    },\n    nodoSeleccionado() {\n      return this.todosNodos.find((n) => n.id === this.idNodoSeleccionado);\n    },\n    // nodoCentradoArbol() {\n    //   return this.nodosTodos.find((n) => n.id === this.idNodoCentradoArbol);\n    // },\n    usuarioAdministradorNodoSeleccionado() {\n      if (!this.usuario || !this.usuario.id) return false;\n      if (!this.nodoSeleccionado) return false;\n      return this.nodoSeleccionado.administradores.includes(this.usuario.id);\n    },\n    usuarioResponsableNodoSeleccionado() {\n      if (!this.usuario || !this.usuario.id) return false;\n      if (!this.nodoSeleccionado) return false;\n\n      return this.nodoSeleccionado.responsables.includes(this.usuario.id);\n    },\n    usuarioResponsableAmplioNodoSeleccionado() {\n      if (!this.usuarioLogeado || !this.usuario || !this.usuario.id)\n        return false;\n\n      if (!this.nodoSeleccionado) return false;\n      return (\n        this.nodoSeleccionado.responsablesAmplio &&\n        this.nodoSeleccionado.responsablesAmplio.includes(this.usuario.id)\n      );\n    },\n    nodosRequierenSeleccionado() {\n      if (!this.idNodoSeleccionado) return [];\n      return this.todosNodos.filter((n) =>\n        n.vinculos\n          .filter((v) => v.tipo == \"requiere\")\n          .map((v) => v.idRef)\n          .includes(this.idNodoSeleccionado)\n      );\n    },\n    nodosRequeridosSeleccionado() {\n      return this.todosNodos.filter((n) =>\n        this.idsNodosRequeridosSeleccionado.includes(n.id)\n      );\n    },\n    idsNodosChildrenSeleccionado() {\n      if (!this.nodoSeleccionado || !this.indiceNodosUnder) return [];\n      return this.indiceNodosUnder[this.idNodoSeleccionado].nodosChildren.map(\n        (n) => n.id\n      );\n    },\n    idsNodosRequierenSeleccionado() {\n      return this.nodosRequierenSeleccionado.map((n) => n.id);\n    },\n    idsNodosRequeridosSeleccionado() {\n      if (!this.nodoSeleccionado) {\n        return [];\n      }\n      return this.nodoSeleccionado.vinculos\n        .filter((v) => v.tipo == \"requiere\")\n        .map((v) => v.idRef);\n    },\n    idsNodosDesplegados() {\n      if (\n        !this.yo ||\n        !this.yo.atlasSolidaridad ||\n        !this.yo.atlasSolidaridad.idsNodosDesplegados\n      )\n        return [];\n      return this.yo.atlasSolidaridad.idsNodosDesplegados;\n    },   \n    trabajos() {\n      return this.nodosSolidaridad.filter((n) => n.tipoNodo === \"trabajo\");\n    },\n    objetivos() {\n      return this.nodosSolidaridad.filter((n) => n.tipoNodo === \"objetivo\");\n    },\n    nodosConRequerimentos() {\n      var nr = this.todosNodos.filter(\n          (n) =>\n            n.vinculos.filter((v) => v.tipo === \"requiere\").length > 0 ||\n            (n.__typename==='NodoSolidaridad' && n.responsables.length > 0)\n        );\n\n      return nr;\n    },        \n    idsNodosSolidaridadRender() {\n      return this.nodosSolidaridadRender.map((n) => n.id);\n    },\n    idsPersonasRender() {\n      return this.personasRender.map((n) => n.id);\n    },\n    idsTodosNodosRender() {\n      return this.idsNodosSolidaridadRender.concat(this.idsPersonasRender);\n    },\n    \n  },\n  watch: {\n    centroVista(actual) {\n      const distanciaCentroDescarga = Math.hypot(\n        this.centroDescarga.x - actual.x,\n        this.centroDescarga.y - actual.y\n      );\n      // console.log(`Distancia centro descarga: ${distanciaCentroDescarga}`);\n      if (\n        this.radioDescarga - distanciaCentroDescarga <\n        this.sizeAtlas.diagonal / this.factorZoom / 2\n      ) {\n        //Hora de actualizar nodos\n        this.radioDescarga = Math.ceil(\n          (Math.max(this.sizeAtlas.x, this.sizeAtlas.y) * 2) / this.factorZoom\n        );\n        this.$set(this.centroDescarga, \"x\", Math.round(this.centroVista.x));\n        this.$set(this.centroDescarga, \"y\", Math.round(this.centroVista.y));\n      }\n    },\n    idNodoSeleccionado(nuevo) {\n      if (!nuevo) {\n        // this.cerrarNodoEnVentanita();\n        this.showingNombreNodoEmergente = false;\n      } else {\n        // this.$refs.listas.desplegarCascadaHaciaNodo(nuevo);\n        if (this.zoom < 65) {\n          this.showingNombreNodoEmergente = true;\n          this.hideNombreNodoEmergente();\n        }\n      }\n    },\n    zoom() {\n      this.transicionarPosicionNodos = false;\n      this.showingZoomInfo = true;\n      this.hideZoomInfo();\n    },\n    idsNodosDesplegados() {\n      if (this.usuarioLogeado) {\n        this.setNodosRender();\n        this.uploadNodosDesplegados();\n      }\n    },\n    personas() {\n      this.setNodosRender();\n    },\n    todosNodos() {\n      this.setNodosRender();\n    },\n    mostrandoPersonas() {\n      this.setNodosRender();\n    },\n    idsTodosNodosRender() {\n      const idsNuevosPersonas = this.idsPersonasRender.filter(\n        (id) => !this.infoNodosEverRendered.map((ner) => ner.id).includes(id)\n      );\n      const idsNuevosNodosSolidaridad = this.idsNodosSolidaridadRender.filter(\n        (id) => !this.infoNodosEverRendered.map((ner) => ner.id).includes(id)\n      );\n\n      const infoPersonasNuevosRender = idsNuevosPersonas.map((idp) => {\n        return { id: idp, tipo: \"usuario\" };\n      });\n      const infoNodosSolidaridadNuevosRender = idsNuevosNodosSolidaridad.map(\n        (idn) => {\n          return { id: idn, tipo: \"nodoSolidaridad\" };\n        }\n      );\n\n      this.infoNodosEverRendered = this.infoNodosEverRendered\n        .concat(infoPersonasNuevosRender)\n        .concat(infoNodosSolidaridadNuevosRender);\n    },\n    \n  },\n  mounted() {\n    var posAtlas = this.$el.getBoundingClientRect();\n    this.$set(this.sizeAtlas, \"x\", posAtlas.width);\n    this.$set(this.sizeAtlas, \"y\", posAtlas.height);\n    this.$set(\n      this.sizeAtlas,\n      \"diagonal\",\n      Math.hypot(this.sizeAtlas.x, this.sizeAtlas.y)\n    );\n\n    this.radioDescarga = Math.ceil(\n      (Math.max(this.sizeAtlas.x, this.sizeAtlas.y) * 2) / this.factorZoom\n    );\n    this.montado = true;\n    this.$el.scrollIntoView({ behavior: \"smooth\" });\n  },\n  created() {\n    window.addEventListener(\"wheel\", this.zoomWheel, { passive: false });\n  },\n  removed() {\n    window.removeEventListener(\"wheel\", this.zoomWheel);\n  },\n  // beforeRouteLeave(to, from, next) {\n  //   console.log(`Hacia: ${to}`);\n  //   if (this.$refs.listas.abierta) {\n  //     this.$refs.listas.abierta = false;\n  //     return next(false);\n  //   }\n  //   if (this.idNodoPaVentanita) {\n  //     this.idNodoPaVentanita = null;\n  //     return next(false);\n  //   }\n  //   next();\n  // },\n};\n</script>\n<style>\n:root {\n  --atlasFondo: #12263a;\n  --atlasVerde: #4d8b31;\n  --atlasAmarillo: #ffc800;\n  --atlasAzul: #69c7c7;\n  --atlasFondoNodo: #a9d1d1;\n  --atlasNaranja: #ef7229;\n  --atlasMorado: #ba2c73;\n  --atlasGris: #929292;\n  --atlasParent: #3066be;\n\n  --atlasFilterFondo: invert(10%) sepia(55%) saturate(1034%) hue-rotate(174deg)\n    brightness(91%) contrast(91%);\n  --atlasFilterVerde: invert(41%) sepia(84%) saturate(349%) hue-rotate(57deg)\n    brightness(95%) contrast(89%);\n  --atlasFilterAmarillo: invert(79%) sepia(32%) saturate(4772%) hue-rotate(3deg)\n    brightness(108%) contrast(105%);\n  --atlasFilterAzul: invert(73%) sepia(20%) saturate(732%) hue-rotate(131deg)\n    brightness(92%) contrast(98%);\n  --atlasFilterNaranja: invert(53%) sepia(29%) saturate(1745%)\n    hue-rotate(340deg) brightness(96%) contrast(95%);\n  --atlasFilterMorado: invert(27%) sepia(24%) saturate(4772%) hue-rotate(301deg)\n    brightness(92%) contrast(95%);\n  --atlasFilterGris: invert(61%) sepia(0%) saturate(1316%) hue-rotate(210deg)\n    brightness(97%) contrast(81%);\n  --filterBlanco: invert(100%) sepia(100%) saturate(0%) hue-rotate(130deg)\n    brightness(106%) contrast(102%);\n}\n</style>\n<style scoped>\n.atlasSolidaridad {\n  overflow: hidden;\n  position: relative;\n  background-color: #12263a;\n  height: 100vh;\n}\n#botonVistaLista {\n  position: absolute;\n  width: 24px;\n  height: 24px;\n  top: 22px;\n  left: 22px;\n  filter: var(--atlasFilterGris);\n  cursor: pointer;\n  z-index: 2;\n}\n#botonVistaLista:hover {\n  filter: var(--filterBlanco);\n}\n.ventanaLista {\n  position: absolute;\n  top: 0;\n  left: 0%;\n  transition: transform 0.6s;\n  box-shadow: 4px 4px 6px rgba(152, 143, 253, 0.25);\n  background-color: #a9d1d1;\n  width: min(1000px, 100%);\n}\n\n.nodoVistaLista #barraSuperior {\n  background-color: red;\n}\n#menuContextual {\n  position: absolute;\n  background-color: rgb(173, 173, 173);\n  z-index: 2;\n}\n.botonMenuContextual {\n  padding: 5px 10px;\n  cursor: pointer;\n}\n.botonMenuContextual:hover {\n  background-color: gray;\n}\n#contenedorNodos {\n  position: relative;\n  z-index: 1;\n}\n#contenedorVinculosNodos {\n  position: relative;\n}\n\n#canvasesatlasSolidaridad {\n  position: relative;\n}\n#centroVista {\n  width: 3px;\n  height: 3px;\n  border-radius: 50%;\n  background-color: orange;\n  transform: translate(-50%, -50%);\n  position: absolute;\n}\n\n#botonCallingPosiciones {\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  border: 1px solid black;\n  position: absolute;\n  top: 1%;\n  right: 1%;\n  cursor: pointer;\n  z-index: 100;\n}\n.ventanitaNodo {\n  width: min(400px, 90%);\n  position: absolute;\n  top: 15px;\n  left: 15px;\n  z-index: 60;\n}\n#loadingNodos {\n  position: absolute;\n  bottom: 50%;\n  left: 50%;\n  transform: translateX(-50%);\n}\n#indicadorCentroDescarga {\n  width: 50px;\n  height: 50px;\n  position: absolute;\n  background-color: red;\n  transform: translate(-50%, -50%);\n  border-radius: 50%;\n}\n#indicadorCentroVista {\n  width: 50px;\n  height: 50px;\n  position: absolute;\n  background-color: rgb(0, 60, 255);\n  transform: translate(-50%, -50%);\n  border-radius: 50%;\n}\n\n#infoZoom {\n  position: absolute;\n  top: 2%;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 10px;\n  display: inline-block;\n  font-weight: bold;\n  color: rgb(102, 102, 102);\n  z-index: 3;\n}\n\n#nombreNodoEmergente {\n  position: fixed;\n  bottom: 5px;\n  left: 50%;\n  transform: translateX(-50%);\n  border-radius: 10px;\n  border: 2px solid rgb(56, 128, 131);\n  background-color: rgb(185, 215, 216);\n  padding: 10px;\n  font-size: 20px;\n  z-index: 10;\n}\n#panelConfiguracion {\n  position: fixed;\n  bottom: 1vh;\n  right: 3vw;\n}\n\n.botonPanelConfiguracion {\n  height: 25px;\n  padding: 5px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px solid transparent;\n}\n.botonPanelConfiguracion.activo {\n  border-color: white;\n}\n.botonPanelConfiguracion img {\n  height: 100%;\n}\n.fadeOut-leave-to {\n  opacity: 0;\n}\n.fadeOut-leave-active {\n  transition: opacity 1s;\n}\n.fadeOut-leave {\n  opacity: 1;\n}\n\n.fadeOutLento-leave-to {\n  opacity: 0;\n}\n.fadeOutLento-leave-active {\n  transition: opacity 2s;\n}\n.fadeOutLento-leave {\n  opacity: 1;\n}\n\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.3s;\n}\n\n.fade-enter,\n.fade-leave-to {\n  opacity: 0;\n}\n</style>"]}]}