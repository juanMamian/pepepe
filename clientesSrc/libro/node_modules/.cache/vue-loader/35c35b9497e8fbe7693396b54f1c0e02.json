{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/LibrosPublicos.vue?vue&type=style&index=0&id=6aa0fe84&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/LibrosPublicos.vue","mtime":1620349802170},{"path":"/home/juan/webPj/pepepe/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNsaWJyb3NQdWJsaWNvcyB7CiAgcGFkZGluZzogMTBweDsKICBib3JkZXI6IDJweCBzb2xpZCBjYWRldGJsdWU7CiAgbWFyZ2luOiAxMHB4OwogIGJvcmRlci1yYWRpdXM6IDE1cHg7CiAgcGFkZGluZzogMTVweDsKICBmb250LXNpemU6IDIycHg7Cn0KCi5iQ29udHJvbFRvZG9zTGlicm9zIHsKICB3aWR0aDogNTBweDsKICBoZWlnaHQ6IDUwcHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGN1cnNvcjogcG9pbnRlcjsKICBtYXJnaW46IDVweCAxMHB4Owp9Ci5iQ29udHJvbFRvZG9zTGlicm9zOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjQxLCAxNTMsIDI0MSk7Cn0KCi5ibG9xdWVBdXRvciB7CiAgcGFkZGluZzogMjBweCAwcHg7CiAgbWFyZ2luOiAyMHB4IDBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEyOCwgMTI4LCAxMjgsIDAuNDA0KTsKICBib3JkZXItcmFkaXVzOiAyMHB4Owp9CgouaWNvbm9QZXJzb25hQXV0b25vbW8gewogIG1hcmdpbjogNXB4IDI1cHg7Cn0KCi5wb3J0YWRhTGlicm8gewogIHBhZGRpbmc6IDVweCAxMHB4OwogIGZvbnQtc2l6ZTogaW5oZXJpdDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgcGFkZGluZy1ib3R0b206IDIwcHg7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDIwMHB4IDFmciAyMDBweDsKICBncmlkLXRlbXBsYXRlLWFyZWFzOiAibm9tYnJlIC4uLiBjb250cm9sZXMiOwp9Ci5wb3J0YWRhTGlicm86aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMTI4LCAwLCAxMjgsIDAuMjMzKTsKfQouc2VsZWNjaW9uYWRvIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEyOCwgMCwgMTI4LCAwLjIzMyk7Cn0KCi5ub21icmVMaWJybyB7CiAgZ3JpZC1hcmVhOiBub21icmU7Cn0KCi5jb250cm9sZXNMaWJybyB7CiAgZ3JpZC1hcmVhOiBjb250cm9sZXM7CiAgdmlzaWJpbGl0eTogaGlkZGVuOwp9CgoucG9ydGFkYUxpYnJvOmhvdmVyID4gLmNvbnRyb2xlc0xpYnJvIHsKICB2aXNpYmlsaXR5OiB2aXNpYmxlOwp9Ci5jb250cm9sTGlicm8gewogIHdpZHRoOiAyOXB4OwogIAogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgbWFyZ2luOiAwcHggMTBweDsKfQouY29udHJvbExpYnJvOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiBncmF5Owp9Cg=="},{"version":3,"sources":["LibrosPublicos.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LibrosPublicos.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"librosPublicos\">\n    <h3 style=\"cursor: pointer\" @click=\"desplegado = !desplegado\">\n      Libros publicos\n    </h3>\n    <div id=\"controlesLibrosPublicos\"></div>\n\n    <div id=\"listaLibrosPublicos\" v-show=\"desplegado\">\n      <div\n        class=\"bloqueAutor\"\n        v-for=\"(listaLibros, idAutor) of librosPorAutor\"\n        :key=\"idAutor\"\n      >\n        <icono-persona-autonomo :idPersona=\"idAutor\" />\n        <br />\n        <br />\n        <br />\n        <div class=\"listaLibros\">\n          <div\n            class=\"portadaLibro\"\n            v-for=\"portada of listaLibros\"\n            :key=\"portada.id\"\n            @click=\"seleccionarLibro(portada.id)\"\n            :class=\"{ seleccionado: idLibroSeleccionado == portada.id }\"\n          >\n            <div class=\"nombreLibro\">\n              {{ portada.titulo }}\n            </div>\n            <div class=\"controlesLibro\">\n              <a :href=\"URLLibrosolo + '?id=' + portada.id\" target=\"_blank\">\n                <img\n                  src=\"@/assets/iconos/libroAbierto.png\"\n                  class=\"controlLibro\"\n                  alt=\"Libro\"\n                  title=\"Ver libro\"                  \n                />\n              </a>\n              <img\n                src=\"@/assets/iconos/delete.png\"\n                alt=\"Eliminar\"\n                title=\"Eliminar este libro\"\n                class=\"controlLibro\"\n                v-show=\"usuarioSuperadministrador\"\n                @click.stop=\"eliminarLibro(portada.id)\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport IconoPersonaAutonomo from \"./IconoPersonaAutonomo.vue\";\n\nconst QUERY_LIBROS_PUBLICOS = gql`\n  query {\n    librosPublicos {\n      id\n      titulo\n      idsEditores\n    }\n  }\n`;\n\nexport default {\n  components: { IconoPersonaAutonomo },\n  name: \"LibrosPublicos\",\n  apollo: {\n    librosPublicos: {\n      query: QUERY_LIBROS_PUBLICOS,\n      skip() {\n        return !this.usuarioLogeado;\n      },\n    },\n  },\n  props: {\n    idLibroSeleccionado: String,\n    URLLibrosolo: String,\n  },\n  data() {\n    return {\n      desplegado: false,\n    };\n  },\n  methods: {\n    seleccionarLibro(idLibro) {\n      this.$emit(\"libroSeleccionado\", idLibro);\n    },\n    removerLibroCache(idLibro) {\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_LIBROS_PUBLICOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      const indexL = nuevoCache.librosPublicos.findIndex((l) => l.id == idLibro);\n      if (indexL > -1) {\n        nuevoCache.librosPublicos.splice(indexL, 1);\n        store.writeQuery({\n          query: QUERY_LIBROS_PUBLICOS,\n          data: nuevoCache,\n        });\n      } else {\n        console.log(`Libro no estaba en caché`);\n      }\n    },\n    eliminarLibro(idLibro) {\n      if (!confirm(\"Eliminando un libro. ¿Continuar?\")) return;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!) {\n              eliminarLibro(idLibro: $idLibro)\n            }\n          `,\n          variables: {\n            idLibro,\n          },\n        })\n        .then(({ data: { eliminarLibro } }) => {\n          if (eliminarLibro) {\n            this.$emit(\"elimineUnLibro\", idLibro);\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n        });\n    },\n  },\n  computed: {\n    usuarioSuperadministrador() {\n      if (!this.usuario || !this.usuario.permisos) {\n        console.log(\n          `Datos insuficientes para decidir si usuario es súperadministrador`\n        );\n        return false;\n      }      \n      return this.usuario.permisos.includes(\"superadministrador\");\n    },\n    librosPorAutor() {\n      var objetoFinal = {};\n      if (!this.librosPublicos) {\n        return objetoFinal;\n      }\n      this.librosPublicos.forEach((libro) => {\n        let idAutor = libro.idsEditores[0];\n        if (!objetoFinal[idAutor]) {\n          objetoFinal[idAutor] = [libro];\n        } else {\n          objetoFinal[idAutor].push(libro);\n        }\n      });\n      return objetoFinal;\n    },\n  },\n};\n</script>\n\n<style scoped>\n#librosPublicos {\n  padding: 10px;\n  border: 2px solid cadetblue;\n  margin: 10px;\n  border-radius: 15px;\n  padding: 15px;\n  font-size: 22px;\n}\n\n.bControlTodosLibros {\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n  cursor: pointer;\n  margin: 5px 10px;\n}\n.bControlTodosLibros:hover {\n  background-color: rgb(241, 153, 241);\n}\n\n.bloqueAutor {\n  padding: 20px 0px;\n  margin: 20px 0px;\n  background-color: rgba(128, 128, 128, 0.404);\n  border-radius: 20px;\n}\n\n.iconoPersonaAutonomo {\n  margin: 5px 25px;\n}\n\n.portadaLibro {\n  padding: 5px 10px;\n  font-size: inherit;\n  cursor: pointer;\n  padding-bottom: 20px;\n  display: grid;\n  grid-template-columns: 200px 1fr 200px;\n  grid-template-areas: \"nombre ... controles\";\n}\n.portadaLibro:hover {\n  background-color: rgba(128, 0, 128, 0.233);\n}\n.seleccionado {\n  background-color: rgba(128, 0, 128, 0.233);\n}\n\n.nombreLibro {\n  grid-area: nombre;\n}\n\n.controlesLibro {\n  grid-area: controles;\n  visibility: hidden;\n}\n\n.portadaLibro:hover > .controlesLibro {\n  visibility: visible;\n}\n.controlLibro {\n  width: 29px;\n  \n  border-radius: 50%;\n  cursor: pointer;\n  margin: 0px 10px;\n}\n.controlLibro:hover {\n  background-color: gray;\n}\n</style>"]}]}