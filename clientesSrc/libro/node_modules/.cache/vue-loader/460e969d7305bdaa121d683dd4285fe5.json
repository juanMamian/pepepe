{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/CuadroImagen.vue?vue&type=style&index=0&id=fb161856&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/CuadroImagen.vue","mtime":1617741478928},{"path":"/home/juan/webPj/pepepe/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY3VhZHJvSW1hZ2VuIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm9yZGVyLXdpZHRoOiAxcHg7CiAgYm9yZGVyLXN0eWxlOiBzb2xpZDsKfQouY3VhZHJvSW1hZ2VuOm5vdCguZW5QYWdpbmFTZWxlY2Npb25hZGEpIHsKICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50Owp9Ci5lblBhZ2luYVNlbGVjY2lvbmFkYSB7CiAgYm9yZGVyLWNvbG9yOiBwdXJwbGU7Cn0KLmltYWdlbkNvbnRlbmlkbyB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwp9CiNyZXNpemVIYW5kbGUgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDEwMCU7CiAgbGVmdDogMTAwJTsKCiAgYm9yZGVyLXJhZGl1czogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwoKICBjdXJzb3I6IHBvaW50ZXI7CiAgYm9yZGVyOiAxcHggc29saWQgcHVycGxlOwp9CiNib2xpdGFSZXNpemVIYW5kbGUgewogIHdpZHRoOiAxMHB4OwogIGhlaWdodDogMTBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogNTAlOwogIGxlZnQ6IDUwJTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICBiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjsKfQoKI2RyYWdIYW5kbGUgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IC0yMHB4OwogIGxlZnQ6IDUwJTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJvcmRlcjogMXB4IHNvbGlkIHB1cnBsZTsKfQojYm9saXRhRHJhZ0hhbmRsZSB7CiAgd2lkdGg6IDIwcHg7CiAgaGVpZ2h0OiAyMHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiA1MCU7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogIGJhY2tncm91bmQtY29sb3I6IGdyZWVuOwogIHRleHQtYWxpZ246IGNlbnRlcjsKfQouY29uQXVkaW8gewogIGN1cnNvcjogcG9pbnRlcjsKfQoKI2JFbGltaW5hckN1YWRyb0ltYWdlbiB7CiAgd2lkdGg6IDMwcHg7CiAgaGVpZ2h0OiAzMHB4OwogIHBhZGRpbmc6IDVweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMTI4LCAwLCAxMjgsIDAuMjEyKTsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAtNDBweDsKICByaWdodDogLTM1cHg7Cn0KI2JFbGltaW5hckN1YWRyb0ltYWdlbjpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgxMjgsIDAsIDEyOCwgMC42MzcpOwp9CgojekhhbmRsZXJzewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6LTMzcHg7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEwNCwgNywgMTA0LCAwLjUzNCk7CiAgYm9yZGVyLXJhZGl1czogMTNweDsKICBwYWRkaW5nOiA1cHggMTBweDsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMTZweCAzMHB4IDE2cHg7Cn0KCi56SGFuZGxlcnsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgd2lkdGg6IDE1cHg7CiAgaGVpZ2h0OiAxNXB4OwogIGN1cnNvcjogcG9pbnRlcjsgICAgCn0KI2JTZW5kQmFja3sKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDgsIDgzLCA4LCAwLjM3Nyk7CiAgZ3JpZC1jb2x1bW46IDEvMjsKfQojYlNlbmRCYWNrOmhvdmVyewogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoOCwgODMsIDgsIDAuNjEpOyAKfQojYkJyaW5nRnJvbnR7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDgsIDgzLCA4KTsKICBncmlkLWNvbHVtbjogMy80Owp9CiNiQnJpbmdGcm9udDpob3ZlcnsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNCwgNTYsIDQpOwoKfQo="},{"version":3,"sources":["CuadroImagen.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"CuadroImagen.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"cuadroImagen\"\n    :style=\"[estiloLayout]\"\n    @click=\"playAudio\"\n    :class=\"{\n      conAudio: esteCuadroImagen.audio,\n      deshabilitado: updatingInfo,\n      enPaginaSeleccionada: paginaSeleccionada,\n    }\"\n  >\n    <img\n      :src=\"urlImagen + '?v=' + versionImagen\"\n      alt=\"ilustracion\"\n      class=\"imagenContenido\"\n    />\n\n    <div id=\"zHandlers\">\n      <div class=\"zHandler\" id=\"bSendBack\" title=\"Mover hacia atrás\" @click=\"posicionZeta=posicionZeta>0?posicionZeta-1:0\"></div>\n      <div class=\"zHandler\" id=\"bBringFront\" title=\"Mover hacia adelante\" @click=\"posicionZeta++\"></div>\n    </div>\n\n    <div\n      id=\"dragHandle\"\n      v-show=\"seleccionado\"\n      :style=\"sizeDragHandle\"\n      @mousedown.left.stop=\"iniciarDrag\"\n      @mousemove=\"drag\"\n      @mouseup=\"finDrag\"\n    >\n      <div id=\"bolitaDragHandle\">{{esteCuadroImagen.posicionZeta}}</div>\n    </div>\n\n    <div\n      id=\"resizeHandle\"\n      :style=\"[sizeResizeHandle]\"\n      v-show=\"seleccionado\"\n      @mousedown.left=\"iniciarResize\"\n      @mousemove=\"resize\"\n      @mouseup=\"finResize\"\n    >\n      <div id=\"bolitaResizeHandle\"></div>\n    </div>\n\n    <img\n      src=\"@/assets/iconos/delete.png\"\n      alt=\"Eliminar\"\n      title=\"Eliminar cuadro de imagen\"\n      id=\"bEliminarCuadroImagen\"\n      v-show=\"seleccionado\"\n      @click=\"eliminarse\"\n    />\n\n    <input\n      type=\"file\"\n      id=\"inputArchivoImagen\"\n      style=\"display: none\"\n      ref=\"inputArchivoImagen\"\n      @change=\"uploadArchivoCuadroImagen\"\n    />\n\n    <audio type=\"audio/ogg\" v-if=\"esteCuadroImagen.audio\" ref=\"audio\">\n      <source :src=\"urlAudio\" type=\"audio/ogg\" />\n    </audio>\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport axios from \"axios\";\nexport default {\n  name: \"cuadroImagen\",\n  props: {\n    esteCuadroImagen: Object,\n    idLibro: String,\n    idPagina: String,\n    sizePagina: Object,\n    seleccionado: Boolean,\n    archivoCuadroImagenPagina: Object,\n    paginaSeleccionada: Boolean,\n    zBase:Number,\n  },\n  data() {\n    return {\n      posicionZeta:0,\n      resizing: false,\n      dragging: false,\n      posicion: {\n        x: null,\n        y: null,\n      },\n      size: {\n        x: null,\n        y: null,\n      },\n      updatingInfo: false,\n      versionImagen: 0,\n    };\n  },\n  computed: {\n    estiloLayout() {\n      return {\n        top: this.posicion.y + \"%\",\n        left: this.posicion.x + \"%\",\n\n        width: this.size.x + \"%\",\n        height: this.size.y + \"%\",\n\n        zIndex:this.seleccionado?this.zBase+this.posicionZeta+100:this.zBase+this.posicionZeta,\n\n      };\n    },\n    urlImagen() {\n      return (\n        this.serverUrl +\n        \"/apiCuentos/imagenCuento/\" +\n        this.idLibro +\n        \"/\" +\n        this.idPagina +\n        \"/\" +\n        this.esteCuadroImagen.id\n      );\n    },\n    sizeResizeHandle() {\n      return {\n        width: this.resizing ? 200 + \"px\" : 10 + \"px\",\n        height: this.resizing ? 200 + \"px\" : 10 + \"px\",\n      };\n    },\n    sizeDragHandle() {\n      return {\n        width: this.dragging ? 200 + \"px\" : 10 + \"px\",\n        height: this.dragging ? 200 + \"px\" : 10 + \"px\",\n      };\n    },\n    urlAudio() {\n      return (\n        this.serverUrl +\n        \"/apiCuentos/audioImagen/\" +\n        this.idLibro +\n        \"/\" +\n        this.idPagina +\n        \"/\" +\n        this.esteCuadroImagen.id\n      );\n    },\n  },\n  methods: {\n    playAudio() {\n      if (!this.esteCuadroImagen.audio) return;\n      this.$refs.audio.play();\n    },\n    iniciarResize() {\n      this.resizing = true;\n    },\n    resize(e) {\n      if (this.resizing) {\n        var cuadroPos = {\n          x: this.$el.getBoundingClientRect().left,\n          y: this.$el.getBoundingClientRect().top,\n        };\n\n        const nuevox = e.clientX - cuadroPos.x - 5;\n        const nuevoy = e.clientY - cuadroPos.y - 5;\n\n        var nuevoxP = Math.floor((nuevox * 100) / this.sizePagina.x);\n        var nuevoyP = Math.floor((nuevoy * 100) / this.sizePagina.y);\n\n        if (this.posicion.x + nuevoxP > 100)\n          nuevoxP = Math.floor(100 - this.posicion.x);\n        if (this.posicion.y + nuevoyP > 100)\n          nuevoyP = Math.floor(100 - this.posicion.y);\n\n        this.$set(this.size, \"x\", nuevoxP);\n        this.$set(this.size, \"y\", nuevoyP);\n      }\n    },\n    finResize() {\n      this.resizing = false;\n\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation(\n            $idLibro: ID!\n            $idPagina: ID!\n            $idCuadroImagen: ID!\n            $nuevoSize: CoordsInput!\n          ) {\n            updateSizeCuadroImagen(\n              idLibro: $idLibro\n              idPagina: $idPagina\n              idCuadroImagen: $idCuadroImagen\n              nuevoSize: $nuevoSize\n            ) {\n              id\n              size {\n                x\n                y\n              }\n            }\n          }\n        `,\n        variables: {\n          idLibro: this.idLibro,\n          idPagina: this.idPagina,\n          idCuadroImagen: this.esteCuadroImagen.id,\n          nuevoSize: this.size,\n        },\n      });\n    },\n\n    iniciarDrag() {\n      this.dragging = true;\n    },\n    drag(e) {\n      if (this.dragging) {\n        console.log(`Dragging`);\n        const elemPagina = this.$el.closest(\".pagina\");\n        const posPagina = elemPagina.getBoundingClientRect();\n        var posMouse = {\n          x: e.clientX - posPagina.left,\n          y: e.clientY - posPagina.top,\n        };\n        var nuevaPos = {\n          x: posMouse.x - this.$el.offsetWidth / 2,\n          y: posMouse.y + 20,\n        };\n\n        if (nuevaPos.x + this.$el.offsetWidth > elemPagina.offsetWidth) {\n          nuevaPos.x = elemPagina.offsetWidth - this.$el.offsetWidth;\n        }\n        if (nuevaPos.x < 0) {\n          nuevaPos.x = 0;\n        }\n\n        if (nuevaPos.y + this.$el.offsetHeight > elemPagina.offsetHeight) {\n          nuevaPos.y = elemPagina.offsetHeight - this.$el.offsetHeight;\n        }\n        if (nuevaPos.y < 0) {\n          nuevaPos.y = 0;\n        }\n\n        var nuevaPosP = {\n          x: Math.round((nuevaPos.x * 100) / elemPagina.offsetWidth),\n          y: Math.round((nuevaPos.y * 100) / elemPagina.offsetHeight),\n        };\n\n        this.posicion = nuevaPosP;\n      }\n    },\n    finDrag() {\n      this.dragging = false;\n      this.$apollo.mutate({\n        mutation: gql`\n          mutation(\n            $idLibro: ID!\n            $idPagina: ID!\n            $idCuadroImagen: ID!\n            $nuevoPosicion: CoordsInput!\n          ) {\n            updatePosicionCuadroImagen(\n              idLibro: $idLibro\n              idPagina: $idPagina\n              idCuadroImagen: $idCuadroImagen\n              nuevoPosicion: $nuevoPosicion\n            ) {\n              id\n              posicion {\n                x\n                y\n              }\n            }\n          }\n        `,\n        variables: {\n          idLibro: this.idLibro,\n          idPagina: this.idPagina,\n          idCuadroImagen: this.esteCuadroImagen.id,\n          nuevoPosicion: this.posicion,\n        },\n      });\n    },\n\n    uploadArchivoCuadroImagen() {\n      var datos = new FormData();\n      if (!this.$refs.inputArchivoImagen.value) {\n        console.log(`No había archivo seleccionado`);\n        return;\n      }\n      datos.append(\"idLibro\", this.idLibro);\n      datos.append(\"idPagina\", this.idPagina);\n      datos.append(\"idCuadroImagen\", this.esteCuadroImagen.id);\n      datos.append(\"imagen\", this.$refs.inputArchivoImagen.files[0]);\n\n      axios({\n        method: \"post\",\n        url: this.serverUrl + \"/apiCuentos/subirArchivoCuadroImagen\",\n        data: datos,\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: \"Bearer \" + this.$store.state.token,\n        },\n      })\n        .then(({ res }) => {\n          console.log(`Resultado de upload archivo: ${res}`);\n          this.versionImagen++;\n        })\n        .catch((error) => {\n          console.log(`Error uploading archivo de cuadroImagen. E: ${error}`);\n        });\n    },\n\n    eliminarse() {\n      if (\n        !confirm(\n          \"Eliminando cuadro de imagen. Esta operación no se puede deshacer. ¿Continuar?\"\n        )\n      ) {\n        return;\n      }\n      this.updatingInfo = true;\n      console.log(`Eliminando un cuadro de imagen`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!, $idPagina: ID!, $idCuadroImagen: ID!) {\n              eliminarCuadroImagenLibro(\n                idLibro: $idLibro\n                idPagina: $idPagina\n                idCuadroImagen: $idCuadroImagen\n              )\n            }\n          `,\n          variables: {\n            idLibro: this.idLibro,\n            idPagina: this.idPagina,\n            idCuadroImagen: this.esteCuadroImagen.id,\n          },\n        })\n        .then(({ data: { eliminarCuadroImagenLibro } }) => {\n          console.log(`Resultado: ${eliminarCuadroImagenLibro}`);\n          if (eliminarCuadroImagenLibro) {\n            this.$emit(\"meElimine\");\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n          this.updatingInfo = false;\n        });\n    },\n  },\n  mounted() {\n    console.log(`Montado`);\n    this.$set(this.posicion, \"x\", this.esteCuadroImagen.posicion.x);\n    this.$set(this.posicion, \"y\", this.esteCuadroImagen.posicion.y);\n\n    this.$set(this.size, \"x\", this.esteCuadroImagen.size.x);\n    this.$set(this.size, \"y\", this.esteCuadroImagen.size.y);\n\n    if (this.esteCuadroImagen.sinArchivo) {\n      console.log(`Abriendo el input de archivo`);\n      this.$refs.inputArchivoImagen.click();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.cuadroImagen {\n  position: absolute;\n  border-width: 1px;\n  border-style: solid;\n}\n.cuadroImagen:not(.enPaginaSeleccionada) {\n  border-color: transparent;\n}\n.enPaginaSeleccionada {\n  border-color: purple;\n}\n.imagenContenido {\n  width: 100%;\n  height: 100%;\n}\n#resizeHandle {\n  position: absolute;\n  top: 100%;\n  left: 100%;\n\n  border-radius: 50%;\n  transform: translate(-50%, -50%);\n\n  cursor: pointer;\n  border: 1px solid purple;\n}\n#bolitaResizeHandle {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: green;\n}\n\n#dragHandle {\n  position: absolute;\n  top: -20px;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  border-radius: 50%;\n  cursor: pointer;\n  border: 1px solid purple;\n}\n#bolitaDragHandle {\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: green;\n  text-align: center;\n}\n.conAudio {\n  cursor: pointer;\n}\n\n#bEliminarCuadroImagen {\n  width: 30px;\n  height: 30px;\n  padding: 5px;\n  border-radius: 50%;\n  cursor: pointer;\n  background-color: rgba(128, 0, 128, 0.212);\n  position: absolute;\n  top: -40px;\n  right: -35px;\n}\n#bEliminarCuadroImagen:hover {\n  background-color: rgba(128, 0, 128, 0.637);\n}\n\n#zHandlers{\n  position: absolute;\n  top:-33px;\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: rgba(104, 7, 104, 0.534);\n  border-radius: 13px;\n  padding: 5px 10px;\n  display: grid;\n  grid-template-columns: 16px 30px 16px;\n}\n\n.zHandler{\n  border-radius: 50%;\n  width: 15px;\n  height: 15px;\n  cursor: pointer;    \n}\n#bSendBack{\n  background-color: rgba(8, 83, 8, 0.377);\n  grid-column: 1/2;\n}\n#bSendBack:hover{\n  background-color: rgba(8, 83, 8, 0.61); \n}\n#bBringFront{\n  background-color: rgb(8, 83, 8);\n  grid-column: 3/4;\n}\n#bBringFront:hover{\n  background-color: rgb(4, 56, 4);\n\n}\n</style>"]}]}