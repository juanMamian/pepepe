{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/Foro.vue?vue&type=style&index=0&id=71d42152&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/Foro.vue","mtime":1619027779804},{"path":"/home/juan/webPj/pepepe/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmZvcm8gewogIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrOwogIGJhY2tncm91bmQtY29sb3I6IHJnYigyNDEsIDI0MSwgMjQxKTsKICBtYXJnaW46IDBweCBhdXRvOwp9CiNub21icmVGb3JvIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgZm9udC1zaXplOiAyMnB4OwogIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KCi5iYXJyYVN1cGVyaW9yRm9ybyB7CiAgZGlzcGxheTogZmxleDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGRmZWZmOwp9CgojYlJlZ3Jlc2FyQ29udmVyc2FjaW9uZXMgewogIHBhZGRpbmc6IDIwcHggNXB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBjdXJzb3I6IHBvaW50ZXI7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKICBtYXJnaW46IDEwcHggYXV0bzsKICBib3JkZXI6IDJweCBzb2xpZCBibGFjazsKfQojYlJlZ3Jlc2FyQ29udmVyc2FjaW9uZXM6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6IGNhZGV0Ymx1ZTsKfQojY29udHJvbGVzRm9ybyB7CiAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWZsb3c6IHJvdy1yZXZlcnNlOwp9Ci5jb250cm9sZXNGb3JvIHsKICBtYXJnaW4tbGVmdDogMTBweDsKfQouYm90b25lc0NvbnRyb2xlcyB7CiAgcGFkZGluZzogM3B4IDVweDsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KLmJvdG9uZXNDb250cm9sZXM6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICM5NWNjY2M7Cn0KLnpvbmFDb252ZXJzYWNpb25lcyB7CiAgcGFkZGluZy1sZWZ0OiAwcHg7Cn0KCi56b25hU2VsZWN0b3JQYWdpbmEgewogIGRpc3BsYXk6IGZsZXg7CiAgcGFkZGluZzogMnB4IDEwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2RkZmVmZjsKfQouc2VsZWN0b3JQYWdpbmEgewogIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogIHBhZGRpbmc6IDNweCA1cHg7CiAgbWFyZ2luOiAycHg7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIGN1cnNvcjogcG9pbnRlcjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNGRiOWI5Owp9Cgouc2VsZWN0b3JQYWdpbmE6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICM5NWNjY2M7Cn0KLnNlbGVjdG9yU2VsZWNjaW9uYWRvIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTVjY2NjOwogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9CiNhbnVuY2lvIHsKICBwYWRkaW5nOiA1cHggNXB4Owp9CiN6b25hQ3JlYXJDb252ZXJzYWNpb24gewogIGJvcmRlcjogMnB4IHNvbGlkIGNhZGV0Ymx1ZTsKICBib3JkZXItcmFkaXVzOiAxMHB4OwogIHBhZGRpbmc6IDEwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg5NSwgMTU4LCAxNjAsIDAuMzI5KTsKfQojaW5wdXRUaXR1bG9OdWV2YUNvbnZlcnNhY2lvbiB7CiAgZm9udC1zaXplOiAyMHB4OwogIHBhZGRpbmc6IDNweCA1cHg7CiAgd2lkdGg6IG1pbig4MCUsIDUwMHB4KTsKfQo="},{"version":3,"sources":["Foro.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Foro.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"foro\">\n    <div class=\"barraSuperiorForo\">\n      <div id=\"anuncio\" v-show=\"idConversacionSeleccionada === null\">\n        Conversaciones\n      </div>\n      <div\n        id=\"bRegresarConversaciones\"\n        v-show=\"idConversacionSeleccionada != null\"\n        @click=\"idConversacionSeleccionada = null\"\n      >\n        Volver a conversaciones\n      </div>\n      <div id=\"controlesForo\">\n        <div\n          class=\"controlesForo botonesControles\"\n          id=\"bCrearConversacion\"\n          v-if=\"\n            usuarioLogeado &&\n            (esteForo.acceso == 'publico' || usuarioMiembro == true || usuarioSuperadministrador) &&\n            esteForo.id\n          \"\n          v-show=\"!conversacionAbierta\"\n          @click=\"creandoConversacion = !creandoConversacion\"\n        >\n          {{ creandoConversacion ? \"Cancelar\" : \"Crear conversación\" }}\n        </div>\n      </div>\n    </div>\n    <div class=\"zonaConversaciones\">\n      <!-- <creador-conversacion\n        v-if=\"\n          usuarioLogeado &&\n          (esteForo.acceso == 'publico' || usuarioMiembro == true) &&\n          esteForo.id\n        \"\n        :idForo=\"esteForo.id\"\n        :parent=\"parent\"\n        v-show=\"creandoConversacion\"\n        @hiceConversacion=\"addConversacion($event)\"\n      /> -->\n      <div\n        id=\"zonaCrearConversacion\"\n        v-if=\"\n          usuarioLogeado &&\n          (esteForo.acceso == 'publico' || usuarioMiembro == true || usuarioSuperadministrador) &&\n          esteForo.id\n        \"\n        v-show=\"creandoConversacion\"\n      >\n        <center><h3>Creando conversación</h3></center>\n        <input\n          type=\"text\"\n          v-model=\"tituloNuevaConversacion\"\n          id=\"inputTituloNuevaConversacion\"\n          placeholder=\"Titulo de la nueva conversación\"\n          :class=\"{ letrasRojas: tituloNuevaConversacionIlegal }\"\n        />\n        <cuadro-responder\n          :idForo=\"esteForo.id\"\n          :parent=\"parent\"\n          :tituloNuevaConversacion=\"tituloNuevaConversacion\"\n          :class=\"{ deshabilitado: tituloNuevaConversacionIlegal }\"\n          @hiceConversacion=\"addConversacion($event)\"\n        />\n      </div>\n\n      <div class=\"zonaSelectorPagina\" v-if=\"numPaginas && !conversacionAbierta\">\n        <div\n          class=\"selectorPagina\"\n          v-for=\"index in numPaginas\"\n          :key=\"index\"\n          :class=\"{ selectorSeleccionado: index == numPaginaSeleccionada }\"\n          @click=\"numPaginaSeleccionada = index\"\n        >\n          {{ index }}\n        </div>\n      </div>\n      <div class=\"zonaPaginasConversaciones\" v-if=\"numPaginas\">\n        <div\n          class=\"paginaConversaciones\"\n          :key=\"index\"\n          v-for=\"index in numPaginas\"\n        ></div>\n        <conversacion\n          v-for=\"conversacion of conversacionesPorPagina[numPaginaSeleccionada]\"\n          :key=\"conversacion.id\"\n          :estaConversacion=\"conversacion\"\n          :seleccionado=\"idConversacionSeleccionada == conversacion.id\"\n          :usuarioMiembro=\"usuarioMiembro\"\n          :idForo=\"idForo\"\n          :parent=\"parent\"\n          v-show=\"\n            idConversacionSeleccionada == conversacion.id ||\n            !conversacionAbierta\n          \"\n          @click.native=\"\n            idConversacionSeleccionada = conversacion.id;\n            setConversacionLeida(\n              conversacion.id,\n              conversacion.cantidadRespuestas\n            );\n          \"\n          @meElimine=\"refreshPagina\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport Conversacion from \"./foros/Conversacion.vue\";\nimport CuadroResponder from \"./foros/CuadroResponder.vue\";\n\nconst charProhibidosTituloNuevaConversacion = /[^ a-zA-ZÀ-ž0-9_():.,-¡!¿?]/;\n\nexport const fragmentoConversacion = gql`\n  fragment fragConversacion on Conversacion {\n    id\n    titulo\n    estado\n    acceso\n    cantidadRespuestas\n  }\n`;\n\nconst QUERY_FORO = gql`\n  query($idForo: ID!) {\n    foro(idForo: $idForo) {\n      id\n      acceso\n      miembros\n    }\n  }\n`;\n\nconst QUERY_CONVERSACIONES_PAGINA = gql`\n  query($idForo: ID!, $pagina: Int!) {\n    conversacionesPaginaForo(idForo: $idForo, pagina: $pagina) {\n      pagina\n      numPaginas\n      conversaciones {\n        ...fragConversacion\n      }\n    }\n  }\n  ${fragmentoConversacion}\n`;\n\nexport default {\n  components: { Conversacion, CuadroResponder },\n  name: \"Foro\",\n  apollo: {\n    esteForo: {\n      query: QUERY_FORO,\n      variables() {\n        return {\n          idForo: this.idForo,\n        };\n      },\n      fetchPolicy: \"cache-and-network\",\n      update: (data) => {\n        return data.foro;\n      },\n      skip() {\n        return !this.idForo;\n      },\n    },\n    numPaginas: {\n      query: QUERY_CONVERSACIONES_PAGINA,\n      variables() {\n        return {\n          idForo: this.idForo,\n          pagina: this.numPaginaSeleccionada,\n        };\n      },\n      fetchPolicy: \"no-cache\",\n      skip() {\n        return !this.idForo;\n      },\n      update({\n        conversacionesPaginaForo: { conversaciones, pagina, numPaginas },\n      }) {\n        if (this.numPaginaSeleccionada != pagina) {\n          this.numPaginaSeleccionada = pagina;\n        }\n        this.$set(this.conversacionesPorPagina, pagina, conversaciones);\n        return numPaginas;\n      },\n    },\n  },\n  props: {\n    idForo: String,\n    parent: Object,\n  },\n  data() {\n    return {\n      esteForo: {\n        miembros: [],\n        conversaciones: [],\n      },\n      idConversacionSeleccionada: null,\n      creandoConversacion: false,\n      numPaginaSeleccionada: 0,\n      conversacionesPorPagina: {},\n\n      tituloNuevaConversacion: null,\n    };\n  },\n  methods: {\n    addConversacion(nuevaConversacion) {\n      this.creandoConversacion = false;\n      var targetPagina = this.numPaginas;\n      console.log(`Target página: ${targetPagina}`);\n      if (\n        this.conversacionesPorPagina[targetPagina].length >= 6 ||\n        targetPagina < 1\n      ) {\n        targetPagina++;\n        if (!this.conversacionesPorPagina[targetPagina]) {\n          this.$set(this.conversacionesPorPagina, targetPagina, []);\n        }\n      }\n      console.log(`Pushing en targetPagina ${targetPagina}`);\n      this.conversacionesPorPagina[targetPagina].push(nuevaConversacion);\n      if (this.numPaginaSeleccionada != targetPagina) {\n        this.numPaginaSeleccionada = targetPagina;\n      }\n      this.tituloNuevaConversacion = null;\n    },\n    refreshPagina() {\n      //let store = this.$apollo.provider.defaultClient;\n      this.idConversacionSeleccionada = null;\n      this.$apollo.queries.numPaginas.refresh();\n    },\n    setConversacionLeida(idConversacion, cantidadRespuestasLeidas) {\n      if (!this.usuario || !this.usuario.id) {\n        return;\n      } else {\n        console.log(`Setting conversación leida`);\n\n        this.$apollo\n          .mutate({\n            mutation: gql`\n              mutation(\n                $idUsuario: ID!\n                $idForo: ID!\n                $idConversacion: ID!\n                $cantidadRespuestasLeidas: Int!\n              ) {\n                setCantidadRespuestasConversacionLeidasPorUsuario(\n                  idUsuario: $idUsuario\n                  idForo: $idForo\n                  idConversacion: $idConversacion\n                  cantidadRespuestasLeidas: $cantidadRespuestasLeidas\n                )\n              }\n            `,\n            variables: {\n              idUsuario: this.usuario.id,\n              idForo: this.idForo,\n              idConversacion,\n              cantidadRespuestasLeidas: parseInt(cantidadRespuestasLeidas),\n            },\n          })\n          .then(\n            ({\n              data: { setCantidadRespuestasConversacionLeidasPorUsuario },\n            }) => {\n              console.log(\n                `Resultado: ${setCantidadRespuestasConversacionLeidasPorUsuario}`\n              );\n              if (setCantidadRespuestasConversacionLeidasPorUsuario) {\n                this.$store.commit(\"setRespuestasLeidasConversacionUsuario\", {\n                  idForo: this.idForo,\n                  idConversacion,\n                  respuestasLeidas: cantidadRespuestasLeidas,\n                });\n              }\n            }\n          )\n          .catch((error) => {\n            console.log(`Error. E: ${error}`);\n          });\n      }\n    },\n  },\n  computed: {\n    usuarioMiembro() {\n      if (this.esteForo.acceso == \"publico\") {\n        return true;\n      } else if (this.esteForo.acceso == \"privado\") {\n        if (this.esteForo.miembros.includes(this.$store.state.usuario.id)) {\n          return true;\n        }\n      }\n      return false;\n    },    \n    conversacionAbierta() {\n      return this.idConversacionSeleccionada;\n    },\n    tituloNuevaConversacionIlegal() {\n      if (\n        !this.tituloNuevaConversacion ||\n        this.tituloNuevaConversacion.length < 1\n      ) {\n        return true;\n      }\n      if (\n        charProhibidosTituloNuevaConversacion.test(this.tituloNuevaConversacion)\n      ) {\n        return true;\n      }\n      return false;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.foro {\n  border: 2px solid black;\n  background-color: rgb(241, 241, 241);\n  margin: 0px auto;\n}\n#nombreForo {\n  text-align: center;\n  font-size: 22px;\n  margin-bottom: 20px;\n}\n\n.barraSuperiorForo {\n  display: flex;\n  background-color: #ddfeff;\n}\n\n#bRegresarConversaciones {\n  padding: 20px 5px;\n  text-align: center;\n  cursor: pointer;\n  border-radius: 10px;\n  margin: 10px auto;\n  border: 2px solid black;\n}\n#bRegresarConversaciones:hover {\n  background-color: cadetblue;\n}\n#controlesForo {\n  margin-left: auto;\n  display: flex;\n  flex-flow: row-reverse;\n}\n.controlesForo {\n  margin-left: 10px;\n}\n.botonesControles {\n  padding: 3px 5px;\n  cursor: pointer;\n}\n.botonesControles:hover {\n  background-color: #95cccc;\n}\n.zonaConversaciones {\n  padding-left: 0px;\n}\n\n.zonaSelectorPagina {\n  display: flex;\n  padding: 2px 10px;\n  background-color: #ddfeff;\n}\n.selectorPagina {\n  border: 1px solid black;\n  padding: 3px 5px;\n  margin: 2px;\n  border-radius: 5px;\n  cursor: pointer;\n  background-color: #4db9b9;\n}\n\n.selectorPagina:hover {\n  background-color: #95cccc;\n}\n.selectorSeleccionado {\n  background-color: #95cccc;\n  pointer-events: none;\n}\n#anuncio {\n  padding: 5px 5px;\n}\n#zonaCrearConversacion {\n  border: 2px solid cadetblue;\n  border-radius: 10px;\n  padding: 10px;\n  background-color: rgba(95, 158, 160, 0.329);\n}\n#inputTituloNuevaConversacion {\n  font-size: 20px;\n  padding: 3px 5px;\n  width: min(80%, 500px);\n}\n</style>"]}]}