{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/LibrosPublicos.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/LibrosPublicos.vue","mtime":1621177679639},{"path":"/home/juan/webPj/pepepe/libro/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdxbCB9IGZyb20gImFwb2xsby1zZXJ2ZXItY29yZSI7CmltcG9ydCBJY29ub1BlcnNvbmFBdXRvbm9tbyBmcm9tICIuL0ljb25vUGVyc29uYUF1dG9ub21vLnZ1ZSI7Cgpjb25zdCBRVUVSWV9MSUJST1NfUFVCTElDT1MgPSBncWxgCiAgcXVlcnkgewogICAgbGlicm9zUHVibGljb3MgewogICAgICBpZAogICAgICB0aXR1bG8KICAgICAgaWRzRWRpdG9yZXMKICAgIH0KICB9CmA7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBJY29ub1BlcnNvbmFBdXRvbm9tbyB9LAogIG5hbWU6ICJMaWJyb3NQdWJsaWNvcyIsCiAgYXBvbGxvOiB7CiAgICBsaWJyb3NQdWJsaWNvczogewogICAgICBxdWVyeTogUVVFUllfTElCUk9TX1BVQkxJQ09TLAogICAgICBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy51c3VhcmlvTG9nZWFkbzsKICAgICAgfSwKICAgIH0sCiAgfSwKICBwcm9wczogewogICAgaWRMaWJyb1NlbGVjY2lvbmFkbzogU3RyaW5nLAogICAgVVJMTGlicm9zb2xvOiBTdHJpbmcsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVzcGxlZ2FkbzogZmFsc2UsCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgc2VsZWNjaW9uYXJMaWJybyhpZExpYnJvKSB7CiAgICAgIHRoaXMuJGVtaXQoImxpYnJvU2VsZWNjaW9uYWRvIiwgaWRMaWJybyk7CiAgICB9LAogICAgcmVtb3ZlckxpYnJvQ2FjaGUoaWRMaWJybykgewogICAgICBjb25zdCBzdG9yZSA9IHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50OwogICAgICBjb25zdCBjYWNoZSA9IHN0b3JlLnJlYWRRdWVyeSh7CiAgICAgICAgcXVlcnk6IFFVRVJZX0xJQlJPU19QVUJMSUNPUywKICAgICAgfSk7CiAgICAgIHZhciBudWV2b0NhY2hlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYWNoZSkpOwoKICAgICAgY29uc3QgaW5kZXhMID0gbnVldm9DYWNoZS5saWJyb3NQdWJsaWNvcy5maW5kSW5kZXgoCiAgICAgICAgKGwpID0+IGwuaWQgPT0gaWRMaWJybwogICAgICApOwogICAgICBpZiAoaW5kZXhMID4gLTEpIHsKICAgICAgICBudWV2b0NhY2hlLmxpYnJvc1B1YmxpY29zLnNwbGljZShpbmRleEwsIDEpOwogICAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgICAgcXVlcnk6IFFVRVJZX0xJQlJPU19QVUJMSUNPUywKICAgICAgICAgIGRhdGE6IG51ZXZvQ2FjaGUsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coYExpYnJvIG5vIGVzdGFiYSBlbiBjYWNow6lgKTsKICAgICAgfQogICAgfSwKICAgIGVsaW1pbmFyTGlicm8oaWRMaWJybykgewogICAgICBpZiAoIWNvbmZpcm0oIkVsaW1pbmFuZG8gdW4gbGlicm8uIMK/Q29udGludWFyPyIpKSByZXR1cm47CgogICAgICB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiBncWxgCiAgICAgICAgICAgIG11dGF0aW9uKCRpZExpYnJvOiBJRCEpIHsKICAgICAgICAgICAgICBlbGltaW5hckxpYnJvKGlkTGlicm86ICRpZExpYnJvKQogICAgICAgICAgICB9CiAgICAgICAgICBgLAogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGlkTGlicm8sCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHsgZGF0YTogeyBlbGltaW5hckxpYnJvIH0gfSkgPT4gewogICAgICAgICAgaWYgKGVsaW1pbmFyTGlicm8pIHsKICAgICAgICAgICAgdGhpcy4kZW1pdCgiZWxpbWluZVVuTGlicm8iLCBpZExpYnJvKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvci4gRTogJHtlcnJvcn1gKTsKICAgICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVMaWJybyh7bGlicm8sIG51ZXZvRXN0YWRvfSl7CiAgICAgIGNvbnN0IHB1YmxpY289bnVldm9Fc3RhZG87CiAgICAgIGNvbnNvbGUubG9nKGBUb2dnbGluZyBsaWJybyBlbiBsYSBsaXN0YSBkZSBsaWJyb3MgcHVibGljb3MuIEVzdGFkbzogJHtwdWJsaWNvfWApOwogICAgICBjb25zdCBzdG9yZT10aGlzLiRhcG9sbG8ucHJvdmlkZXIuZGVmYXVsdENsaWVudDsKICAgICAgY29uc3QgY2FjaGU9c3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfTElCUk9TX1BVQkxJQ09TCiAgICAgIH0pOwogICAgICB2YXIgbnVldm9DYWNoZT1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CgogICAgICBpZihwdWJsaWNvKXsgICAgICAgICAgCiAgICAgICAgaWYoIW51ZXZvQ2FjaGUubGlicm9zUHVibGljb3Muc29tZShwPT5wLmlkPT1saWJyby5pZCkpewogICAgICAgICAgY29uc29sZS5sb2coYFB1c2hpbmcgbGlicm8gYSBsYSBsaXN0YSBkZSBsaWJyb3MgcMO6YmxpY29zYCk7CiAgICAgICAgICBudWV2b0NhY2hlLmxpYnJvc1B1YmxpY29zLnB1c2gobGlicm8pOwogICAgICAgICAgc3RvcmUud3JpdGVRdWVyeSh7CiAgICAgICAgICAgIHF1ZXJ5OlFVRVJZX0xJQlJPU19QVUJMSUNPUywKICAgICAgICAgICAgZGF0YTpudWV2b0NhY2hlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgIGNvbnNvbGUubG9nKGBFbCBsaWJybyB5YSBlc3RhYmEgZW4gbGEgbGlzdGEgZGUgbGlicm9zIHDDumJsaWNvc2ApOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlewogICAgICAgIGNvbnN0IGluZGV4UD1udWV2b0NhY2hlLmxpYnJvc1B1YmxpY29zLmZpbmRJbmRleChwPT5wLmlkPT1saWJyby5pZCkKICAgICAgICBpZihpbmRleFA+LTEpewogICAgICAgICAgbnVldm9DYWNoZS5saWJyb3NQdWJsaWNvcy5zcGxpY2UoaW5kZXhQLCAxKTsKICAgICAgICAgIHN0b3JlLndyaXRlUXVlcnkoewogICAgICAgICAgICBxdWVyeTpRVUVSWV9MSUJST1NfUFVCTElDT1MsCiAgICAgICAgICAgIGRhdGE6bnVldm9DYWNoZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgdXN1YXJpb1N1cGVyYWRtaW5pc3RyYWRvcigpIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5wZXJtaXNvcykgewogICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgYERhdG9zIGluc3VmaWNpZW50ZXMgcGFyYSBkZWNpZGlyIHNpIHVzdWFyaW8gZXMgc8O6cGVyYWRtaW5pc3RyYWRvcmAKICAgICAgICApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy51c3VhcmlvLnBlcm1pc29zLmluY2x1ZGVzKCJzdXBlcmFkbWluaXN0cmFkb3IiKTsKICAgIH0sCiAgICBsaWJyb3NQb3JBdXRvcigpIHsKICAgICAgdmFyIG9iamV0b0ZpbmFsID0ge307CiAgICAgIGlmICghdGhpcy5saWJyb3NQdWJsaWNvcykgewogICAgICAgIHJldHVybiBvYmpldG9GaW5hbDsKICAgICAgfQogICAgICB0aGlzLmxpYnJvc1B1YmxpY29zLmZvckVhY2goKGxpYnJvKSA9PiB7CiAgICAgICAgbGV0IGlkQXV0b3IgPSBsaWJyby5pZHNFZGl0b3Jlc1swXTsKICAgICAgICBpZiAoIW9iamV0b0ZpbmFsW2lkQXV0b3JdKSB7CiAgICAgICAgICBvYmpldG9GaW5hbFtpZEF1dG9yXSA9IFtsaWJyb107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9iamV0b0ZpbmFsW2lkQXV0b3JdLnB1c2gobGlicm8pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBvYmpldG9GaW5hbDsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["LibrosPublicos.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LibrosPublicos.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"librosPublicos\">\n    <h4\n      style=\"cursor: pointer\"\n      class=\"tituloZona\"\n      @click=\"desplegado = !desplegado\"\n    >\n      <div\n        class=\"trianguloBullet\"\n        :style=\"{ transform: desplegado ? 'rotateZ(90deg)' : 'rotateZ(0deg)' }\"\n      ></div>\n      Libros publicos\n    </h4>\n    <div id=\"controlesLibrosPublicos\"></div>\n    <img\n      src=\"@/assets/iconos/loading.png\"\n      alt=\"Cargando\"\n      class=\"simboloLoading\"\n      style=\"width: 20px; margin: 10px auto; display: block\"\n      v-show=\"desplegado && $apollo.queries.librosPublicos.loading\"\n    />\n\n    <div id=\"listaLibrosPublicos\" v-show=\"desplegado\">\n      <div\n        class=\"bloqueAutor\"\n        v-for=\"(listaLibros, idAutor) of librosPorAutor\"\n        :key=\"idAutor\"\n      >\n        <icono-persona-autonomo :idPersona=\"idAutor\" />\n        <br />\n        <br />\n        <br />\n        <div class=\"listaLibros\">\n          <div\n            class=\"portadaLibro\"\n            v-for=\"portada of listaLibros\"\n            :key=\"portada.id\"\n            @click=\"seleccionarLibro(portada.id)\"\n            :class=\"{ seleccionado: idLibroSeleccionado == portada.id }\"\n          >\n            <div class=\"nombreLibro\">\n              {{ portada.titulo }}\n            </div>\n            <div class=\"controlesLibro\" @click.stop=\"\">\n              <img\n                src=\"@/assets/iconos/delete.png\"\n                alt=\"Eliminar\"\n                title=\"Eliminar este libro\"\n                class=\"controlLibro\"\n                v-show=\"usuarioSuperadministrador\"\n                @click.stop=\"eliminarLibro(portada.id)\"\n              />\n              <a :href=\"URLLibrosolo + '?id=' + portada.id\" target=\"_blank\">\n                <img\n                  src=\"@/assets/iconos/libroAbierto.png\"\n                  class=\"controlLibro\"\n                  alt=\"Libro\"\n                  title=\"Ver libro\"\n                />\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport IconoPersonaAutonomo from \"./IconoPersonaAutonomo.vue\";\n\nconst QUERY_LIBROS_PUBLICOS = gql`\n  query {\n    librosPublicos {\n      id\n      titulo\n      idsEditores\n    }\n  }\n`;\n\nexport default {\n  components: { IconoPersonaAutonomo },\n  name: \"LibrosPublicos\",\n  apollo: {\n    librosPublicos: {\n      query: QUERY_LIBROS_PUBLICOS,\n      skip() {\n        return !this.usuarioLogeado;\n      },\n    },\n  },\n  props: {\n    idLibroSeleccionado: String,\n    URLLibrosolo: String,\n  },\n  data() {\n    return {\n      desplegado: false,\n    };\n  },\n  methods: {\n    seleccionarLibro(idLibro) {\n      this.$emit(\"libroSeleccionado\", idLibro);\n    },\n    removerLibroCache(idLibro) {\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_LIBROS_PUBLICOS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      const indexL = nuevoCache.librosPublicos.findIndex(\n        (l) => l.id == idLibro\n      );\n      if (indexL > -1) {\n        nuevoCache.librosPublicos.splice(indexL, 1);\n        store.writeQuery({\n          query: QUERY_LIBROS_PUBLICOS,\n          data: nuevoCache,\n        });\n      } else {\n        console.log(`Libro no estaba en caché`);\n      }\n    },\n    eliminarLibro(idLibro) {\n      if (!confirm(\"Eliminando un libro. ¿Continuar?\")) return;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!) {\n              eliminarLibro(idLibro: $idLibro)\n            }\n          `,\n          variables: {\n            idLibro,\n          },\n        })\n        .then(({ data: { eliminarLibro } }) => {\n          if (eliminarLibro) {\n            this.$emit(\"elimineUnLibro\", idLibro);\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    toggleLibro({libro, nuevoEstado}){\n      const publico=nuevoEstado;\n      console.log(`Toggling libro en la lista de libros publicos. Estado: ${publico}`);\n      const store=this.$apollo.provider.defaultClient;\n      const cache=store.readQuery({\n        query: QUERY_LIBROS_PUBLICOS\n      });\n      var nuevoCache=JSON.parse(JSON.stringify(cache));\n\n      if(publico){          \n        if(!nuevoCache.librosPublicos.some(p=>p.id==libro.id)){\n          console.log(`Pushing libro a la lista de libros públicos`);\n          nuevoCache.librosPublicos.push(libro);\n          store.writeQuery({\n            query:QUERY_LIBROS_PUBLICOS,\n            data:nuevoCache\n          });\n        }\n        else{\n          console.log(`El libro ya estaba en la lista de libros públicos`);\n        }\n      }\n      else{\n        const indexP=nuevoCache.librosPublicos.findIndex(p=>p.id==libro.id)\n        if(indexP>-1){\n          nuevoCache.librosPublicos.splice(indexP, 1);\n          store.writeQuery({\n            query:QUERY_LIBROS_PUBLICOS,\n            data:nuevoCache\n          });\n        }\n      }\n    }\n  },\n  computed: {\n    usuarioSuperadministrador() {\n      if (!this.usuario || !this.usuario.permisos) {\n        console.log(\n          `Datos insuficientes para decidir si usuario es súperadministrador`\n        );\n        return false;\n      }\n      return this.usuario.permisos.includes(\"superadministrador\");\n    },\n    librosPorAutor() {\n      var objetoFinal = {};\n      if (!this.librosPublicos) {\n        return objetoFinal;\n      }\n      this.librosPublicos.forEach((libro) => {\n        let idAutor = libro.idsEditores[0];\n        if (!objetoFinal[idAutor]) {\n          objetoFinal[idAutor] = [libro];\n        } else {\n          objetoFinal[idAutor].push(libro);\n        }\n      });\n      return objetoFinal;\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>"]}]}