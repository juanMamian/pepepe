{"remainingRequest":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/clientesSrc/libro/src/components/foros/Conversacion.vue?vue&type=style&index=0&id=9e3ce0f2&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/src/components/foros/Conversacion.vue","mtime":1621134760340},{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/clientesSrc/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jb252ZXJzYWNpb24gewogIGJhY2tncm91bmQtY29sb3I6ICNmZGMxOTA7CiAgYm9yZGVyOiAxcHggc29saWQgd2hpdGU7CiAgcGFkZGluZzogMHB4IDBweDsKfQouY29udmVyc2FjaW9uOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjdiNTdmOwp9Ci5jb25SZXNwdWVzdGFzTm9MZWlkYXMgewogIGJhY2tncm91bmQtY29sb3I6ICNmOGNjYTg7Cn0KLnNlbGVjY2lvbmFkbyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y3YjU3ZjsKfQouaW5mb0NvbnZlcnNhY2lvbiB7CiAgZm9udC1zaXplOiAxMHB4OwogIGZvbnQtc3R5bGU6IGl0YWxpYzsKICBjb2xvcjogZ3JheTsKICB0ZXh0LWFsaWduOiByaWdodDsKfQoucmVzcHVlc3RhIHsKICBtYXJnaW46IDVweDsKfQouY29udmVyc2FjaW9uOm5vdCguc2VsZWNjaW9uYWRvKSB7CiAgY3Vyc29yOiBwb2ludGVyOwp9Ci50aXR1bG9Db252ZXJzYWNpb24gewogIHBhZGRpbmc6IDE1cHggMHB4OwogIG1hcmdpbjogNXB4OwogIGZvbnQtd2VpZ2h0OiBib2xkOwogIGRpc3BsYXk6IGdyaWQ7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDM1cHggMWZyIDUwcHg7CiAgY29sb3I6ICM5YzFhMWE7Cn0KLmltYWdlbkNvbnZlcnNhY2lvbiB7CiAgd2lkdGg6IDMwcHg7CiAgaGVpZ2h0OiAzMHB4OwogIG1hcmdpbi1yaWdodDogMTBweDsKfQouZGF0b3NDb252ZXJzYWNpb24gewogIHBhZGRpbmc6IDEwcHggMHB4Owp9Ci5kYXRvIHsKICBtYXJnaW46IDBweCAzcHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgcGFkZGluZzogM3B4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBmb250LXNpemU6IDEycHg7Cn0KCi5kYXRvUmVzcHVlc3Rhc05vTGVpZGFzIHsKICBib3JkZXI6IDFweCBzb2xpZCBjaG9jb2xhdGU7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI0MywgMjA2LCAxODApOwp9CgouZGF0b0NhbnRpZGFkUmVzcHVlc3RhcyB7CiAgYm9yZGVyOiAxcHggc29saWQgcmdiKDc1LCA3MywgNzMpOwp9Ci56b25hUmVzcHVlc3RhcyB7CiAgcGFkZGluZy1sZWZ0OiAwcHg7Cn0KLmNvbnRyb2xlc0NvbnZlcnNhY2lvbiB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWZsb3c6IHJvdy1yZXZlcnNlOwp9Ci5iRWxpbWluYXJDb252ZXJzYWNpb24gewogIHBhZGRpbmc6IDNweDsKfQouYkVsaW1pbmFyQ29udmVyc2FjaW9uOmhvdmVyIHsKICBwYWRkaW5nOiAzcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogcmVkOwogIGN1cnNvcjogcG9pbnRlcjsKfQouem9uYVNlbGVjdG9yUGFnaW5hcyB7CiAgZGlzcGxheTogZmxleDsKICBwYWRkaW5nOiAycHggMTBweDsKfQouc2VsZWN0b3JQYWdpbmEgewogIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogIHBhZGRpbmc6IDNweCA1cHg7CiAgbWFyZ2luOiAycHg7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIGN1cnNvcjogcG9pbnRlcjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjdiNTdmOwp9Cgouc2VsZWN0b3JQYWdpbmE6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICNmZmQwYWE7Cn0KLnNlbGVjdG9yU2VsZWNjaW9uYWRvIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZkMGFhOwoKICBwb2ludGVyLWV2ZW50czogbm9uZTsKICBmb250LXdlaWdodDogYm9sZDsKfQoKQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWluLXdpZHRoOiA3NjhweCkgewogIC50aXR1bG9Db252ZXJzYWNpb24gewogICAgcGFkZGluZzogMTVweCAxMHB4OwogICAgbWFyZ2luOiA1cHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiA2NXB4IDFmciA5MHB4OwogICAgY29sb3I6ICM5YzFhMWE7CiAgfQogIC5pbWFnZW5Db252ZXJzYWNpb24gewogICAgd2lkdGg6IDUwcHg7CiAgICBoZWlnaHQ6IDUwcHg7CiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7CiAgfQogIC5kYXRvIHsKICAgIG1hcmdpbjogMHB4IDRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBwYWRkaW5nOiA2cHg7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBmb250LXNpemU6IDE0cHg7CiAgfQp9Cg=="},{"version":3,"sources":["Conversacion.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Conversacion.vue","sourceRoot":"src/components/foros","sourcesContent":["<template>\n  <div\n    class=\"conversacion\"\n    :class=\"{\n      seleccionado,\n      deshabilitado: seleccionado && loading,\n      conRespuestasNoLeidas:\n        estaConversacion.cantidadRespuestas > cantidadRespuestasLeidasUsuario,\n    }\"\n  >\n    <div class=\"infoConversacion\">\n      {{ estaConversacion.cantidadRespuestas }} publicacion{{\n        estaConversacion.cantidadRespuestas > 1 ? \"es\" : \"\"\n      }}. Última publicación en {{ fechaFormateada }}\n    </div>\n    <div class=\"tituloConversacion\">\n      <img\n        src=\"@/assets/iconos/conversacion.png\"\n        alt=\"Conversacion\"\n        class=\"imagenConversacion\"\n      />\n      {{ estaConversacion.titulo }}\n      <span class=\"datosConversacion\">\n        <span\n          class=\"dato datoRespuestasNoLeidas\"\n          title=\"Respuestas nuevas en esta conversación\"\n          v-show=\"\n            estaConversacion.cantidadRespuestas >\n            cantidadRespuestasLeidasUsuario\n          \"\n        >\n          {{\n            estaConversacion.cantidadRespuestas -\n            cantidadRespuestasLeidasUsuario\n          }}\n        </span>\n      </span>\n    </div>\n\n    <div\n      class=\"zonaSelectorPaginas\"\n      v-if=\"numPaginas > 0\"\n      v-show=\"seleccionado\"\n    >\n      <div\n        class=\"selectorPagina\"\n        :class=\"{ selectorSeleccionado: index == numPaginaSeleccionada }\"\n        v-for=\"index in numPaginas\"\n        :key=\"index\"\n        @click=\"numPaginaSeleccionada = index\"\n      >\n        {{ index }}\n      </div>\n    </div>\n    <div class=\"zonaRespuestas\" v-show=\"seleccionado\">\n      <div class=\"zonaPaginas\">\n        <div\n          class=\"pagina\"\n          v-for=\"index in numPaginas\"\n          :key=\"'pagina' + index\"\n          v-show=\"numPaginaSeleccionada == index\"\n        >\n          <respuesta\n            v-for=\"respuesta of respuestasPorPagina[index]\"\n            :key=\"respuesta.id\"\n            :idConversacion=\"estaConversacion.id\"\n            :estaRespuesta=\"respuesta\"\n            @meQuierenCitar=\"citarRespuesta\"\n            @meElimine=\"updateRespuestaEliminada(respuesta.id, index)\"\n          />\n        </div>\n      </div>\n      <cuadro-responder\n        ref=\"cuadroResponder\"\n        :parent=\"parent\"\n        v-if=\"\n          usuarioLogeado &&\n          (estaConversacion.acceso == 'publico' || usuarioMiembro == true) &&\n          estaConversacion.id\n        \"        \n        :idConversacion=\"estaConversacion.id\"\n        @hiceRespuesta=\"addRespuesta($event)\"\n      />\n    </div>\n\n    <div class=\"controlesConversacion\">\n      <!-- <div class=\"bEliminarConversacion\">Eliminar</div> -->\n    </div>\n  </div>\n</template>\n\n<script>\nimport gql from \"graphql-tag\";\nimport CuadroResponder from \"./CuadroResponder.vue\";\nimport Respuesta from \"./Respuesta.vue\";\nimport { fragmentoRespuesta } from \"../utilidades/recursosGql\";\n\nconst QUERY_RESPUESTAS = gql`\n  query($idConversacion: ID!, $pagina: Int!) {\n    respuestasPaginaDeConversacion(\n      idConversacion: $idConversacion\n      pagina: $pagina\n    ) {\n      pagina\n      numPaginas\n      respuestas {\n        ...fragRespuesta\n      }\n    }\n  }\n  ${fragmentoRespuesta}\n`;\n\nexport default {\n  components: { Respuesta, CuadroResponder },\n  name: \"Conversacion\",\n  apollo: {\n    numPaginas: {\n      query: QUERY_RESPUESTAS,\n      variables() {\n        return {\n          idConversacion: this.estaConversacion.id,\n          pagina: this.numPaginaSeleccionada,\n        };\n      },\n      update({\n        respuestasPaginaDeConversacion: { pagina, numPaginas, respuestas },\n      }) {        \n        this.$set(this.respuestasPorPagina, pagina, respuestas);\n        if (this.numPaginaSeleccionada != pagina) {\n          this.numPaginaSeleccionada = pagina;\n        }\n        this.loading = false;\n        return numPaginas;\n      },\n      skip() {\n        return !this.seleccionado;\n      },\n      fetchPolicy: \"no-cache\",\n    },\n  },\n  data() {\n    return {\n      numPaginas: 0,\n      numPaginaSeleccionada: 0,\n      respuestasPorPagina: {},\n      loading: true,\n    };\n  },\n  props: {\n    estaConversacion: {\n      type: Object,\n      default() {\n        return {\n          respuestas: [],\n        };\n      },\n    },\n    idForo: String,\n    parent: Object,\n    seleccionado: Boolean,\n    usuarioMiembro: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  methods: {\n    addRespuesta(nuevaRespuesta) {\n      var targetPagina = this.numPaginas;\n      if (\n        this.respuestasPorPagina[targetPagina].length >= 5 ||\n        targetPagina < 1\n      ) {\n        targetPagina++;\n        if (!this.respuestasPorPagina[targetPagina]) {\n          this.$set(this.respuestasPorPagina, targetPagina, []);\n        }\n      }\n      this.respuestasPorPagina[targetPagina].push(nuevaRespuesta);\n      this.$refs.cuadroResponder.cerrarse();\n      if (this.numPaginaSeleccionada != targetPagina) {\n        this.numPaginaSeleccionada = targetPagina;\n      }\n      console.log(`Emitiendo 'respuesta publicada'`);\n      this.$emit(\"respuestaPublicada\");\n    },\n    updateRespuestaEliminada(idRespuesta, pagina) {\n      console.log(`Respuesta ${idRespuesta} eliminada de la pagina ${pagina}`);\n      if (this.numPaginas == 1 && this.respuestasPorPagina[1].length < 2) {\n        console.log(`Era la ultima respuesta`);\n        this.$emit(\"meElimine\");\n      } else {\n        console.log(`Refreshing respuestas pagina`);\n        this.$apollo.queries.numPaginas.refresh();\n      }\n    },\n    citarRespuesta(quote){\n      this.$refs.cuadroResponder.interpolarQuote(quote);\n    }\n  },\n  computed: {\n    cantidadRespuestasLeidasUsuario() {\n      if (this.usuario && this.usuario.foros) {\n        const infoForo = this.usuario.foros.find(\n          (f) => f.idForo == this.idForo\n        );\n        if (!infoForo) {\n          return 0;\n        }\n        const infoConversacion = infoForo.conversaciones.find(\n          (c) => c.idConversacion == this.estaConversacion.id\n        );\n        if (!infoConversacion) {\n          return 0;\n        }\n        return infoConversacion.respuestasLeidas;\n      } else {\n        return 0;\n      }\n    },\n    fechaFormateada: function () {\n      if (\n        !this.estaConversacion.infoUltimaRespuesta ||\n        !this.estaConversacion.infoUltimaRespuesta.fecha\n      ) {\n        return \"Fecha desconocida\";\n      }\n      let laFecha = new Date(\n        this.estaConversacion.infoUltimaRespuesta.fecha\n      ).toString();\n      let indexParentesis = laFecha.indexOf(\"(\");\n      let fechaCorta = laFecha.substr(0, indexParentesis);\n      let indexGMT = fechaCorta.indexOf(\"GMT\");\n      if (indexGMT > -1) {\n        fechaCorta = fechaCorta.substr(0, indexGMT);\n      }\n      return fechaCorta;\n    },\n  },\n  watch:{\n    seleccionado(nuevo, viejo){\n      if(nuevo && !viejo){\n        this.$emit(\"meAbrieron\");\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n.conversacion {\n  background-color: #fdc190;\n  border: 1px solid white;\n  padding: 0px 0px;\n}\n.conversacion:hover {\n  background-color: #f7b57f;\n}\n.conRespuestasNoLeidas {\n  background-color: #f8cca8;\n}\n.seleccionado {\n  background-color: #f7b57f;\n}\n.infoConversacion {\n  font-size: 10px;\n  font-style: italic;\n  color: gray;\n  text-align: right;\n}\n.respuesta {\n  margin: 5px;\n}\n.conversacion:not(.seleccionado) {\n  cursor: pointer;\n}\n.tituloConversacion {\n  padding: 15px 0px;\n  margin: 5px;\n  font-weight: bold;\n  display: grid;\n  align-items: center;\n  grid-template-columns: 35px 1fr 50px;\n  color: #9c1a1a;\n}\n.imagenConversacion {\n  width: 30px;\n  height: 30px;\n  margin-right: 10px;\n}\n.datosConversacion {\n  padding: 10px 0px;\n}\n.dato {\n  margin: 0px 3px;\n  cursor: pointer;\n  border-radius: 10px;\n  padding: 3px;\n  text-align: center;\n  font-size: 12px;\n}\n\n.datoRespuestasNoLeidas {\n  border: 1px solid chocolate;\n  background-color: rgb(243, 206, 180);\n}\n\n.datoCantidadRespuestas {\n  border: 1px solid rgb(75, 73, 73);\n}\n.zonaRespuestas {\n  padding-left: 0px;\n}\n.controlesConversacion {\n  display: flex;\n  flex-flow: row-reverse;\n}\n.bEliminarConversacion {\n  padding: 3px;\n}\n.bEliminarConversacion:hover {\n  padding: 3px;\n  background-color: red;\n  cursor: pointer;\n}\n.zonaSelectorPaginas {\n  display: flex;\n  padding: 2px 10px;\n}\n.selectorPagina {\n  border: 1px solid black;\n  padding: 3px 5px;\n  margin: 2px;\n  border-radius: 5px;\n  cursor: pointer;\n  background-color: #f7b57f;\n}\n\n.selectorPagina:hover {\n  background-color: #ffd0aa;\n}\n.selectorSeleccionado {\n  background-color: #ffd0aa;\n\n  pointer-events: none;\n  font-weight: bold;\n}\n\n@media only screen and (min-width: 768px) {\n  .tituloConversacion {\n    padding: 15px 10px;\n    margin: 5px;\n    font-weight: bold;\n    display: grid;\n    align-items: center;\n    grid-template-columns: 65px 1fr 90px;\n    color: #9c1a1a;\n  }\n  .imagenConversacion {\n    width: 50px;\n    height: 50px;\n    margin-right: 10px;\n  }\n  .dato {\n    margin: 0px 4px;\n    cursor: pointer;\n    border-radius: 10px;\n    padding: 6px;\n    text-align: center;\n    font-size: 14px;\n  }\n}\n</style>"]}]}