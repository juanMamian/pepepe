{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/Pagina.vue?vue&type=style&index=0&id=3cec6303&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/Pagina.vue","mtime":1617665825185},{"path":"/home/juan/webPj/pepepe/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnBhZ2luYSB7CiAgYm9yZGVyOiAycHggc29saWQgYmxhY2s7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIAogIHVzZXItc2VsZWN0OiBub25lOwp9Ci5jdXJzb3JUZXh0b3sKY3Vyc29yOnVybCgnfi4uL2Fzc2V0cy9pY29ub3MvcHVudGVyb1RleHRvLnBuZycpLCBkZWZhdWx0Owp9Ci5jdXJzb3JJbWFnZW57CmN1cnNvcjp1cmwoJ34uLi9hc3NldHMvaWNvbm9zL3B1bnRlcm9JbWFnZW4ucG5nJyksIGRlZmF1bHQ7Cn0KLnNlZ3VuZG9QbGFubyB7CiAgb3BhY2l0eTogMC4zOwp9Ci5lbGVtZW50b1BhZ2luYSB7CiAgei1pbmRleDogMTAwOwp9Ci5wcmltZXJQbGFubyB7CiAgei1pbmRleDogNTAwOwp9Ci5zZWxlY2Npb25hZGEgewogIGJvcmRlci1jb2xvcjogcHVycGxlOwogIHotaW5kZXg6IDI7Cn0KCi56b25hQ29udHJvbGVzUGFnaW5hIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgcGFkZGluZzogMTBweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAtNjBweDsKICBsZWZ0OiA1MCU7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOwp9CgouYkNvbnRyb2xlc1BhZ2luYSB7CiAgd2lkdGg6IDMwcHg7CiAgaGVpZ2h0OiAzMHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKCiAgY3Vyc29yOiBwb2ludGVyOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyMzEsIDI1NSk7Cn0KCiNoZXJyYW1pZW50YXNFZGljaW9uIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAxNTBweDsKICBsZWZ0OiAtMTAwcHg7Cn0KLmZhbnRhc21hRWxlbWVudG8gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBib3JkZXI6IDNweCBkb3R0ZWQgcHVycGxlOwogIGJvcmRlci1yYWRpdXM6IDVweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEyOCwgMCwgMTI4LCAwLjIwNSk7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKfQo="},{"version":3,"sources":["Pagina.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2ZA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Pagina.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"pagina\"\n    :style=\"[estiloColumna, estiloSize, estiloApariencia]\"\n    :class=\"{ seleccionada, deshabilitado: uploadingInfo, segundoPlano, cursorTexto:creandoTexto, cursorImagen:creandoImagen }\"\n    @mousedown.left.stop=\"accionCrearElemento\"\n    @mousemove=\"resizeFantasmaElemento\"\n    @mouseup=\"endDibujandoElemento\"\n    @click=\"idElementoSeleccionado = null\"\n  >\n    <div class=\"zonaControlesPagina\" v-show=\"seleccionada\">\n      <img\n        src=\"@/assets/iconos/delete.png\"\n        class=\"bControlesPagina bEliminarPagina\"\n        @click=\"eliminarse\"\n      />\n    </div>\n\n    <herramientas-edicion\n      v-show=\"seleccionada\"\n      ref=\"herramientasEdicion\"\n      @creacionTexto=\"\n        desactivarHerramientas();\n        creandoTexto = true;\n      \"\n      @creacionImagen=\"\n        desactivarHerramientas();        \n        creandoImagen = true;\n      \"\n      @mousedown.stop=\"\"\n      @mouseup.stop=\"\"\n    />\n\n    <div\n      id=\"fantasmaTexto\"\n      class=\"fantasmaElemento\"\n      :style=\"[estiloLayoutFantasmaTexto]\"\n      v-show=\"dibujandoTexto\"\n    ></div>\n    <div\n      id=\"fantasmaImagen\"\n      class=\"fantasmaElemento\"\n      :style=\"[estiloLayoutFantasmaImagen]\"\n      v-show=\"dibujandoImagen\"\n    ></div>\n    \n    <cuadro-imagen\n      v-for=\"cuadroImagen of estaPagina.cuadrosImagen\"\n      class=\"elementoPagina\"\n      :ref=\"'cuadroImagen'+cuadroImagen.id\"\n      :class=\"{ primerPlano: idElementoSeleccionado == cuadroImagen.id }\"\n      :key=\"cuadroImagen.id\"\n      :esteCuadroImagen=\"cuadroImagen\"\n      :idLibro=\"idLibro\"\n      :idPagina=\"estaPagina.id\"\n      :sizePagina=\"size\"\n      :seleccionado=\"idElementoSeleccionado == cuadroImagen.id && seleccionada\"\n      :paginaSeleccionada=\"seleccionada\"\n      @click.native=\"resolverSeleccion($event, cuadroImagen.id)\"      \n      @meElimine=\"$emit('elimineCuadroImagen', cuadroImagen.id)\"\n    />\n\n    <cuadro-texto\n      v-for=\"cuadroTexto of estaPagina.cuadrosTexto\"\n      class=\"elementoPagina\"\n      :class=\"{ primerPlano: idElementoSeleccionado == cuadroTexto.id }\"\n      :key=\"cuadroTexto.id\"\n      :esteCuadroTexto=\"cuadroTexto\"\n      :idLibro=\"idLibro\"\n      :idPagina=\"estaPagina.id\"\n      :sizePagina=\"size\"\n      :seleccionado=\"idElementoSeleccionado == cuadroTexto.id && seleccionada\"\n      :paginaSeleccionada=\"seleccionada\"\n      @click.native=\"resolverSeleccion($event, cuadroTexto.id)\"      \n      @meElimine=\"$emit('elimineCuadroTexto', cuadroTexto.id)\"\n    />\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport CuadroImagen from \"./CuadroImagen.vue\";\nimport CuadroTexto from \"./CuadroTexto.vue\";\nimport HerramientasEdicion from \"./HerramientasEdicion.vue\";\nimport { fragmentoCuadroImagen, fragmentoCuadroTexto } from \"./Libro.vue\";\nexport default {\n  components: { CuadroImagen, CuadroTexto, HerramientasEdicion },\n  name: \"Pagina\",\n  props: {\n    estaPagina: Object,\n    paginaDerecha: Boolean,\n    preparada: {\n      type: Boolean,\n      default: false,\n    },\n    visible: {\n      type: Boolean,\n    },\n    idLibro: String,\n    seleccionada: Boolean,\n    segundoPlano: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      ancho: 450,\n      alto: 600,\n      uploadingInfo: false,\n\n      creandoTexto: false,\n      creandoImagen: false,\n\n      dibujandoTexto: false,\n      dibujandoImagen: false,\n\n      posFantasmaTexto: {\n        x: 0,\n        y: 0,\n      },\n      sizeFantasmaTexto: {\n        x: 30,\n        y: 30,\n      },\n\n      posFantasmaImagen: {\n        x: 0,\n        y: 0,\n      },\n      sizeFantasmaImagen: {\n        x: 30,\n        y: 30,\n      },\n\n      idElementoSeleccionado: null,\n    };\n  },\n  computed: {\n    estiloColumna() {\n      if (this.paginaDerecha) {\n        return {\n          gridColumn: \"1/2\",\n          justifySelf: \"right\",\n        };\n      }\n      return null;\n    },\n    estiloSize() {\n      return {\n        width: this.ancho + \"px\",\n        height: this.alto + \"px\",\n      };\n    },\n    size() {\n      return {\n        x: this.ancho,\n        y: this.alto,\n      };\n    },\n    estiloApariencia() {\n      return {\n        backgroundColor: this.estaPagina.color,\n      };\n    },\n    estiloLayoutFantasmaTexto() {\n      return {\n        top: this.posFantasmaTexto.y + \"px\",\n        left: this.posFantasmaTexto.x + \"px\",\n        width: this.sizeFantasmaTexto.x + \"px\",\n        height: this.sizeFantasmaTexto.y + \"px\",\n      };\n    },\n    estiloLayoutFantasmaImagen() {\n      return {\n        top: this.posFantasmaImagen.y + \"px\",\n        left: this.posFantasmaImagen.x + \"px\",\n        width: this.sizeFantasmaImagen.x + \"px\",\n        height: this.sizeFantasmaImagen.y + \"px\",\n      };\n    },\n  },\n  methods: {\n    eliminarse() {\n      if (\n        !confirm(\n          \"Eliminando página. Esta operación no se puede deshacer. ¿Continuar?\"\n        )\n      ) {\n        return;\n      }\n      this.uploadingInfo = true;\n      console.log(`Eliminando una página`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!, $idPagina: ID!) {\n              eliminarPaginaDeLibro(idLibro: $idLibro, idPagina: $idPagina)\n            }\n          `,\n          variables: {\n            idLibro: this.idLibro,\n            idPagina: this.estaPagina.id,\n          },\n        })\n        .then(({ data: { eliminarPaginaDeLibro } }) => {\n          console.log(`Resultado: ${eliminarPaginaDeLibro}`);\n          if (eliminarPaginaDeLibro) {\n            this.$emit(\"meElimine\");\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n          this.uploadingInfo = false;\n        });\n    },\n    desactivarHerramientas() {\n      this.creandoTexto = false;\n      this.creandoImagen = false;\n    },\n    accionCrearElemento(e) {\n      const posPagina = this.$el.getBoundingClientRect();\n      const posClick = {\n        x: e.clientX - posPagina.left,\n        y: e.clientY - posPagina.top,\n      };\n\n      if (this.creandoTexto) {\n        this.dibujandoTexto = true;\n        this.$set(this.posFantasmaTexto, \"x\", Math.floor(posClick.x));\n        this.$set(this.posFantasmaTexto, \"y\", Math.floor(posClick.y));\n\n        this.$set(this.sizeFantasmaTexto, \"x\", 30);\n        this.$set(this.sizeFantasmaTexto, \"y\", 30);\n      } else if (this.creandoImagen) {\n        this.dibujandoImagen = true;\n        this.$set(this.posFantasmaImagen, \"x\", Math.floor(posClick.x));\n        this.$set(this.posFantasmaImagen, \"y\", Math.floor(posClick.y));\n\n        this.$set(this.sizeFantasmaImagen, \"x\", 30);\n        this.$set(this.sizeFantasmaImagen, \"y\", 30);\n      }\n    },\n    resizeFantasmaElemento(e) {\n      const posPagina = this.$el.getBoundingClientRect();\n      const posClick = {\n        x: e.clientX - posPagina.left,\n        y: e.clientY - posPagina.top,\n      };\n\n      if (this.dibujandoTexto) {\n        let sizeFantasma = {\n          x: posClick.x - this.posFantasmaTexto.x,\n          y: posClick.y - this.posFantasmaTexto.y,\n        };\n\n        if (sizeFantasma.x < 30) {\n          sizeFantasma.x = 30;\n        }\n        if (sizeFantasma.y < 30) {\n          sizeFantasma.y = 30;\n        }\n\n        this.$set(this.sizeFantasmaTexto, \"x\", Math.floor(sizeFantasma.x));\n        this.$set(this.sizeFantasmaTexto, \"y\", Math.floor(sizeFantasma.y));\n      }\n\n      if (this.dibujandoImagen) {\n        let sizeFantasma = {\n          x: posClick.x - this.posFantasmaImagen.x,\n          y: posClick.y - this.posFantasmaImagen.y,\n        };\n\n        if (sizeFantasma.x < 30) {\n          sizeFantasma.x = 30;\n        }\n        if (sizeFantasma.y < 30) {\n          sizeFantasma.y = 30;\n        }\n\n        this.$set(this.sizeFantasmaImagen, \"x\", Math.floor(sizeFantasma.x));\n        this.$set(this.sizeFantasmaImagen, \"y\", Math.floor(sizeFantasma.y));\n      }\n    },\n    endDibujandoElemento() {\n      if (this.dibujandoTexto) {\n        console.log(`Creando cuadroTexto`);\n        this.dibujandoTexto = false;\n        this.$refs.herramientasEdicion.reset();\n        this.crearTextoFromFantasma();\n      } else if (this.dibujandoImagen) {\n        console.log(`Creando cuadro de imágen`);\n        this.dibujandoImagen = false;\n        this.$refs.herramientasEdicion.reset();\n        this.crearCuadroImagenFromFantasma();\n      }\n      this.desactivarHerramientas();\n    },\n    crearCuadroImagenFromFantasma() {\n      var datosPosicion = {\n        x: Math.round((this.posFantasmaImagen.x * 100) / this.$el.offsetWidth),\n        y: Math.round((this.posFantasmaImagen.y * 100) / this.$el.offsetHeight),\n      };\n\n      var datosSize = {\n        x: Math.round((this.sizeFantasmaImagen.x * 100) / this.$el.offsetWidth),\n        y: Math.round(\n          (this.sizeFantasmaImagen.y * 100) / this.$el.offsetHeight\n        ),\n      };\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation(\n              $idLibro: ID!\n              $idPagina: ID!\n              $datosPosicion: CoordsInput!\n              $datosSize: CoordsInput!\n            ) {\n              crearCuadroImagenPaginaLibro(\n                idLibro: $idLibro\n                idPagina: $idPagina\n                datosPosicion: $datosPosicion\n                datosSize: $datosSize\n              ) {\n                ...fragCuadroImagen\n              }\n            }\n            ${fragmentoCuadroImagen}\n          `,\n          variables: {\n            idLibro: this.idLibro,\n            idPagina: this.estaPagina.id,\n            datosPosicion,\n            datosSize,\n          },\n        })\n        .then(({ data: { crearCuadroImagenPaginaLibro } }) => {\n          this.$emit(\"tengoNuevoCuadroImagen\", crearCuadroImagenPaginaLibro);\n        })\n        .catch((error) => {\n          console.log(`Error en mutación de crear cuadro imágen. E: ${error}`);\n        });\n    },\n    crearTextoFromFantasma() {\n      console.log(\n        `Enviando con ${JSON.stringify(this.idLibro)}, ${JSON.stringify(\n          this.estaPagina.id\n        )}, ${JSON.stringify(this.posFantasmaTexto)}, ${JSON.stringify(\n          this.sizeFantasmaTexto\n        )}`\n      );\n\n      var datosPosicion = {\n        x: Math.round((this.posFantasmaTexto.x * 100) / this.$el.offsetWidth),\n        y: Math.round((this.posFantasmaTexto.y * 100) / this.$el.offsetHeight),\n      };\n\n      var datosSize = {\n        x: Math.round((this.sizeFantasmaTexto.x * 100) / this.$el.offsetWidth),\n        y: Math.round((this.sizeFantasmaTexto.y * 100) / this.$el.offsetHeight),\n      };\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation(\n              $idLibro: ID!\n              $idPagina: ID!\n              $datosPosicion: CoordsInput!\n              $datosSize: CoordsInput!\n            ) {\n              crearCuadroTextoPaginaLibro(\n                idLibro: $idLibro\n                idPagina: $idPagina\n                datosPosicion: $datosPosicion\n                datosSize: $datosSize\n              ) {\n                ...fragCuadroTexto\n              }\n            }\n            ${fragmentoCuadroTexto}\n          `,\n          variables: {\n            idLibro: this.idLibro,\n            idPagina: this.estaPagina.id,\n            datosPosicion,\n            datosSize,\n          },\n          errorPolicy: \"all\",\n        })\n        .then(({ data: { crearCuadroTextoPaginaLibro } }) => {\n          this.$emit(\"tengoNuevoCuadroTexto\", crearCuadroTextoPaginaLibro);\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error.message}`);\n          console.log(`Hubo ${error.graphQLErrors} errores graphql`);\n        });\n    },\n    resolverSeleccion(e, idElemento){\n      if(this.seleccionada){\n        e.stopPropagation();\n        this.idElementoSeleccionado=idElemento;\n      }\n    }\n  },\n};\n</script>\n\n<style scoped>\n.pagina {\n  border: 2px solid black;\n  position: relative;\n  \n  user-select: none;\n}\n.cursorTexto{\ncursor:url('~../assets/iconos/punteroTexto.png'), default;\n}\n.cursorImagen{\ncursor:url('~../assets/iconos/punteroImagen.png'), default;\n}\n.segundoPlano {\n  opacity: 0.3;\n}\n.elementoPagina {\n  z-index: 100;\n}\n.primerPlano {\n  z-index: 500;\n}\n.seleccionada {\n  border-color: purple;\n  z-index: 2;\n}\n\n.zonaControlesPagina {\n  text-align: center;\n  padding: 10px;\n  position: absolute;\n  top: -60px;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.bControlesPagina {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n\n  cursor: pointer;\n  display: inline-block;\n  background-color: rgb(255, 231, 255);\n}\n\n#herramientasEdicion {\n  position: absolute;\n  top: 150px;\n  left: -100px;\n}\n.fantasmaElemento {\n  position: absolute;\n  border: 3px dotted purple;\n  border-radius: 5px;\n  background-color: rgba(128, 0, 128, 0.205);\n  box-sizing: border-box;\n}\n</style>"]}]}