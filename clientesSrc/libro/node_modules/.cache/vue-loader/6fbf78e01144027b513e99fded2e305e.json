{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/TodosLibros.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/TodosLibros.vue","mtime":1621177679639},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdxbCB9IGZyb20gImFwb2xsby1zZXJ2ZXItY29yZSI7CmltcG9ydCBJY29ub1BlcnNvbmFBdXRvbm9tbyBmcm9tICIuL0ljb25vUGVyc29uYUF1dG9ub21vLnZ1ZSI7Cgpjb25zdCBRVUVSWV9UT0RPU19MSUJST1MgPSBncWxgCiAgcXVlcnkgewogICAgdG9kb3NMaWJyb3MgewogICAgICBpZAogICAgICB0aXR1bG8KICAgICAgaWRzRWRpdG9yZXMKICAgIH0KICB9CmA7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBJY29ub1BlcnNvbmFBdXRvbm9tbyB9LAogIG5hbWU6ICJUb2Rvc0xpYnJvcyIsCiAgYXBvbGxvOiB7CiAgICB0b2Rvc0xpYnJvczogewogICAgICBxdWVyeTogUVVFUllfVE9ET1NfTElCUk9TLAogICAgICBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yOwogICAgICB9LAogICAgfSwKICB9LAogIHByb3BzOiB7CiAgICBpZExpYnJvU2VsZWNjaW9uYWRvOiBTdHJpbmcsCiAgICBVUkxMaWJyb3NvbG86IFN0cmluZywKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkZXNwbGVnYWRvOiBmYWxzZSwKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBzZWxlY2Npb25hckxpYnJvKGlkTGlicm8pIHsKICAgICAgdGhpcy4kZW1pdCgibGlicm9TZWxlY2Npb25hZG8iLCBpZExpYnJvKTsKICAgIH0sCiAgICByZW1vdmVyTGlicm9DYWNoZShpZExpYnJvKSB7CiAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQ7CiAgICAgIGNvbnN0IGNhY2hlID0gc3RvcmUucmVhZFF1ZXJ5KHsKICAgICAgICBxdWVyeTogUVVFUllfVE9ET1NfTElCUk9TLAogICAgICB9KTsKICAgICAgdmFyIG51ZXZvQ2FjaGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7CgogICAgICBjb25zdCBpbmRleEwgPSBudWV2b0NhY2hlLnRvZG9zTGlicm9zLmZpbmRJbmRleCgobCkgPT4gbC5pZCA9PSBpZExpYnJvKTsKICAgICAgaWYgKGluZGV4TCA+IC0xKSB7CiAgICAgICAgbnVldm9DYWNoZS50b2Rvc0xpYnJvcy5zcGxpY2UoaW5kZXhMLCAxKTsKICAgICAgICBzdG9yZS53cml0ZVF1ZXJ5KHsKICAgICAgICAgIHF1ZXJ5OiBRVUVSWV9UT0RPU19MSUJST1MsCiAgICAgICAgICBkYXRhOiBudWV2b0NhY2hlLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKGBMaWJybyBubyBlc3RhYmEgZW4gY2FjaMOpYCk7CiAgICAgIH0KICAgIH0sCiAgICBlbGltaW5hckxpYnJvKGlkTGlicm8pIHsKICAgICAgaWYgKCFjb25maXJtKCJFbGltaW5hbmRvIHVuIGxpYnJvLiDCv0NvbnRpbnVhcj8iKSkgcmV0dXJuOwoKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLm11dGF0ZSh7CiAgICAgICAgICBtdXRhdGlvbjogZ3FsYAogICAgICAgICAgICBtdXRhdGlvbigkaWRMaWJybzogSUQhKSB7CiAgICAgICAgICAgICAgZWxpbWluYXJMaWJybyhpZExpYnJvOiAkaWRMaWJybykKICAgICAgICAgICAgfQogICAgICAgICAgYCwKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICBpZExpYnJvLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKCh7IGRhdGE6IHsgZWxpbWluYXJMaWJybyB9IH0pID0+IHsKICAgICAgICAgIGlmIChlbGltaW5hckxpYnJvKSB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoImVsaW1pbmVVbkxpYnJvIiwgaWRMaWJybyk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3IuIEU6ICR7ZXJyb3J9YCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgCiAgfSwKICBjb21wdXRlZDogewogICAgdXN1YXJpb1N1cGVyYWRtaW5pc3RyYWRvcigpIHsKICAgICAgaWYgKCF0aGlzLnVzdWFyaW8gfHwgIXRoaXMudXN1YXJpby5wZXJtaXNvcykgewogICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgYERhdG9zIGluc3VmaWNpZW50ZXMgcGFyYSBkZWNpZGlyIHNpIHVzdWFyaW8gZXMgc8O6cGVyYWRtaW5pc3RyYWRvcmAKICAgICAgICApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMudXN1YXJpby5wZXJtaXNvcy5pbmNsdWRlcygic3VwZXJhZG1pbmlzdHJhZG9yIik7CiAgICB9LAogICAgbGlicm9zUG9yQXV0b3IoKSB7CiAgICAgIHZhciBvYmpldG9GaW5hbCA9IHsKICAgICAgICBzaW5BdXRvcjpbXQogICAgICB9OwogICAgICBpZiAoIXRoaXMudG9kb3NMaWJyb3MpIHsKICAgICAgICByZXR1cm4gb2JqZXRvRmluYWw7CiAgICAgIH0KICAgICAgdGhpcy50b2Rvc0xpYnJvcy5mb3JFYWNoKChsaWJybykgPT4geyAgCiAgICAgICAgaWYobGlicm8uaWRzRWRpdG9yZXMubGVuZ3RoPDEpewogICAgICAgICAgb2JqZXRvRmluYWwuc2luQXV0b3IucHVzaChsaWJybyk7CiAgICAgICAgfSAgICAgIAogICAgICAgIGVsc2V7CiAgICAgICAgICBsZXQgaWRBdXRvciA9IGxpYnJvLmlkc0VkaXRvcmVzWzBdOwogICAgICAgICAgaWYgKCFvYmpldG9GaW5hbFtpZEF1dG9yXSkgewogICAgICAgICAgICBvYmpldG9GaW5hbFtpZEF1dG9yXSA9IFtsaWJyb107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvYmpldG9GaW5hbFtpZEF1dG9yXS5wdXNoKGxpYnJvKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgIH0pOwogICAgICByZXR1cm4gb2JqZXRvRmluYWw7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["TodosLibros.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"TodosLibros.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"todosLibros\">\n    <h4\n      style=\"cursor: pointer\"\n      class=\"tituloZona\"\n      @click=\"desplegado = !desplegado\"\n    >\n     <div class=\"trianguloBullet\" :style=\"{transform: desplegado?'rotateZ(90deg)':'rotateZ(0deg)'}\"></div>\n      Todos los libros\n    </h4>\n    <div id=\"controlesTodosLibros\"></div>\n\n    <img\n      src=\"@/assets/iconos/loading.png\"\n      alt=\"Cargando\"\n      class=\"simboloLoading\"\n      style=\"width: 20px; margin: 10px auto; display: block\"\n      v-show=\"desplegado && $apollo.queries.todosLibros.loading\"\n    />\n\n    <div id=\"listaMisLibros\" v-show=\"desplegado\">\n      <div\n        class=\"bloqueAutor\"\n        v-for=\"(listaLibros, idAutor) of librosPorAutor\"\n        :key=\"idAutor\"\n      >\n        <icono-persona-autonomo :idPersona=\"idAutor\" v-if=\"idAutor!='sinAutor'\"/>\n        <br />\n        <br />\n        <br />\n        <div class=\"listaLibros\">\n          <div\n            class=\"portadaLibro\"\n            v-for=\"portada of listaLibros\"\n            :key=\"portada.id\"\n            @click=\"seleccionarLibro(portada.id)\"\n            :class=\"{ seleccionado: idLibroSeleccionado == portada.id }\"\n          >\n            <div class=\"bulletPortada\"></div>\n\n            <div class=\"nombreLibro\">\n              {{ portada.titulo }}\n            </div>\n            <div class=\"controlesLibro\" @click.stop=\"\">\n              <img\n                src=\"@/assets/iconos/delete.png\"\n                alt=\"Eliminar\"\n                title=\"Eliminar este libro\"\n                class=\"controlLibro\"\n                v-show=\"usuarioSuperadministrador\"\n                @click.stop=\"eliminarLibro(portada.id)\"\n              />\n              <a\n                :href=\"URLLibrosolo + '?id=' + portada.id\"\n                target=\"_blank\"                \n              >\n                <img\n                  src=\"@/assets/iconos/libroAbierto.png\"\n                  class=\"controlLibro\"\n                  alt=\"Libro\"\n                  title=\"Ver libro\"\n                />\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport IconoPersonaAutonomo from \"./IconoPersonaAutonomo.vue\";\n\nconst QUERY_TODOS_LIBROS = gql`\n  query {\n    todosLibros {\n      id\n      titulo\n      idsEditores\n    }\n  }\n`;\n\nexport default {\n  components: { IconoPersonaAutonomo },\n  name: \"TodosLibros\",\n  apollo: {\n    todosLibros: {\n      query: QUERY_TODOS_LIBROS,\n      skip() {\n        return !this.usuarioSuperadministrador;\n      },\n    },\n  },\n  props: {\n    idLibroSeleccionado: String,\n    URLLibrosolo: String,\n  },\n  data() {\n    return {\n      desplegado: false,\n    };\n  },\n  methods: {\n    seleccionarLibro(idLibro) {\n      this.$emit(\"libroSeleccionado\", idLibro);\n    },\n    removerLibroCache(idLibro) {\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_TODOS_LIBROS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      const indexL = nuevoCache.todosLibros.findIndex((l) => l.id == idLibro);\n      if (indexL > -1) {\n        nuevoCache.todosLibros.splice(indexL, 1);\n        store.writeQuery({\n          query: QUERY_TODOS_LIBROS,\n          data: nuevoCache,\n        });\n      } else {\n        console.log(`Libro no estaba en caché`);\n      }\n    },\n    eliminarLibro(idLibro) {\n      if (!confirm(\"Eliminando un libro. ¿Continuar?\")) return;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!) {\n              eliminarLibro(idLibro: $idLibro)\n            }\n          `,\n          variables: {\n            idLibro,\n          },\n        })\n        .then(({ data: { eliminarLibro } }) => {\n          if (eliminarLibro) {\n            this.$emit(\"elimineUnLibro\", idLibro);\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    \n  },\n  computed: {\n    usuarioSuperadministrador() {\n      if (!this.usuario || !this.usuario.permisos) {\n        console.log(\n          `Datos insuficientes para decidir si usuario es súperadministrador`\n        );\n        return false;\n      }\n\n      return this.usuario.permisos.includes(\"superadministrador\");\n    },\n    librosPorAutor() {\n      var objetoFinal = {\n        sinAutor:[]\n      };\n      if (!this.todosLibros) {\n        return objetoFinal;\n      }\n      this.todosLibros.forEach((libro) => {  \n        if(libro.idsEditores.length<1){\n          objetoFinal.sinAutor.push(libro);\n        }      \n        else{\n          let idAutor = libro.idsEditores[0];\n          if (!objetoFinal[idAutor]) {\n            objetoFinal[idAutor] = [libro];\n          } else {\n            objetoFinal[idAutor].push(libro);\n          }\n        }\n        \n      });\n      return objetoFinal;\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>"]}]}