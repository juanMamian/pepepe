{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/Pagina.vue?vue&type=style&index=0&id=39498ab6&scoped=true&lang=css&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/Pagina.vue","mtime":1617579055414},{"path":"/home/juan/webPj/pepepe/libro/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucGFnaW5hIHsKICBib3JkZXI6IDJweCBzb2xpZCBibGFjazsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgei1pbmRleDogMDsKICB1c2VyLXNlbGVjdDogbm9uZTsKfQoKLnNlZ3VuZG9QbGFubyB7CiAgb3BhY2l0eTogMC4zOwp9Ci5lbGVtZW50b1BhZ2luYXsKICB6LWluZGV4OjEwMDsKfQoucHJpbWVyUGxhbm97CiAgei1pbmRleDogNTAwOwp9Ci5zZWxlY2Npb25hZGEgewogIGJvcmRlci1jb2xvcjogcHVycGxlOwp9Cgouem9uYUNvbnRyb2xlc1BhZ2luYSB7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHBhZGRpbmc6IDEwcHg7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogLTYwcHg7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKfQoKLmJDb250cm9sZXNQYWdpbmEgewogIHdpZHRoOiAzMHB4OwogIGhlaWdodDogMzBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CgogIGN1cnNvcjogcG9pbnRlcjsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjMxLCAyNTUpOwp9CgojaGVycmFtaWVudGFzRWRpY2lvbiB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMTUwcHg7CiAgbGVmdDogLTEwMHB4Owp9Ci5mYW50YXNtYUVsZW1lbnRvewogIHBvc2l0aW9uOmFic29sdXRlOwogIGJvcmRlcjozcHggZG90dGVkIHB1cnBsZTsKICBib3JkZXItcmFkaXVzOiA1cHg7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgxMjgsIDAsIDEyOCwgMC4yMDUpOwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7Cn0K"},{"version":3,"sources":["Pagina.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsXA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Pagina.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"pagina\"\n    :style=\"[estiloColumna, estiloSize, estiloApariencia]\"\n    :class=\"{ seleccionada, deshabilitado: uploadingInfo, segundoPlano }\"\n    @mousedown.left.stop=\"accionCrearElemento\"\n    @mousemove=\"resizeFantasmaElemento\"\n    @mouseup=\"endDibujandoElemento\"\n    @click=\"idElementoSeleccionado=null\"\n  >\n    <div class=\"zonaControlesPagina\" v-show=\"seleccionada\">\n      <img\n        src=\"@/assets/iconos/delete.png\"\n        class=\"bControlesPagina bEliminarPagina\"\n        @click=\"eliminarse\"\n      />\n    </div>\n\n    <herramientas-edicion\n      v-show=\"seleccionada\"\n      ref=\"herramientasEdicion\"\n      @creacionTexto=\"\n        desactivarHerramientas();\n        creandoTexto = true;\n      \"\n      @creacionImagen=\"\n        desactivarHerramientas();\n        creandoImagen = true;\n      \"\n    />\n\n    <div id=\"fantasmaTexto\" class=\"fantasmaElemento\" :style=\"[estiloLayoutFantasmaTexto]\" v-show=\"dibujandoTexto\"></div>\n    <div id=\"fantasmaImagen\" class=\"fantasmaElemento\" :style=\"[estiloLayoutFantasmaImagen]\" v-show=\"dibujandoImagen\"></div>\n\n    <cuadro-imagen\n      v-for=\"cuadroImagen of estaPagina.cuadrosImagen\"\n      class=\"elementoPagina\"\n      :key=\"cuadroImagen.id\"\n      :esteCuadroImagen=\"cuadroImagen\"\n      :idLibro=\"idLibro\"\n      :idPagina=\"estaPagina.id\"\n      :sizePagina=\"size\"\n    />\n\n    <cuadro-texto\n      v-for=\"cuadroTexto of estaPagina.cuadrosTexto\"\n      class=\"elementoPagina\"\n      :class=\"{primerPlano:idElementoSeleccionado==cuadroTexto.id}\"\n      :key=\"cuadroTexto.id\"\n      :esteCuadroTexto=\"cuadroTexto\"\n      :idLibro=\"idLibro\"\n      :idPagina=\"estaPagina.id\"\n      :sizePagina=\"size\"\n      :seleccionado=\"idElementoSeleccionado==cuadroTexto.id\"\n      @click.native.stop=\"idElementoSeleccionado=cuadroTexto.id\"\n      @meElimine=\"$emit('elimineCuadroTexto', cuadroTexto.id)\"\n    />\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport CuadroImagen from \"./CuadroImagen.vue\";\nimport CuadroTexto from \"./CuadroTexto.vue\";\nimport HerramientasEdicion from \"./HerramientasEdicion.vue\";\nimport { fragmentoCuadroImagen, fragmentoCuadroTexto } from './Libro.vue';\n\nexport default {\n  components: { CuadroImagen, CuadroTexto, HerramientasEdicion },\n  name: \"Pagina\",\n  props: {\n    estaPagina: Object,\n    paginaDerecha: Boolean,\n    preparada: {\n      type: Boolean,\n      default: false,\n    },\n    visible: {\n      type: Boolean,\n    },\n    idLibro: String,\n    seleccionada: Boolean,\n    segundoPlano: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      ancho: 450,\n      alto: 600,\n      uploadingInfo: false,\n\n      creandoTexto: false,\n      creandoImagen: false,\n\n      dibujandoTexto: false,\n      dibujandoImagen: false,\n\n      posFantasmaTexto: {\n        x: 0,\n        y: 0,\n      },\n      sizeFantasmaTexto: {\n        x: 30,\n        y: 30,\n      },\n\n      posFantasmaImagen: {\n        x: 0,\n        y: 0,\n      },\n      sizeFantasmaImagen: {\n        x: 30,\n        y: 30,\n      },\n\n      idElementoSeleccionado:null,\n    };\n  },\n  computed: {\n    estiloColumna() {\n      if (this.paginaDerecha) {\n        return {\n          gridColumn: \"1/2\",\n          justifySelf: \"right\",\n        };\n      }\n      return null;\n    },\n    estiloSize() {\n      return {\n        width: this.ancho + \"px\",\n        height: this.alto + \"px\",\n      };\n    },\n    size() {\n      return {\n        x: this.ancho,\n        y: this.alto,\n      };\n    },\n    estiloApariencia() {\n      return {\n        backgroundColor: this.estaPagina.color,\n      };\n    },\n    estiloLayoutFantasmaTexto(){\n      return {\n        top: this.posFantasmaTexto.y+\"px\",\n        left: this.posFantasmaTexto.x+\"px\",\n        width: this.sizeFantasmaTexto.x+\"px\",\n        height: this.sizeFantasmaTexto.y+\"px\"\n      }\n    },\n    estiloLayoutFantasmaImagen(){\n      return {\n        top: this.posFantasmaImagen.y+\"px\",\n        left: this.posFantasmaImagen.x+\"px\",\n        width: this.sizeFantasmaImagen.x+\"px\",\n        height: this.sizeFantasmaImagen.y+\"px\"\n      }\n    }\n  },\n  methods: {\n    eliminarse() {\n      if (\n        !confirm(\n          \"Eliminando página. Esta operación no se puede deshacer. ¿Continuar?\"\n        )\n      ) {\n        return;\n      }\n      this.uploadingInfo = true;\n      console.log(`Eliminando una página`);\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!, $idPagina: ID!) {\n              eliminarPaginaDeLibro(idLibro: $idLibro, idPagina: $idPagina)\n            }\n          `,\n          variables: {\n            idLibro: this.idLibro,\n            idPagina: this.estaPagina.id,\n          },\n        })\n        .then(({ data: { eliminarPaginaDeLibro } }) => {\n          console.log(`Resultado: ${eliminarPaginaDeLibro}`);\n          if (eliminarPaginaDeLibro) {\n            this.$emit(\"meElimine\");\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n          this.uploadingInfo = false;\n        });\n    },\n    desactivarHerramientas() {\n      this.creandoTexto = false;\n      this.creandoImagen = false;\n    },\n    accionCrearElemento(e) {\n      const posPagina = this.$el.getBoundingClientRect();\n      const posClick = {\n        x: e.clientX - posPagina.left,\n        y: e.clientY - posPagina.top,\n      };\n\n      if (this.creandoTexto) {\n        this.dibujandoTexto = true;\n        this.$set(this.posFantasmaTexto, \"x\", Math.floor(posClick.x));\n        this.$set(this.posFantasmaTexto, \"y\", Math.floor(posClick.y));\n\n        this.$set(this.sizeFantasmaTexto, \"x\", 30);\n        this.$set(this.sizeFantasmaTexto, \"y\", 30);\n\n      } else if (this.creandoImagen) {\n        this.dibujandoImagen = true;\n        this.$set(this.posFantasmaImagen, \"x\", Math.floor(posClick.x));\n        this.$set(this.posFantasmaImagen, \"y\", Math.floor(posClick.y));\n\n        this.$set(this.sizeFantasmaImagen, \"x\", 30);\n        this.$set(this.sizeFantasmaImagen, \"y\", 30);\n      }\n    },\n    resizeFantasmaElemento(e) {\n      const posPagina = this.$el.getBoundingClientRect();\n      const posClick = {\n        x: e.clientX - posPagina.left,\n        y: e.clientY - posPagina.top,\n      };\n\n      if (this.dibujandoTexto) {\n        let sizeFantasma = {\n          x: posClick.x - this.posFantasmaTexto.x,\n          y: posClick.y - this.posFantasmaTexto.y,\n        };\n\n        if(sizeFantasma.x<30){\n          sizeFantasma.x=30\n        }\n        if(sizeFantasma.y<30){\n          sizeFantasma.y=30\n        }\n\n        this.$set(this.sizeFantasmaTexto, \"x\", Math.floor(sizeFantasma.x));\n        this.$set(this.sizeFantasmaTexto, \"y\", Math.floor(sizeFantasma.y));\n      }\n\n      if (this.dibujandoImagen) {\n        let sizeFantasma = {\n          x: posClick.x - this.posFantasmaImagen.x,\n          y: posClick.y - this.posFantasmaImagen.y,\n        };\n\n        if(sizeFantasma.x<30){\n          sizeFantasma.x=30\n        }\n        if(sizeFantasma.y<30){\n          sizeFantasma.y=30\n        }\n\n        this.$set(this.sizeFantasmaImagen, \"x\", Math.floor(sizeFantasma.x));\n        this.$set(this.sizeFantasmaImagen, \"y\", Math.floor(sizeFantasma.y));\n      }\n    },\n    endDibujandoElemento(){\n      if(this.dibujandoTexto){\n        console.log(`Creando cuadroTexto`);\n        this.dibujandoTexto=false;\n        this.$refs.herramientasEdicion.reset();\n        this.crearTextoFromFantasma();\n      }\n      else if(this.dibujandoImagen){\n        console.log(`Creando cuadro de imágen`);\n        this.dibujandoImagen=false;\n        this.$refs.herramientasEdicion.reset();\n\n        this.uploadingInfo=true;\n\n        this.$apollo.mutate({\n          mutation:gql`\n            mutation($idLibro:ID!, $idPagina:ID!)\n          `,\n        })\n\n        axios({\n          method: \"post\",\n          url: this.serverUrl + \"/apiCuentos/subirArchivoCuadroImagen\",\n          data: datos,\n          headers: {\n            \"Content-Type\": \"multipart/form-data\",\n            Authorization: \"Bearer \" + this.$store.state.token,\n          },\n        }).then(()=>{\n\n        });\n      }\n      this.desactivarHerramientas();\n    },\n    crearCuadroImagenFromFantasma(){\n      var datosPosicion={\n        x:Math.round(this.posFantasmaTexto.x*100/this.$el.offsetWidth),\n        y:Math.round(this.posFantasmaTexto.y*100/this.$el.offsetHeight),\n      }\n\n      var datosSize={\n        x:Math.round(this.sizeFantasmaTexto.x*100/this.$el.offsetWidth),\n        y:Math.round(this.sizeFantasmaTexto.y*100/this.$el.offsetHeight),\n      }\n\n      this.$apollo.mutate({\n        mutation:gql`\n          mutation($idLibro:ID!, $idPagina:ID!, $datosPosicion:CoordsInput!, $datosSize:CoordsInput!){\n            crearCuadroImagenPaginaLibro(idLibro:$idLibro, idPagina:$idPagina, datosPosicion:$datosPosicion, datosSize:$datosSize){\n              ...fragCuadroImagen\n            }\n          }\n          ${fragmentoCuadroImagen}\n        `,\n        variables:{\n          idLibro:this.idLibro,\n          idPagina:this.estaPagina.id,\n          datosPosicion,\n          datosSize,\n        }\n      }).then(({data:{crearCuadroImagenPaginaLibro}})=>{\n        this.$emit(\"tengoNuevoCuadroImagen\", crearCuadroImagenPaginaLibro);\n      }).catch((error)=>{\n        console.log(`Error. E: ${error}`);\n      })\n    },\n    crearTextoFromFantasma(){\n      console.log(`Enviando con ${JSON.stringify(this.idLibro)}, ${JSON.stringify(this.estaPagina.id)}, ${JSON.stringify(this.posFantasmaTexto)}, ${JSON.stringify(this.sizeFantasmaTexto)}`);\n\n      var datosPosicion={\n        x:Math.round(this.posFantasmaTexto.x*100/this.$el.offsetWidth),\n        y:Math.round(this.posFantasmaTexto.y*100/this.$el.offsetHeight),\n      }\n\n      var datosSize={\n        x:Math.round(this.sizeFantasmaTexto.x*100/this.$el.offsetWidth),\n        y:Math.round(this.sizeFantasmaTexto.y*100/this.$el.offsetHeight),\n      }\n\n      this.$apollo.mutate({\n        mutation:gql`\n          mutation($idLibro:ID!, $idPagina: ID!, $datosPosicion:CoordsInput!, $datosSize:CoordsInput!){\n            crearCuadroTextoPaginaLibro(idLibro:$idLibro, idPagina:$idPagina, datosPosicion:$datosPosicion, datosSize:$datosSize){\n              ...fragCuadroTexto\n            }\n          }\n          ${fragmentoCuadroTexto}\n        `,\n        variables:{\n          idLibro:this.idLibro,\n          idPagina:this.estaPagina.id,\n          datosPosicion,\n          datosSize\n        },\n        errorPolicy:\"all\"\n      }).then(({data:{crearCuadroTextoPaginaLibro}})=>{\n        this.$emit(\"tengoNuevoCuadroTexto\", crearCuadroTextoPaginaLibro);\n      }).catch((error)=>{\n        console.log(`Error. E: ${error.message}`);\n        console.log(`Hubo ${error.graphQLErrors} errores graphql`);\n      })\n    }\n  },\n};\n</script>\n\n<style scoped>\n.pagina {\n  border: 2px solid black;\n  position: relative;\n  z-index: 0;\n  user-select: none;\n}\n\n.segundoPlano {\n  opacity: 0.3;\n}\n.elementoPagina{\n  z-index:100;\n}\n.primerPlano{\n  z-index: 500;\n}\n.seleccionada {\n  border-color: purple;\n}\n\n.zonaControlesPagina {\n  text-align: center;\n  padding: 10px;\n  position: absolute;\n  top: -60px;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.bControlesPagina {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n\n  cursor: pointer;\n  display: inline-block;\n  background-color: rgb(255, 231, 255);\n}\n\n#herramientasEdicion {\n  position: absolute;\n  top: 150px;\n  left: -100px;\n}\n.fantasmaElemento{\n  position:absolute;\n  border:3px dotted purple;\n  border-radius: 5px;\n  background-color: rgba(128, 0, 128, 0.205);\n  box-sizing: border-box;\n}\n</style>"]}]}