{"remainingRequest":"/home/juan/webPj/pepepe/libro/node_modules/babel-loader/lib/index.js!/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/juan/webPj/pepepe/libro/src/components/TodosLibros.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/juan/webPj/pepepe/libro/src/components/TodosLibros.vue","mtime":1621177679639},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/juan/webPj/pepepe/libro/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90YWdnZWRUZW1wbGF0ZUxpdGVyYWwgZnJvbSAiL2hvbWUvanVhbi93ZWJQai9wZXBlcGUvbGlicm8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RhZ2dlZFRlbXBsYXRlTGl0ZXJhbCI7Cgp2YXIgX3RlbXBsYXRlT2JqZWN0LCBfdGVtcGxhdGVPYmplY3QyOwoKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCB7IGdxbCB9IGZyb20gImFwb2xsby1zZXJ2ZXItY29yZSI7CmltcG9ydCBJY29ub1BlcnNvbmFBdXRvbm9tbyBmcm9tICIuL0ljb25vUGVyc29uYUF1dG9ub21vLnZ1ZSI7CnZhciBRVUVSWV9UT0RPU19MSUJST1MgPSBncWwoX3RlbXBsYXRlT2JqZWN0IHx8IChfdGVtcGxhdGVPYmplY3QgPSBfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsKFsiXG4gIHF1ZXJ5IHtcbiAgICB0b2Rvc0xpYnJvcyB7XG4gICAgICBpZFxuICAgICAgdGl0dWxvXG4gICAgICBpZHNFZGl0b3Jlc1xuICAgIH1cbiAgfVxuIl0pKSk7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBJY29ub1BlcnNvbmFBdXRvbm9tbzogSWNvbm9QZXJzb25hQXV0b25vbW8KICB9LAogIG5hbWU6ICJUb2Rvc0xpYnJvcyIsCiAgYXBvbGxvOiB7CiAgICB0b2Rvc0xpYnJvczogewogICAgICBxdWVyeTogUVVFUllfVE9ET1NfTElCUk9TLAogICAgICBza2lwOiBmdW5jdGlvbiBza2lwKCkgewogICAgICAgIHJldHVybiAhdGhpcy51c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yOwogICAgICB9CiAgICB9CiAgfSwKICBwcm9wczogewogICAgaWRMaWJyb1NlbGVjY2lvbmFkbzogU3RyaW5nLAogICAgVVJMTGlicm9zb2xvOiBTdHJpbmcKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkZXNwbGVnYWRvOiBmYWxzZQogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNlbGVjY2lvbmFyTGlicm86IGZ1bmN0aW9uIHNlbGVjY2lvbmFyTGlicm8oaWRMaWJybykgewogICAgICB0aGlzLiRlbWl0KCJsaWJyb1NlbGVjY2lvbmFkbyIsIGlkTGlicm8pOwogICAgfSwKICAgIHJlbW92ZXJMaWJyb0NhY2hlOiBmdW5jdGlvbiByZW1vdmVyTGlicm9DYWNoZShpZExpYnJvKSB7CiAgICAgIHZhciBzdG9yZSA9IHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50OwogICAgICB2YXIgY2FjaGUgPSBzdG9yZS5yZWFkUXVlcnkoewogICAgICAgIHF1ZXJ5OiBRVUVSWV9UT0RPU19MSUJST1MKICAgICAgfSk7CiAgICAgIHZhciBudWV2b0NhY2hlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjYWNoZSkpOwogICAgICB2YXIgaW5kZXhMID0gbnVldm9DYWNoZS50b2Rvc0xpYnJvcy5maW5kSW5kZXgoZnVuY3Rpb24gKGwpIHsKICAgICAgICByZXR1cm4gbC5pZCA9PSBpZExpYnJvOwogICAgICB9KTsKCiAgICAgIGlmIChpbmRleEwgPiAtMSkgewogICAgICAgIG51ZXZvQ2FjaGUudG9kb3NMaWJyb3Muc3BsaWNlKGluZGV4TCwgMSk7CiAgICAgICAgc3RvcmUud3JpdGVRdWVyeSh7CiAgICAgICAgICBxdWVyeTogUVVFUllfVE9ET1NfTElCUk9TLAogICAgICAgICAgZGF0YTogbnVldm9DYWNoZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJMaWJybyBubyBlc3RhYmEgZW4gY2FjaFx4RTkiKTsKICAgICAgfQogICAgfSwKICAgIGVsaW1pbmFyTGlicm86IGZ1bmN0aW9uIGVsaW1pbmFyTGlicm8oaWRMaWJybykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKCFjb25maXJtKCJFbGltaW5hbmRvIHVuIGxpYnJvLiDCv0NvbnRpbnVhcj8iKSkgcmV0dXJuOwogICAgICB0aGlzLiRhcG9sbG8ubXV0YXRlKHsKICAgICAgICBtdXRhdGlvbjogZ3FsKF90ZW1wbGF0ZU9iamVjdDIgfHwgKF90ZW1wbGF0ZU9iamVjdDIgPSBfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsKFsiXG4gICAgICAgICAgICBtdXRhdGlvbigkaWRMaWJybzogSUQhKSB7XG4gICAgICAgICAgICAgIGVsaW1pbmFyTGlicm8oaWRMaWJybzogJGlkTGlicm8pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgIl0pKSksCiAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICBpZExpYnJvOiBpZExpYnJvCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIGVsaW1pbmFyTGlicm8gPSBfcmVmLmRhdGEuZWxpbWluYXJMaWJybzsKCiAgICAgICAgaWYgKGVsaW1pbmFyTGlicm8pIHsKICAgICAgICAgIF90aGlzLiRlbWl0KCJlbGltaW5lVW5MaWJybyIsIGlkTGlicm8pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coIkVycm9yLiBFOiAiLmNvbmNhdChlcnJvcikpOwogICAgICB9KTsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICB1c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yOiBmdW5jdGlvbiB1c3VhcmlvU3VwZXJhZG1pbmlzdHJhZG9yKCkgewogICAgICBpZiAoIXRoaXMudXN1YXJpbyB8fCAhdGhpcy51c3VhcmlvLnBlcm1pc29zKSB7CiAgICAgICAgY29uc29sZS5sb2coIkRhdG9zIGluc3VmaWNpZW50ZXMgcGFyYSBkZWNpZGlyIHNpIHVzdWFyaW8gZXMgc1x4RkFwZXJhZG1pbmlzdHJhZG9yIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy51c3VhcmlvLnBlcm1pc29zLmluY2x1ZGVzKCJzdXBlcmFkbWluaXN0cmFkb3IiKTsKICAgIH0sCiAgICBsaWJyb3NQb3JBdXRvcjogZnVuY3Rpb24gbGlicm9zUG9yQXV0b3IoKSB7CiAgICAgIHZhciBvYmpldG9GaW5hbCA9IHsKICAgICAgICBzaW5BdXRvcjogW10KICAgICAgfTsKCiAgICAgIGlmICghdGhpcy50b2Rvc0xpYnJvcykgewogICAgICAgIHJldHVybiBvYmpldG9GaW5hbDsKICAgICAgfQoKICAgICAgdGhpcy50b2Rvc0xpYnJvcy5mb3JFYWNoKGZ1bmN0aW9uIChsaWJybykgewogICAgICAgIGlmIChsaWJyby5pZHNFZGl0b3Jlcy5sZW5ndGggPCAxKSB7CiAgICAgICAgICBvYmpldG9GaW5hbC5zaW5BdXRvci5wdXNoKGxpYnJvKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGlkQXV0b3IgPSBsaWJyby5pZHNFZGl0b3Jlc1swXTsKCiAgICAgICAgICBpZiAoIW9iamV0b0ZpbmFsW2lkQXV0b3JdKSB7CiAgICAgICAgICAgIG9iamV0b0ZpbmFsW2lkQXV0b3JdID0gW2xpYnJvXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9iamV0b0ZpbmFsW2lkQXV0b3JdLnB1c2gobGlicm8pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBvYmpldG9GaW5hbDsKICAgIH0KICB9Cn07"},{"version":3,"sources":["TodosLibros.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div id=\"todosLibros\">\n    <h4\n      style=\"cursor: pointer\"\n      class=\"tituloZona\"\n      @click=\"desplegado = !desplegado\"\n    >\n     <div class=\"trianguloBullet\" :style=\"{transform: desplegado?'rotateZ(90deg)':'rotateZ(0deg)'}\"></div>\n      Todos los libros\n    </h4>\n    <div id=\"controlesTodosLibros\"></div>\n\n    <img\n      src=\"@/assets/iconos/loading.png\"\n      alt=\"Cargando\"\n      class=\"simboloLoading\"\n      style=\"width: 20px; margin: 10px auto; display: block\"\n      v-show=\"desplegado && $apollo.queries.todosLibros.loading\"\n    />\n\n    <div id=\"listaMisLibros\" v-show=\"desplegado\">\n      <div\n        class=\"bloqueAutor\"\n        v-for=\"(listaLibros, idAutor) of librosPorAutor\"\n        :key=\"idAutor\"\n      >\n        <icono-persona-autonomo :idPersona=\"idAutor\" v-if=\"idAutor!='sinAutor'\"/>\n        <br />\n        <br />\n        <br />\n        <div class=\"listaLibros\">\n          <div\n            class=\"portadaLibro\"\n            v-for=\"portada of listaLibros\"\n            :key=\"portada.id\"\n            @click=\"seleccionarLibro(portada.id)\"\n            :class=\"{ seleccionado: idLibroSeleccionado == portada.id }\"\n          >\n            <div class=\"bulletPortada\"></div>\n\n            <div class=\"nombreLibro\">\n              {{ portada.titulo }}\n            </div>\n            <div class=\"controlesLibro\" @click.stop=\"\">\n              <img\n                src=\"@/assets/iconos/delete.png\"\n                alt=\"Eliminar\"\n                title=\"Eliminar este libro\"\n                class=\"controlLibro\"\n                v-show=\"usuarioSuperadministrador\"\n                @click.stop=\"eliminarLibro(portada.id)\"\n              />\n              <a\n                :href=\"URLLibrosolo + '?id=' + portada.id\"\n                target=\"_blank\"                \n              >\n                <img\n                  src=\"@/assets/iconos/libroAbierto.png\"\n                  class=\"controlLibro\"\n                  alt=\"Libro\"\n                  title=\"Ver libro\"\n                />\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { gql } from \"apollo-server-core\";\nimport IconoPersonaAutonomo from \"./IconoPersonaAutonomo.vue\";\n\nconst QUERY_TODOS_LIBROS = gql`\n  query {\n    todosLibros {\n      id\n      titulo\n      idsEditores\n    }\n  }\n`;\n\nexport default {\n  components: { IconoPersonaAutonomo },\n  name: \"TodosLibros\",\n  apollo: {\n    todosLibros: {\n      query: QUERY_TODOS_LIBROS,\n      skip() {\n        return !this.usuarioSuperadministrador;\n      },\n    },\n  },\n  props: {\n    idLibroSeleccionado: String,\n    URLLibrosolo: String,\n  },\n  data() {\n    return {\n      desplegado: false,\n    };\n  },\n  methods: {\n    seleccionarLibro(idLibro) {\n      this.$emit(\"libroSeleccionado\", idLibro);\n    },\n    removerLibroCache(idLibro) {\n      const store = this.$apollo.provider.defaultClient;\n      const cache = store.readQuery({\n        query: QUERY_TODOS_LIBROS,\n      });\n      var nuevoCache = JSON.parse(JSON.stringify(cache));\n\n      const indexL = nuevoCache.todosLibros.findIndex((l) => l.id == idLibro);\n      if (indexL > -1) {\n        nuevoCache.todosLibros.splice(indexL, 1);\n        store.writeQuery({\n          query: QUERY_TODOS_LIBROS,\n          data: nuevoCache,\n        });\n      } else {\n        console.log(`Libro no estaba en caché`);\n      }\n    },\n    eliminarLibro(idLibro) {\n      if (!confirm(\"Eliminando un libro. ¿Continuar?\")) return;\n\n      this.$apollo\n        .mutate({\n          mutation: gql`\n            mutation($idLibro: ID!) {\n              eliminarLibro(idLibro: $idLibro)\n            }\n          `,\n          variables: {\n            idLibro,\n          },\n        })\n        .then(({ data: { eliminarLibro } }) => {\n          if (eliminarLibro) {\n            this.$emit(\"elimineUnLibro\", idLibro);\n          }\n        })\n        .catch((error) => {\n          console.log(`Error. E: ${error}`);\n        });\n    },\n    \n  },\n  computed: {\n    usuarioSuperadministrador() {\n      if (!this.usuario || !this.usuario.permisos) {\n        console.log(\n          `Datos insuficientes para decidir si usuario es súperadministrador`\n        );\n        return false;\n      }\n\n      return this.usuario.permisos.includes(\"superadministrador\");\n    },\n    librosPorAutor() {\n      var objetoFinal = {\n        sinAutor:[]\n      };\n      if (!this.todosLibros) {\n        return objetoFinal;\n      }\n      this.todosLibros.forEach((libro) => {  \n        if(libro.idsEditores.length<1){\n          objetoFinal.sinAutor.push(libro);\n        }      \n        else{\n          let idAutor = libro.idsEditores[0];\n          if (!objetoFinal[idAutor]) {\n            objetoFinal[idAutor] = [libro];\n          } else {\n            objetoFinal[idAutor].push(libro);\n          }\n        }\n        \n      });\n      return objetoFinal;\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>"],"sourceRoot":"src/components"}]}